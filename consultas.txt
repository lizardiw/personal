

 federales
4 opb
5 cancun 
1 cozume
3 isla   
2 carrillo                                                                   
6 jmm
7 laz car
8 soli   
9 tulum
bacalar





estatales nom hosp 

www.prevenissste.gob.mx programa prevenissstec

\\cz-centro\c$\Inetpub\wwwroot\ingresos2010\control_obligaciones\reportes\templates
\\ch-sarh2\c$
\\ch-sar
\\op-centro
                                                                                                 

--CONSULTA QUE ORDENA LOS ARTICULOS DE LA LEY EN ORDEN ASCENDENTE
SELECT     Id, Articulo, Descripcion, Salarios_Minimos_Minimo, Salarios_Minimos_Maximo, Hecho_Transito, Reincidencia, Dias_Habiles_Descuento_Automatico, 
             Porciento_Descuento_Automatico, Dias_Naturales_Recargos_Moratorios, Porcentaje_Recargos_Moratorios_Mensuales, Estatus, Texto, 
             Articulo AS Expr1
FROM         TInf_Tipo_Infraccion
ORDER BY CONVERT(Int, Articulo)

--------

DELETE FROM Store_Information
WHERE store_name = "Los Angeles"

---UPDATE
UPDATE "nombre_tabla"
SET "columna_1" = [nuevo valor]
WHERE {condición


----INSERT
INSERT INTO Customers (CustomerID, CompanyName, Country, Phone) VALUES ('WWI', 'Wide Wsiorld Importers', 'USA', '206-321-8765')

--ELIMINAR UNA COLUMNA Y CREAR UNA NUEVA DE UNA TABLA
ALTER TABLE Nombre_tabla 
Drop COLUMN Descrip
ALTER TABLE Nombre_tabla 
Add Domicilio varchar (30) null


--La sintaxis básica para modificar la longitud de un campo existente es la siguiente:

 alter table NOMBRETABLA
  alter column CAMPO NUEVADEFINICION;

Modificamos el campo "titulo" extendiendo su longitud y para que NO admita valores nulos:

 alter table libros
  alter column titulo varchar(40) not null;


---CONSULTA QUE INCLUYE UN case
SELECT CASE precio 
When 2 Then 'Premium' 
When 3 Then 'Magna' 
When 4 Then 'Diesel' END TipoGas
FROM ...

switch($edad){
case < 18:
print ("Eres menor de edad");
break;
case > 18:
print ("Eres mayor de edad");
break;
default:
print ("Has cumplido este año los 18");
break;
}

Case a.Sexo When 1 Then 'Masculino' Else 'Femenino' End As Sexo 
-------------------------------------------------------------------

select getdate() as '01:11 p.m. 25/10/2012 CON HORA' 
select convert(varchar,getdate(),103) AS 'SOLO FECHA' 
Te anexo la lista de listos de salida que tendras que poner en el tercer parametro de convert, espero te pueda servir, hasta luego. 
LISTA 
----- 
Style ID 
Style Type 

0 or 100 mon dd yyyy hh:miAM (or PM) 
101 mm/dd/yy 
102 yy.mm.dd 
103 dd/mm/yy 
104 dd.mm.yy 
105 dd-mm-yy 
106 dd mon yy 
107 Mon dd, yy 
108 hh:mm:ss 
9 or 109 mon dd yyyy hh:mi:ss:mmmAM (or PM) 
110 mm-dd-yy 
111 yy/mm/dd 
112 yymmdd 
13 or 113 dd mon yyyy hh:mm:ss:mmm(24h) 
114 hh:mi:ss:mmm(24h) 
20 or 120 yyyy-mm-dd hh:mi:ss(24h) 
21 or 121 yyyy-mm-dd hh:mi:ss.mmm(24h) 
126 yyyy-mm-dd Thh:mm:ss.mmm(no spaces) 
130 dd mon yyyy hh:mi:ss:mmmAM 
131 dd/mm/yy hh:mi:ss:mmmAM 


formato de fecha en php
date_format($fecha, 'd/m/Y');

EN PHP intruccion para reeemplazar una cadena dentro de otra
$Cadena="Este es un gran artículo de PHP"; 
$Reemplazar="gran"; 
$CadenaNueva="estupendo"; 
$CadenaMod=ereg_replace($Reemplazar,$CadenaNueva,$Cadena); 

REVISAR EL ARCHIVO DE ENTREGA DE DOCUMENTOS EN SIRREF SI TENGO PROBLEMAS PARA CONVERTIR TIPO DE DATO TEXTO A CADENA

---------------------------------------------------------------------------------
En sql server
Existe una funcion llamada DATEDIFF, su sintaxis es la siguiente: 
SELECT DATEDIFF(ParteDeFecha, FechaInicial, FechaFInal)
DATEDIFF(day, b.Fecha_Emision, b.Fecha_Liberacion) as Dias_Estancia 
DATEDIFF(day, a.Fecha_Emision,GetDate())<'365'
Automaticamente te devolvera la diferencia en el parametro "ParteFecha"; acepta las siguientes opciones: 
Year 
quarter 
Month 
dayofyear 
Day 
Week 
Hour 
minute 
second 
millisecond 
----------------------

redondeo en php
ceil() - Redondear fracciones hacia arriba 
round() - Redondea un flotante 
floor()- hacia abajo

------------------------------------------------------------------------
REINICIA EL VALOR IDENTIDAD DE UNA TABLA
indicar el valor en el ke kiero empezar mas 1
DBCC CHECKIDENT ('TInf_Conductor_OPB', RESEED,0)
------------------------------------------------------------------------
CONCATENAR 
SELECT Id, Nombre+' '+Apellido_Paterno+' '+Apellido_Materno as Nombre, Puesto from TInf_Agente order by Nombre
=CONCATENAR("'",A1,"'",",")
------------------------------------------------------------------------
LONGITUD DE UN CAMPO
SELECT LEN(FirstName) AS Length, FirstName, LastName 
FROM Sales.vIndividualCustomer
WHERE CountryRegionName = 'Australia';
------------------------------------------------------------------------
##actualizar la base de eladio donde se marca que un contribuyente esta requerido
	$sql_elimina_odbc=" UPDATE CVDB75X
	SET STA_CVDB75='S'
	WHERE NSE_CVDB75 = '".$fila_periodos['NSE_CVDB75']."' 
	AND ANM_CVDB75 = ".$fila_periodos['ANM_CVDB75']." ";
        odbc_do($enlace,$sql_elimina_odbc);
// localizo el registro
select * FROM openquery (ADS_ING,'select * from CVDB75X where NSE_CVDB75 = ''42073'' ')
-----------------------------------------------------------------------
hacer un join entre sql server y advantage
select * FROM openquery (ADS_ING,'select * from cvdb75x')
select * from ADS_ING...cvdb75x
select * FROM openquery (ADS_ING,'select * from cvdb75x where NSE_CVDB75 in (''1G2WP52K9WF210298'')')
select * FROM openquery (ADS_ING,'select * from cvdb75x where NSE_CVDB75 =''1G2WP52K9WF210298''')
SELECT    a.Municipio,a.Numero_Serie,b.NSE_CVDB75, b.MPO_CVDB75,a.Folio_Impresion
FROM         obl_datos_vehiculo a
left join openquery (ADS_ING,'select * from cvdb75x') as b on a.Numero_Serie=b.NSE_CVDB75
WHERE     a.Numero_Emision = '0926' AND (a.Municipio = '04') AND (a.Oficina = '01') 
and a.Clave_Obligacion = '010603' and  b.MPO_CVDB75!='4'
order by a.Folio_Impresion
SELECT    a.Municipio,a.Numero_Serie,b.NSE_CVDB75, b.MPO_CVDB75,a.Folio_Impresion
FROM         obl_datos_vehiculo a
left join openquery (ADS_ING,'select * from cvdb75x') as b on a.Numero_Serie=b.NSE_CVDB75
WHERE     a.Numero_Emision = '0926' AND (a.Municipio = '04') AND (a.Oficina = '01') 
and a.Clave_Obligacion = '010603'
order by a.Folio_Impresion
-------------------------------------------------------------------------
//morosos de parcialidades
SELECT    Municipio, RFC, Nombre ,Monto,Referencia, Clave_Obligacion
FROM         dec_detalle_parcialidades
WHERE     (Numero_Parcialidad = 1)  AND Pagado='N' AND Clave_Obligacion='010104' 
ORDER BY  Clave_Obligacion,Municipio, RFC
SELECT    *
FROM         dec_detalle_parcialidades
WHERE     (Numero_Parcialidad >= 1)  AND RFC in('YAPT600806PU3') 
AND Clave_Obligacion='010104' 
SELECT Municipio,RFC,Nombre,Clave_Obligacion,
Sum(Monto) as Monto, 
SUM(CASE WHEN Pagado = 'S' THEN Monto ELSE 0 END) AS Pagado, 
SUM(CASE WHEN Pagado = 'N' THEN Monto ELSE 0 END) AS Saldo, 
SUM(CASE WHEN Pagado = 'N' AND Numero_Parcialidad <= 1 THEN Monto ELSE 0 END) AS Vencido
FROM dec_detalle_parcialidades
GROUP BY Municipio,RFC,Nombre,Clave_Obligacion Having SUM(CASE WHEN Pagado = 'N' AND Numero_Parcialidad <= 1 THEN Monto ELSE 0 END) > 0
SELECT Municipio,RFC,Nombre,Clave_Obligacion,
Sum(Monto) as Monto, 
SUM(CASE WHEN Pagado = 'S' THEN Monto ELSE 0 END) AS Pagado, 
SUM(CASE WHEN Pagado = 'N' THEN Monto ELSE 0 END) AS Saldo, 
SUM(CASE WHEN Pagado = 'N' AND Numero_Parcialidad <= 3 THEN Monto ELSE 0 END) AS Vencido
FROM dec_detalle_parcialidades
GROUP BY Municipio,RFC,Nombre,Clave_Obligacion 
-----------------------------------------------------------------------------
// operaciones openquery
EXEC sp_addlinkedserver 'OracleSvr', 
   'Oracle 7.3', 
   'MSDAORA', 
   'ORCLDB';
GO
SELECT *
FROM OPENQUERY(OracleSvr, 'SELECT name, id FROM joe.titles'); 
GO
B. Ejecutar una consulta UPDATE de paso a través
En el ejemplo siguiente se usa una consulta UPDATE de paso a través en el servidor vinculado creado en el ejemplo A.
UPDATE OPENQUERY (OracleSvr, 'SELECT name FROM joe.titles WHERE id = 101') 
SET name = 'ADifferentName';
C. Ejecutar una consulta INSERT de paso a través
En el ejemplo siguiente se usa una consulta INSERT de paso a través en el servidor vinculado creado en el ejemplo A.

INSERT OPENQUERY (OracleSvr, 'SELECT name FROM joe.titles')
VALUES ('NewTitle');
D. Ejecutar una consulta DELETE de paso a través
En el ejemplo siguiente se usa una consulta DELETE de paso a través para eliminar la columna insertada en el ejemplo C.

DELETE OPENQUERY (OracleSvr, 'SELECT name FROM joe.titles WHERE name = ''NewTitle''');
//consultar si un numero de serie ya pago 
select * FROM openquery (ADS_ING,'select * from cvdb06 where nse_cvdb06='93YL62JS48J033595'')
select * FROM openquery (ADS_ING,'select NSE_CVDB06 as Serie,PLL_CVDB06 as Placa,
      TRA_CVDB06 as Rubro,
      FEC_CVDB06 as FechaCobro,
      HRC_CVDB06 as HoraCobro,
      IMP_CVDB06 as Importe,
      IAC_CVDB06 as Actualizacion,
      IRE_CVDB06 as Recargo,
      MUL_CVDB06 as Multa,
      NCA_CVDB06 as Caja,
      FOL_CVDB06 as Folio,
      ACO_CVDB06 as AnioCobro,
      STA_CVDB06 as Status,
      MPO_CVDB06 as Municipio,
      OFN_CVDB06 as Oficina,
      USU_CVDB06 as Usuario from cvdb06 where nse_cvdb06 in (''93YL62JS48J033595'')')

// datos de un vehiculo
select * from openquery (ADS_ING,'select NSE_CVDB02 as Serie,
      PLL_CVDB02 as Placa,
      CVV_CVDB02 as ClaveVehicular,
      NOM_CVDB02 as Nombre,
      APA_CVDB02 as ApellidoP,
      AMA_CVDB02 as ApellidoM,  
      RFC_CVDB02 as RFC,
      MPO_CVDB02 as Municipio,
      DOM_CVDB02 as Domicilio,
      ANC_CVDB02 as Modelo,
      COL_CVDB02 as Color,
      NCI_CVDB02 as Cilindros,
      NPT_CVDB02 as Puertas,
      NMO_CVDB02 as Motor,
      FRE_CVDB02 as FechaRegistro,
      FFA_CVDB02 as FechaFactura,
      PFA_CVDB02 as PrecioFactura,
      CPO_CVDB02 as CP,
      BAR_CVDB02 as Colonia,
      FCA_CVDB02 as FechaCaptura,
      DVO_CVDB02 as Descripcion,
      LOC_CVDB02 as Localidad,
      USU_CVDB02 as Usuario,
      NEX_CVDB02 as NumExt,
      OFN_CVDB02 as Oficina
     from cvdb02
      where APA_CVDB02 in (''LIZARDI'') AND NOM_CVDB02 in (''LILI'') ')
Serie	Placa
93CXM19246C197362   	UTA976A    LILI CORSA
Serie	Placa
L503477             	TB9047B    EVA CAMION
curp DIRE371008MVZZMV05
SELECT * FROM TEN_CONTROL_VALORES WHERE PLACA='TB9047B'




SELECT * FROM tenencias.dbo.TEN_CONTROL_VALORES WHERE PLACA='UUV974e'

select referencia, rfc, serie, * from cob_cobros where serie='8AGXM19R95R117271'
order by fecha_pago

select * from cob_cobros_cfdi  where no_operacion='02010181559321'
order by fecha_pago



select Serie,Placa,Descripcion_Vehiculo,An_Construccion  
from tenencias.dbo.ten_Padron_Vehicular 
where Apellido_Paterno like  '%lizardi%' 
and		Apellido_Materno like '%rodriguez%'






SELECT * FROM tenencias.dbo.TEN_CONTROL_VALORES WHERE PLACA='UUV974e'//placa papalo

select referencia, rfc, serie, * from cob_cobros where serie='8AGXM19R95R117271'
order by fecha_pago

select * from cob_cobros_cfdi  where no_operacion='02010181559321'
order by fecha_pago



select Serie,Placa,Descripcion_Vehiculo,An_Construccion  
from tenencias.dbo.ten_Padron_Vehicular 
where Apellido_Paterno like  '%lizardi%' 
and		Apellido_Materno like '%rodriguez%'




--------------------------------------------------------------------------------


formato de numero en PHP
$numero = 15200.67;
number_format($numero,2);
//devuelve 15,201.67 


--------------------------------------------------------------------------------
//select que me devuelve los movimientos de las emisiones 2009
SELECT documento.Numero_Control
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'ME'
AND documento.Status != 'B'
WHERE datos.Numero_Emision = '955'
AND datos.Municipio_Estatal = '02'
GROUP BY documento.Numero_Control
---------------------------------
--Obligaciones por Establecimiento
--Periodicidad de las Obligaciones
SELECT * FROM obl_periodicidad_obligacion;

--Catalogo de Obligaciones
SELECT * FROM cat_obligaciones;

--Vencimiento del Catalogo de Obligaciones
SELECT * FROM obl_cat_obligaciones
where Clave_Obligacion='010610' AND Periodicidad=03;

SELECT * FROM obl_obligacion_vigilable_presentada
WHERE RFC LIKE '%EOHD750928135%' 
AND Clave_Obligacion='010610' AND Tipo_Periodo=3 and Anio_Inicial in('2008','2009')
ORDER BY Anio_Inicial, Mes_Inicial;
SELECT * FROM pad_obligacionesporestablecimiento
WHERE RFC LIKE '%EOHD750928135%';
SELECT * FROM pad_obligacionesporestablecimiento
WHERE RFC LIKE '%ROPE740527JQ0%';
SELECT * FROM ftObligacionesPendientes('ROPE740527JQ0','00000','010610',2009,3)
ORDER BY Mes_Inicial;
SELECT * FROM ftObligacionesPendientes(' HRM031002150','08001','010104',2009,2)
ORDER BY Mes_Inicial;
SELECT * FROM ftObligacionesPendientes('MEHG530912DA5','00000','010618',2008,3)
ORDER BY Mes_Inicial;
SELECT * FROM ftObligacionesPendientes('MEHG530912DA5','00000','010618',2009,3)
ORDER BY Mes_Inicial;
SELECT * FROM ftObligacionesPendientes('ROPE740527JQ0','00000','010623',2008,3) 
ORDER BY Mes_Inicial;
SELECT * FROM ftObligacionesPendientes('GAZF680429U86','00000','010610',2008,3)
ORDER BY Mes_Inicial;
-------------------------------------

## obtener los morosos por una lista de rfc's
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'GOCD810616QM5';

insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'REAA800828UQ5'
And Clave not in ('010208');
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE '%CCC9702288X6'
And Clave not in ('010208');
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE '%CRE0812013Y4'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'CAMC780923JH3'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE '%CHG081113AW4'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'EOHD750928135'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'PESE790822GJ2'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'GAZE6210294M2'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'ROPE740527JQ0'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'AAGF7412038M0'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'GAZF680429U86'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'MOBF770402RU1'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'SACF8112143P8'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,2 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE ' GKA050601HW9'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,2 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE ' GWE911001M51'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE 'MEHG530912DA5'
And Clave not in ('010208');
insert into pad_obligacionesporestablecimiento_2009
select *,3 as Periodicidad from pad_obligacionesporestablecimiento where RFC LIKE ' HRM031002150'
And Clave not in ('010208');
select * from cat_obligaciones
select * from obl_cat_obligaciones

##query q me trae de la tabla de funcion dbo.ftObligacionesPendientes donde se guardan  
##todos los periodos morosos de los rfc guardados en pad_obligacionesporestablecimiento_2009 

select a.RFC, a.Numero_Establecimiento,a.Clave,a.Anual,a.Fecha_Inicio,a.Fecha_Baja,a.Fecha_Suspension,a.Periodicidad,b.Mes_Inicial,
b.Mes_Final,b.Descripcion,b.Fecha_Declarado from pad_obligacionesporestablecimiento_2009 as a
cross apply  dbo.ftObligacionesPendientes(a.RFC,a.Numero_Establecimiento,a.Clave,a.Anual,a.Periodicidad) as b
order by RFC,Numero_Establecimiento,Clave,Anual,Mes_Inicial

##Le aumente el where para que me traiga solamente los que estan activos.
select a.RFC, a.Numero_Establecimiento,a.Clave,a.Anual,a.Fecha_Inicio,a.Fecha_Baja,
a.Fecha_Suspension,a.Periodicidad,b.Mes_Inicial,b.Mes_Final,b.Descripcion,
b.Fecha_Declarado 
from pad_obligacionesporestablecimiento_2009 as a
cross apply  dbo.ftObligacionesPendientes(a.RFC,a.Numero_Establecimiento,a.Clave,a.Anual,a.Periodicidad) as b
where a.Situacion in ('Activo')
order by RFC,Numero_Establecimiento,Clave,Anual,Mes_Inicial

---------------------------------------------------------------------------
//select que muestra los requerimientos que se pueden asignar a un notificador  son los que se encuentran en estado impreso y 
// no localizado

SELECT doc.Folio_Impresion, doc.Numero_Emision, doc.Movimiento, 
MIN(doc.Status) AS Status, MIN(doc.RFC) AS RFC, 
MIN(emi.Clave_Obligacion) AS Clave_Obligacion 
FROM obl_detalle_documentos doc JOIN obl_control_emisiones emi 
ON doc.Numero_Emision = emi.Numero_Emision AND doc.Municipio = emi.Municipio AND doc.Oficina = emi.Oficina 
WHERE doc.Status IN ('I', 'N') AND ( doc.Fecha_Impresion BETWEEN 
CONVERT(datetime,DATEADD(DAY, -1, '01-08-2009'),20) AND CONVERT(datetime,'2009-09-21 23:59:00',20)) 
AND doc.Municipio = '02' AND doc.Oficina = '01' 
GROUP BY doc.Numero_Emision, doc.Folio_Impresion, doc.Movimiento 
ORDER BY doc.Numero_Emision, doc.Folio_Impresion
------------------------------------------------------------------------------
# consulta que me devuelve los morosos de la emision nomina mensual de los morosos de agosto del 2009 ademas de
# los contribuyentes que incian con todas las letras.

SELECT pad_oblxest.RFC,pad_oblxest.Numero_Establecimiento, obl_oblvigpre.RFC AS RFC_OBL_VIG,obldetsuc.RFC AS RFC_OBL_MOR,
 pad_oblxest.Clave, pad_est.Localidad, pad_est.Zona, pad_est.Municipio 
FROM pad_obligacionesporestablecimiento pad_oblxest 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC AND pad_oblxest.Numero_Establecimiento = obl_oblvigpre.Numero_Establecimiento 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '02' 
AND obl_oblvigpre.Anio_Inicial = '2009' 
AND obl_oblvigpre.Mes_Inicial = '08' 
AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN pad_establecimientos pad_est ON pad_oblxest.RFC = pad_est.RFC AND pad_oblxest.Numero_Establecimiento = pad_est.Numero 
LEFT JOIN cob_impuestos_promedios prom ON pad_oblxest.RFC = prom.RFC AND prom.Impuesto = '010103' 
LEFT JOIN obl_detalle_sucursales obldetsuc ON pad_oblxest.RFC = obldetsuc.RFC
AND pad_oblxest.Numero_Establecimiento = obldetsuc.Numero_Establecimiento 
AND pad_oblxest.Clave = obldetsuc.Clave_Obligacion 
AND obldetsuc.Anio_Moroso = '2009' 
AND obldetsuc.Mes = '08' 
AND obldetsuc.Clave_Periodicidad = '02' 
AND obldetsuc.Clave_Obligacion = '010103' 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion 
AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave = '010103' 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2009-08-01',20) OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) 
AND pad_oblxest.RFC 
in ( SELECT RFC FROM pad_establecimientos pad_est 
     WHERE pad_est.Municipio = '02' 
    AND pad_est.Situacion = 'Activo' 
    AND pad_est.Tipo_Establecimiento = 'Matriz' ) 
AND pad_oblxest.Situacion = 'Activo' 
AND obl_oblvigpre.RFC IS NULL 
AND obldetsuc.RFC IS NULL 
AND oco.RFC IS NULL 
AND pad_est.Situacion = 'Activo' 
AND ( LEFT(LTRIM(pad_oblxest.RFC),1) BETWEEN 'A' AND 'F' OR LEFT(LTRIM(pad_oblxest.RFC),1) BETWEEN 'G' AND 'N' OR LEFT(LTRIM(pad_oblxest.RFC),1) BETWEEN 'O' AND 'Z' ) 
ORDER BY prom.Pago_Promedio DESC, pad_oblxest.RFC 

---------------------------------------------------------------------------
// me devuelve una evaluacion de los folios y numeraciones cuando de las emisiones
select e.Municipio,e.Oficina,e.Numero_Emision,e.Clave_Obligacion,count(*) as Requerimientos,Min(d.Folio_Impresion) as Folio_Inicial, Max(d.Folio_Impresion) as Folio_Final,Min(e.Numero_Control_Inicial) as Numero_Control_Inicial,Min(e.Numero_Control_Final) as Numero_Control_Final from obl_control_emisiones as e
       inner join obl_detalle_documentos as d on e.Municipio=d.Municipio and e.Oficina=d.Oficina and e.Numero_Emision=d.Numero_Emision and d.Movimiento='R1'
WHERE   (e.Municipio = '02') AND (e.Oficina = '01') and e.Ejercicio_Fiscal=2009
GROUP BY e.Municipio,e.Oficina,e.Numero_Emision,e.Clave_Obligacion
--HAVING Min(e.Numero_Control_Final)<>Count(*)
ORDER BY e.Municipio,e.Oficina,e.Numero_Emision
---------------------------------------------------------------------------

### SELECCIONA LA CONSULTA POR EL MES DIA O AÑO

--LOS PAGOS DEL DIA 13
select * from dec_detalle_Parcialidades  
WHERE DAY( Fecha_Pago)= '13'

--LOS PAGOS DEL AÑO 13
select * from dec_detalle_Parcialidades  
WHERE YEAR( Fecha_Pago) = '13'

--LOS PAGOS DEL MES 8
select * from dec_detalle_Parcialidades  
WHERE MONTH( Fecha_Pago) = '8'

SELECT YEAR(0), MONTH(0), DAY(0);
select * from dec_detalle_Pagos  
WHERE YEAR( Fecha_Pago) = '2009' and MONTH(Fecha_Pago)>='9'and DAY(Fecha_Pago) between '08' and '10'
order by Fecha_Pago

##comparar fechas directas

select * from dec_detalle_Parcialidades  
WHERE  Fecha_Pago between '20090910'  and '20090913'
----------------------------------------------------------------------------

## requerir morosos de parcialidades
 
SELECT    Municipio, Nombre ,Monto, Clave_Obligacion, Requerido, Numero_Parcialidad, Pagado,Fecha_Pago
FROM         dec_detalle_parcialidades
WHERE     (Numero_Parcialidad in ('2'))  
AND Pagado='N' 
ORDER BY  Municipio, RFC, Numero_Parcialidad

UPDATE dec_detalle_parcialidades
SET Requerido = 'S'
WHERE     (Numero_Parcialidad in ('2'))  
AND Pagado='N' AND Clave_Obligacion='010103'

----------------------------------------------------
# getdate obtiene la fecha actual del servidor

select *,GETDATE() from obl_detalle_documentos
----------------------------------------------------

## Consulta que me devuelve el reporte de los requerimientos pagados durante un mes
select min(a.Numero_emision), min(a.Folio_impresion)
from obl_detalle_documentos a
join obl_detalle_vehiculo b
	ON a.Municipio = b.Municipio
	AND a.Oficina = b.Oficina
	AND a.Numero_Emision = b.Numero_Emision
	AND a.Folio_Impresion = b.Folio_Impresion
where a.Municipio = '02' AND a.Oficina = '02'
AND CONVERT(varchar(10),b.Fecha_Pago,20)
BETWEEN '2009-04-01' AND '2009-04-30'
AND a.status in ('P','T')
AND a.Movimiento = 'R1'
group by a.Numero_emision, a.Folio_impresion


## Consulta que me devuelve las multas por incumplimiento pagadas durante un mes
select *
from obl_detalle_documentos a
where a.Municipio = '02' AND a.Oficina = '02'
AND CONVERT(varchar(10),a.Fecha_Ultimo_Movimiento,20)
BETWEEN '2009-04-01' AND '2009-04-30'
AND a.status in ('P','T')
AND a.Movimiento = 'I1'
---------------------------------------------------
//query que me devuelve cuales rfc's deben un requerimiento 

SELECT *
FROM         obl_detalle_documentos
WHERE     (RFC = 'CAAE801219665') AND Status not in ('P','T')


//query que me dice que obligaciones tiene un contribuyente
SELECT * FROM pad_obligacionesporestablecimiento
WHERE RFC LIKE '%CAAE801219665%' and Situacion not in ('Baja')


--Vencimiento del Catalogo de Obligaciones
SELECT * FROM obl_cat_obligaciones
where Clave_Obligacion='010610' AND Periodicidad=03;

SELECT * FROM obl_obligacion_vigilable_presentada
WHERE RFC LIKE '%EOHD750928135%' 
AND Clave_Obligacion='010610' AND Tipo_Periodo=3 and Anio_Inicial in('2008','2009')
ORDER BY Anio_Inicial, Mes_Inicial;

----------------------------------------------------------------------

// pruebas de notificaciones de credito para hacer que el texto que se imprema  el numero de salario que se estan aplicando de gastos 
// de ejecucion en  nomina y hospedaje
// estos querys me buscan un ejemplo de nomina
// select * from obl_detalle_documentos where Numero_Emision='0809' and Folio_Impresion='2278' and Movimiento='I1'
// delete from obl_detalle_documentos where Numero_Emision='0809' and Folio_Impresion='2278' and Movimiento='I1'
// estos querys me buscan un ejemplo de hospedaje
// select * from obl_detalle_documentos where Numero_Emision='0810' and Folio_Impresion='150' and Movimiento='I1'
// delete from obl_detalle_documentos where Numero_Emision='0810' and Folio_Impresion='150' and Movimiento='I1'

--quedo en el arreglo temporal del archivo notifica_credito_imprimir.php
--agregando el siguente codigo
	//calculo los gastos de ejecucion y los redondeo
 $_Cantidad=$_POST['Gastos_Ejecucion'];
// $_POST['Num_Salarios_Gastos_Ejecucion']='';
  
// este switch es para solucionar el problema de gerardo por las I1 que se generaron con multas de 4 salarios minimos 

if ($_POST['Clave_Obligacion'] =='010103' or $_POST['Clave_Obligacion'] =='010104')
{
switch($_Cantidad)
  {
  case '208':
     $_POST['Gastos_Ejecucion_Letra']="CUATRO";
     break;
  default:
        $_POST['Gastos_Ejecucion_Letra']="DOS";
     break;
  }
}
//fin del calculo	

-- modifique en los archivos fundamento_credito_nomina_tpl.php, fundamento_credito_hospedaje_tpl.php
--agregue la siguente linea

<?=$_POST['Gastos_Ejecucion_Letra']?>

-----------------------------------------------------------------------
// duplicar los registros de un periodo el primer query me regresa los 2008 y el segundo me inserta los mismos pero con el año 2009

select RFC,Descripcion,Clave,Numero_Establecimiento,Fecha_Inicio,Periodicidad,Anual 
from pad_obligacionesporestablecimiento_2009_2 
order by fecha_inicio

insert into pad_obligacionesporestablecimiento_2009_2
select RFC,Descripcion,Clave,Numero_Establecimiento,Fecha_Inicio,Periodicidad,'2009' as Anual 
from pad_obligacionesporestablecimiento_2009_2 
order by fecha_inicio

--------------------------------------------------------------------------

-- compra_venta_obli_nombre 
tabla que me comparte norberto ´para sacar los contribuyentes morosos.

--------------------------------------------------------------------------
**listado de rfc de rpp que estan requeridos

SELECT a.Municipio, a.Oficina, a.RFC, a.Numero_Emision, b.Ejercicio_Fiscal, b.Anio_Moroso,b.Clave_Obligacion,b.Periodo_Inicial,
 b.Periodo_Final, a.Status, a.Fecha_Vencimiento, a.Fecha_Ultimo_Movimiento
FROM         obl_detalle_documentos as a join 
obl_control_emisiones as b on a.Municipio=b.Municipio 
and a.Oficina=b.Oficina and a.Numero_Emision=b.Numero_Emision
WHERE     RFC in (' AOHJ471026E40',
' BACL670318VDA',' BACM580729738',' BODJ801007830',
' BODP690705DI2',' BOPS710420AU5',' CABH7506131T6',
' CACL560416GSA',' CAIJ560601NDA',' CAME610818KD0',
' CAPJ651003UR9',' CESC621208Q11',' COPC521121LD6',
' COTM7207121Z6',' CUHC630910BS4',' CUPP691205M12',
' CUSM440829GF2',' DELE6809275Q3',' DIGA750908J81',
' DIOA6101317P4',' DIYM591224313',' EERJ5906045P5',
' GAZF680429U86',' GOHE390415AJ5',' HEGS720719812',
' HEUM750219BN3',' HIRC380729230',' LIEJ520317AJA',
' MAMA480117FE8',' MARE590908JX6',' MASJ410804EL4',
' MEOG600822U33',' NOTR681122LU0',' PEKR620801GS9',
' POBS640912JQ7',' RABI610419C33',' RECE5405315E6',
' ROGF5603076VA',' ROSR540205FM2',' SAEC651128772',
' SESA700606UD4',' TIMC4711296M7',' TODG631117TW3',
' UOPL6603055T5',' VACM640223FS0',' VIGF820828HB1',' VIMS550524CD8')
 AND Status not in ('P','T','X') AND usuario_cancelacion is null and Movimiento='R1' 
order by Municipio, Oficina, RFC, Numero_Emision,Ejercicio_Fiscal, Anio_Moroso, Periodo_Inicial


SELECT a.Municipio, a.Oficina, a.RFC, a.Numero_Emision, b.Ejercicio_Fiscal, 
b.Anio_Moroso,b.Clave_Obligacion,b.Periodo_Inicial,
 b.Periodo_Final, a.Status, a.Fecha_Vencimiento, a.Fecha_Ultimo_Movimiento
FROM         obl_detalle_documentos as a join 
obl_control_emisiones as b on a.Municipio=b.Municipio 
and a.Oficina=b.Oficina and a.Numero_Emision=b.Numero_Emision
WHERE     RFC in ('VIGF820828HB1')  --and Clave_Obligacion='010623' 
 AND Status not in ('P','T','X') AND usuario_cancelacion is null and Movimiento='R1'
order by Municipio, Oficina, RFC, Numero_Emision,Ejercicio_Fiscal, Anio_Moroso, Periodo_Inicial

------------------------------------------------------------------------------------------------

## me devuelve la fecha actual del sistema
date("Y-m-d")

if ( ($_POST['entrega'][$k]['Fecha'])> $fcha=date("Y-m-d"))
					{
$exito = false;
$mensaje = 'La fecha del Folio '.$_POST['entrega'][$k]['Folio'].' que ha elegido no es valida';
break;
					}
------------------------------------------------------------------------------------------------
sabes los req. de actos notificador
select distinct (Status) from obl_actos_notificador 
where Numero_Emision='0815' and 
Municipio='04' and Oficina='01' and Movimiento='R1' --and Status='D'


--------------------------------

-- procedimiento almacenado complementado por jorge para obtener de un listado de RFCs si son morosos, 
si tienen requerimiento, y el estatus del requerimiento.


-- ================================================
-- Template generated from Template Explorer using:
-- Create Procedure (New Menu).SQL
--
-- Use the Specify Values for Template Parameters 
-- command (Ctrl-Shift-M) to fill in the parameter 
-- values below.
--
-- This block of comments will not be included in
-- the definition of the procedure.
-- ================================================
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Jorge Baroudi y Lilí Lizardi
-- Create date: 03 Noviembre 09
-- Description:	<Description,,>
-- =============================================
alter PROCEDURE pObl_Detalle_Documentos_Obtener_Morosos_Sin_Requerimientos
	-- Add the parameters for the stored procedure here
(
	@Ejercicio char(4)
	,@CadenaDeRFCs varchar(max)
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

select 
	presentados.RFC, presentados.Numero_Establecimiento, presentados.Clave, presentados.Anual, presentados.Fecha_Inicio, presentados.Periodicidad, presentados.Ejercicio, 
	presentados.Fecha_Declarado,presentados.Mes_Inicial,presentados.Mes_Final,presentados.Descripcion,
	(Case 
		WHEN docs.Status is null then 'NO'
		WHEN (docs.Status is not null and docs.Status not in('P','T','H','L','M','J','S','Y','Z','O','U','W','R'))then 'SI'
	end) as Requerido
	,ne.Nombre as Estatus
from 
(
SELECT oblXest.RFC, oblXest.Numero_Establecimiento, oblXest.Clave, oblXest.Anual, oblXest.Fecha_Inicio, obl.Periodicidad, obl.Ejercicio, 
	crossApply.Fecha_Declarado,crossApply.Mes_Inicial,crossApply.Mes_Final,crossApply.Descripcion 
FROM         pad_obligacionesporestablecimiento AS oblXest INNER JOIN
                      obl_cat_obligaciones AS obl ON oblXest.Clave = obl.Clave_Obligacion AND oblXest.Anual = obl.Ejercicio
			and obl.ejercicio = @Ejercicio
			and oblXest.RFC in ( @CadenaDeRFCs )
cross apply dbo.ftObligacionesPendientes(
	oblXest.RFC, 
	oblXest.Numero_Establecimiento, 
	oblXest.Clave, 
	obl.Ejercicio, 
	obl.Periodicidad
) as crossApply
) as presentados
left join dbo.obl_detalle_documentos docs
on presentados.RFC = docs.RFC
left join dbo.obl_nombres_estatus ne
on docs.status = ne.clave


END
GO


---------
ejecuta procedimiento almacenado anterior 
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pObl_Detalle_Documentos_Obtener_Morosos_Sin_Requerimientos]
		@Ejercicio = N'2009'
		,@CadenaDeRFCs = 'UMGE870920QGA'

SELECT	'Return Value' = @return_value

GO

-----------
solo query- del procedimiento anterior
select 
	presentados.RFC, presentados.Numero_Establecimiento, presentados.Clave, presentados.Anual, presentados.Fecha_Inicio, presentados.Periodicidad, presentados.Ejercicio, 
	presentados.Fecha_Declarado,presentados.Mes_Inicial,presentados.Mes_Final,presentados.Descripcion,
	(Case 
		WHEN docs.Status is null then 'NO'
		WHEN (docs.Status is not null and docs.Status not in('P','T'))then 'SI'
	end) as Requerido,
	ne.Nombre as Descripcion_Estatus
from 
(
SELECT     top 10 oblXest.RFC, oblXest.Numero_Establecimiento, oblXest.Clave, oblXest.Anual, oblXest.Fecha_Inicio, obl.Periodicidad, obl.Ejercicio, 
	crossApply.Fecha_Declarado,crossApply.Mes_Inicial,crossApply.Mes_Final,crossApply.Descripcion 
FROM         pad_obligacionesporestablecimiento AS oblXest INNER JOIN
                      obl_cat_obligaciones AS obl ON oblXest.Clave = obl.Clave_Obligacion AND oblXest.Anual = obl.Ejercicio
			and obl.ejercicio = '2009'
cross apply dbo.ftObligacionesPendientes(
	oblXest.RFC, 
	oblXest.Numero_Establecimiento, 
	oblXest.Clave, 
	obl.Ejercicio, 
	obl.Periodicidad
) as crossApply
) as presentados
left join dbo.obl_detalle_documentos docs
on presentados.RFC = docs.RFC
left join dbo.obl_nombres_estatus ne
on docs.status = ne.clave


------------------------------------------------------------------------------------
//se genero una emision con un numero duplicado una 57 en 2008 y una 57 en 2009 para sirref
esto me afecta 4 tablas 
sirref_co_emisiones
sirref_co_datos  (sirref co_datos me dice tomando en cuenta el numero de emision y el municipio cuantos
		  cuantos requerimientos hay de cada municipio y la suma de todos me da el total de req.)
sirref_co_detalle
sirref_co_documentos

con este query actualizo el numero de emision de datos de co_datos a 957

##
	update
	sirref_co_datos
	set Numero_Emision='957'
	where
	Numero_Control in
	(select a.Numero_control  from sirref_co_documentos as a
	left join sirref_co_datos as b on a.RFC=b.RFC and a.Numero_Emision=b.Numero_Emision and a.Numero_control=b.Numero_Control
	where a.Numero_Emision='57' and a.Movimiento='R1' and a.Status='B' and Fecha_Impresion is null 
	and year(Fecha_Ultimo_Movimiento)='2009' and month(Fecha_Ultimo_Movimiento)='11' and a.Usuario_Impresion='nasg0' )

	update sirref_co_documentos
	SET Numero_Emision = '957'
	where Numero_Control in 
	(select a.Numero_control  from sirref_co_documentos as a
	left join sirref_co_datos as b on a.RFC=b.RFC and a.Numero_Emision=b.Numero_Emision and a.Numero_control=b.Numero_Control
	where a.Numero_Emision='57' and a.Movimiento='R1' and a.Status='B' and Fecha_Impresion is null 
	and year(Fecha_Ultimo_Movimiento)='2009' and month(Fecha_Ultimo_Movimiento)='11' and a.Usuario_Impresion='nasg0')

	UPDATE sirref_co_detalle
	SET Numero_Emision = '957'
	where Numero_Control in 
	(select a.Numero_control  from sirref_co_documentos as a
	left join sirref_co_datos as b on a.RFC=b.RFC and a.Numero_Emision=b.Numero_Emision and a.Numero_control=b.Numero_Control
	where a.Numero_Emision='57' and a.Movimiento='R1' and a.Status='B' and Fecha_Impresion is null 
	and year(Fecha_Ultimo_Movimiento)='2009' and month(Fecha_Ultimo_Movimiento)='11' and a.Usuario_Impresion='nasg0') 
	AND (Ejercicio_Fiscal = '2009')

## me devuelve los datos en detalle modificar el numero de emision a 957
	select * from sirref_co_detalle where Numero_Emision='57' and Ejercicio_Fiscal='2009'


## me devuelve los datos de los datos de sirref datos modificar el numero de emision a 957
	select top 10 * from sirref_co_documentos as a
	where a.Numero_Emision='957' and a.Movimiento='R1' and a.Status='B' and Fecha_Impresion is null 
	and year(Fecha_Ultimo_Movimiento)='2009' and month(Fecha_Ultimo_Movimiento)='11' and a.Usuario_Impresion='nasg0'

--------------------------------------------------------------------------------------

##crear un respaldo de alguna tabla en particular desde ch-sarh a sarh2
##podria crear antes una tabla nueva para ahi respaldar.

INSERT INTO [ingresos].[dbo].[obl_datos_vehiculo]
           ([Municipio]
           ,[Oficina]
           ,[Numero_Emision]
           ,[RFC]
           ,[Numero_Serie]
           ,[Folio_Impresion]
           ,[Nombre_Contribuyente]
           ,[Apellido_Paterno]
           ,[Apellido_Materno]
           ,[Localidad]
           ,[Domicilio_Calle]
           ,[Domicilio_Numero]
           ,[Domicilio_Colonia]
           ,[Domicilio_Ubicacion]
           ,[Domicilio_Codigo_Postal]
           ,[Ejercicio_Fiscal]
           ,[Pagado]
           ,[Clave_Obligacion]
           ,[Clave_Periodicidad]
           ,[Placa]
           ,[Modelo]
           ,[Marca]
           ,[Sub_Marca]
           ,[Numero_Motor]
           ,[Folio_Anterior])
select * from [CH-SARH].ingresos.dbo.obl_datos_vehiculo
-----------------------------------------------------------------------------------------


## cuando no pueden generar una I1 y se encuentra en edo. vencido el R1 verificar que no este en pago espontaneo 
si es en federales checar obl_obligacion_vigilable_presentada  y obl_detalle_federales si esta marcado 
como pagado si es asi desmarcar como pagado y 
-------------------------------------------------------------------

##pasar variables por get 

##pagina 1
<td align="center"><a href="listar_reporte_emisiones_detallado.php?numero_emision=<?php echo $conexionBD->Registro['Numero_Emision'];?>&municipio=<?php echo $_POST['municipio']; ?>"  target='_blank'> <?php echo $conexionBD->Registro['Numero_Emision'];?></a></td>

##pagina 2
 echo $_GET['saludo']."lili"; 
-------------------------------------------------------------------
##Emisiones Federales  de Isla mujeres
las tablas
para capturar el pago de cotejar que haya declarado y que haya pagado con en numero de operacion con hugo
marcar como pagado en 
obl_datos_generales
obl_detalle_sucursales
obl_detalle_documentos

nomina
0726 año 2005, 
0728 año 2006
--------------------------------------------------------------------



// checar por ke no me permite ver la periodicidad
SELECT  pad_oblxest.RFC, pad_oblxest.Clave, cont.*, 
Establecimientos.Nombre as Nombre_Comercial,fed.Clave_Periodicidad, obl_oblvigpre.Tipo_Periodo
FROM pad_obligacionesporestablecimiento pad_oblxest
JOIN pad_contribuyentes cont ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN ( SELECT DISTINCT(RFC),Nombre FROM pad_establecimientos est 
WHERE --est.Municipio = '04' AND 
est.Tipo_Establecimiento = 'Matriz' 
AND est.Situacion = 'Activo' ) AS Establecimientos ON pad_oblxest.RFC = Establecimientos.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '02' AND obl_oblvigpre.Anio_Inicial = '2006' 
--AND obl_oblvigpre.Mes_Inicial = '01' 
AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave = fed.Clave_Obligacion AND fed.Anio_Moroso = '2006' 
--AND fed.Mes_Inicial  = '01' 
AND fed.Clave_Periodicidad = '02' 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave = '010611' 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2006-01-01',20) OR pad_oblxest.Fecha_Inicio = '' 
OR pad_oblxest.Fecha_Inicio IS NULL ) 
--AND cont.Municipio = '04' 
AND pad_oblxest.Situacion = 'Activo' 
AND cont.Situacion = 'Activo' AND fed.RFC IS NULL 
AND obl_oblvigpre.RFC IS NULL AND oco.RFC IS NULL 
AND cont.Localidad = '0001' AND cont.Zona = '001' 
AND cont.Localizable = 'S'
order by cont.municipio

SELECT * FROM ftObligacionesPendientes('CACE6203109S0','00000','010611',2006,2)
ORDER BY Mes_Inicial;

//query norberto para sacar los contribuyentes activos
//de 
select  a.RFC
from pad_contribuyentes as a
inner join pad_obligacionesporestablecimiento as b on a.rfc=b.rfc
--where a.situacion='Activo' and b.situacion='Activo' and clave in ('010610','010611','010618','010623')
where a.situacion='Activo' and b.situacion='Activo' and clave in ('010611')
group by a.RFC
order by a.RFC


---------------------------------------------------------------------------------------------------

### procedimiento almacenado reporte de mororsos

USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[pRpt_Morosos]    Fecha de la secuencia de comandos: 11/23/2009 13:57:12 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Jorge Baroudi, Lilí Lizardi
-- Create date: 13 Noviembre 2009
-- Description:	
/*
	-- Todos los parametros se pueden obviar (valores nulos)
	para sacar información general
	
	-- Se valida la congruencia de valores iniciales vs finales
	
	-- Todas las Listas son separadas por comas ej. bapj79040817a,gel740907134
	
	-- Para el caso de Municipio y Oficina, si municipio es nulo
	y oficina tiene un valor se utilizará nulo también

	-- el parametro debug en nulo se salta los mensajes de debuggeo de programación
	
	-- La periodicidad se puede mandar como lista ej. 1,2,3,4,... 
	-- y mostrará los anuales, los mensuales etc ver campo Tipo de tabla cat_periodos
*/
-- =============================================
ALTER PROCEDURE [dbo].[pRpt_Morosos]
	-- Add the parameters for the stored procedure here
(
	@Ejercicio_Inicial varchar(4) = null,
	@Ejercicio_Final varchar(4) = null,
	@Mes_Inicial varchar(2) = null,
	@Mes_Final varchar(2) = null,
	@Lista_RFCS varchar(max) = null,
	@Lista_Obligaciones varchar(300) = null,
	@Municipio varchar(10) = null,
	@Oficina varchar(10) = null,
	@Separador_Listas varchar(3) = ',',
	@Pagados char(1) = 'T', -- [S=Si, N=No, T=Todos: Pagados y No pagados]
	@debug char(1) = null
)	
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

	DECLARE @getdateEjercicio int
	DECLARE @getdateMes int
	set @getdateEjercicio = year(getdate())
	set @getdateMes = month(getdate())

	-- variables de tablas para ir filtrando la información
	DECLARE @tablaRFCs TABLE
	(
		RFC varchar(20)
		,Localizable varchar(2)
		,Municipio char(2)
		,Oficina char(2)
	)

	DECLARE @tablaObligacionesPorEstablecimiento TABLE
	(
		RFC varchar(20)
		,Nombres varchar(120)
		,Apellido_Paterno varchar(20)
		,Apellido_Materno varchar(20)
		,Municipio varchar(30) -- cat_municipios
		,Localidad varchar(40) -- cat_localidades
		,Zona varchar(40) -- cat_zonas
		,Domicilio_Fiscal_Calle varchar(45)
		,Domicilio_Fiscal_Numero varchar(20)
		,Domicilio_Fiscal_Ubicacion varchar(255)
		,Domicilio_Fiscal_Colonia varchar(40)
		,Numero_Establecimiento varchar(6)
		,Clave_Obligacion varchar(6)
		,Nombre_Obligacion varchar(35) -- cat_obligaciones
		,Fecha_Inicio datetime
	)

	DECLARE @tablaCatalogosObligacionesConPeriodos TABLE
	(
		Ejercicio varchar(4)
		,Clave_Obligacion varchar(6)
		,Periodicidad tinyint
		,Descripcion_Tipo_Periodo varchar(30)
		,Mes_Inicial int
		,Mes_Final int
		,Descripcion_Periodo varchar(20)
	)

	DECLARE @tablaFinal TABLE
	(
		RFC varchar(20)
		,Nombres varchar(120)
		,Apellido_Paterno varchar(20)
		,Apellido_Materno varchar(20)
		,Municipio varchar(30) -- cat_municipios
		,Localidad varchar(40) -- cat_localidades
		,Zona varchar(40) -- cat_zonas
		,Domicilio_Fiscal_Calle varchar(45)
		,Domicilio_Fiscal_Numero varchar(20)
		,Domicilio_Fiscal_Ubicacion varchar(255)
		,Domicilio_Fiscal_Colonia varchar(40)
		,Numero_Establecimiento varchar(6)
		,Clave_Obligacion varchar(6)
		,Nombre_Obligacion varchar(35) -- cat_obligaciones
		,Fecha_Inicio datetime
		,Ejercicio_Moroso varchar(4) --  anio moroso en control de emisiones
		,Descripcion_Tipo_Periodo varchar(30)
		,Mes_Inicial int
		,Mes_Final int
		,Descripcion_Periodo varchar(30)
		,Pagado char(1)
		,Requerido char(1)
		,Numero_Emision varchar(4) -- obl_control_emisiones
		,Folio_Impresion bigint --dbo.obl_detalle_documentos
		,Clave_Estatus char(1)
		,Estatus varchar(30) --dbo.obl_nombres_estatus
	)

	DECLARE @Ejercicio_Actual int
	set @Ejercicio_Actual = @getdateEjercicio

	if 	(@Pagados is not null)
	begin
		--la variable pagados debe de tener un valor:
		-- [S=Si, N=No, T=Todos: Pagados y No pagados]
		if (@Pagados not in ('S','N','T') OR len(@Pagados) > 1)
		begin
			select 'Por favor configure la variable @Pagados con [S=Si, N=No, T=Todos: Pagados y No pagados]' as Mensaje_Error
			return
		end
	end 
45
    -- Validar congruencia de parametros
	-- Ejercicios
	if (@Ejercicio_Inicial is null)
	begin
		set @Ejercicio_Final = cast(@Ejercicio_Actual as varchar)
		set @Ejercicio_Inicial = cast(@Ejercicio_Actual - 5 as varchar)
	end

	if (@Ejercicio_Final is null)
	begin
		set @Ejercicio_Final = @Ejercicio_Inicial
	end

	if (@Mes_Inicial is null)
	begin
		set @Mes_Inicial = '01'
		set @Mes_Final = '12'
	end

	if (@Mes_Final is null)
	begin
		set @Mes_Final = @Mes_Inicial
	end

	if (@Municipio is null OR @Municipio = '' OR len(@Municipio) <> 2)
	begin
		set @Oficina = '%'
		set @Municipio = '%'
	end
	else if(@Oficina is null OR @Oficina = '' OR len(@Oficina) <> 2)
	begin
		set @Oficina = '%'
	end

	if (@debug is not null)
	begin
		select @Ejercicio_Inicial as Ejercicio_Inicial,
			@Ejercicio_Final as Ejercicio_Final,
			@Mes_Inicial as Mes_Inicial,
			@Mes_Final as Mes_Final,
			@Lista_RFCS as Lista_RFCS,
			@Lista_Obligaciones as Lista_Obligaciones,
			@Municipio as Municipio,
			@Separador_Listas as Separador_Listas
	end


	-- Ya validados vamos creando la serie de queries y llenar variables de tablas 
	-- necesarias

	-- 1) Verificar de la lista de RFCs que en la tabla de contribuyentes sean activos
	if (@Lista_RFCs is null)
	begin
		-- seleccionar los datos de pad_contribuyentes e insertarlos en la tabla RFCs
		INSERT INTO @tablaRFCs
		SELECT   pad_contribuyentes.RFC, 
			pad_contribuyentes.Localizable, pad_contribuyentes.Municipio
			, pad_contribuyentes.Oficina
		FROM         pad_contribuyentes 
		left JOIN obl_contribuyentes_omitidos 
			ON pad_contribuyentes.RFC = obl_contribuyentes_omitidos.RFC
		WHERE  (obl_contribuyentes_omitidos.Activado is null or obl_contribuyentes_omitidos.Activado = 'N') 
		AND (pad_contribuyentes.Situacion = 'Activo')
		AND pad_contribuyentes.Municipio like @Municipio
		AND pad_contribuyentes.Oficina like @Oficina
	end
	else
	begin
		INSERT INTO @tablaRFCs
		SELECT   pad_contribuyentes.RFC, pad_contribuyentes.Localizable, pad_contribuyentes.Municipio
				, pad_contribuyentes.Oficina
		FROM         pad_contribuyentes 
		LEFT JOIN obl_contribuyentes_omitidos 
			ON pad_contribuyentes.RFC = obl_contribuyentes_omitidos.RFC
		WHERE  (obl_contribuyentes_omitidos.Activado is null or obl_contribuyentes_omitidos.Activado = 'N') 
		AND (pad_contribuyentes.Situacion = 'Activo')
		AND pad_contribuyentes.Municipio like @Municipio
		AND pad_contribuyentes.Oficina like @Oficina
		and pad_contribuyentes.RFC in (
			select * from dbo.SplitString(@Lista_RFCs, @Separador_Listas)
		)
	end

	if (@debug is not null)
	begin
		select * from @tablaRFCs
	end
	-- 2) Filtrar las claves de obligacines por establecimiento 
	-- utilizando el parametro @Lista_Obligaciones y además
	-- que estén activas.
	-- De4splegar su fecha inicial, numro de establecimiento, etc

	if (@Lista_Obligaciones is null)	
	begin
		insert into @tablaObligacionesPorEstablecimiento 
		SELECT     oxe.RFC, con.Nombres, con.Apellido_Paterno, con.Apellido_Materno, mun.Nombre AS Municipio, loc.Nombre AS Localidad, 
		  zon.Nombre AS Zona, con.Domicilio_Fiscal_Calle, con.Domicilio_Fiscal_Numero, con.Domicilio_Fiscal_Ubicacion, con.Domicilio_Fiscal_Colonia, 
		  oxe.Numero_Establecimiento, oxe.Clave, co.Descripcion AS Nombre_Obligacion, oxe.Fecha_Inicio
		FROM         cat_localidades AS loc INNER JOIN
		  cat_municipios AS mun ON loc.Clave_Municipio = mun.Clave INNER JOIN
		  cat_zonas AS zon INNER JOIN
		  pad_obligacionesporestablecimiento AS oxe INNER JOIN
		  pad_contribuyentes AS con ON oxe.RFC = con.RFC ON zon.Clave = con.Zona AND zon.Clave_Localidad = con.Localidad AND 
		  zon.Clave_Municipio = con.Municipio ON loc.Clave = zon.Clave_Localidad AND loc.Clave_Municipio = zon.Clave_Municipio INNER JOIN
		  cat_obligaciones AS co ON oxe.Clave = co.Clave
		WHERE     (oxe.Situacion = 'Activo')		
		and oxe.RFC in (
			SELECT RFC From @tablaRFCs
		)
		and co.Vigilable_Proceso_Emision = 1
	end
	else
	begin
		insert into @tablaObligacionesPorEstablecimiento 
		SELECT     oxe.RFC, con.Nombres, con.Apellido_Paterno, con.Apellido_Materno, mun.Nombre AS Municipio, loc.Nombre AS Localidad, 
		  zon.Nombre AS Zona, con.Domicilio_Fiscal_Calle, con.Domicilio_Fiscal_Numero, con.Domicilio_Fiscal_Ubicacion, con.Domicilio_Fiscal_Colonia, 
		  oxe.Numero_Establecimiento, oxe.Clave, co.Descripcion AS Nombre_Obligacion, oxe.Fecha_Inicio
		FROM         cat_localidades AS loc INNER JOIN
		  cat_municipios AS mun ON loc.Clave_Municipio = mun.Clave INNER JOIN
		  cat_zonas AS zon INNER JOIN
		  pad_obligacionesporestablecimiento AS oxe INNER JOIN
		  pad_contribuyentes AS con ON oxe.RFC = con.RFC ON zon.Clave = con.Zona AND zon.Clave_Localidad = con.Localidad AND 
		  zon.Clave_Municipio = con.Municipio ON loc.Clave = zon.Clave_Localidad AND loc.Clave_Municipio = zon.Clave_Municipio INNER JOIN
		  cat_obligaciones AS co ON oxe.Clave = co.Clave
		WHERE     (oxe.Situacion = 'Activo')		
		and oxe.Clave in (
			select * from dbo.SplitString(@Lista_Obligaciones, @Separador_Listas)
		)
		and oxe.RFC in (
			SELECT RFC From @tablaRFCs
		)
		and co.Vigilable_Proceso_Emision = 1
	end
	
/*
	if (@debug is not null)
	begin
		select * from @tablaObligacionesPorEstablecimiento
	end
*/

--	if (@Municipio is not null AND @Municipio <> '%')
--	begin
--		delete from @tablaObligacionesPorEstablecimiento 
--		where @Municipio <> left(Numero_Establecimiento, 2) 
--	end

	if (@debug is not null)
	begin
		select * from @tablaObligacionesPorEstablecimiento
	end
	-- 3) unir el resultado de obligaciones por establecimiento 
	-- al catalogo de obligaciones tanto en padron (cat_obligaciones)  
	-- como en el módulo de control de obligaciones (obl_cat_obligaciones) 
	-- para obtener la periodicidad.

	-- 3.1) tomar de obl_cat_obligaciones la periodicidad y unirlo con catalogo de periodos
	if (@Lista_Obligaciones is null)
	begin
		insert into @tablaCatalogosObligacionesConPeriodos
		SELECT     obl_cat_obligaciones.Ejercicio, obl_cat_obligaciones.Clave_Obligacion, cat_periodos.Tipo, cat_periodos.Descripcion_Tipo_Periodo, 
                      cat_periodos.Mes_Inicial, cat_periodos.Mes_Final, cat_periodos.Descripcion
FROM         obl_cat_obligaciones INNER JOIN
                      cat_periodos ON CAST(obl_cat_obligaciones.Periodicidad AS int) = CAST(cat_periodos.Tipo AS int) INNER JOIN
                      cat_obligaciones ON obl_cat_obligaciones.Clave_Obligacion = cat_obligaciones.Clave
WHERE     (obl_cat_obligaciones.Ejercicio BETWEEN @Ejercicio_Inicial AND @Ejercicio_Final) AND (cat_obligaciones.Vigilable_Proceso_Emision = 1)

			--and obl_cat_obligaciones.Activado = 'S'
	end
	else
	begin
		insert into @tablaCatalogosObligacionesConPeriodos
SELECT     obl_cat_obligaciones.Ejercicio, obl_cat_obligaciones.Clave_Obligacion, cat_periodos.Tipo, cat_periodos.Descripcion_Tipo_Periodo, 
                      cat_periodos.Mes_Inicial, cat_periodos.Mes_Final, cat_periodos.Descripcion
FROM         obl_cat_obligaciones INNER JOIN
                      cat_periodos ON CAST(obl_cat_obligaciones.Periodicidad AS int) = CAST(cat_periodos.Tipo AS int) INNER JOIN
                      cat_obligaciones ON obl_cat_obligaciones.Clave_Obligacion = cat_obligaciones.Clave
WHERE     (obl_cat_obligaciones.Ejercicio BETWEEN @Ejercicio_Inicial AND @Ejercicio_Final) AND (cat_obligaciones.Vigilable_Proceso_Emision = 1)
		--and obl_cat_obligaciones.Activado = 'S'
		AND (obl_cat_obligaciones.Clave_Obligacion IN
		(
			SELECT     Token
			FROM          dbo.SplitString(@Lista_Obligaciones, @Separador_Listas) AS SplitString_1)
		)
	end

	-- Eliminar de la tabla de catalogo obligaciones periodos el futuro.
	-- no eliminar la clave de obligacion de ISTUV ANUAL para el año actual, 
	-- ya que se pueden requerir tenencias en el mismo año 
	-- (se pagan los primeros 3 meses y si no te requieren a partir del cuarto)
	delete from @tablaCatalogosObligacionesConPeriodos 
	where clave_obligacion <> '010603'  -- Obligación de ISTUV
	and (
		Ejercicio > @getdateEjercicio 
		OR (Ejercicio = @getdateEjercicio AND Mes_Final >= @getdateMes)
	)

	delete from @tablaCatalogosObligacionesConPeriodos 
	where clave_obligacion = '010603'  -- Obligación de ISTUV
	and (
		Ejercicio > @getdateEjercicio 
	)

	if (@debug is not null)
	begin
		select * from @tablaCatalogosObligacionesConPeriodos
	end

--	if (@Lista_Periodicidad is not null)
--	begin
--		delete from @tablaCatalogosObligacionesConPeriodos	
--		where Periodicidad not in (
--			SELECT     Token
--			FROM          dbo.SplitString(@Lista_Periodicidad, @Separador_Listas) AS SplitString_1
--		)
--	end

	DECLARE @RFC varchar(20)
	DECLARE @Numero_Establecimiento varchar(6)
	DECLARE @Clave_Obligacion varchar(6)
	DECLARE @Fecha_Inicio datetime

	DECLARE @Nombres varchar(120)
	DECLARE @Apellido_Paterno varchar(20)
	DECLARE @Apellido_Materno varchar(20)
	DECLARE @MunicipioX varchar(30) -- cat_municipios
	DECLARE @Localidad varchar(40) -- cat_localidades
	DECLARE @Zona varchar(40) -- cat_zonas
	DECLARE @Domicilio_Fiscal_Calle varchar(45)
	DECLARE @Domicilio_Fiscal_Numero varchar(20)
	DECLARE @Domicilio_Fiscal_Ubicacion varchar(255)
	DECLARE @Domicilio_Fiscal_Colonia varchar(40)
	DECLARE @Nombre_Obligacion varchar(35) -- cat_obligaciones


	-- 3.2) Unir el resultado de 3.1 con las obligaciones activas y verificar de una vez los pagos
	Declare crObligaciones CURSOR FOR
	SELECT * FROM @tablaObligacionesPorEstablecimiento

	OPEN crObligaciones
	
	FETCH NEXT FROM crObligaciones
	INTO @RFC
		,@Nombres 
		,@Apellido_Paterno 
		,@Apellido_Materno 
		,@MunicipioX 
		,@Localidad 
		,@Zona 
		,@Domicilio_Fiscal_Calle 
		,@Domicilio_Fiscal_Numero 
		,@Domicilio_Fiscal_Ubicacion 
		,@Domicilio_Fiscal_Colonia 
		,@Numero_Establecimiento
		,@Clave_Obligacion
		,@Nombre_Obligacion
		,@Fecha_Inicio

	WHILE @@FETCH_STATUS = 0
	BEGIN

		if (@debug is not null)
		BEGIN
			select 'PAGOS' AS t, @RFC as RFC, cop.Clave_Obligacion,
				cop.Descripcion_Tipo_Periodo, 
				cop.Mes_Inicial, cop.Mes_Final, 
				cop.Descripcion_Periodo,
				cop.Periodicidad,
				cop.Ejercicio
			from @tablaCatalogosObligacionesConPeriodos cop
			left join obl_obligacion_vigilable_presentada obl
				on obl.RFC = @RFC
				and obl.Numero_Establecimiento = @Numero_Establecimiento
				and cop.clave_Obligacion = obl.clave_Obligacion
				and cop.Ejercicio = obl.Ejercicio_Fiscal
				and cop.Periodicidad = obl.Tipo_Periodo
				and cop.Mes_Inicial = obl.Mes_Inicial
				and cop.Mes_Final = obl.Mes_Final
				and obl.estado = 'T'
			-- Filtrar los periodos a verificar del RFC / Clave obligacion actual en el cursor
			where cop.Clave_Obligacion = @Clave_Obligacion
			and obl.RFC is null
			AND
			(
				cop.Ejercicio > year(@Fecha_Inicio)
				OR 
				(cop.Ejercicio = year(@Fecha_Inicio) and cop.Mes_Inicial > month(@Fecha_Inicio))
			)			


			SELECT  'REQUERIMIENTOS' AS T,  dd.RFC, ce.clave_Obligacion, ce.Clave_Periodicidad, dd.Numero_Emision, 
				dd.Folio_Impresion, ce.Anio_Moroso AS Ejercicio_Moroso, dd.Status AS Estatus, 
				obl_nombres_estatus.Nombre AS Nombre_Estatus, ce.Periodo_Inicial
			FROM         obl_control_emisiones AS ce INNER JOIN
			obl_detalle_documentos AS dd ON ce.Municipio = dd.Municipio AND ce.Oficina = dd.Oficina AND ce.Numero_Emision = dd.Numero_Emision INNER JOIN
			obl_nombres_estatus ON dd.Status = obl_nombres_estatus.Clave
			WHERE     (dd.RFC = @RFC) 
			AND (ce.Clave_Obligacion = @Clave_Obligacion) 
			AND (dd.Status NOT IN ('P', 'T', 'H', 'L', 'M', 'J', 'S', 'Y', 'Z', 'O', 'U', 'W', 'R'))
			AND dd.Movimiento in ('R1')

		END

		insert into @tablaFinal
		select 
			@RFC 
			,@Nombres 
			,@Apellido_Paterno 
			,@Apellido_Materno 
			,@MunicipioX 
			,@Localidad 
			,@Zona 
			,@Domicilio_Fiscal_Calle 
			,@Domicilio_Fiscal_Numero 
			,@Domicilio_Fiscal_Ubicacion 
			,@Domicilio_Fiscal_Colonia 
			,@Numero_Establecimiento
			,@Clave_Obligacion
			,@Nombre_Obligacion
			,@Fecha_Inicio
			,pagos.Ejercicio
			,pagos.Descripcion_Tipo_Periodo
			,pagos.Mes_Inicial
			,pagos.Mes_Final
			,pagos.Descripcion_Periodo
			,pagos.Pagado
			,(CASE WHEN requerimientos.Ejercicio_Moroso is null THEN 'N' ELSE 'S' END) as Requerido
			,requerimientos.Numero_Emision
			,requerimientos.Folio_Impresion
			,requerimientos.Estatus
			,requerimientos.Nombre_Estatus
		from (
			-- pagos 
			select @RFC as RFC, cop.Clave_Obligacion,
				cop.Descripcion_Tipo_Periodo, 
				cop.Mes_Inicial, cop.Mes_Final, 
				cop.Descripcion_Periodo,
				cop.Periodicidad,
				cop.Ejercicio,
				(CASE WHEN obl.estado is null THEN 'N' ELSE 'S' END) as Pagado
			from @tablaCatalogosObligacionesConPeriodos cop
			left join obl_obligacion_vigilable_presentada obl
				on obl.RFC = @RFC
				and obl.Numero_Establecimiento = @Numero_Establecimiento
				and cop.clave_Obligacion = obl.clave_Obligacion
				and cop.Ejercicio = obl.Ejercicio_Fiscal
				and cop.Periodicidad = obl.Tipo_Periodo
				and cop.Mes_Inicial = obl.Mes_Inicial
				and cop.Mes_Final = obl.Mes_Final
				and obl.estado = 'T'
			-- Filtrar los periodos a verificar del RFC / Clave obligacion actual en el cursor
			where cop.Clave_Obligacion = @Clave_Obligacion
			and obl.RFC is null
			AND
			(
				cop.Ejercicio > year(@Fecha_Inicio)
				OR 
				(cop.Ejercicio = year(@Fecha_Inicio) and cop.Mes_Inicial > month(@Fecha_Inicio))
			)

		) as pagos left join
		(
			SELECT     dd.RFC, ce.clave_Obligacion, ce.Clave_Periodicidad, dd.Numero_Emision, 
				dd.Folio_Impresion, ce.Anio_Moroso AS Ejercicio_Moroso, dd.Status AS Estatus, 
				obl_nombres_estatus.Nombre AS Nombre_Estatus, ce.Periodo_Inicial
			FROM         obl_control_emisiones AS ce INNER JOIN
			obl_detalle_documentos AS dd ON ce.Municipio = dd.Municipio AND ce.Oficina = dd.Oficina AND ce.Numero_Emision = dd.Numero_Emision INNER JOIN
			obl_nombres_estatus ON dd.Status = obl_nombres_estatus.Clave
			WHERE     (dd.RFC = @RFC) 
			AND (ce.Clave_Obligacion = @Clave_Obligacion) 
			AND (dd.Status NOT IN ('P', 'T', 'H', 'L', 'M', 'J', 'S', 'Y', 'Z', 'O', 'U', 'W', 'R'))		
			AND dd.Movimiento in ('R1')
		) as requerimientos 
		on pagos.RFC = requerimientos.RFC
		and pagos.Clave_Obligacion = requerimientos.Clave_Obligacion
		and pagos.Periodicidad = cast(requerimientos.Clave_Periodicidad as tinyint)
		and pagos.Ejercicio = requerimientos.Ejercicio_Moroso
		and pagos.Mes_Inicial = requerimientos.Periodo_Inicial
		order by pagos.Clave_Obligacion, pagos.Ejercicio, pagos.Mes_Inicial 

	FETCH NEXT FROM crObligaciones
	INTO @RFC
		,@Nombres 
		,@Apellido_Paterno 
		,@Apellido_Materno 
		,@MunicipioX 
		,@Localidad 
		,@Zona 
		,@Domicilio_Fiscal_Calle 
		,@Domicilio_Fiscal_Numero 
		,@Domicilio_Fiscal_Ubicacion 
		,@Domicilio_Fiscal_Colonia 
		,@Numero_Establecimiento
		,@Clave_Obligacion
		,@Nombre_Obligacion
		,@Fecha_Inicio
	END

	CLOSE crObligaciones
	DEALLOCATE crObligaciones

	-- 3.3) de la lista anterior, lso que ya hayan pagado, no tomarlos en cuenta 
	-- y buscar los que esten requeridos o marcarlos como no requeridos

	if (@Pagados = 'T')	
		select * from @tablaFinal 
	else 
		select * from @tablaFinal  where Pagado = @Pagados
	
END

#################### ejecutar pa anterior
DECLARE	@return_value int

EXEC	@return_value = dbo.pRpt_Morosos--_test_varios_rfcs
		@Ejercicio_Inicial = NULL,
		@Ejercicio_Final = NULL,
		@Mes_Inicial = NULL,
		@Mes_Final = NULL,
		@Lista_RFCS =  'RAAR481022HX4,ROCA7306028P8',
		--@Lista_RFCS =  'RAAR481022HX4',
		--@Lista_Obligaciones = '010611,010610,010623,010608,010102',
	   @Separador_Listas = ',',
		@Pagados = 't',
		@Municipio = '02',
		@Oficina = '01'

		,@debug = N's'

SELECT	'Return Value' = @return_value

GO

### la cuenta mestrella es una cuenta de sirref 
## cuando me llamen por que no pueden imprimir correctamente la multa por extemp
## de sirref checar el numero de emision en sirref_co_detalle

SELECT     ALR, RFC, Numero_Control, Numero_Emision, Movimiento, Concepto_Ley, Ejercicio_Fiscal, Numero_Pago, Agrupacion, Principal, Actualizacion, 
                      Recargo, Honorarios_Notificacion, Gastos_Ejecucion, Multa, Pagado, Numero_Operacion, Numero_Control AS Expr1, Movimiento AS Expr2
FROM         sirref_co_detalle
WHERE     (Movimiento = 'ME') AND (Numero_Emision = '57') AND (Ejercicio_Fiscal = 2009) AND (Numero_Control = '1004297W003877')

--update sirref_co_detalle
SET Numero_Emision = 957
WHERE (Numero_Control = '1004297W003877') AND (Movimiento = 'ME')
---------------------------------------------------------------------------------------------------------


### query que me trae los morosos de un periodo de intermedios cuando se quiere generar una emision
### en el caso de lazaro cardenas 
### saque este listado y de estos RFCs fui a pad contribuyentes y los marque como localizables

SELECT DISTINCT(s.RFC) FROM ( SELECT pad_oblxest.RFC, min(pad_oblxest.clave) as clave_obligacion 
FROM pad_obligacionesporestablecimiento pad_oblxest JOIN pad_contribuyentes cont ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre ON pad_oblxest.RFC = obl_oblvigpre.RFC 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion AND obl_oblvigpre.Tipo_Periodo = '02' 
AND obl_oblvigpre.Anio_Inicial = '2011' AND obl_oblvigpre.Mes_Inicial = '01' 
AND obl_oblvigpre.Estado = 'T' LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave = fed.Clave_Obligacion AND fed.Anio_Moroso = '2011' 
AND fed.Mes_Inicial = '01' AND fed.Clave_Periodicidad = '02' 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' WHERE pad_oblxest.Clave = '010611' 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2011-01-01',20) 
OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) 
AND cont.Municipio = '07' 
AND pad_oblxest.Situacion = 'Activo' 
AND cont.Situacion = 'Activo' 
AND fed.RFC IS NULL AND oco.RFC IS NULL 
AND cont.Localizable = 'S' 
AND obl_oblvigpre.RFC IS NULL 
AND pad_oblxest.RFC not in (SELECT a.RFC FROM obl_detalle_documentos a 
JOIN obl_control_emisiones b ON a.Municipio = b.Municipio AND a.Oficina = b.Oficina 
AND a.Numero_Emision = b.Numero_Emision WHERE a.Municipio = '07' 
AND a.Oficina = '01' AND a.Status in ('X') AND a.Movimiento in ('R1','R2','R3') 
AND b.Clave_Obligacion = '010611' GROUP BY a.RFC) GROUP BY (pad_oblxest.RFC) ) AS s 
INNER JOIN obl_obligacion_vigilable_presentada AS v ON s.rfc=v.rfc AND s.clave_obligacion=v.clave_obligacion 
WHERE v.anio_inicial>'2007' AND v.tipo_periodo='02' AND v.clave_obligacion = '010611' AND v.estado='T'

-----------------------------------------------------------------------------------------

##querys para traer a los morosos de repecos
##query que me trae solo la cantidad de morosos de repecos


SELECT  pad_oblxest.Clave, cont.*, Establecimientos.Nombre as Nombre_Comercial
				FROM pad_obligacionesporestablecimiento pad_oblxest
				JOIN pad_contribuyentes cont
					ON pad_oblxest.RFC = cont.RFC
				LEFT JOIN ( SELECT DISTINCT(RFC),Nombre FROM pad_establecimientos est
							WHERE est.Municipio = '06'
							AND est.Tipo_Establecimiento = 'Matriz'
							AND est.Situacion = 'Activo') as Establecimientos
					ON pad_oblxest.RFC = Establecimientos.RFC
				LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre
					ON pad_oblxest.RFC = obl_oblvigpre.RFC
					AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion
					AND obl_oblvigpre.Tipo_Periodo = '03'
					AND obl_oblvigpre.Anio_Inicial = '2006'
					AND obl_oblvigpre.Mes_Inicial = '08'
					AND obl_oblvigpre.Mes_Final = '09'
					AND obl_oblvigpre.Estado = 'T'
				LEFT JOIN obl_datos_federales fed
					ON pad_oblxest.RFC = fed.RFC
					AND pad_oblxest.Clave = fed.Clave_Obligacion
					AND fed.Anio_Moroso = '2006'
					AND fed.Mes_Inicial = '08'
					AND fed.Mes_Final = '09'
					AND fed.Clave_Periodicidad = '03'
				LEFT JOIN RFCNoLoc NoLoc
					ON cont.RFC = NoLoc.RFC
				LEFT JOIN obl_contribuyentes_omitidos oco
					ON pad_oblxest.RFC = oco.RFC
					AND pad_oblxest.Clave = oco.Clave_Obligacion
					AND oco.Activado = 'S'
				WHERE pad_oblxest.Clave in ('010610','010618','010623')
					AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2006-09-01',20)
					OR pad_oblxest.Fecha_Inicio = ''
					OR pad_oblxest.Fecha_Inicio IS NULL )
					AND cont.Municipio = '06' 
					AND pad_oblxest.Situacion = 'Activo'
					AND cont.Situacion = 'Activo'
					AND fed.RFC IS NULL
					AND NoLoc.RFC IS NULL
					AND obl_oblvigpre.RFC IS NULL
					AND cont.Localidad = '0001'
				    AND cont.Zona = '001'
					AND cont.Localizable = 'S'
					AND oco.RFC IS NULL
-----------------------------------------------------------------------------------				  
	## query para generar la emision de repecos
SELECT  pad_oblxest.Clave, cont.*, Establecimientos.Nombre as Nombre_Comercial 
FROM pad_obligacionesporestablecimiento pad_oblxest 
JOIN pad_contribuyentes cont ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN ( SELECT DISTINCT(RFC),Nombre 
			FROM pad_establecimientos est 
			WHERE est.Municipio = '06' 
			AND est.Tipo_Establecimiento = 'Matriz' 
			AND est.Situacion = 'Activo') as Establecimientos 
			ON pad_oblxest.RFC = Establecimientos.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '03' 
AND obl_oblvigpre.Anio_Inicial = '2006' 
AND obl_oblvigpre.Mes_Inicial = '08' 
AND obl_oblvigpre.Mes_Final = '09' 
AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave = fed.Clave_Obligacion 
AND fed.Anio_Moroso = '2006' 
AND fed.Mes_Inicial = '08' 
AND fed.Mes_Final = '09' 
AND fed.Clave_Periodicidad = '03' 
LEFT JOIN RFCNoLoc NoLoc ON cont.RFC = NoLoc.RFC 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion 
AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave in ('010610','010618','010623') 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2006-09-01',20) OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) AND cont.Municipio = '06' AND pad_oblxest.Situacion = 'Activo' AND cont.Situacion = 'Activo' AND fed.RFC IS NULL AND NoLoc.RFC IS NULL AND obl_oblvigpre.RFC IS NULL AND cont.Localizable = 'S' AND oco.RFC IS NULL AND cont.Localidad = '0001' AND cont.Zona = '001' ORDER BY pad_oblxest.RFC 

-----------------------------------------------------------------------------
##prueba solo los datos de un mes complementar el procedimient almac
SELECT     obl_cat_obligaciones.Ejercicio, obl_cat_obligaciones.Clave_Obligacion, cat_periodos.Tipo, cat_periodos.Descripcion_Tipo_Periodo, 
                      cat_periodos.Mes_Inicial, cat_periodos.Mes_Final, cat_periodos.Descripcion
FROM         obl_cat_obligaciones 
INNER JOIN
cat_periodos ON CAST(obl_cat_obligaciones.Periodicidad AS int) = CAST(cat_periodos.Tipo AS int) 
INNER JOIN
cat_obligaciones ON obl_cat_obligaciones.Clave_Obligacion = cat_obligaciones.Clave
WHERE     (obl_cat_obligaciones.Ejercicio BETWEEN '2009' AND '2009') 
and (cat_periodos.Mes_Inicial ='1') --and (cat_periodos.Mes_Final <='12')
AND (cat_obligaciones.Vigilable_Proceso_Emision = 1)


-----------------------------------------------------------------------------------------------------
###para reportar requerimientos PAGADOS durante un mes coral salas
###la ultima vez que calcule utilize este metodo pues el primero no me mostraban resultados confiables
select count(*)
from obl_detalle_documentos a
where a.Municipio = '02' AND a.Oficina = '02'
AND CONVERT(varchar(10),a.Fecha_Ultimo_Movimiento,20)
BETWEEN '2010-11-01' AND '2010-11-30'
AND a.status in ('P','T')
AND a.Movimiento = 'R1'


##para reportar las multas por incumplimiento pagadas durante un mes peticion coral salas
select count(*)
from obl_detalle_documentos a
where a.Municipio = '02' AND a.Oficina = '02'
AND CONVERT(varchar(10),a.Fecha_Ultimo_Movimiento,20)
BETWEEN '2010-11-01' AND '2010-11-30'
AND a.status in ('P','T')
AND a.Movimiento = 'I1'

select case when  movimiento='I1' then 'Multas por Incumplimiento' 
when movimiento='R1'  then 'Primer Requerimientos' end as Movimiento,count(*) as Total_Pagados
from obl_detalle_documentos a
where a.Municipio = @Municipio AND a.Oficina = @Oficina
AND CONVERT(varchar(10),a.Fecha_Ultimo_Movimiento,20)
BETWEEN @fecha_inicial AND @fecha_final
AND a.status in ('P','T') and (a.Movimiento = 'R1' or a.Movimiento = 'I1')
group by Movimiento

---------------------------------------------------------------------------------------------------
--obtener los requerimientos y not. cred. IMPRESAS durante un mes
--comentar y descomentar las opciones cuando esta en estatus B y cuando la fecha de impresion no es null para 
--comparar y ver que las cantidades totales queden igual.
select count(*)
from obl_detalle_documentos a
where a.Municipio = '02' AND a.Oficina = '02'
AND CONVERT(varchar(10),a.Fecha_Impresion,20)
BETWEEN '2009-12-01' AND '2009-12-31'
AND a.status not in ('B') and a.Fecha_Impresion is not null
AND a.Movimiento = 'R1'

select count(*)
from obl_detalle_documentos a
where a.Municipio = '02' AND a.Oficina = '02'
AND CONVERT(varchar(10),a.Fecha_Impresion,20)
BETWEEN '2009-12-01' AND '2009-12-31'
--AND a.status not in ('B') and a.Fecha_Impresion is not null
AND a.Movimiento = 'I1'

--------------------------------------------------------------------------------------------------
---el caso especial de los pagos marcados DE ISTUV, el sig query me dice los numeros de operacion de enero 2009 
select  Numero_Operacion --*--count(*)
from obl_detalle_documentos a
join obl_detalle_vehiculo as b on
a.Numero_Emision=b.Numero_Emision and
a.Oficina=b.Oficina and 
a.Municipio=b.Municipio and 
a.Folio_Impresion= b.Folio_Impresion
where a.Municipio = '02' AND a.Oficina = '02'
AND CONVERT(varchar(10),b.Fecha_Pago,20)
BETWEEN '2010-01-01' AND '2010-01-31'
AND a.status in ('P','T')
AND a.Movimiento = 'R1'
group by Numero_Operacion
-----------------------------------------------------------------------------
###ejemplo de documento que se encuentra en estatus de pago espontaneo pero
no se localiza la base para fundamentar que se encuentre, como pago espontaneo pues no existe en la base de datos.
este es en ch-sarh
select * from obl_detalle_documentos as a
join obl_detalle_sucursales as b on a.Numero_emision=b.Numero_emision 
and a.Folio_Impresion=b.Folio_Impresion and a.Municipio=b.Municipio
where a.Folio_Impresion='4460' and 
a.Numero_Emision='0922' and b.Numero_Operacion is null and Pagado='S'


## este ejemplo es el registro que realize con la opcion cancelacion de documentos
hecho en ch-sarh2

select * from obl_detalle_documentos as a
inner join obl_control_emisiones as b on a.Numero_emision=b.Numero_Emision
and a.Municipio=b.Municipio and a.Oficina=b.Oficina 
inner join obl_detalle_sucursales  as c on b.Numero_emision=c.Numero_Emision
and b.Municipio=c.Municipio and b.Oficina=c.Oficina and a.Folio_Impresion=c.Folio_Impresion
where b.Clave_Obligacion='010103' 
and b.Ejercicio_Fiscal='2008' 
 and a.Municipio='01' 
and a.Folio_Impresion='274'
order by a.RFC

-------------------------------------------------------------------------------
## mtuz usuario sirref de isla mujeres....
##
-----------------------------------------

#####ACLARACION RICARDO BENITO JUAREZ

SELECT     *, Numero_Emision AS Expr1, Municipio AS Expr2, Folio_Impresion AS Expr3
FROM         obl_detalle_documentos
WHERE     (Numero_Emision = '0950') AND (Municipio = '02') AND Folio_Impresion IN ('11509','11504','11497', 
'11514','11488','11359','11501','11577','11576','11565','11492','11477','11479','11480', '11470 ', ' 11474 ', ' 11447 ', ' 11453 ', ' 11606 ',' 11632 ', ' 11590 ', ' 11513 ', ' 11516 ')


-------------------------------------------------------------------------------
### tablas para trabajar el salario minimo

select * from cob_rubros_conceptos 
select top 1 (Salario_Minimo) from cat_salarios_minimos order by fecha_publicacion desc

-------------------------------------------------------------------------------

**modificaciones para el calculo de morosos de control de obligaciones de intermedios


**quite del archivo desglose_por_municipio  la condicion AND cont.Zona = '001' cuando se calcula la cantidad de morosos
** cuando se generan los paquete de la emision en el archivo genera_emision_paquetes tambien quite la especificacion, en los intermedios




----clara
este es mi nuevo num 983 83 68506

cita mama 20
-----
limite
clave_obligacion
clave_municipio
clavePeriodicidad
ejercicioFiscal
mes
mesFinal
ejercicioFiscal
claveZona
claveOficina
anio

1408
641


------------------------------


**localizar la basura de vigilable_presentada
SELECT    Anio_Inicial, max(Anio_Final), count(*)
FROM         obl_obligacion_vigilable_presentada
group by Anio_Inicial


------------------------------

--Ya pagaron
	select distinct a.RFC from 
	obl_obligacion_vigilable_presentada as a 
	inner join pad_contribuyentes as b
	on a.RFC=b.RFC  
	inner join pad_obligacionesporestablecimiento	as c
	on a.RFC= c.RFC and a.Numero_Establecimiento= c.Numero_Establecimiento
	where a.Tipo_Periodo = '02'
	AND a.Anio_Inicial = '2009'
	AND a.Clave_Obligacion = '010611'
	AND a.Mes_Inicial = 11
	AND a.Estado = 'T'
	AND b.Municipio ='01'

--Padron Deben Pagar
	select DISTINCT a.RFC from 
	pad_contribuyentes as a, pad_obligacionesporestablecimiento as b,
    cat_periodos as c
	where c.Tipo = 2
    AND a.RFC=b.RFC
	AND b.Clave = '010611'
    AND b.Numero_Establecimiento='00000'
    AND b.Situacion='Activo' 
    AND c.Mes_Inicial=11
	AND a.Municipio ='01'


morosos federales actualizado el query

SELECT  * FROM 
	pad_contribuyentes as a, pad_obligacionesporestablecimiento as b,
    cat_periodos as c
	WHERE c.Tipo = 2
    AND a.RFC=b.RFC
	AND b.Clave = '010611'
    AND b.Numero_Establecimiento='00000'
    AND a.Situacion='Activo'
	AND b.Situacion='Activo'
	AND c.Mes_Inicial=11
	AND a.Municipio ='01'
	AND a.Localidad = '0001'
    AND a.Localizable = 'S'
	AND (b.Fecha_Inicio <= CONVERT(datetime,'2009-11-01',20)
								OR b.Fecha_Inicio = ''
								OR b.Fecha_Inicio IS NULL )
    AND a.RFC NOT IN (	SELECT RFC FROM obl_contribuyentes_omitidos WHERE Clave_Obligacion='010611' and Activado='S')
    AND a.RFC NOT IN (	SELECT DISTINCT a.RFC from 
	obl_obligacion_vigilable_presentada as a 
	inner join pad_contribuyentes as b
	on a.RFC=b.RFC  
	inner join pad_obligacionesporestablecimiento	as c
	on a.RFC= c.RFC and a.Numero_Establecimiento= c.Numero_Establecimiento
	where a.Tipo_Periodo = '02'
	AND a.Anio_Inicial = '2009'
	AND a.Clave_Obligacion = '010611'
	AND a.Mes_Inicial = 11
	AND a.Estado = 'T'
	AND b.Municipio ='01' )
	AND a.RFC NOT IN (SELECT RFC from obl_datos_federales e
	where e.Municipio= '01'
	AND e.Oficina='01'
	AND e.Anio_Moroso='2009'
	AND e.Mes_Inicial = '11'
	AND e.Clave_Periodicidad = '02'
	AND e.Clave_Obligacion ='010611')

----------------------------------------------------------------
***    update con inner join 
		 update #TMP_datos_federales
                   SET #TMP_datos_federales.Folio_Impresion=b.Folio_Impresion
                   FROM #TMP_datos_federales as a INNER JOIN #TMP_detalle_documentos as b
                   on a.RFC=b.RFC;

----------------------------------------------------------------
crea un contador a partir de un folio 

			SELECT @Folio_Impresion=Max(datos.Folio_Impresion) 
			FROM obl_datos_federales datos
			LEFT JOIN obl_control_emisiones emision
				ON datos.Municipio = emision.Municipio
				AND datos.Oficina = emision.Oficina
				AND datos.Numero_Emision = emision.Numero_Emision
			WHERE datos.Municipio = @Municipio 
				AND datos.Oficina = @ClaveOficina
				AND emision.Clave_Obligacion in ('010610','010618','010623')
				AND emision.Ejercicio_Fiscal = @Anio
  WITH CTE
     AS (SELECT Folio_Impresion,@Folio_Impresion+ROW_NUMBER()
               OVER (ORDER BY RFC ASC) AS ROWNUM FROM #TMP_detalle_documentos)
          UPDATE CTE
          SET Folio_Impresion = ROWNUM;

-------------------------------------------------------------

USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[Requerir_Morosos_Repecos]    Fecha de la secuencia de comandos: 01/19/2010 10:56:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Ramon Sosa, Lilí Lizardi
-- Create date: 14/01/2010
-- Description:	Requerir Morosos de REPECOS
-- =============================================
ALTER PROCEDURE [dbo].[Requerir_Morosos_Repecos]
	-- Add the parameters for the stored procedure here
		@Limite int,
		@Clave_Obligacion varchar(MAX),
		@Municipio varchar(2),
		@ClavePeriodicidad varchar(2),
		@EjercicioFiscal varchar(4),
		@Mes varchar(2),
		@MesFinal varchar (2),
		@ClaveLocalidad varchar(10),
		@ClaveZona varchar(10),
		@ClaveOficina varchar(10),
		@Anio varchar(4),
		@Numero_Emision varchar(10),
		@Separador varchar(3) = ','
		
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

	--Declaramos e inicializamos
	DECLARE @LimiteTriple int;
	DECLARE @texto_zona varchar(50);
	DECLARE @FolioNumeroControl BIGINT;
	DECLARE @Total BIGINT;
	DECLARE @RFC_Final varchar (13);
	DECLARE @Contador_Morosos_Federales BIGINT;
	DECLARE @Folio_Impresion BIGINT;
	SET @Folio_Impresion=0
	SET @Contador_Morosos_Federales=0
	SET @FolioNumeroControl =0
	SET @RFC_Final=''
	SET @LimiteTriple =0	
	SET @Total =0

    
	CREATE TABLE #RFCNoLoc(
       RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS
    );
	CREATE TABLE #TMP_detalle_documentos(
			Municipio VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
			Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
			Numero_Emision VARCHAR (4) COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 	RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Numero_Serie VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS, 
			Movimiento VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
			Status VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS, 
			Folio_Impresion BIGINT 
    );
	
	CREATE TABLE #TMP_datos_federales
	(
			Municipio VARCHAR (2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
			Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
			Numero_Emision VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 	RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS,
			CURP VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Numero_Serie VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Folio_Impresion BIGINT ,
			Nombre_Contribuyente VARCHAR (200)COLLATE SQL_Latin1_General_CP1_CI_AS,
			Apellido_Paterno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Apellido_Materno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Localidad VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Zona VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Localidad_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Colonia_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Domicilio_Calle VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--este esta muy pequeño y no caben,
			Domicilio_Numero VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Domicilio_Colonia VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--otro pequeño
			Domicilio_Ubicacion VARCHAR(255) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Domicilio_Codigo_Postal VARCHAR(8) COLLATE SQL_Latin1_General_CP1_CI_AS,--este tambien esta pequeño debe ser 8 
			Ejercicio_Fiscal VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Anio_Moroso VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Mes_Inicial VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Mes_Final VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Pagado VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Clave_Periodicidad VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Numero_Control VARCHAR(14) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Folio_Facturacion VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
			Numero_Operacion VARCHAR(14)COLLATE SQL_Latin1_General_CP1_CI_AS,
			Nombre_Comercial VARCHAR(63)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL
	);
	--Guardamos en la tabla RFCNoLoc los rfc de contribuyentes 
	--Marcados como no localizados y doble no localizados

	INSERT INTO #RFCNoLoc
	SELECT a.RFC 
	FROM obl_detalle_documentos a
	JOIN obl_control_emisiones b
	ON a.Municipio = b.Municipio
	AND a.Oficina = b.Oficina
	AND a.Numero_Emision = b.Numero_Emision
	WHERE a.Municipio = @Municipio 
	AND a.Status in ('N','X')
	AND a.Movimiento in ('R1','R2','R3')
	AND b.Clave_Obligacion in (select * from dbo.SplitString(@Clave_Obligacion, @Separador))
	GROUP BY a.RFC
	
	--Multiplico el limite que ingresa el usuario para generar la emision triple
	SET @LimiteTriple = @Limite * 3
   
	--$numeroControl = generaNumeroControl( $municipio, $numeroEmision, $folioNumeroControl);

	--QUERY QUE ME DEVUELVE LOS REGISTROS QUE VOY A INSERTAR EN LA TABLA obl_detalle_documentos

	
			SELECT @Folio_Impresion=Max(datos.Folio_Impresion) 
			FROM obl_datos_federales datos
			LEFT JOIN obl_control_emisiones emision
				ON datos.Municipio = emision.Municipio
				AND datos.Oficina = emision.Oficina
				AND datos.Numero_Emision = emision.Numero_Emision
			WHERE datos.Municipio = @Municipio 
				AND datos.Oficina = @ClaveOficina
				AND emision.Clave_Obligacion in (select * from dbo.SplitString(@Clave_Obligacion, @Separador))
				AND emision.Ejercicio_Fiscal = @Anio

           --SELECT @Folio_Impresion;


		--QUERY QUE ME DEVUELVE LOS DATOS QUE VOY A INSERTAR EN LA TABLA obl_datos_federales
	
	INSERT INTO #TMP_datos_federales
	SELECT  TOP (@LimiteTriple) 
					@Municipio as Municipio, 
					@ClaveOficina as Oficina,
					@Numero_Emision as Numero_Emision, 
					pad_contribuyentes.RFC, 
					pad_contribuyentes.CURP,
					'00' as Numero_Serie,
					0 as Folio_Impresion, 
					pad_contribuyentes.Nombres as Nombre_Contribuyente, 
					pad_contribuyentes.Apellido_Paterno, 
					pad_contribuyentes.Apellido_Materno,
					pad_contribuyentes.Localidad, 
					pad_contribuyentes.Zona, 
					pad_contribuyentes.Localidad_Federal, 
					pad_contribuyentes.Colonia_Federal, 
					pad_contribuyentes.Domicilio_Fiscal_Calle as Domicilio_Calle,
					pad_contribuyentes.Domicilio_Fiscal_Numero as Domicilio_Numero, 
					pad_contribuyentes.Domicilio_Fiscal_Colonia as Domicilio_Colonia, 
					pad_contribuyentes.Domicilio_Fiscal_Ubicacion as Domicilio_Ubicacion,
					pad_contribuyentes.Localidad_Federal as Domicilio_Codigo_Postal,
					@Anio as Ejercicio_Fiscal, 
					@EjercicioFiscal as Anio_Moroso,
					@Mes as Mes_Inicial,
					@MesFinal as Mes_Final,
					'N' as Pagado,
					pad_oblxest.Clave as Clave_Obligacion,
					@ClavePeriodicidad as Clave_Periodicidad,
					'' as Numero_Control,
					'' as Folio_Facturacion,
					'' Numero_Operacion,
					est.Nombre as Nombre_Comercial
	FROM	pad_contribuyentes as pad_contribuyentes , 
			pad_obligacionesporestablecimiento as pad_oblxest ,
			cat_periodos as c,
			pad_establecimientos as est
	WHERE	c.Tipo = @ClavePeriodicidad
			AND pad_contribuyentes.RFC=pad_oblxest.RFC
			AND pad_oblxest.Clave in (select * from dbo.SplitString(@Clave_Obligacion, @Separador))
			AND pad_oblxest.Numero_Establecimiento='00000'
			AND pad_contribuyentes.Situacion='Activo'
			AND pad_oblxest.Situacion='Activo'
			AND c.Mes_Inicial= @Mes
			AND pad_contribuyentes.Municipio = @Municipio
			AND pad_contribuyentes.Localidad like ('%'+@ClaveLocalidad+'%')
			AND pad_contribuyentes.Zona like ('%'+@ClaveZona+'%')
			AND pad_contribuyentes.Localizable = 'S'
			AND pad_oblxest.RFC = est.RFC
			AND est.Municipio = @Municipio
			AND est.Tipo_Establecimiento = 'Matriz'
			AND est.Situacion = 'Activo'
			AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,@EjercicioFiscal+'-'+@MesFinal+'-'+'01',20)
								OR pad_oblxest.Fecha_Inicio = ''
								OR pad_oblxest.Fecha_Inicio IS NULL )
			AND pad_contribuyentes.RFC NOT IN (	
					SELECT RFC 
					FROM obl_contribuyentes_omitidos 
					WHERE Clave_Obligacion in (select * from dbo.SplitString(@Clave_Obligacion, @Separador)) and Activado='S')
			AND pad_contribuyentes.RFC NOT IN (	
					SELECT DISTINCT cont.RFC 
					FROM	obl_obligacion_vigilable_presentada as obl_oblvigpre
					INNER JOIN  pad_contribuyentes as cont 
					ON obl_oblvigpre.RFC=cont.RFC 
					INNER JOIN pad_obligacionesporestablecimiento	as pad_oblxest 
					ON obl_oblvigpre.RFC= pad_oblxest.RFC 
					AND obl_oblvigpre.Numero_Establecimiento= pad_oblxest.Numero_Establecimiento 
					WHERE obl_oblvigpre.Tipo_Periodo = @ClavePeriodicidad
					AND obl_oblvigpre.Anio_Inicial = @EjercicioFiscal
					AND obl_oblvigpre.Clave_Obligacion in (select * from dbo.SplitString(@Clave_Obligacion, @Separador))
					AND obl_oblvigpre.Mes_Inicial = @mes
					AND obl_oblvigpre.Estado = 'T'
					AND cont.Municipio ='01' )
			AND pad_contribuyentes.RFC NOT IN (
					SELECT RFC 
					FROM obl_datos_federales as fed 
					WHERE fed.Municipio= @Municipio
			AND fed.Anio_Moroso=@EjercicioFiscal
			AND fed.Mes_Inicial = @Mes
			AND fed.Clave_Periodicidad = @ClavePeriodicidad
			AND fed.Clave_Obligacion in (select * from dbo.SplitString(@Clave_Obligacion, ',')))
	ORDER BY pad_contribuyentes.RFC;

	INSERT INTO #TMP_detalle_documentos
	SELECT  @Municipio as Municipio, 
					@ClaveOficina as Oficina, 
					@Numero_Emision as Numero_Emision, 
					RFC,
					'00' as Numero_Serie, 
					'R1' as Movimiento, 
					'B' as Status, 0 as Folio_Impresion
	FROM #TMP_datos_federales
	GROUP BY RFC ORDER BY RFC ;


     WITH CTE
     AS (SELECT Folio_Impresion,@Folio_Impresion+ROW_NUMBER()
               OVER (ORDER BY RFC ASC) AS ROWNUM FROM #TMP_detalle_documentos)
          UPDATE CTE
          SET Folio_Impresion = ROWNUM;


	SELECT  TOP (1) @RFC_Final=RFC from #TMP_detalle_documentos order by RFC desc 
	SELECT  * from #TMP_detalle_documentos 
	
	DELETE FROM #TMP_datos_federales where RFC = @RFC_Final;

		
	INSERT INTO #TMP_datos_federales
	SELECT  TOP (@LimiteTriple) 
					@Municipio as Municipio, 
					@ClaveOficina as Oficina,
					@Numero_Emision as Numero_Emision, 
					pad_contribuyentes.RFC, 
					pad_contribuyentes.CURP,
					'00' as Numero_Serie,
					0 as Folio_Impresion, 
					pad_contribuyentes.Nombres as Nombre_Contribuyente, 
					pad_contribuyentes.Apellido_Paterno, 
					pad_contribuyentes.Apellido_Materno,
					pad_contribuyentes.Localidad, 
					pad_contribuyentes.Zona, 
					pad_contribuyentes.Localidad_Federal, 
					pad_contribuyentes.Colonia_Federal, 
					pad_contribuyentes.Domicilio_Fiscal_Calle as Domicilio_Calle,
					pad_contribuyentes.Domicilio_Fiscal_Numero as Domicilio_Numero, 
					pad_contribuyentes.Domicilio_Fiscal_Colonia as Domicilio_Colonia, 
					pad_contribuyentes.Domicilio_Fiscal_Ubicacion as Domicilio_Ubicacion,
					pad_contribuyentes.Localidad_Federal as Domicilio_Codigo_Postal,
					@Anio as Ejercicio_Fiscal, 
					@EjercicioFiscal as Anio_Moroso,
					@Mes as Mes_Inicial,
					@MesFinal as Mes_Final,
					'N' as Pagado,
					pad_oblxest.Clave as Clave_Obligacion,
					@ClavePeriodicidad as Clave_Periodicidad,
					'' as Numero_Control,
					'' as Folio_Facturacion,
					'' Numero_Operacion,
					est.Nombre as Nombre_Comercial
	FROM	pad_contribuyentes as pad_contribuyentes , 
			pad_obligacionesporestablecimiento as pad_oblxest ,
			pad_establecimientos as est
	WHERE	pad_contribuyentes.RFC=pad_oblxest.RFC
			AND pad_contribuyentes.RFC= @RFC_Final
			AND pad_oblxest.Clave in (select * from dbo.SplitString(@Clave_Obligacion, @Separador))
			AND pad_oblxest.Numero_Establecimiento='00000'
			AND pad_contribuyentes.Situacion='Activo'
			AND pad_oblxest.Situacion='Activo'
			AND pad_contribuyentes.Municipio = @Municipio
			AND pad_contribuyentes.Localidad like ('%'+@ClaveLocalidad+'%')
			AND pad_contribuyentes.Zona like ('%'+@ClaveZona+'%')
			AND pad_contribuyentes.Localizable = 'S'
			AND pad_oblxest.RFC = est.RFC
			AND est.Municipio = @Municipio
			AND est.Tipo_Establecimiento = 'Matriz'
			AND est.Situacion = 'Activo'
	ORDER BY pad_contribuyentes.RFC;

	UPDATE #TMP_datos_federales
    SET #TMP_datos_federales.Folio_Impresion=b.Folio_Impresion
    FROM #TMP_datos_federales as a INNER JOIN #TMP_detalle_documentos as b
    ON a.RFC=b.RFC;
	
	SELECT * FROM #TMP_datos_federales;
	
END
---------------------------------------------
---requerir morosos de intermedios
SELECT pad_oblxest.RFC FROM pad_obligacionesporestablecimiento pad_oblxest 
JOIN pad_contribuyentes cont ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '02' AND obl_oblvigpre.Anio_Inicial = '2010' 
AND obl_oblvigpre.Mes_Inicial = '08' AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave = fed.Clave_Obligacion AND fed.Anio_Moroso = '2010' 
AND fed.Mes_Inicial = '08' AND fed.Clave_Periodicidad = '02' 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave = '010611' AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2010-08-01',20) 
OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) AND cont.Municipio = '07' 
AND pad_oblxest.Situacion = 'Activo' AND cont.Situacion = 'Activo' AND fed.RFC 
IS NULL AND oco.RFC IS NULL 
AND cont.Localidad = '0001' 
AND cont.Localizable = 'S' 
AND obl_oblvigpre.RFC IS NULL AND pad_oblxest.RFC 
not in (SELECT a.RFC FROM obl_detalle_documentos a 
JOIN obl_control_emisiones b ON a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina AND a.Numero_Emision = b.Numero_Emision 
WHERE a.Municipio = '07' AND a.Oficina = '01' AND a.Status in ('X') 
AND a.Movimiento in ('R1','R2','R3') AND b.Clave_Obligacion = '010611' GROUP BY a.RFC) 
GROUP BY (pad_oblxest.RFC) 

-----------------------------------------------
**reemplazar una cadena dentro de otra
SELECT REPLACE($campo,'cde','xxx');
GO
---------------------------------------------
**usar una comilla simple dentro de otras comillas simples

'Select * from tabla Where tabla.mes <= '+chr(39)+Edit1.text+chr(39)+';


**substraer una parte de caracteres de una cadena
Case pad_contribuyentes.Localidad_Federal
					when ''
					then SUBSTRING ( pad_contribuyentes.Localidad_Federal ,1,5)
					else SUBSTRING ( pad_contribuyentes.Colonia_Federal ,1,5)
					END
					as Domicilio_Codigo_Postal
from pad_contribuyentes 
where RFC='AAAS690102S89'
---------------------------------------------
**cuando no aparece un requerimiento no localizado en el reporte de no_localizados
--checar el numero de serie que quiza no coincide

SELECT     Municipio, Oficina, Numero_Emision, RFC, Numero_Serie, Folio_Impresion, Nombre_Contribuyente, Apellido_Paterno, Apellido_Materno, Localidad, 
                      Domicilio_Calle, Domicilio_Numero, Domicilio_Colonia, Domicilio_Ubicacion, Domicilio_Codigo_Postal, Ejercicio_Fiscal, Pagado, Clave_Obligacion, 
                      Clave_Periodicidad, Placa, Modelo, Marca, Sub_Marca, Numero_Motor, Folio_Anterior
FROM         obl_datos_vehiculo
WHERE     (Municipio = '04') AND (Oficina = '01') AND (Numero_Emision = '0926') AND (Folio_Impresion = '273')


-------------------------------------------------
delete 
from obl_control_emisiones 
where Numero_Emision like ('10%')

delete
from obl_detalle_documentos
where Numero_Emision like ('10%')

delete
from obl_datos_federales
where Numero_Emision like ('10%')



select * 
from obl_control_emisiones 
where Numero_Emision like ('10%')

select * 
from obl_detalle_documentos
where Numero_Emision like ('10%')

select *
from obl_datos_federales
where Numero_Emision like ('10%')
order by Folio_Impresion


---------------------------------------------------
en un procedimiento almacenado cuando una variable es null ponerlo en 0

--		   SET @Folio_Impresion = (CASE WHEN @Folio_Impresion IS NULL THEN 0
	--						ELSE @Folio_Impresion
	--					 END)
----------------------------------------------------
*********enlace istuv
$username_enlace = "tenencias";
$password_enlace = "C3AkX#eNK¡";
-----------------------------------
**modificar el tipo de dato de un campo
ALTER TABLE [dbo].[person]
ALTER COLUMN [lastname] VARCHAR(35) NULL

GO 

ALTER TABLE cvdb06
ALTER COLUMN FOL_CVDB06 BIGINT NULL

GO 
-------------------------------------------------------------
#############update con inner join
UPDATE CLIENTESSETNOMBRE = FICHERO_CLIENTES.NOMBRE,APELLIDO1 = FICHERO_CLIENTES.APELLIDO1,APELLIDO2 = FICHERO_CLIENTES.APELLIDO2
FROM CLIENTES
INNER JOIN FICHERO_CLIENTES 	
ON FICHERO_CLIENTES.CO_CLIENTE = CLIENTES.CO_CLIENTE 


-------------------------------------------------------------

##procedimiento almacenado que actualiza los pagos de istuv con la tabla cvdb_06


USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[Marcar_Pagos_Istuv]    Fecha de la secuencia de comandos: 01/28/2010 12:22:41 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Ramon Sosa, Lilí Lizardi
-- Create date: 27/01/2010
-- Description:	Marcar pagos de Istuv 
-- =============================================
ALTER PROCEDURE [dbo].[Marcar_Pagos_Istuv]
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
			    
			
		CREATE TABLE #TMP_datos
		(		Municipio VARCHAR (2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Ejercicio_Fiscal VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Folio_Impresion BIGINT,
		 		Numero_Serie VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Movimiento VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Status VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				SubStatus VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Anio_Moroso VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Pagado VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Pago DATETIME,
				Numero_Operacion VARCHAR(14) COLLATE SQL_Latin1_General_CP1_CI_AS
		);

		INSERT INTO #TMP_datos
		select  
			a.Municipio, 
			a.Oficina, 
			a.Numero_Emision, 
			a.Ejercicio_Fiscal,
			b.Folio_Impresion, 
			b.Numero_Serie, 
			b.RFC, 
			b.Movimiento,
			b.Status, 
			b.Substatus, 
			c.Anio_Moroso,
			c.Pagado,
			d.FEC_CVDB06 as Fecha_Pago,
			d.FOL_CVDB06 AS Numero_Operacion
		from obl_control_emisiones as a
		inner join obl_detalle_documentos as b on 
			a.Municipio=b.Municipio 
			and a.Oficina=b.Oficina 
			and a.Numero_Emision=b.Numero_Emision
		inner join obl_detalle_vehiculo as c on
			a.Municipio=b.Municipio 
			and b.Oficina=c.Oficina 
			and b.Numero_Emision=c.Numero_Emision
			and b.Folio_Impresion=c.Folio_Impresion
			and b.Numero_Serie= c.Numero_Serie
		inner join tenencias.dbo.cvdb06  as d on
			b.Numero_Serie= d.NSE_CVDB06  
			and d.ACO_CVDB06 = c.Anio_Moroso 
			and d.TRA_CVDB06 ='TEN'
		where a.Clave_Obligacion='010603'
			and b.Status in ('E','V','C','N','X','A','B','I','D')  
			and c.Pagado ='N'
			--and b.Numero_Serie in ('9BWDC05X53T059276')
		order by a.Municipio, b.Numero_Serie, c.Anio_Moroso;
		
	select * from #TMP_datos;
	/*	
/*select b.Municipio, b.Oficina, b.Numero_Emision, 
			   b.Folio_Impresion, b.Numero_Serie, b.Anio_Moroso,
			   b.Numero_Operacion, b.Pagado, b. Fecha_Pago,  
			   #TMP_datos.Fecha_Pago, #TMP_datos.Numero_Operacion*/
		update obl_detalle_vehiculo
		set Numero_Operacion= #TMP_datos.Numero_Operacion,
			Pagado='S',
			Fecha_Pago=#TMP_datos.Fecha_Pago		
		from obl_detalle_vehiculo as b 
		inner join  #TMP_datos  on 
			b.Municipio= #TMP_datos.Municipio
			and b.Oficina=#TMP_datos.Oficina
			and b.Numero_Emision=#TMP_datos.Numero_Emision
			and b.Folio_Impresion=#TMP_datos.Folio_Impresion
			and b.Numero_Serie=#TMP_datos.Numero_Serie
			and b.Anio_Moroso=#TMP_datos.Anio_Moroso;


		/*select a.Municipio, a.Oficina, a.Numero_Emision, 
			   a.Folio_Impresion, a.Numero_Serie, a.Movimiento, a.Status, 
				a.Substatus,
				a.Fecha_Ultimo_Movimiento,
			    #TMP_datos.Fecha_Pago,#TMP_datos.Numero_Operacion*/
		UPDATE obl_detalle_documentos
		SET Substatus= a.Status,
			Status = CASE WHEN (a.Status in ('E','V')) then  'P' ELSE 'T' END,
			Fecha_Ultimo_Movimiento=getdate()
		from obl_detalle_documentos as a  
		inner join  #TMP_datos  on 
			a.Municipio= #TMP_datos.Municipio
			and a.Oficina=#TMP_datos.Oficina
			and a.Numero_Emision=#TMP_datos.Numero_Emision
			and a.Folio_Impresion=#TMP_datos.Folio_Impresion
			and a.Numero_Serie=#TMP_datos.Numero_Serie
			and a.Movimiento=#TMP_datos.Movimiento;
		

		/*select c.Municipio, c.Oficina, c.Numero_Emision, 
			   c.Folio_Impresion, c.Numero_Serie, c. Pagado, 
			   #TMP_datos.Fecha_Pago, #TMP_datos.Numero_Operacion*/
		UPDATE obl_datos_vehiculo
		SET Pagado= 'S'
		from  obl_datos_vehiculo as c 
		inner join  #TMP_datos  on 
			c.Municipio= #TMP_datos.Municipio
			and c.Oficina=#TMP_datos.Oficina
			and c.Numero_Emision=#TMP_datos.Numero_Emision
			and c.Folio_Impresion=#TMP_datos.Folio_Impresion
			and c.Numero_Serie=#TMP_datos.Numero_Serie;
		

	
		UPDATE	obl_detalle_documentos 
		SET	Status= a.Substatus,
		Fecha_Ultimo_Movimiento=getdate()
		FROM obl_detalle_vehiculo as b
		left join obl_detalle_documentos as a on
		a.Municipio=b.Municipio 
		and a.Oficina=b.Oficina
		and a.Numero_Emision=b.Numero_Emision
		and a.Folio_Impresion=b.Folio_Impresion
		inner join #TMP_datos on b.Municipio=#TMP_datos.Municipio 
		and b.Oficina=#TMP_datos.Oficina
		and b.Numero_Emision=#TMP_datos.Numero_Emision
		and b.Folio_Impresion=#TMP_datos.Folio_Impresion
		and b.Pagado='N';
		
		
		UPDATE	obl_datos_vehiculo 
		SET	Pagado= 'N'
		FROM obl_detalle_vehiculo as b
		left join obl_datos_vehiculo as a on
		a.Municipio=b.Municipio 
		and a.Oficina=b.Oficina
		and a.Numero_Emision=b.Numero_Emision
		and a.Folio_Impresion=b.Folio_Impresion
		inner join #TMP_datos on b.Municipio=#TMP_datos.Municipio 
		and b.Oficina=#TMP_datos.Oficina
		and b.Numero_Emision=#TMP_datos.Numero_Emision
		and b.Folio_Impresion=#TMP_datos.Folio_Impresion
		and b.Pagado='N';
*/
        
            COMMIT 
	 END TRY
  BEGIN CATCH
     -- Whoops, il y a eu une erreur.
     IF @@TRANCOUNT > 0
		BEGIN
			ROLLBACK 
	 
   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END

---------------------------------------------------------------------------------------------------
##procedimiento almacenado que actualiza los pagos de istuv con la tabla cvdb_09

USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[Marcar_Pagos_Istuv]    Fecha de la secuencia de comandos: 01/28/2010 12:22:41 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Ramon Sosa, Lilí Lizardi
-- Create date: 27/01/2010
-- Description:	Marcar pagos de Istuv 
-- =============================================
ALTER PROCEDURE [dbo].[Marcar_Pagos_Istuv]
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
			    
			
		CREATE TABLE #TMP_datos
		(		Municipio VARCHAR (2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Ejercicio_Fiscal VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Folio_Impresion BIGINT,
		 		Numero_Serie VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Movimiento VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Status VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				SubStatus VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Anio_Moroso VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Pagado VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Pago DATETIME,
				Numero_Operacion VARCHAR(14) COLLATE SQL_Latin1_General_CP1_CI_AS
		);

		INSERT INTO #TMP_datos
		select  
			a.Municipio, 
			a.Oficina, 
			a.Numero_Emision, 
			a.Ejercicio_Fiscal,
			b.Folio_Impresion, 
			b.Numero_Serie, 
			b.RFC, 
			b.Movimiento,
			b.Status, 
			b.Substatus, 
			c.Anio_Moroso,
			c.Pagado,
			d.FEC_CVDB09 as Fecha_Pago,
			d.FOL_CVDB09 AS Numero_Operacion
		from obl_control_emisiones as a
		inner join obl_detalle_documentos as b on 
			a.Municipio=b.Municipio 
			and a.Oficina=b.Oficina 
			and a.Numero_Emision=b.Numero_Emision
		inner join obl_detalle_vehiculo as c on
			a.Municipio=b.Municipio 
			and b.Oficina=c.Oficina 
			and b.Numero_Emision=c.Numero_Emision
			and b.Folio_Impresion=c.Folio_Impresion
			and b.Numero_Serie= c.Numero_Serie
		inner join tenencias.dbo.cvdb06  as d on
			b.Numero_Serie= d.NSE_CVDB09  
			and d.ACO_CVDB09 = c.Anio_Moroso 
			and d.TRA_CVDB09 ='TEN'
		where a.Clave_Obligacion='010603'
			and b.Status in ('E','V','C','N','X','A','B','I','D')  
			and c.Pagado ='N'
			--and b.Numero_Serie in ('9BWDC05X53T059276')
		order by a.Municipio, b.Numero_Serie, c.Anio_Moroso;
		
	select * from #TMP_datos;
		
/*select b.Municipio, b.Oficina, b.Numero_Emision, 
			   b.Folio_Impresion, b.Numero_Serie, b.Anio_Moroso,
			   b.Numero_Operacion, b.Pagado, b. Fecha_Pago,  
			   #TMP_datos.Fecha_Pago, #TMP_datos.Numero_Operacion*/
		update obl_detalle_vehiculo
		set Numero_Operacion= #TMP_datos.Numero_Operacion,
			Pagado='S',
			Fecha_Pago=#TMP_datos.Fecha_Pago		
		from obl_detalle_vehiculo as b 
		inner join  #TMP_datos  on 
			b.Municipio= #TMP_datos.Municipio
			and b.Oficina=#TMP_datos.Oficina
			and b.Numero_Emision=#TMP_datos.Numero_Emision
			and b.Folio_Impresion=#TMP_datos.Folio_Impresion
			and b.Numero_Serie=#TMP_datos.Numero_Serie
			and b.Anio_Moroso=#TMP_datos.Anio_Moroso;


		/*select a.Municipio, a.Oficina, a.Numero_Emision, 
			   a.Folio_Impresion, a.Numero_Serie, a.Movimiento, a.Status, 
				a.Substatus,
				a.Fecha_Ultimo_Movimiento,
			    #TMP_datos.Fecha_Pago,#TMP_datos.Numero_Operacion*/
		UPDATE obl_detalle_documentos
		SET Substatus= a.Status,
			Status = CASE WHEN (a.Status in ('E','V')) then  'P' ELSE 'T' END,
			Fecha_Ultimo_Movimiento=getdate()
		from obl_detalle_documentos as a  
		inner join  #TMP_datos  on 
			a.Municipio= #TMP_datos.Municipio
			and a.Oficina=#TMP_datos.Oficina
			and a.Numero_Emision=#TMP_datos.Numero_Emision
			and a.Folio_Impresion=#TMP_datos.Folio_Impresion
			and a.Numero_Serie=#TMP_datos.Numero_Serie
			and a.Movimiento=#TMP_datos.Movimiento;
		

		/*select c.Municipio, c.Oficina, c.Numero_Emision, 
			   c.Folio_Impresion, c.Numero_Serie, c. Pagado, 
			   #TMP_datos.Fecha_Pago, #TMP_datos.Numero_Operacion*/
		UPDATE obl_datos_vehiculo
		SET Pagado= 'S'
		from  obl_datos_vehiculo as c 
		inner join  #TMP_datos  on 
			c.Municipio= #TMP_datos.Municipio
			and c.Oficina=#TMP_datos.Oficina
			and c.Numero_Emision=#TMP_datos.Numero_Emision
			and c.Folio_Impresion=#TMP_datos.Folio_Impresion
			and c.Numero_Serie=#TMP_datos.Numero_Serie;
		

	
		UPDATE	obl_detalle_documentos 
		SET	Status= a.Substatus,
		Fecha_Ultimo_Movimiento=getdate()
		FROM obl_detalle_vehiculo as b
		left join obl_detalle_documentos as a on
		a.Municipio=b.Municipio 
		and a.Oficina=b.Oficina
		and a.Numero_Emision=b.Numero_Emision
		and a.Folio_Impresion=b.Folio_Impresion
		inner join #TMP_datos on b.Municipio=#TMP_datos.Municipio 
		and b.Oficina=#TMP_datos.Oficina
		and b.Numero_Emision=#TMP_datos.Numero_Emision
		and b.Folio_Impresion=#TMP_datos.Folio_Impresion
		and b.Pagado='N';
		
		
		UPDATE	obl_datos_vehiculo 
		SET	Pagado= 'N'
		FROM obl_detalle_vehiculo as b
		left join obl_datos_vehiculo as a on
		a.Municipio=b.Municipio 
		and a.Oficina=b.Oficina
		and a.Numero_Emision=b.Numero_Emision
		and a.Folio_Impresion=b.Folio_Impresion
		inner join #TMP_datos on b.Municipio=#TMP_datos.Municipio 
		and b.Oficina=#TMP_datos.Oficina
		and b.Numero_Emision=#TMP_datos.Numero_Emision
		and b.Folio_Impresion=#TMP_datos.Folio_Impresion
		and b.Pagado='N';

        
            COMMIT 
	 END TRY
  BEGIN CATCH
     -- Whoops, il y a eu une erreur.
     IF @@TRANCOUNT > 0
		BEGIN
			ROLLBACK 
	 
   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END
-------------------------------------------------------------------------------
##ESTE QUERY ME DEVUELVE LOS REQUERIMIENTOS GENERADOS EN 2009 INCLUYE TODOS LOS MUNICIPIOS Y TODAS LAS OBLIGACIONES

/*INSERT INTO [obl_contribuyentes_cumplimiento_copia]
 ([RFC],[Ejercicio_Fiscal],[Municipio],[Obligacion],[Clave_Periodicidad],
[Periodo_Inicial], [Requerido],[Activado],[Estado])
select b.RFC,a.Anio_Moroso, a.Municipio, a.Clave_Obligacion, 
a.Clave_Periodicidad, a.Periodo_Inicial, 'S' as Requerido, 'S' as Activado, b.Status
from obl_control_emisiones as a
inner join obl_detalle_documentos  as b on
a.Municipio=b.Municipio and 
a.Oficina=b.Oficina and 
a.Numero_Emision=b.Numero_Emision 
where  a.Anio_Moroso='2009' 
and Clave_Periodicidad in ('02','03')
and b.Movimiento='R1' 
and Status not in ('T','P') 
and Clave_Obligacion not in ('010613') 
order by a.Municipio, a.Oficina, a.Clave_Obligacion,
a.Clave_Periodicidad, 
a.Numero_Emision, 
b.Folio_Impresion
*/


## QUERY QUE ME DEVUELVE LOS REQUERIMIENTOS 2009 DE ISTUV EN TODOS LOS MUNICIPIOS 
/*select b.RFC,b.Numero_Serie, a.Anio_Moroso, a.Municipio, a.Clave_Obligacion, 
a.Clave_Periodicidad, a.Periodo_Inicial, 'S' as Requerido, 'S' as Activado,
 b.Status, b.Folio_Impresion, b.Numero_emision
from obl_control_emisiones as a
inner join obl_detalle_documentos  as b on
a.Municipio=b.Municipio and 
a.Oficina=b.Oficina and 
a.Numero_Emision=b.Numero_Emision 
where  a.Anio_Moroso='2009' 
--and Clave_Periodicidad in ('02','03')
and b.Movimiento='R1' 
and Status not in ('T','P') 
and a.Clave_Obligacion in ('010603') 
order by b.Numero_Serie*/


select a.Anio_Moroso, a.Municipio, a.Clave_Obligacion, b.RFC, b.Numero_Serie,  
a.Clave_Periodicidad, a.Periodo_Inicial, 'S' as Requerido, 'S' as Activado,
 b.Status,  b.Numero_emision, b.Folio_Impresion
from obl_control_emisiones as a
inner join obl_detalle_documentos  as b on
a.Municipio=b.Municipio and 
a.Oficina=b.Oficina and 
a.Numero_Emision=b.Numero_Emision 
where  a.Anio_Moroso='2009' 
--and Clave_Periodicidad in ('02','03')
and b.Movimiento='R1' 
and Status not in ('T','P') 
and a.Clave_Obligacion in ('010603') 
order by a.Municipio, a.Oficina, a.Clave_Obligacion,
a.Clave_Periodicidad, 
a.Numero_Emision, 
b.Folio_Impresion

--1A4GJ45R77B135849
-----------------------------------------------------------

jorge sanchez me pidio cambiar el pago del documento para poder imprimir la multa por extemporaneidad
Numero_Emision='0944'

Folio_Impresion=9222

Municipio='02' 

------------------------------------------------------------

--estadistica de documentos diligenciados  de repecos


select t.Municipio, t.Oficina, t.Clave_Obligacion, t.Obligacion, Numero_Emision, t.Dirigida, 
		t.Periodo_Inicial, t.Periodo_Final, t.Anio_Moroso,
		t.Total as Emitidos, t.Impreso as Impresos,( t.Entregado+t.No_Localizado+t.Doble_No_Localizado+t.Declaracion_en_Ceros
		+t.Cambio_Periodo+t.Resolucion_Juridica
		 +t.Solventado_por_Insolvencia+t.Baja+t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa
		 +t.Contribuyente_Solidario+t.Aviso_RFC)
		 as Diligenciados, t.Entregado as Entregados, 
		t.Pagado+t.Pago_Honorarios as Pagados, t.Pago_Espontaneo as Pagos_Espontaneos from 
(
SELECT
		b. Municipio,
		b.Oficina,
		b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               a.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN ( a.Fecha_Impresion is null and a.Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado,
               SUM(CASE WHEN (a.Fecha_Entrega is null and a.Status in ('D')) THEN 1 ELSE 0 END) AS Pendiente,
               --SUM(CASE WHEN (a.Status in ('C')) THEN 1 ELSE 0 END) AS Citatorio, 
	       SUM(CASE WHEN (a.Fecha_Citatorio is not null) THEN 1 ELSE 0 END) AS Citatorio, 
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Entregado,
               SUM(CASE WHEN (a.Status in ('V')) THEN 1 ELSE 0 END) AS Vencido,
		SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('N')) THEN 1 ELSE 0 END) AS No_Localizado,
               SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('X')) THEN 1 ELSE 0 END) AS Doble_No_Localizado,
               SUM(CASE WHEN (a.Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado,
               SUM(CASE WHEN (a.Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo,
               SUM(CASE WHEN (a.Status in ('H'))  THEN 1 ELSE 0 END) AS Pago_Honorarios,
               SUM(CASE WHEN (a.Status in ('L'))  THEN 1 ELSE 0 END) AS Declaracion_en_Ceros,
               SUM(CASE WHEN (a.Status in ('M'))  THEN 1 ELSE 0 END) AS Cambio_Periodo,
               SUM(CASE WHEN (a.Status in ('J'))  THEN 1 ELSE 0 END) AS Resolucion_Juridica,
               SUM(CASE WHEN (a.Status in ('S'))  THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia,
               SUM(CASE WHEN (a.Status in ('Y'))  THEN 1 ELSE 0 END) AS Baja,
               SUM(CASE WHEN (a.Status in ('Z'))  THEN 1 ELSE 0 END) AS Suspension_Actividades,
               SUM(CASE WHEN (a.Status in ('O'))  THEN 1 ELSE 0 END) AS Sin_Obligacion,
               SUM(CASE WHEN (a.Status in ('U'))  THEN 1 ELSE 0 END) AS Pago_Multa,
               SUM(CASE WHEN (a.Status in ('W'))  THEN 1 ELSE 0 END) AS Contribuyente_Solidario,
               SUM(CASE WHEN (a.Status in ('R'))  THEN 1 ELSE 0 END) AS Aviso_RFC
			   FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               where --a.Movimiento='R1' and 
			   b.Clave_Obligacion='010623' and 
			   b.Ejercicio_Fiscal='2009'
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision ,c.Descripcion 
			   
) as t
order by  t.Municipio, t.Oficina,t.Clave_Obligacion,t.Numero_Emision 
-----------------

Usuario Freddy Falcon

User:ffalcon
ctrs:Chivas12



---------------------------------
## PROCEDIMIENTO QUE CAMBIA EL ESTATUS D UN DOCUMENTO

USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[pCambiar_Estatus_Documentos]    Fecha de la secuencia de comandos: 03/02/2010 12:39:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Ramon Sosa, Lilí Lizardi
-- Create date: 22/01/2010
-- Description:	Cambiar Estatus de Requerimientos
-- =============================================
ALTER PROCEDURE [dbo].[pCambiar_Estatus_Documentos]
	-- Add the parameters for the stored procedure here
		@Municipio varchar(2),
		@Oficina varchar(10),
		@Clave_Obligacion varchar(MAX),
		@Folio_Impresion int,
		@Movimiento varchar(2) ,
		@Usuario_Login varchar(25),
		@Status varchar(1),
		@Estado varchar(200),
		@Clave_Periodicidad varchar(2),
		@Anio varchar(4)
		
						
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
		
		DECLARE @Limp_Fech varchar (100);
		SET @Limp_Fech ='';
		DECLARE @Estatus_Anterior varchar (1);
		SET @Estatus_Anterior ='';
		DECLARE @Clave_Notificador varchar (100);
		SET @Clave_Notificador ='';
		DECLARE @Total int;
		SET @Total='0';
		DECLARE @Fecha_Movimiento datetime;
		DECLARE @Fecha_Estado_Anterior datetime;
		DECLARE @Numero_Emision varchar (100);
		SET @Numero_Emision ='';
	

	    declare @detalle_documentos table(
		   Municipio char(2),
		   Oficina char(2),
           Clave_Obligacion varchar(6),
           Numero_Emision varchar(4),
		   Folio_Impresion varchar(6),
		   Movimiento varchar (2),
		   RFC varchar(14), 
           Estatus_Anterior char(1),
		   Fecha_Estado_Anterior datetime,
           Clave_Notificador varchar(17)
	    );

	
		--HACER EL QUERY PARA TRAER LOS DOCUMENTOS QUE VAMOS A AFECTAR
            INSERT INTO @detalle_documentos
			SELECT	oce.Municipio, 
					oce.Oficina, 
					oce.Clave_Obligacion,
					odd.Numero_Emision,
					odd.Folio_Impresion,
					odd.Movimiento,
					odd.RFC,   
					odd.Status as Estatus,
					(CASE WHEN (odd.Status ='V') 
        			THEN  odd.Fecha_Vencimiento
        			ELSE	
        				(CASE WHEN (odd.Status='E') 
        				 THEN odd.Fecha_Entrega 
        				 ELSE 
        					(CASE WHEN odd.Status in ('A','D') 
        					 THEN odd.Fecha_Asignacion 
        					 ELSE 
        						(CASE WHEN odd.Status in ('C') 
        						 THEN odd.Fecha_Citatorio
        						 ELSE
        							(CASE WHEN odd.Status in ('X','N') 
        							 THEN odd.Fecha_No_Localizado
        						   END)
        						 END)			
        					END)
        				END)
        			END)
					AS Fecha_Estado_Anterior,
					odd.Clave_Notificador
			FROM obl_detalle_documentos odd
			JOIN obl_control_emisiones oce 
				ON odd.Municipio = oce.Municipio
				AND odd.Oficina = oce.Oficina
				AND odd.Numero_Emision = oce.Numero_Emision
			WHERE odd.Folio_Impresion = @Folio_Impresion
				AND odd.Movimiento = @Movimiento
				AND odd.Municipio = @Municipio
				AND odd.Oficina = @Oficina
				AND oce.Clave_Obligacion = @Clave_Obligacion
				AND oce.Ejercicio_Fiscal = @Anio
				AND oce.Clave_Periodicidad = @Clave_Periodicidad;
		
		select  * from @detalle_documentos;

		select @Total=count(*) from @detalle_documentos

select @Total

 IF (@Total=0)
 BEGIN
 SELECT @Total as Total;
 END 

 IF (@Total>=1)
  BEGIN
		SELECT @Total as Total;
		
		select @Estatus_Anterior= Estatus_Anterior 
		from @detalle_documentos;
		
		select @Fecha_Estado_Anterior= Fecha_Estado_Anterior 
		from @detalle_documentos;
		
		select @Clave_Notificador= Clave_Notificador 
		from @detalle_documentos;
		
		select @Numero_Emision= Numero_Emision 
		from @detalle_documentos;
		
	--Si el documento esta en cualquier estatus que no sea asignado o pendiente eliminar todos los registros
	--de los actos del notificador menos el que esta como asignado				
	IF (@Estatus_Anterior <> 'A' and @Estatus_Anterior <>'D') 
		BEGIN
			
			INSERT INTO obl_historial_actos_notificador
				(
				Id_Registro,
				Clave_Notificador,
				Fecha_Movimiento,
				Movimiento,
				Status,
				Folio_Impresion,
				Numero_Emision,
				Motivo,
				Fecha_Almacenamiento,
				Municipio,
				Oficina
				)
			SELECT a.Id_Registro,
				a.Clave_Notificador,
				a.Fecha_Movimiento,
				a.Movimiento,
				a.Status,
				a.Folio_Impresion,
				a.Numero_Emision,
				a.Motivo,
				a.Fecha_Almacenamiento,
				a.Municipio,
				a.Oficina
			FROM obl_actos_notificador as a
			INNER JOIN @detalle_documentos as b on
			a.Folio_Impresion = b.Folio_Impresion
								AND a.Movimiento = b.Movimiento 
								AND a.Municipio = b.Municipio
								AND a.Oficina =  b.Oficina                       
								AND a.Numero_Emision= b.Numero_Emision
								AND a.Clave_Notificador= b.Clave_Notificador
								AND a.Status not in ('A');

			DELETE obl_actos_notificador
			FROM obl_actos_notificador as a
			INNER JOIN @detalle_documentos as b on
			a.Folio_Impresion = b.Folio_Impresion
								AND a.Movimiento = b.Movimiento 
								AND a.Municipio = b.Municipio
								AND a.Oficina =  b.Oficina                       
								AND a.Numero_Emision= b.Numero_Emision
								AND a.Clave_Notificador= b.Clave_Notificador
								AND a.Status not in ('A');
		END
	

	--Si el documento esta como asignado o pendiente eliminar todos y dejar como impreso para que pueda ser asignado
	--nuevamente
	IF (@Estatus_Anterior = 'A' or  @Estatus_Anterior ='D') 
		BEGIN 
			--Pngo el Status como Impreso para que se pueda volver a asignar el requerimiento
			SET @Status='I';

			INSERT INTO obl_historial_actos_notificador
				(
				Id_Registro,
				Clave_Notificador,
				Fecha_Movimiento,
				Movimiento,
				Status,
				Folio_Impresion,
				Numero_Emision,
				Motivo,
				Fecha_Almacenamiento,
				Municipio,
				Oficina
				)
			SELECT a.Id_Registro,
				a.Clave_Notificador,
				a.Fecha_Movimiento,
				a.Movimiento,
				a.Status,
				a.Folio_Impresion,
				a.Numero_Emision,
				a.Motivo,
				a.Fecha_Almacenamiento,
				a.Municipio,
				a.Oficina
			FROM obl_actos_notificador as a
			INNER JOIN @detalle_documentos as b on
			a.Folio_Impresion = b.Folio_Impresion
								AND a.Movimiento = b.Movimiento 
								AND a.Municipio = b.Municipio
								AND a.Oficina =  b.Oficina                       
								AND a.Numero_Emision= b.Numero_Emision
								AND a.Clave_Notificador= b.Clave_Notificador

			DELETE obl_actos_notificador
			FROM obl_actos_notificador as a
			INNER JOIN @detalle_documentos as b on
			a.Folio_Impresion = b.Folio_Impresion
								AND a.Movimiento = b.Movimiento 
								AND a.Municipio = b.Municipio
								AND a.Oficina =  b.Oficina                       
								AND a.Numero_Emision= b.Numero_Emision
								AND a.Clave_Notificador= b.Clave_Notificador;
			
		END
	

	INSERT INTO obl_historial_cambios_documentos
                   (Municipio, 
					Oficina, 
					Numero_Emision, 
					Clave_Obligacion,
					Folio_Impresion, 
					Movimiento,
					Usuario,
					Estado_Anterior,
					Fecha_Estado_Anterior,
					Estado_Nuevo,
					Usuario_Cambio,
					Fecha_Cambio,
					Motivo) 
         VALUES (	@Municipio,
					@Oficina, 
					@Numero_Emision, 
					@Clave_Obligacion,
					@Folio_Impresion,
					@Movimiento,
					@Clave_Notificador,
					@Estatus_Anterior,
					CONVERT ( datetime ,@Fecha_Estado_Anterior, (20) ),
					@Status,
					@Usuario_Login,
					GETDATE(),
					@Estado
					);

				-- actualiza los documentos y las fechas

		
				IF (@Estatus_Anterior = ('V'))
				BEGIN
					UPDATE obl_detalle_documentos
  					SET SubStatus = Status,
  							Status = @Status,
  							Fecha_Ultimo_Movimiento = GETDATE(),
  							Usuario_Cambio_Estatus = @Usuario_Login, 
							Fecha_Citatorio=NULL , 
							Fecha_Entrega=NULL, 
							Fecha_Vencimiento=NULL
					WHERE Folio_Impresion  = @Folio_Impresion
  							AND Movimiento = @Movimiento
  							AND Municipio  = @Municipio
  							AND Oficina    = @Oficina
  							AND Numero_Emision = @Numero_Emision
				END
				
				IF (@Estatus_Anterior = ('A'))
				BEGIN
					SET @Status='I';
						
					UPDATE obl_detalle_documentos
  					SET SubStatus = Status,
  							Status = @Status,
  							Fecha_Ultimo_Movimiento = GETDATE(),
  							Usuario_Cambio_Estatus = @Usuario_Login, 
							Fecha_Asignacion=NULL
					WHERE Folio_Impresion  = @Folio_Impresion
  							AND Movimiento = @Movimiento
  							AND Municipio  = @Municipio
  							AND Oficina    = @Oficina
  							AND Numero_Emision = @Numero_Emision
				END
				
				IF (@Estatus_Anterior = ('N'))
				BEGIN
					UPDATE obl_detalle_documentos
  					SET SubStatus = Status,
  							Status = @Status,
  							Fecha_Ultimo_Movimiento = GETDATE(),
  							Usuario_Cambio_Estatus = @Usuario_Login, 
							Fecha_No_Localizado=NULL
					WHERE Folio_Impresion  = @Folio_Impresion
  							AND Movimiento = @Movimiento
  							AND Municipio  = @Municipio
  							AND Oficina    = @Oficina
							AND Numero_Emision = @Numero_Emision
  				END
				

				IF (@Estatus_Anterior = ('X'))
				BEGIN
					--Traemos la fecha de la primera no localizacion
					SELECT @Fecha_Movimiento=Fecha_Movimiento 
					FROM  obl_actos_notificador 
                    WHERE  Folio_Impresion = @Folio_Impresion 
                                    AND Movimiento = @Movimiento 
                                    AND Municipio = @Municipio
                                    AND Oficina =  @Oficina
                                    AND Numero_Emision= @Numero_Emision 
                                    AND Status in ('N');

					UPDATE obl_detalle_documentos
  					SET SubStatus = Status,
  							Status = @Status,
  							Fecha_Ultimo_Movimiento = GETDATE(),
  							Usuario_Cambio_Estatus = @Usuario_Login, 
							Fecha_No_Localizado=CONVERT ( datetime ,@Fecha_Movimiento, 20 )--checar aki
					WHERE Folio_Impresion  = @Folio_Impresion
  							AND Movimiento = @Movimiento
  							AND Municipio  = @Municipio
  							AND Oficina    = @Oficina
							AND Numero_Emision= @Numero_Emision 
  			END	

			IF (@Estatus_Anterior = ('C'))
			BEGIN
					UPDATE obl_detalle_documentos
  					SET SubStatus = Status,
  							Status = @Status,
  							Fecha_Ultimo_Movimiento = GETDATE(),
  							Usuario_Cambio_Estatus = @Usuario_Login, 
							Fecha_Citatorio=NULL
					WHERE Folio_Impresion  = @Folio_Impresion
  							AND Movimiento = @Movimiento
  							AND Municipio  = @Municipio
  							AND Oficina    = @Oficina
							AND Numero_Emision= @Numero_Emision 
  			END
				
			IF (@Estatus_Anterior = ('E'))
			BEGIN
					UPDATE obl_detalle_documentos
  					SET SubStatus = Status,
  							Status = @Status,
  							Fecha_Ultimo_Movimiento = GETDATE(),
  							Usuario_Cambio_Estatus = @Usuario_Login, 
							Fecha_Citatorio=NULL, 
							Fecha_Entrega=NULL, 
							Fecha_Vencimiento=NULL
					WHERE Folio_Impresion  = @Folio_Impresion
  							AND Movimiento = @Movimiento
  							AND Municipio  = @Municipio
  							AND Oficina    = @Oficina
							AND Numero_Emision= @Numero_Emision 
  				END
		END		
				

            COMMIT 
	 END TRY
  BEGIN CATCH
     -- Whoops, il y a eu une erreur.
     IF @@TRANCOUNT > 0
		BEGIN
			ROLLBACK 
	 
   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH
END
-------------------------------------------------------------------


if (@Clave_Obligacion='010103' or @Clave_Obligacion='010104')
			BEGIN
			Insert Into @detalle
			select min(b.Ejercicio_Fiscal) as Ejercicio_Fiscal, 
			min(b.Municipio) as Municipio,
			min(b.Oficina) as Oficina,
			min(b.Clave_Obligacion) as Clave_Obligacion, 
			min(c.Descripcion) as Obligacion, 
			min(a.Numero_Emision) as Numero_Emision, 
			min(a.Folio_Impresion) as Folio_Impresion,
			min(d.Numero_Operacion) as Numero_Operacion,
			min (Status) as Estatus,
			min(b.Fecha_Emision) as Fecha_Emision, 
			min(b.Dirigida) as Dirigida, 
			min(b.Periodo_Inicial) as Periodo_Inicial, 
			min(b.Periodo_Final) as Periodo_Final,
			min(b.anio_moroso) as Anio_Moroso, 
			min(a.Movimiento) as Movimiento,
			min (a.RFC)  as RFC,
			min (a.Numero_Serie) as Numero_Serie,
			min (Fecha_Impresion) as Fecha_Impresion,
			min (Fecha_Asignacion) as Fecha_Asignacion,
			min (Fecha_Citatorio) as Fecha_Citatorio,
			min (Fecha_No_Localizado) as Fecha_No_Localizado,
			min (Fecha_Entrega) as Fecha_Entrega,
			min (Fecha_Vencimiento) as Fecha_Vencimiento			
			FROM obl_detalle_documentos as a 
			inner join obl_control_emisiones as b 
			on a.Numero_Emision=b.Numero_Emision 
			and a.Municipio=b.Municipio and a.Oficina=b.Oficina 
			left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave 
			inner join obl_detalle_sucursales  as d on 
			a.Numero_Emision=d.Numero_Emision 
			and a.Municipio=d.Municipio 
			and a.Oficina=d.Oficina 
			and a.Folio_Impresion=d.Folio_Impresion 
			where a.Municipio=@Municipio 
				and a.Oficina=@Oficina 
				and a.Movimiento in ('R1','I1') 
				and b.Clave_Obligacion = @Clave_Obligacion 
				and b.Ejercicio_Fiscal=@Ejercicio_Fiscal 
				and MONTH(b.Fecha_Emision) BETWEEN @Periodo_Inicial and @Periodo_Final 
			--group by b.Clave_Obligacion,c.Descripcion, a.Movimiento) as t 
			group by a.Municipio, a.Oficina, a.Numero_Emision, a.Folio_Impresion, a.Movimiento
			END	

-----------------------------------------------------------------
procedimiento incorrecto 


USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[paEstadistica_Emisiones]    Fecha de la secuencia de comandos: 03/16/2010 11:42:47 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Ramon Sosa, Lilí Lizardi
-- Create date: 09/03/2010
-- Description:	Estadistica de Emisiones
-- =============================================
ALTER PROCEDURE [dbo].[paEstadistica_Emisiones]
	-- Add the parameters for the stored procedure here
		@Municipio varchar(2),
		@Oficina varchar(10),
		@Clave_Obligacion varchar(MAX),
		@Ejercicio_Fiscal varchar(4),
		@Periodo_Inicial varchar(2),
		@Periodo_Final varchar(2)
						
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
 

	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
		
		DECLARE @Limp_Fech varchar (100);
		SET @Limp_Fech ='';
		DECLARE @Estatus_Anterior varchar (1);
		SET @Estatus_Anterior ='';
		DECLARE @Clave_Notificador varchar (100);
		SET @Clave_Notificador ='';
		DECLARE @Total int;
		SET @Total=0;
		DECLARE @Fecha_Movimiento datetime;
		DECLARE @Fecha_Estado_Anterior datetime;
		DECLARE @Numero_Emision varchar (100);
		SET @Numero_Emision ='';
		DECLARE @Cambiable int;
		SET @Cambiable =0;
		DECLARE @Nombre_Estatus_Anterior varchar (200);
		SET @Nombre_Estatus_Anterior ='';
		DECLARE @Estatus_Diferentes int;
		SET @Estatus_Diferentes=0;

	    declare @detalle table(
			Ejercicio_Fiscal varchar(4),
			Municipio char(2),
			Oficina char(2),
			Clave_Obligacion varchar(6),
			Obligacion varchar(200),
			Numero_Emision varchar(4),
			Folio_Impresion varchar(6),
			Numero_Operacion varchar(20),
			Status char(1),
			Fecha_Emision datetime,
			Dirigida char(1),
			Periodo_Inicial varchar(2),
			Periodo_Final varchar(2),
			Anio_Moroso varchar(4),
			Movimiento varchar (2),
			RFC varchar(14), 
			Numero_Serie varchar(40),
			Fecha_Impresion datetime,
			Fecha_Asignacion datetime,
  		    Fecha_Citatorio datetime,
			Fecha_No_Localizado datetime,
			Fecha_Entrega datetime,
			Fecha_Vencimiento datetime
		    );

			--Ejemplo de declaracion de variables de tabla y un campo 
			/*DECLARE @Reporte_FEPOA_UR TABLE
				(
					Clave_UR varchar(10),
					Descripcion_UR varchar(MAX),
					Auto_Trimestre money,
					Ejer_Trimestre money,
					Eficacia_Presupuestal AS (Ejer_Trimestre*100/Auto_Trimestre)
				)*/

		IF (@Clave_Obligacion='010610' or @Clave_Obligacion='010618' )
		  BEGIN
			Insert Into @detalle
			select		min(b.Ejercicio_Fiscal) as Ejercicio_Fiscal, 
						min(b.Municipio) as Municipio,
						min(b.Oficina) as Oficina,
						min(b.Clave_Obligacion) as Clave_Obligacion, 
						min(c.Descripcion) as Obligacion, 
						min (a.Numero_Emision) as Numero_Emision, 
						min(a.Folio_Impresion) as Folio_Impresion,
						min(d.Numero_Operacion) as Numero_Operacion,
						min (Status) as Estatus,
						min(b.Fecha_Emision) as Fecha_Emision, 
						min(b.Dirigida) as Dirigida, 
						min(b.Periodo_Inicial) as Periodo_Inicial, 
						min(b.Periodo_Final) as Periodo_Final,
						min(b.anio_moroso) as Anio_Moroso, 
						min(a.Movimiento) as Movimiento,
						min (a.RFC)  as RFC,
						min (a.Numero_Serie) as Numero_Serie,
						min (Fecha_Impresion) as Fecha_Impresion,
						min (Fecha_Asignacion) as Fecha_Asignacion,
						min (Fecha_Citatorio) as Fecha_Citatorio,
						min (Fecha_No_Localizado) as Fecha_No_Localizado,
						min (Fecha_Entrega) as Fecha_Entrega,
						min (Fecha_Vencimiento) as Fecha_Vencimiento	
			from obl_control_emisiones  as b 
			join obl_detalle_documentos as a 
			on		a.Numero_Emision=b.Numero_Emision 
				and a.Municipio=b.Municipio 
				and a.Oficina=b.Oficina
			left join cat_obligaciones as c 
			on b.Clave_Obligacion=c.Clave 
			inner join obl_datos_federales  as d on 
						a.Numero_Emision=d.Numero_Emision 
						and a.Municipio=d.Municipio 
						and a.Oficina=d.Oficina 
						and a.Folio_Impresion=d.Folio_Impresion 
			where		a.Municipio=@Municipio 
							and a.Oficina=@Oficina 
							and a.Movimiento in ('R1','I1','M1') 
							and b.Clave_Obligacion = @Clave_Obligacion 
							and b.Ejercicio_Fiscal=@Ejercicio_Fiscal 
							and MONTH(b.Fecha_Emision) BETWEEN @Periodo_Inicial and @Periodo_Final 
			group by a.Folio_Impresion, a.Movimiento
		  END

		IF ( @Clave_Obligacion='010611')
				  BEGIN
					Insert Into @detalle
					select		min(b.Ejercicio_Fiscal) as Ejercicio_Fiscal, 
								min(b.Municipio) as Municipio,
								min(b.Oficina) as Oficina,
								min(b.Clave_Obligacion) as Clave_Obligacion, 
								min(c.Descripcion) as Obligacion, 
								min (a.Numero_Emision) as Numero_Emision, 
								min(a.Folio_Impresion) as Folio_Impresion,
								min(d.Numero_Operacion) as Numero_Operacion,
								min (Status) as Estatus,
								min(b.Fecha_Emision) as Fecha_Emision, 
								min(b.Dirigida) as Dirigida, 
								min(b.Periodo_Inicial) as Periodo_Inicial, 
								min(b.Periodo_Final) as Periodo_Final,
								min(b.anio_moroso) as Anio_Moroso, 
								min(a.Movimiento) as Movimiento,
								min (a.RFC)  as RFC,
								min (a.Numero_Serie) as Numero_Serie,
								min (Fecha_Impresion) as Fecha_Impresion,
								min (Fecha_Asignacion) as Fecha_Asignacion,
								min (Fecha_Citatorio) as Fecha_Citatorio,
								min (Fecha_No_Localizado) as Fecha_No_Localizado,
								min (Fecha_Entrega) as Fecha_Entrega,
								min (Fecha_Vencimiento) as Fecha_Vencimiento	
					from obl_control_emisiones  as b 
					join obl_detalle_documentos as a 
					on		a.Numero_Emision=b.Numero_Emision 
						and a.Municipio=b.Municipio 
						and a.Oficina=b.Oficina
					left join cat_obligaciones as c 
					on b.Clave_Obligacion=c.Clave 
					inner join obl_datos_federales  as d on 
								a.Numero_Emision=d.Numero_Emision 
								and a.Municipio=d.Municipio 
								and a.Oficina=d.Oficina 
								and a.Folio_Impresion=d.Folio_Impresion 
					where		a.Municipio=@Municipio 
									and a.Oficina=@Oficina 
									and a.Movimiento in ('R1','I1','ME') 
									and b.Clave_Obligacion = @Clave_Obligacion 
									and b.Ejercicio_Fiscal=@Ejercicio_Fiscal 
									and MONTH(b.Fecha_Emision) BETWEEN @Periodo_Inicial and @Periodo_Final 
					group by a.Folio_Impresion, a.Movimiento
				  END

			
		IF (@Clave_Obligacion='010623')
			BEGIN
			Insert Into @detalle
			select	min(b.Ejercicio_Fiscal) as Ejercicio_Fiscal, 
						min(b.Municipio) as Municipio,
						min(b.Oficina) as Oficina,
						min(b.Clave_Obligacion) as Clave_Obligacion, 
						min(c.Descripcion) as Obligacion, 
						min (a.Numero_Emision) as Numero_Emision, 
						min(a.Folio_Impresion) as Folio_Impresion,
						min(d.Numero_Operacion) as Numero_Operacion,
						min (Status) as Estatus,
						min(b.Fecha_Emision) as Fecha_Emision, 
						min(b.Dirigida) as Dirigida, 
						min(b.Periodo_Inicial) as Periodo_Inicial, 
						min(b.Periodo_Final) as Periodo_Final,
						min(b.anio_moroso) as Anio_Moroso, 
						min(a.Movimiento) as Movimiento,
						min (a.RFC)  as RFC,
						min (a.Numero_Serie) as Numero_Serie,
						min (Fecha_Impresion) as Fecha_Impresion,
						min (Fecha_Asignacion) as Fecha_Asignacion,
						min (Fecha_Citatorio) as Fecha_Citatorio,
						min (Fecha_No_Localizado) as Fecha_No_Localizado,
						min (Fecha_Entrega) as Fecha_Entrega,
						min (Fecha_Vencimiento) as Fecha_Vencimiento	
			from obl_control_emisiones  as b 
			join obl_detalle_documentos as a 
			on		a.Numero_Emision=b.Numero_Emision 
				and a.Municipio=b.Municipio 
				and a.Oficina=b.Oficina
			left join cat_obligaciones as c 
			on b.Clave_Obligacion=c.Clave 
			inner join obl_datos_federales  as d on 
						a.Numero_Emision=d.Numero_Emision 
						and a.Municipio=d.Municipio 
						and a.Oficina=d.Oficina 
						and a.Folio_Impresion=d.Folio_Impresion 
			where		a.Municipio=@Municipio 
					and a.Oficina=@Oficina 
					and d.Clave_Obligacion = @Clave_Obligacion 
					and b.Ejercicio_Fiscal=@Ejercicio_Fiscal
					and a.Movimiento in ('R1','M3','I1')
					and MONTH(b.Fecha_Emision) BETWEEN @Periodo_Inicial and @Periodo_Final
			group by a.Folio_Impresion, a.Movimiento
		END
			
		IF (@Clave_Obligacion='010103' or @Clave_Obligacion='010104')
		  BEGIN
			Insert Into @detalle
						select	 
						min(b.Ejercicio_Fiscal) as Ejercicio_Fiscal, 
						min(b.Municipio) as Municipio,
						min(b.Oficina) as Oficina,
						min(b.Clave_Obligacion) as Clave_Obligacion, 
						min(c.Descripcion) as Obligacion, 
						min (a.Numero_Emision) as Numero_Emision, 
						min(a.Folio_Impresion) as Folio_Impresion,
						min(d.Numero_Operacion) as Numero_Operacion,
						min (Status) as Estatus,
						min(b.Fecha_Emision) as Fecha_Emision, 
						min(b.Dirigida) as Dirigida, 
						min(b.Periodo_Inicial) as Periodo_Inicial, 
						min(b.Periodo_Final) as Periodo_Final,
						min(b.anio_moroso) as Anio_Moroso, 
						min(a.Movimiento) as Movimiento,
						min (a.RFC)  as RFC,
						min (a.Numero_Serie) as Numero_Serie,
						min (Fecha_Impresion) as Fecha_Impresion,
						min (Fecha_Asignacion) as Fecha_Asignacion,
						min (Fecha_Citatorio) as Fecha_Citatorio,
						min (Fecha_No_Localizado) as Fecha_No_Localizado,
						min (Fecha_Entrega) as Fecha_Entrega,
						min (Fecha_Vencimiento) as Fecha_Vencimiento	
			from obl_control_emisiones  as b 
			join obl_detalle_documentos as a 
			on		a.Numero_Emision=b.Numero_Emision 
				and a.Municipio=b.Municipio 
				and a.Oficina=b.Oficina
			left join cat_obligaciones as c 
			on b.Clave_Obligacion=c.Clave 
			inner join obl_detalle_sucursales  as d on 
						a.Numero_Emision=d.Numero_Emision 
						and a.Municipio=d.Municipio 
						and a.Oficina=d.Oficina 
						and a.Folio_Impresion=d.Folio_Impresion 
			where		a.Municipio=@Municipio 
				and a.Oficina=@Oficina 
				and b.Clave_Obligacion = @Clave_Obligacion 
				and b.Ejercicio_Fiscal=@Ejercicio_Fiscal 
				and a.Movimiento in ('R1','I1')
				and MONTH(b.Fecha_Emision) BETWEEN @Periodo_Inicial and @Periodo_Final 
			group by a.Folio_Impresion, a.Movimiento
		 END

		IF (@Clave_Obligacion='010603')
		  BEGIN
			Insert Into @detalle
			select min(b.Ejercicio_Fiscal) as Ejercicio_Fiscal, 
			min(b.Municipio) as Municipio,
			min(b.Oficina) as Oficina,
			min(b.Clave_Obligacion) as Clave_Obligacion, 
			min(c.Descripcion) as Obligacion, 
			min(a.Numero_Emision) as Numero_Emision, 
			min(a.Folio_Impresion) as Folio_Impresion,
			min(d.Numero_Operacion) as Numero_Operacion,
			min (Status) as Estatus,
			min(b.Fecha_Emision) as Fecha_Emision, 
			min(b.Dirigida) as Dirigida, 
			min(b.Periodo_Inicial) as Periodo_Inicial, 
			min(b.Periodo_Final) as Periodo_Final,
			min(b.anio_moroso) as Anio_Moroso, 
			min(a.Movimiento) as Movimiento,
			min (a.RFC)  as RFC,
			min (a.Numero_Serie) as Numero_Serie,
			min (Fecha_Impresion) as Fecha_Impresion,
			min (Fecha_Asignacion) as Fecha_Asignacion,
			min (Fecha_Citatorio) as Fecha_Citatorio,
			min (Fecha_No_Localizado) as Fecha_No_Localizado,
			min (Fecha_Entrega) as Fecha_Entrega,
			min (Fecha_Vencimiento) as Fecha_Vencimiento			
			FROM obl_detalle_documentos as a 
			inner join obl_control_emisiones as b 
			on a.Numero_Emision=b.Numero_Emision 
			and a.Municipio=b.Municipio and a.Oficina=b.Oficina 
			left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave 
			inner join obl_detalle_vehiculo  as d on 
			a.Numero_Emision=d.Numero_Emision 
			and a.Municipio=d.Municipio 
			and a.Oficina=d.Oficina 
			and a.Folio_Impresion=d.Folio_Impresion 
			where a.Municipio=@Municipio 
				and a.Oficina=@Oficina 
				and a.Movimiento in ('R1','I1') 
				and b.Clave_Obligacion = @Clave_Obligacion 
				and b.Ejercicio_Fiscal = @Ejercicio_Fiscal 
				and MONTH(b.Fecha_Emision) BETWEEN @Periodo_Inicial and @Periodo_Final 
			--group by b.Clave_Obligacion,c.Descripcion, a.Movimiento) as t 
			group by a.Numero_Emision, a.Folio_Impresion
		  END

/*
	select sum (Total)
	from (SELECT     a.No_Operacion, SUM(b.Principal) AS Principal, SUM(b.Actualizacion) AS Actualizacion,SUM(b.Recargos) as Recargos, SUM(b.Multa) as Multa, SUM(b.Gastos_Ejecucion) as Gastos_Ejecucion, SUM(b.Honorarios_Notificacion) as Honorarios_Notificacion, SUM(b.Principal+b.Actualizacion+b.Recargos+b.Multa+b.Gastos_Ejecucion+b.Honorarios_Notificacion) as Total
    FROM         cob_cobros AS a INNER JOIN
                      cob_desglose AS b ON a.No_Operacion = b.No_Operacion
    WHERE     (a.No_Operacion in (select Numero_Operacion from @detalle where Status in ('P','T','H') and Fecha_Entrega is not null 
		group by Numero_Operacion))
    GROUP BY a.No_Operacion) as t


		*/

			select t.Ejercicio_Fiscal,
          		(case when (t.Movimiento='R1' and (t.Clave_Obligacion='010103' or t.Clave_Obligacion='010104') )
                    then 'Requerimientos y Multas de Extemporaneidad'
                    when (t.Movimiento='R1' and (t.Clave_Obligacion<>'010103' and t.Clave_Obligacion<>'010104') )
                    then 'Requerimientos'  
          			when t.Movimiento='I1' 
                    then 'Multa por Incumplimiento'
                    when t.Movimiento='ME' 
                    then 'Multa por Extemporaneidad '
                    when (t.Movimiento='M1' and (t.Clave_Obligacion='010610')) 
                    then 'Multa por Extemporaneidad '
                    when (t.Movimiento='M2' and (t.Clave_Obligacion='010618')) 
                    then 'Multa por Extemporaneidad '
                    when (t.Movimiento='M3' and (@Clave_Obligacion='010623')) 
                    then 'Multa por Extemporaneidad '   
                    end) as Movimiento, 
          		t.Impreso, t.Citatorio, 
          		(t.Entregado+t.No_Localizado+t.Doble_No_Localizado+t.Cambio_Periodo +t.Resolucion_Juridica +t.Solventado_por_Insolvencia+t.Baja + t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa +t.Contribuyente_Solidario+t.Aviso_RFC) as Diligenciados , 
          		t.Entregado, 
          		(t.No_Localizado+t.Doble_No_Localizado) as No_Localizados,
				(t.Cambio_Periodo +t.Resolucion_Juridica+t.Solventado_por_Insolvencia+t.Baja +t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa +t.Contribuyente_Solidario+t.Aviso_RFC) as Otras_Situaciones,
          		t.Pagado+t.Pago_Espontaneo as Pagados, 
          		t.Pago_Honorarios as Pago_Honorarios, 
          		t.Declaracion_en_Ceros as Declaracion_en_Ceros, 
				  (case when t.Movimiento='R1'  then 
					(select sum (Total) as Total--, count(*) as cuantos 
								from (
								SELECT     a.No_Operacion, SUM(b.Principal) AS Principal, 
										SUM(b.Actualizacion) AS Actualizacion,SUM(b.Recargos) as Recargos, 
										SUM(b.Gastos_Ejecucion) as Gastos_Ejecucion, 
										SUM(b.Honorarios_Notificacion) as Honorarios_Notificacion, 
										SUM(b.Principal+b.Actualizacion+b.Recargos+b.Gastos_Ejecucion+b.Honorarios_Notificacion) as Total,
										SUM(b.Multa) as Multa
								 FROM         cob_cobros AS a INNER JOIN
										  cob_desglose AS b ON a.No_Operacion = b.No_Operacion
								WHERE     (a.No_Operacion 
								in (select Numero_Operacion from @detalle 
								where Status in ('T','H','P')  
								and Fecha_Entrega is not null ))
								GROUP BY a.No_Operacion
								) as t)
					end) as Monto,
					(case when t.Movimiento='R1'  then 
					(select sum (Multa) as Total--, count(*) as cuantos 
								from (
								SELECT     a.No_Operacion, SUM(b.Multa) as Multa
								 FROM         cob_cobros AS a INNER JOIN
										  cob_desglose AS b ON a.No_Operacion = b.No_Operacion
								WHERE     (a.No_Operacion 
								in (select Numero_Operacion from @detalle 
								where Status in ('T','H','P')  
								and Fecha_Entrega is not null ))
								GROUP BY a.No_Operacion
								) as t)
					end) as Multa,
          		t.Vencido as Vencidos				
			  from (
					SELECT max(Ejercicio_Fiscal) as Ejercicio_Fiscal, 
                      min(Clave_Obligacion) as Clave_Obligacion, 
                      min(Obligacion) as Obligacion, 
                      min(Numero_Emision) as Numero_Emision, 
                      min(Fecha_Emision) as Fecha_Emision, 
                      min(Dirigida) as Dirigida, 
                      min(Periodo_Inicial) as Periodo_Inicial, 
                      min(Periodo_Final) as Periodo_Final, 
                      min(anio_moroso) as Anio_Moroso,
                      min(Movimiento) as Movimiento, 
                      SUM(CASE WHEN Status is not null THEN 1 ELSE 0 END) AS Total, 
                      SUM(CASE WHEN ( Fecha_Impresion is null and Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is null) and (Status in ('D'))) THEN 1 ELSE 0 END) AS Pendiente, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Citatorio is not null)) THEN 1 ELSE 0 END) AS Citatorio, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null ) and (Fecha_Entrega is not null)) THEN 1 ELSE 0 END) AS Entregado, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null ) and (Fecha_Entrega is not null) and (Status in ('V'))) THEN 1 ELSE 0 END) AS Vencido, 
                      SUM(CASE WHEN (Fecha_Impresion is not null )  and (Fecha_No_Localizado is not null) and (Status in ('N')) THEN 1 ELSE 0 END) AS No_Localizado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null )  and (Fecha_No_Localizado is not null) and (Status in ('X')) THEN 1 ELSE 0 END) AS Doble_No_Localizado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Fecha_Entrega is not null) and (Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Fecha_Entrega is not null) and (Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Fecha_Entrega is not null) and (Status in ('H')) THEN 1 ELSE 0 END) AS Pago_Honorarios, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Fecha_Entrega is null) and (Status in ('L')) THEN 1 ELSE 0 END) AS Declaracion_en_Ceros, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('M')) THEN 1 ELSE 0 END) AS Cambio_Periodo, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('J')) THEN 1 ELSE 0 END) AS Resolucion_Juridica, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('S')) THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('Y')) THEN 1 ELSE 0 END) AS Baja, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('Z')) THEN 1 ELSE 0 END) AS Suspension_Actividades, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('O')) THEN 1 ELSE 0 END) AS Sin_Obligacion, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('U')) THEN 1 ELSE 0 END) AS Pago_Multa, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('W')) THEN 1 ELSE 0 END) AS Contribuyente_Solidario, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('R')) THEN 1 ELSE 0 END) AS Aviso_RFC 
					from @detalle
					group by Movimiento) as t
				order by Clave_Obligacion, Movimiento desc 
           COMMIT 
	 END TRY
  BEGIN CATCH
     -- Whoops, il y a eu une erreur.
     IF @@TRANCOUNT > 0
		BEGIN
			ROLLBACK 
	 
   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH
END
----------------------------------------------------
--ejecutar procedimiento almacenado de ramon listado por hora
USE [ingresos]
GO
DECLARE	@return_value int

EXEC	@return_value = [dbo].[paObtenerCobrosResumenporHoraPeriodo]
		@Municipio = N'01',
		@Oficina = N'03',
		@Fecha_Inicio = N'2010-01-01',
		@Fecha_Final = N'2010-03-19'

SELECT	'Return Value' = @return_value
GO
------------------------------------

saber el monto de un folio de un requerimirnto
select * FROM openquery (ADS_ING,'select * from cvdb06 where fol_cvdb06 in (31911040502)')
-----------------------------------
ejemplo de utilizar el unsplit_string

--			select * from @detalle 
--			where Status in ('P','T','H') and Fecha_Entrega is not null
--			DECLARE @xmlTokens XML
--			DECLARE @resultado varchar(max)
--
--			SET @xmlTokens = (
--					select Numero_Operacion from @detalle 
--					where Status in ('P','T','H') and Fecha_Entrega is not null 
--					group by Numero_Operacion
--					for xml auto, elements, root('root')
--				)
--
--			SET @resultado = [dbo].[UnSplitString](@xmlTokens, ',')
--			SET @Query = 'select year(fec_cvdb06) as Ejercicio_Fiscal, 
--						  aco_cvdb06 as Anio_Moroso,tra_cvdb06 as Concepto, 
--						  sum(imp_cvdb06) as Importe ,sum(iac_cvdb06) as Actualizacion, 
--						  sum(ire_cvdb06) as Recargo, sum(mul_cvdb06) as Multa 
--						  from cvdb06 
--						  where tra_cvdb06 in (''''TEN'''',''''GEJ'''') and fol_cvdb06 in ('+@resultado+')
--						  group by year(fec_cvdb06), tra_cvdb06, aco_cvdb06';
--
--			print @Query;
----
--			select  * FROM openquery(ADS_ING3,@Query);

##segundo ejemplo de usar unsplitstring funcion desagrupar columnas de jorge 
			DECLARE @xmlTokens XML;
			DECLARE @resultado varchar(max);

			SET @xmlTokens = (select Grupo  from seg_usuarios_grupos where Usuario='agranados' for xml auto, elements, root('root'));

			SET @resultado = [dbo].[UnSplitString](@xmlTokens, ',');
			select @resultado,'2010';

---------------------------------------------

- len(cadena): retorna la longitud de la cadena enviada como argumento. "len" viene de length, que significa longitud en inglés. Ejemplo:

 select len('Hola');
-------------------------------------------

cuando no pueden hacer un cobro por rubro y capturan el RFC y salta un error 
checar los datos del contribuyente por ke podrian tener un enter en los datos que hace que se bote el java script


-----------------------------------------
usuario para cambiar los datos del contribuyente
jcervantes
jcervantes 

usuario cajero cancun
jaleman
kokiro3.
-------------------------------------
listado usuario_ cambio 2010 2009 listado de usuarios que hicieron cambios en los pagos 2009 y 2010

SELECT     diez.RFC AS RFC, 
	'2010' as Anio, diez.*,
                       '2009' AS Anio,nueve.*
FROM         dbo.repecos_cf_inscritos_2010 AS diez 
LEFT JOIN    dbo.repecos_cf_inscritos_2009 AS nueve 
ON  diez.RFC = nueve.RFC
WHERE     (diez.Usuario_Cambios IS NOT NULL)

---------------------------------------
RFC CAPA

CAP811007MT7
-------------------------------------------------
--query para saber si un requerimiento esta pagado
SELECT     det.Municipio AS Expr1, det.Oficina AS Expr2, det.Numero_Emision AS Expr3, det.RFC AS Expr4, det.Numero_Serie AS Expr5, det.Movimiento AS Expr6,
                       det.Folio_Impresion AS Expr7, det.Status AS Expr8, det.SubStatus AS Expr9, det.Fecha_Asignacion AS Expr10, det.Fecha_Impresion AS Expr11, 
                      det.Fecha_Citatorio AS Expr12, det.Municipio AS Expr16, det.Oficina AS Expr17, det.Numero_Emision AS Expr18, det.RFC AS Expr19, 
                      det.Numero_Serie AS Expr20, det.Movimiento, det.Folio_Impresion, det.Status, det.SubStatus, det.Fecha_Impresion, det.Fecha_Asignacion, 
                      det.Fecha_Citatorio, det.Fecha_No_Localizado, det.Fecha_Entrega, det.Fecha_Vencimiento, det.Fecha_Ultimo_Movimiento, det.Clave_Notificador, 
                      det.Gastos_Ejecucion, det.Multa_Efectiva, det.Multa_Programada, det.Actualizacion, det.Recargos, det.Honorarios_Notificacion, 
                      det.usuario_cancelacion, det.Categoria_No_Loc, det.Numero_No_Loc, det.Num_Salarios_Gastos_Ejecucion, ctrl.Municipio AS Expr13, 
                      ctrl.Oficina AS Expr14, ctrl.Numero_Emision AS Expr15, ctrl.Municipio AS Expr21, ctrl.Oficina AS Expr22, ctrl.Numero_Emision, 
                      ctrl.Numero_Control_Inicial, ctrl.Numero_Control_Final, ctrl.Clave_Obligacion AS Expr23, ctrl.Clave_Periodicidad, ctrl.Ejercicio_Fiscal AS Expr24, 
                      ctrl.Periodo_Inicial, ctrl.Periodo_Final, ctrl.Anio_Moroso, ctrl.Fecha_Emision, ctrl.Activado, ctrl.Tipo_Moroso, ctrl.Cuenta_Registro, ctrl.Dirigida, 
                      vig.RFC, vig.Numero_Serie, vig.REC, vig.Numero_Establecimiento, vig.Clave_Obligacion, vig.Anio_Inicial, vig.Mes_Inicial, vig.Fecha_Inicial, 
                      vig.Anio_Final, vig.Mes_Final, vig.Fecha_Final, vig.Fecha_Declarado, vig.No_Operacion, vig.Tipo_Periodo, vig.Estado, vig.Tipo_Presentacion, 
                      vig.Ejercicio_Fiscal, vig.Fuente_Informacion, vig.Municipio, vig.Oficina
FROM         dbo.obl_detalle_documentos AS det INNER JOIN
                      dbo.obl_control_emisiones AS ctrl ON det.Municipio = ctrl.Municipio AND det.Oficina = ctrl.Oficina AND 
                      det.Numero_Emision = ctrl.Numero_Emision INNER JOIN
                      dbo.obl_obligacion_vigilable_presentada AS vig ON det.RFC = vig.RFC AND ctrl.Clave_Obligacion = vig.Clave_Obligacion AND 
                      ctrl.Periodo_Inicial = vig.Mes_Inicial AND ctrl.Anio_Moroso = vig.Anio_Inicial AND ctrl.Clave_Periodicidad = vig.Tipo_Periodo
WHERE     (det.Folio_Impresion = '1173') AND (det.Numero_Emision = '1013') AND (det.RFC = 'COSF180724RC3')



------query para sacar los pagos de obligaciones(pago, pagado, requerimiento)
select * 
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision and a.municipio=b.municipio and a.oficina=b.oficina
inner join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC and b.periodo_inicial=c.mes_inicial and b.Anio_Moroso=c.Anio_Inicial and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion
where status='P' and a.municipio='07' and a.oficina='01'
 and a.numero_emision='0928' and a.folio_impresion='86'
and a.movimiento='R1'
order by fecha_ultimo_movimiento desc
--------------------------------------------------

el 23 de abril implemente la validacion para la entrega de documentos que verifica antes de traer los documentos a entregar
ai hay pago espontaneos.
---------------------------------------------------
querys 26 de abril
select * 
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
inner join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and b.periodo_inicial=c.mes_inicial 
and b.Anio_Moroso=c.Anio_Inicial 
and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion
where status='P' and a.municipio='03' 
and a.oficina='01' 
and a.numero_emision='1012' 
and a.folio_impresion='1367'
and a.movimiento='ME'
order by fecha_ultimo_movimiento desc

select * from obl_control_emisiones 
where --numero_emision like '10%' --and municipio='05' and oficina='01'
--and 
clave_obligacion='010603' 
and anio_moroso='2010'

select * 
from obl_detalle_documentos as	a
where status='P' 
and a.municipio='05' 
and a.oficina='01' 
and a.numero_emision='0952' 
and a.folio_impresion='706'
and a.movimiento='R1'
order by fecha_ultimo_movimiento desc

select top 100 * 
from obl_detalle_documentos as	a
where status='P' and fecha_ultimo_movimiento>'23/04/2010'
order by fecha_ultimo_movimiento desc

select * 
from obl_detalle_documentos 
where substatus='G'

select * 
from obl_detalle_documentos
where municipio='05' 
and oficina='01' 
and numero_emision='1017'

select * 
from obl_detalle_documentos
where municipio='05' 
and oficina='01' 
and numero_emision='1022' 
and RFC='AOMF860509'

select * from seg_usuarios 
where nombre like 'notificador%'
----------------------------------------------------------------------------
## me trae los requerimientos de la primera emision con proc almacenado
SELECT     min(doc.Oficina), 
			min(doc.Municipio), 
			min(doc.Numero_Emision), 
			min(doc.RFC), 
			min(doc.Movimiento), 
			min(doc.Folio_Impresion), 
			min(doc.SubStatus), 
			min(doc.Status), 
			min(emi.Municipio) AS Expr1, 
            min(emi.Periodo_Inicial), 
			min(emi.Ejercicio_Fiscal), 
			min(emi.Anio_Moroso), 
			min(vig.No_Operacion), 
			min(vig.Fecha_Declarado), 
			min(vig.RFC) AS Expr2, 
			min(doc.Fecha_Impresion), 
            min(emi.Fecha_Emision), 
			min(vig.Tipo_Presentacion), 
			min(vig.Estado), 
			min(vig.Fuente_Informacion), 
			min(vig.Mes_Inicial), 
			min(vig.Anio_Inicial), 
			min(vig.Fecha_Inicial), 
			min(vig.Anio_Final), 
            min(emi.Clave_Periodicidad), 
			min(emi.Numero_Control_Inicial), 
			min(emi.Clave_Obligacion), 
			min(emi.Numero_Control_Final)
FROM         dbo.obl_detalle_documentos AS doc 
left JOIN             dbo.obl_control_emisiones AS emi ON doc.Municipio = emi.Municipio AND doc.Oficina = emi.Oficina AND 
                      doc.Numero_Emision = emi.Numero_Emision 
left JOIN             dbo.obl_obligacion_vigilable_presentada AS vig ON doc.RFC = vig.RFC AND emi.Clave_Obligacion = vig.Clave_Obligacion AND 
                      emi.Periodo_Inicial = vig.Mes_Inicial AND emi.Anio_Moroso = vig.Anio_Inicial AND emi.Clave_Periodicidad = vig.Tipo_Periodo
WHERE     (doc.Oficina = '01') AND (doc.Municipio = '07') AND (emi.Clave_Obligacion = '010611') AND (emi.Periodo_Inicial = '03') AND (emi.Anio_Moroso = '2010') 
                      AND (emi.Ejercicio_Fiscal = '2010') AND (emi.Clave_Periodicidad = '02') 
--AND (vig.Fecha_Declarado >= '28/04/2010')
group by doc.Folio_Impresion

---------------------------------------------
##codigo para saber si un requerimiento ya fue pagado
##query para saber los requerimientos pagados de una emision

select * 
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and b.periodo_inicial=c.mes_inicial 
and b.Anio_Moroso=c.Anio_Inicial 
and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion
where a.municipio='08' 
and a.oficina='01' 
and a.numero_emision='1007' 
and a.folio_impresion='1616'
order by folio_impresion
---and a.folio_impresion='1367'
--and a.movimiento='ME'    






##esta es la buena 
select * 
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
left join obl_detalle_sucursales as d on 
a.municipio=d.municipio and a.numero_emision=d.numero_emision
and a.folio_impresion=d.numero_emision and a.oficina=d.oficina
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and d.Mes ='12' 
and d.Anio_Moroso='2020' 
and d.Clave_Periodicidad='02'
and d.Clave_Obligacion=c.Clave_Obligacion
and d.numero_establecimiento=c.numero_establecimiento
where a.municipio='02' 
and a.oficina='01' 
and a.numero_emision='2111' 
--and a.folio_impresion='1616'
order by a.folio_impresion
---and a.folio_impresion='1367'
--and a.movimiento='ME' 




 ## ESTE ME DEVUELVE SOLO LOS QUE YA TIENEN UN PAGO REVISAR QUE LA DECLARACION SEA NORMAL

select *
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
 join obl_detalle_sucursales as d on 
a.municipio=d.municipio and a.numero_emision=d.numero_emision
and a.folio_impresion=d.Folio_Impresion and a.oficina=d.oficina
 join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and d.Mes ='12' 
and d.Anio_Moroso='2020' 
and d.Clave_Periodicidad='02'
and d.Clave_Obligacion=c.Clave_Obligacion
and d.numero_establecimiento=c.numero_establecimiento
where a.municipio='02' 
and a.oficina='01' 
and a.numero_emision='2111' 
--and a.folio_impresion='55'
order by a.folio_impresion
---and a.folio_impresion='1367'
--and a.movimiento='ME' 



       ##estos querys me dicen de donde desde donde entra el pago 
select * from cob_cobros where referencia ='72020631987442906'

select * from cob_desglose where no_operacion ='01100102564392'



select * from dec_contribucion where  referencia ='72020631987442906'

select * from dec_contribucion_detalle where  id_dec_contribucion ='3033571'



----------------------------------------------
###analisis  validacion pagos bancos

select top 10 * from 
obl_obligacion_vigilable_presentada  as a
inner join dec_nominas as b on 
SUBSTRING ( b.Referencia ,4,14)=a.No_Operacion and a.RFC=b.RFC
where a.clave_obligacion='010103' and a.Anio_Inicial='2008'
and a.Mes_Inicial='01' and a.fuente_informacion='bancos'        


select  a.RFC, a.numero_establecimiento, a.fecha_declarado, 
a.No_Operacion, Tipo_periodo, a.ejercicio_fiscal, a.fuente_informacion, 
b.folio, b.referencia, b.tipo_declaracion, pago_usuario from 
obl_obligacion_vigilable_presentada  as a
inner join dec_nominas as b on 
SUBSTRING ( b.Referencia ,4,14)=a.No_Operacion and a.RFC=b.RFC
where a.clave_obligacion='010103' and a.Anio_Inicial='2008'
and a.Mes_Inicial='01' and a.fuente_informacion='bancos'  


select  a.RFC, a.numero_establecimiento, a.fecha_declarado, 
a.No_Operacion, Tipo_periodo, a.ejercicio_fiscal, a.fuente_informacion, 
b.folio, b.referencia, b.tipo_declaracion, pago_usuario from 
obl_obligacion_vigilable_presentada  as a
inner join dec_hospedaje as b on 
SUBSTRING ( b.Referencia ,4,14)=a.No_Operacion 
and a.RFC=b.RFC
where a.clave_obligacion='010104' 
and a.Anio_Inicial='2008'
and a.Mes_Inicial='01' 
and a.fuente_informacion='bancos'  

select  a.RFC, a.Clave_Obligacion, a.numero_establecimiento, a.fecha_declarado, 
a.No_Operacion, Tipo_periodo, a.ejercicio_fiscal, a.fuente_informacion, 
b.folio, b.referencia, b.tipo_declaracion, pago_usuario from 
obl_obligacion_vigilable_presentada  as a
inner join dec_ietu_isr_iva as b on 
SUBSTRING ( b.Referencia ,4,14)=a.No_Operacion and a.RFC=b.RFC
where a.clave_obligacion in ('010610','010618','010623') and a.Anio_Inicial='2008'
and a.Mes_Inicial='01' and a.fuente_informacion='bancos'  



select referencia 
from dec_nominas 
where SUBSTRING ( Referencia ,4,14)=('80205201696907')

(select  * --referencia 
from dec_nominas where referencia like ('%80205201696907%'))

--------------------------------------------------------------------------
genaro navarro

Usuario	Password
nasg0	Repecos2011

-------------------------------------------------------------------------
## QUERY QUE ME DEVUELVE LOS REQUERIMIENTOS DE UN CONTRIBUYENTE EN BASE A UN RFC

SELECT  docu.Municipio, 
	docu.Oficina, 
	docu.Numero_Emision, 
	emi.Ejercicio_Fiscal AS Año_de_Emision, 
	docu.RFC,
	CASE 	WHEN docu.Movimiento IN ('ME') 
		THEN 'Multa Extemporaneidad'  
		WHEN docu.Movimiento IN ('R1') 
		THEN 'Primer Requerimiento' 
	END AS Obligacion , 
	docu.Folio_Impresion,
	dbo.obl_nombres_estatus.Clave as Clave_Estado_Requerimiento, 
	dbo.obl_nombres_estatus.Nombre as Nombre_Estado_Requerimiento, 
        CASE 	WHEN emi.Clave_Obligacion IN ('010103') 
		THEN 'Nómina' END AS Obligacion, 
	emi.Anio_Moroso, 
	emi.Periodo_Inicial, 
	emi.Periodo_Final, 
        docu.Fecha_Entrega, 
	docu.Fecha_Vencimiento
FROM    dbo.obl_detalle_documentos AS docu 
INNER JOIN   dbo.obl_control_emisiones AS emi 
	ON  docu.Municipio = emi.Municipio 
	AND docu.Oficina = emi.Oficina 
	AND docu.Numero_Emision = emi.Numero_Emision 
INNER JOIN   dbo.obl_nombres_estatus 
	ON docu.Status = dbo.obl_nombres_estatus.Clave
WHERE     (docu.RFC = ' FSI970908ML5') 
AND (docu.Status NOT IN ('T'))
ORDER BY 	docu.Municipio, 
		docu.Oficina, 
		docu.Numero_Emision, 
		docu.Movimiento, 
		docu.Folio_Impresion, 
		docu.Status
------------------------------------------------------------------------------

pie de pagina de acta notificacion
Credencial No. __________________<br />
			Fecha de expedici&oacute;n: _____________<br />
			Vigencia: <?=date('Y')?>.<br />
			Adscripci&oacute;n: Recaudadora de Rentas. <br />
			Cargo: Notificador Ejecutor. <br />
			Expedida por el Secretario de Hacienda<br />
			del Estado de Quintana Roo, con fotograf&iacute;a<br />
			del portador y sello oficial.<br />

----------------------------------------------------
##QUERY  RAMON PAGOS CAPTURADOS CON FECHA año 1900 EN LA TABLA OBL_VIGILABLE_PRESENTADA

select No_Operacion
from  obl_obligacion_vigilable_presentada 
where No_Operacion 
in 
('00519337337604',
'00519337337604', 
'00527237645497', 
'00531249769229', 
'00531349792628', 
'00531349792989', 
'00531349793186', 
'00531349793227', 
'00531349793320', 
'00526209727932', 
'00527209753624', 
'00528209774307', 
'00528209774699', 
'00528209774754', 
'00531109817250', 
'00531209811604', 
'00531209811745', 
'00531209831086', 
'00419200009968', 
'00511200024364', 
'00511200025073', 
'00511200025327', 
'00527200049579', 
'00527200050058', 
'00528300052425', 
'00530100054107')
group by No_Operacion
-------------------------------------------------------




-------------------------------------------------------
##traer requerimientos para imrimir requerimientos y multas

SELECT     emi.Municipio, emi.Oficina, emi.Numero_Emision, docu.RFC, docu.Folio_Impresion, docu.Status, docu.Movimiento, docu.SubStatus, 
                      emi.Clave_Obligacion, emi.Clave_Periodicidad, emi.Ejercicio_Fiscal, emi.Periodo_Inicial
FROM         dbo.obl_control_emisiones AS emi INNER JOIN
                      dbo.obl_detalle_documentos AS docu ON emi.Municipio = docu.Municipio AND emi.Oficina = docu.Oficina AND 
                      emi.Numero_Emision = docu.Numero_Emision
WHERE     (emi.Municipio = '01') AND (emi.Oficina = '01') AND (emi.Clave_Periodicidad = '02') 
AND (emi.Ejercicio_Fiscal = '2010') AND (emi.Periodo_Inicial = '04') 
AND (emi.Clave_Obligacion = '010611') AND (docu.Folio_Impresion = 1211)
ORDER BY docu.Folio_Impresion

SELECT     emi.Municipio, emi.Oficina, emi.Numero_Emision, docu.RFC, docu.Folio_Impresion, docu.Status, docu.Movimiento, docu.SubStatus, 
                      emi.Clave_Obligacion, emi.Clave_Periodicidad, emi.Ejercicio_Fiscal, emi.Periodo_Inicial
FROM         dbo.obl_control_emisiones AS emi INNER JOIN
                      dbo.obl_detalle_documentos AS docu ON emi.Municipio = docu.Municipio AND emi.Oficina = docu.Oficina AND 
                      emi.Numero_Emision = docu.Numero_Emision
WHERE     (emi.Municipio = '01') AND (emi.Oficina = '01') AND (emi.Clave_Periodicidad = '03') AND (emi.Ejercicio_Fiscal = '2010') AND (emi.Periodo_Inicial = '03') 
                      AND (emi.Clave_Obligacion = '010610') AND (docu.Folio_Impresion = 1297)
ORDER BY docu.Folio_Impresion
----------------------------------------------------------
### traer los requerimientos de una emision de alguna emision  por un periodo, obligacion y municipio.

select b.* from obl_control_emisiones as a
join obl_detalle_documentos as b on a.municipio=b.municipio 
and a.oficina=b.oficina 
and a.numero_emision=b.numero_emision
where a.clave_obligacion='010611' 
and  a.ejercicio_fiscal='2010'
and a.periodo_inicial='04'
and a.municipio='08'
and a.oficina='01'
order by fecha_emision 
----------------------------------------------------------

## codigo que trae las emisiones que no se han creado en la tabla sirref_co_emisiones para los documentos de sirref

		SELECT MIN(datos.ALR) as ALR, datos.Numero_Emision,
			   datos.Municipio_Estatal, MIN(datos.Municipio_Federal) as Municipio_Federal,count(*) as Numero_Control_Final
		FROM sirref_co_datos datos
		LEFT JOIN sirref_co_emisiones emi
			 ON datos.Numero_Emision = emi.Numero_Emision
			 AND datos.Municipio_Estatal = emi.Municipio_Estatal
		WHERE emi.ALR is NULL
		GROUP BY datos.Numero_Emision, datos.Municipio_Estatal
-------------------------------------------------------------
modificar para generar multa extemp sirref genaro

RFC BAUN730902BPA
# operacion  1004206z006435
-------------------------------------------------
traer los docuemtnos de una emision sirref de un municipio reimprimir GENARO
select * from sirref_co_documentos  as a join
sirref_co_datos as b  on a.numero_control=b.numero_control
where a.numero_emision='051' and b.municipio_estatal='05' and fecha_impresion>'27/08/2012'

update sirref_co_documentos
set status='B'
from sirref_co_documentos  as a 
join sirref_co_datos as b  on a.numero_control=b.numero_control
where a.numero_emision='035' 
and b.municipio_estatal='08' 
and fecha_impresion>'27/08/2012'


-------------------------------------------------------------------------------
--quita el estatus de impreso a los documentos de una emision sirref.

update sirref_co_documentos
set status='B', fecha_impresion=NULL
where numero_control in (
select a.numero_control 
from sirref_co_documentos  as a join
sirref_co_datos as b  on a.numero_control=b.numero_control
where a.numero_emision='035' and b.municipio_estatal='04' ) 
and RFC in (select a.RFC 
from sirref_co_documentos  as a join
sirref_co_datos as b  on a.numero_control=b.numero_control

correccion sirref nidiam

update sirref_co_documentos
set status='B', fecha_impresion=NULL
where numero_control in (
select a.numero_control from sirref_co_documentos  as a join
sirref_co_datos as b  on a.numero_control=b.numero_control
where a.numero_emision='035' and b.municipio_estatal='04'and
a.numero_control in ('100659JD048206',
'100659JD056422',
'100659JD039691',
'100659JD056431',
'100659JD048215',
'100659JD014576',
'100659JD065261',
'100659JD022308',
'100659JD022317',
'100659JD08148A',
'100659JD048224',
'100659JD073559',
'100659JD014585',
'100659JD081499',
'100659JD048233',
'100659JD022326',
'100659JD065270',
'100659JD007482',
'100659JD073568',
'100659JD073577',
'100659JD073586',
'100659JD039708',
'100659JD073595',
'100659JD048242',
'100659JD007491',
'100659JD073601',
'100659JD06528A',
'100659JD065299',
'100659JD022335',
'100659JD081505',
'100659JD056440',
'100659JD022344',
'100659JD007508'))
where a.numero_emision='035' and b.municipio_estatal='04' )
-----------------------------------------------------------------------------------
###asesoria amigui desautorizacion 

c=4]?ö??? ?ä?¢???[/c=6] dice:
K paso?
Lili dice:
oye amigui me hablo manuel nahuat con dos solicitudes nuevas de comodatos  me dice que le aparecen con recargos
Lili dice:
una en ceros y otra con recargos
Lili dice:
que ya estan autorizadas ambas
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Entra a movimientos d comodatos y verifica con el num d licencias porfa
Lili dice:
hay una en ceros
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Ok pero esa misma esta autorizada en el mismo anio?
Lili dice:
no veo un campo que diga autorizado
Lili dice:
pero el año fiscal esta en cero
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Ok es esooo por eso salio en ceros
Lili dice:
que hago 
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Porfa elimina el movimiento k esta en ceros
Lili dice:
asi directo 
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Entra a solicitud d comodatos 2
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Si asi directo
Lili dice:
ya
Lili dice:
solicitudes_comodatos2 
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Sip$
Lili dice:
  ya estoy
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Pero xeca en el sistema entra a solicitud d comiodatos y busca con el num d licencia busca el id d la solicitud t entra a la tabla y buscalo con el id
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Y solo le cambias el status d autorizado ponle N y listo
Lili dice:
 
Lili dice:
lo checo
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Ok grax
Lili dice:
 a ti oye
Lili dice:
el otro caso
Lili dice:
me dice que le parece con recargos
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Aaa ok porfa entra a la solicitud d comodatos
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Y fijate del inicio d conytrato es la fecha d uinicio
Lili dice:
entre en el sistema a solicitud de comodatos
Lili dice:
no veo inicio
Lili dice:
fecha de contrato   
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Si
Lili dice:
  es de ayer
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Ok lo mismo
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Elimina el movimiento
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Y lo mismo k la anterior
Lili dice:
en movimientos de comodatos o desde solicitud de comodatos 
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Nada mas k en donde dice aplicar recargo cambia el estatus a N
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Si eliomina el mivimiento desd el sistema
Lili dice:
si pero desde la opcion solicitud de comodato 
Lili dice:
del sistema 
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Nop la solicitud no la puedes editar solo directamente desd la tabla, el movimiento lo elimonas desd el sistema en movimientos d comodatos
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Y editas la solicitud desd la tabla solicitud_comoidatos2
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Cambia el status d autorizado a N el d aplicar recargo a N y el anio en cero porfa
Lili dice:
oye amigui
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Dime
Lili dice:
espera me va a explicar... por msn
Lili dice:
y te lo pego
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Ok
Lili dice:
@Manu_SH dice:
para que entremos en la misma sinfonia
@Manu_SH dice:
jeje
@Manu_SH dice:
 
@Manu_SH dice:
la primera es la lic.
@Manu_SH dice:
05945
@Manu_SH dice:
esa se autorizo la primera vez me arrojo en 0
@Manu_SH dice:
se volvio a subir y cuando autorize me arrojo con todo y recargos
@Manu_SH dice:
esa esta mal
@Manu_SH dice:
ya que 
@Manu_SH dice:
por ser nuevos comodatos
@Manu_SH dice:
so
Lili dice:
solo me deben cobrar la parte proporcional

Lili dice:
@Manu_SH dice:
y la 06620
@Manu_SH dice:
esta correctamente
Lili dice:
@Manu_SH dice:
el problema solo es con la lic. 5945
@Manu_SH dice:
por esa me arroja recargos
@Manu_SH dice:
la lic. 05945 con id 7795 
@Manu_SH dice:
esa me arroja recargos
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Ok
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Mira
[c=4]?ö??? ?ä?¢???[/c=6] dice:
La 05945
[c=4]?ö??? ?ä?¢???[/c=6] dice:
Entra a movimientos d comodatos y elimina el movimiento k le sale con recargos
[c=4]?ö??? ?ä?¢???[/c=6] dice:


---------------------------------------------------------------------------------
###query para imprimir a los morosos de federales para que no salgan impresos los que ya se han impreso en emisiones anteriores
modificar el archivo imprime_requerimientos2_federales.php

SELECT TOP (1000) datos.*, mun.Nombre as Nombre_Municipio
	FROM sirref_co_datos datos
	JOIN sirref_co_documentos documento
		ON datos.RFC = documento.RFC
		AND datos.Numero_Control = documento.Numero_Control
		AND datos.ALR = documento.ALR
		AND documento.Movimiento = 'R1'
		AND documento.Status = 'B'
	JOIN cat_municipios mun
		ON datos.Municipio_Estatal = mun.Clave
	WHERE datos.Numero_Emision = '051' 
		AND datos.Municipio_Estatal = '02'
		AND datos.RFC  not in (
				select datos.RFC 
				from sirref_co_datos  as datos
				join sirref_co_documentos as documento 
				on datos.RFC = documento.RFC
						AND datos.Numero_Control = documento.Numero_Control
						AND datos.ALR = documento.ALR
						AND documento.Movimiento = 'R1'
						AND documento.Status != 'B'
				where municipio_estatal='02' 
				and datos.numero_emision 
				in (select numero_emision from sirref_co_emisiones 
				where year(fecha_carga)='2010'
				group by numero_emision))

------------------------------------------------------------------------------------
####año actual
year(getdate())


------------------
## query para saber cuantos documentos son imprimibles de sirref cuando el municipio es 01,02,08 en sirref
SELECT count(*)
 --datos.*, mun.Nombre as Nombre_Municipio
	FROM sirref_co_datos datos
	JOIN sirref_co_documentos documento
		ON datos.RFC = documento.RFC
		AND datos.Numero_Control = documento.Numero_Control
		AND datos.ALR = documento.ALR
		AND documento.Movimiento = 'R1'
		AND documento.Status = 'B'
	JOIN cat_municipios mun
		ON datos.Municipio_Estatal = mun.Clave
	WHERE datos.Numero_Emision = '052' 
		AND datos.Municipio_Estatal = '01'
		AND datos.RFC  not in (
				select datos.RFC 
				from sirref_co_datos  as datos
				join sirref_co_documentos as documento 
				on datos.RFC = documento.RFC
						AND datos.Numero_Control = documento.Numero_Control
						AND datos.ALR = documento.ALR
						AND documento.Movimiento = 'R1'
						AND documento.Status != 'B'
				where municipio_estatal='01'
				and datos.numero_emision 
				in (select numero_emision from sirref_co_emisiones 
				where year(fecha_carga)=year(getdate())
				group by numero_emision))
--------------------------------------------------
##desaparecidos del sistema
F.9850**2008** EMISION 0806
F.10172**2008** EMISION 0806
F.14408**2008** EMISION 0806
F.5717 		EMISION 0804



----------------------------------
##comillas dentro de una cadena detexto

$cadena= " \" hola \" "; resulta : " hola "

------------------------------------------------------------
--poner comillas al inicio de cada numero de serie, para luego hacer la subconsulta no
--pude meter los 800 tuve que hacerlo por bloques de 250

SELECT     ''''+''''+numero_serie+''''+''''+','
FROM         dbo.obl_detalle_documentos
WHERE     (Numero_Emision = '1035') AND (Municipio = '04') AND (Oficina = '01')
 AND (Movimiento = 'R1') AND (NOT (Status IN ('T', 'P')))
-------------------------------------------------------------
##query que me devuelve la estadistica de una oficina por todas las obligaciones
// quite esta linea pues confunde con los entregados pero asi lo habia solicitado el lic. sergio glez
(t.Entregado+t.No_Localizado+t.Doble_No_Localizado+t.Cambio_Periodo +t.Resolucion_Juridica +t.Solventado_por_Insolvencia+t.Baja + t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa +t.Contribuyente_Solidario+t.Aviso_RFC) as Diligenciados , 

select
Clave_Municipio,
Clave_Oficina, 
Municipio,
Oficina,
Clave_Obligacion ,
Obligacion,
Numero_Emision,
Fecha_Emision,
Dirigida,
Periodo_Inicial  as Mes_Inicial,
Periodo_Final as Mes_Final,
anio_moroso as Año_Moroso ,
Total,
Impreso as impreso, 
Citatorio, 
t.Entregado, 
(t.No_Localizado+t.Doble_No_Localizado) as No_Localizados,
(t.Cambio_Periodo +t.Resolucion_Juridica+t.Solventado_por_Insolvencia+t.Baja +t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa +t.Contribuyente_Solidario+t.Aviso_RFC) as Otras_Situaciones,
(t.Pagado+t.Pago_Espontaneo) as Pagados, 
t.Pago_Honorarios as Pago_Honorarios, 
t.Declaracion_en_Ceros as Declaracion_en_Ceros
 from (SELECT min(d.Clave) as Clave_Municipio,
				min(e.Clave) as Clave_Oficina,
				min(d.Nombre) as Municipio,
				min(e.Nombre) as Oficina,
               b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               b.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
					SUM(CASE WHEN Status is not null THEN 1 ELSE 0 END) AS Total, 
					SUM(CASE WHEN ( Fecha_Impresion is null and Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is null) and (Status in ('D'))) THEN 1 ELSE 0 END) AS Pendiente, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Citatorio is not null)) THEN 1 ELSE 0 END) AS Citatorio, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is not null)) THEN 1 ELSE 0 END) AS Entregado, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is not null) and (Status in ('V'))) THEN 1 ELSE 0 END) AS Vencido, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Fecha_No_Localizado is not null) and (Status in ('N')) THEN 1 ELSE 0 END) AS No_Localizado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null )  and (Fecha_No_Localizado is not null) and (Status in ('X')) THEN 1 ELSE 0 END) AS Doble_No_Localizado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('H')) THEN 1 ELSE 0 END) AS Pago_Honorarios, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('L')) THEN 1 ELSE 0 END) AS Declaracion_en_Ceros, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('M')) THEN 1 ELSE 0 END) AS Cambio_Periodo, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('J')) THEN 1 ELSE 0 END) AS Resolucion_Juridica, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('S')) THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('Y')) THEN 1 ELSE 0 END) AS Baja, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('Z')) THEN 1 ELSE 0 END) AS Suspension_Actividades, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('O')) THEN 1 ELSE 0 END) AS Sin_Obligacion, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('U')) THEN 1 ELSE 0 END) AS Pago_Multa, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('W')) THEN 1 ELSE 0 END) AS Contribuyente_Solidario, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('R')) THEN 1 ELSE 0 END) AS Aviso_RFC 
               FROM obl_detalle_documentos as a 
               left join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               inner join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
			   inner join cat_municipios as d on b.municipio=d.Clave
			   inner join cat_oficinas as e on b.oficina=e.Clave 
			   and b.municipio=e.Clave_Municipio 
               where b.Municipio='06' and b.Oficina='01' and  
               b.Ejercicio_Fiscal='2010' and a.Movimiento='M1'
               and MONTH(b.Fecha_Emision) BETWEEN '01' and '12'
               group by b.Numero_Emision,  b.Clave_Obligacion,c.Descripcion ) as t  
			   order by clave_municipio, clave_oficina, clave_obligacion,numero_emision

-----------------------------------------------------------------------------------------------------------------
##ESTADISTICA DE EMISIONES POR TODOS LOS MUNICIPIOS Y OFICINAS DE TODAS LAS OBLIGACIONES POR TIPO DE DOCUMENTO

select
Clave_Municipio,
Clave_Oficina, 
Municipio,
Oficina,
Clave_Obligacion ,
Obligacion,
Numero_Emision,
Fecha_Emision,
Dirigida,
Periodo_Inicial  as Mes_Inicial,
Periodo_Final as Mes_Final,
anio_moroso as Año_Moroso ,
Total,
Impreso as impreso, 
Citatorio, 
t.Entregado, 
(t.No_Localizado+t.Doble_No_Localizado) as No_Localizados,
(t.Cambio_Periodo +t.Resolucion_Juridica+t.Solventado_por_Insolvencia+t.Baja +t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa +t.Contribuyente_Solidario+t.Aviso_RFC) as Otras_Situaciones,
(t.Pagado+t.Pago_Espontaneo) as Pagados, 
t.Pago_Honorarios as Pago_Honorarios, 
t.Declaracion_en_Ceros as Declaracion_en_Ceros
 from (SELECT min(d.Clave) as Clave_Municipio,
				min(e.Clave) as Clave_Oficina,
				min(d.Nombre) as Municipio,
				min(e.Nombre) as Oficina,
               b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               b.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
					SUM(CASE WHEN Status is not null THEN 1 ELSE 0 END) AS Total, 
					SUM(CASE WHEN ( Fecha_Impresion is null and Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is null) and (Status in ('D'))) THEN 1 ELSE 0 END) AS Pendiente, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Citatorio is not null)) THEN 1 ELSE 0 END) AS Citatorio, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is not null)) THEN 1 ELSE 0 END) AS Entregado, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is not null) and (Status in ('V'))) THEN 1 ELSE 0 END) AS Vencido, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Fecha_No_Localizado is not null) and (Status in ('N')) THEN 1 ELSE 0 END) AS No_Localizado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null )  and (Fecha_No_Localizado is not null) and (Status in ('X')) THEN 1 ELSE 0 END) AS Doble_No_Localizado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('H')) THEN 1 ELSE 0 END) AS Pago_Honorarios, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('L')) THEN 1 ELSE 0 END) AS Declaracion_en_Ceros, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('M')) THEN 1 ELSE 0 END) AS Cambio_Periodo, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('J')) THEN 1 ELSE 0 END) AS Resolucion_Juridica, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('S')) THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('Y')) THEN 1 ELSE 0 END) AS Baja, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('Z')) THEN 1 ELSE 0 END) AS Suspension_Actividades, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('O')) THEN 1 ELSE 0 END) AS Sin_Obligacion, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('U')) THEN 1 ELSE 0 END) AS Pago_Multa, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('W')) THEN 1 ELSE 0 END) AS Contribuyente_Solidario, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('R')) THEN 1 ELSE 0 END) AS Aviso_RFC 
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b 
				on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               inner join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
			   inner join cat_municipios as d on b.municipio=d.Clave
			   inner join cat_oficinas as e on b.oficina=e.Clave 
			   and b.municipio=e.Clave_Municipio 
               where --b.Municipio='06' and b.Oficina='01' and  
               b.Ejercicio_Fiscal='2010' and a.Movimiento='R1'
               and MONTH(b.Fecha_Emision) BETWEEN '01' and '12'
               group by b.Municipio, b.Oficina, b.Numero_Emision,  b.Clave_Obligacion,c.Descripcion ) as t  
			   order by clave_municipio, clave_oficina, clave_obligacion,numero_emision

---------------------------------------------------------------------------------
## el mismo query optimizado
con el inner de los catalogos optimizado por fuera del select principal


select
t.Clave_Municipio,
t.Clave_Oficina, 
d.Nombre as Municipio,
e.Nombre as Oficina,
t.Clave_Obligacion ,
c.Descripcion as obligacion,
Numero_Emision,
Fecha_Emision,
Dirigida,
Periodo_Inicial  as Mes_Inicial,
Periodo_Final as Mes_Final,
anio_moroso as Año_Moroso ,
Total,
Impreso as impreso, 
Citatorio, 
t.Entregado, 
(t.No_Localizado+t.Doble_No_Localizado) as No_Localizados,
(t.Cambio_Periodo +t.Resolucion_Juridica+t.Solventado_por_Insolvencia+t.Baja +t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa +t.Contribuyente_Solidario+t.Aviso_RFC) as Otras_Situaciones,
(t.Pagado+t.Pago_Espontaneo) as Pagados, 
t.Pago_Honorarios as Pago_Honorarios, 
t.Declaracion_en_Ceros as Declaracion_en_Ceros
 from (SELECT min(b.Municipio) as Clave_Municipio,
				min(b.Oficina) as Clave_Oficina,
				min(b.Clave_Obligacion) as Clave_Obligacion,
               b.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
					SUM(CASE WHEN Status is not null THEN 1 ELSE 0 END) AS Total, 
					SUM(CASE WHEN ( Fecha_Impresion is null and Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is null) and (Status in ('D'))) THEN 1 ELSE 0 END) AS Pendiente, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Citatorio is not null)) THEN 1 ELSE 0 END) AS Citatorio, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is not null)) THEN 1 ELSE 0 END) AS Entregado, 
                      SUM(CASE WHEN ((Fecha_Impresion is not null )and (Fecha_Entrega is not null) and (Status in ('V'))) THEN 1 ELSE 0 END) AS Vencido, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Fecha_No_Localizado is not null) and (Status in ('N')) THEN 1 ELSE 0 END) AS No_Localizado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null )  and (Fecha_No_Localizado is not null) and (Status in ('X')) THEN 1 ELSE 0 END) AS Doble_No_Localizado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('H')) THEN 1 ELSE 0 END) AS Pago_Honorarios, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('L')) THEN 1 ELSE 0 END) AS Declaracion_en_Ceros, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('M')) THEN 1 ELSE 0 END) AS Cambio_Periodo, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('J')) THEN 1 ELSE 0 END) AS Resolucion_Juridica, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('S')) THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('Y')) THEN 1 ELSE 0 END) AS Baja, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('Z')) THEN 1 ELSE 0 END) AS Suspension_Actividades, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('O')) THEN 1 ELSE 0 END) AS Sin_Obligacion, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('U')) THEN 1 ELSE 0 END) AS Pago_Multa, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('W')) THEN 1 ELSE 0 END) AS Contribuyente_Solidario, 
                      SUM(CASE WHEN (Fecha_Impresion is not null ) and (Status in ('R')) THEN 1 ELSE 0 END) AS Aviso_RFC 
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b 
				on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               where b.Municipio='06' and b.Oficina='01' and  
               b.Ejercicio_Fiscal='2010' and a.Movimiento='R1'
               and MONTH(b.Fecha_Emision) BETWEEN '01' and '12'
               group by b.Municipio, b.Oficina, b.Numero_Emision,  b.Clave_Obligacion ) as t 
			   inner join cat_obligaciones as c on t.Clave_Obligacion=c.Clave
			   inner join cat_municipios as d on t.Clave_Municipio=d.Clave
			   inner join cat_oficinas as e on t.clave_Oficina=e.Clave 
			   and t.Clave_Municipio=e.Clave_Municipio  
			   order by clave_municipio, clave_oficina, clave_obligacion,numero_emision
--------------------------------------------------------------------------------
//PONER UN SALTO DE PAGINA ENTRE DOS PAGINAS EN UN REPORTE

<div style="page:pagina;" >
pagina 1
</div>
<br style="page:pagina;page-break-after:always" />
<div style="page:pagina;" >
pagina 2
</div>
--------------------------------------------------------

##querys para usos del foreach

Puede haber notado que las siguientes son funcionalmente idénticas: 

##este query solo asigna a una variable el valor que toma al recorrer el array
<?php
$arr = array("uno", "dos", "tres");
reset($arr);
while (list(, $value) = each($arr)) {
    echo "Valor: $value<br />\n";
}

foreach ($arr as $value) {
    echo "Valor: $value<br />\n";
}
?> 


##este query toma la llave y el valor y los pone en dos variables

Las siguientes también son funcionalmente idénticas: 
<?php
$arr = array("uno", "dos", "tres");
reset($arr);
while (list($key, $value) = each($arr)) {
    echo "Clave: $key; Valor: $value<br />\n";
}

foreach ($arr as $key => $value) {
    echo "Clave: $key; Valor: $value<br />\n";
}
?> 
-------------------------------------------------------------------------------
##para cambiar la emision de invitaciones para todos los años 
cambiar los archivos que estan ch-sarh2 y poner en ch-sarh

genera_emision_cartas_invitacion.php
seleccionar_genera_invitacion.php
------------------------------------------------------------------------------
##boton enviar
echo "<input name='Enviar' type='Button' value='Asignar' onclick='this.disabled=true;document.asigna_requerimientos.submit()'>";
echo "<input name='Restablecer' type='reset' value='Restablecer'>";

---------------------------------------------------------------------------------
### determinar las diferencias entre fechas

SELECT DATEDIFF(Year, @StartDate, @EndDate) AS NewDate
Return Value = 0 Year


SELECT DATEDIFF(quarter, @StartDate, @EndDate) AS NewDate
Return Value = 1 quarter


SELECT DATEDIFF(Month, @StartDate, @EndDate) AS NewDate
Return Value = 2 Month


SELECT DATEDIFF(dayofyear,@StartDate, @EndDate) AS NewDate
Return Value = 61 day


SELECT DATEDIFF(Day, @StartDate, @EndDate) AS NewDate
Return Value = 61 Day


SELECT DATEDIFF(Week, @StartDate, @EndDate) AS NewDate
Return Value = 9 Week


SELECT DATEDIFF(Hour, @StartDate, @EndDate) AS NewDate
Return Value = 1464 Hour


SELECT DATEDIFF(minute, @StartDate, @EndDate) AS NewDate
Return Value = 87840 minute


SELECT DATEDIFF(second, @StartDate, @EndDate) AS NewDate
Return Value = 5270400 second


DECLARE @StartDate DATETIME
DECLARE @EndDate DATETIME
SET @StartDate ='2007-06-05' 
SET @EndDate ='2007-06-06' 

SELECT DATEDIFF(millisecond, @StartDate, @EndDate) AS NewDate
Return Value = 86400000 millisecond

--------------------------------------------------------------
##query que me trae las asignaciones duplicadas

select *, DATEDIFF(second,b.Fecha_Movimiento,a.Fecha_Movimiento) as Segundos 
from obl_actos_notificador as a 
inner join obl_actos_notificador as b
on a.Municipio=b.Municipio 
and a.Oficina=b.Oficina 
and a.Numero_Emision=b.Numero_Emision 
and a.Folio_Impresion=b.Folio_Impresion 
and a.Movimiento=b.Movimiento 
and a.Status=b.Status
where a.Municipio='04' 
and a.Oficina='01' 
--and a.Numero_Emision like '10%'
--and a.Movimiento='R1' 
and a.Status='A' 
and DATEDIFF(second,b.Fecha_Movimiento,a.Fecha_Movimiento) BETWEEN 1 AND 59
order by a.numero_emision, a.folio_impresion, a.clave_notificador



-------------------------------------------------------------
## registros que no se cargaron en la emiison 147 de sirref

73|CAER670429QP0|10065957000036|ROMAN CANCHE ESCAMILLA                                                          |CALLE HERMENEGILDO GALEANA MZA 5 LT 5|NUMERO 35||REG 215 FRACC LOS HEROES|CANCUN|900088|2009|01|F|      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |06|2010/08/30|77517|005|
73| CAM080509KV1|10065957000038|CUATRO AMORES DE MEXICO                                                         |RELAMPAGO MZA 9 LOTE 24|CASA 1||SM 18|CANCUN|A UNA CUADRA DE FARMACIA YZA       |900088|2009|01|0|      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |06|2010/08/30|77505|005|
73| CGH980616C20|10065957000047|CORPORACION GHEOSS                                                              |AV KINIK MZA 13 LOTE 1|EDIFICIO G4|DEPTO 102|SMZA 50 FRACC FRAMBOYANES CANCUN|CA|900088|2009|01|0|      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |06|2010/08/30|77533|005|
73| CHR0708184QA|10065957000048|COMEPROMER H. ROMERO                                                            |CIRCUITO HACIENDAS DEL JARAL MANZANA 91 LOTE 1|NUMERO 1627-B||SM 200 HDAS DEL CA|900088|2009|01|0|      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |06|2010/08/30|77539|005|
73|COKE650325LIA|10316957000051|JOSE ENRIQUE DANIEL COUOH KOH                                                   |AV. AGUSTIN MELGAR MANZANA 44|LOTE 2|S N|NICTE HA PLAYA DEL CARMEN|PLAYA DEL CAR|900088|2009|01|F|      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |06|2010/08/30|77710|008|
73| CWI080815MJA|10065957000059|CORAL WINE                                                                      |CARRETERA CANCUN-AEROPUERTO KM 17|BODEGA 1 MANZANA 7 LOTE 7|PLANTA ALTA|SM 301|C|900088|2009|01|0|      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |06|2010/08/30|77560|005|
73| DMA050429CB8|10065957000066|DIAGONAL MAYA                                                                   |CARRETERA CANCUN AEROPUERTO KM 17|BOD 30|PLANTA ALT|CTRAL DE ABASTOS CANCUN|CANC|900088|2009|01|0|      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |      |    |  | |06|2010/08/30|77560|005|
-------------------------------------------------------------------------------
##query para saber los documentos a los que se les envio una invitacion
## y se les actualizo la cuota 


select  a.RFC,
   (a.nombres+' '+a.apellido_paterno+' '+a.apellido_materno) as NOMBRE,
    case when (c.rfc=null) then 'Este contribuyente no esta en el padron' 
	else coalesce(c.Domicilio_Fiscal_Calle,c.Domicilio_Calle,'') end as DOMICILIO,
       a.descripcion_actividad as ACTIVIDAD, 
       --a.total_ingresos AS INGRESOS, descomentar
       a.rango_anterior,
       a.rango_Actual, 
       a.tarifa_anterior,
       a.tarifa_actual,
       a.municipio,
      case when a.tarifa_anterior='A' then b.a_total else  b.b_total  end as cuota_anterior,
      case when a.tarifa_actual='A' then d.a_total else  d.b_total  end as cuota_actual,
      a.fecha_ultima_actualizacion,
       a.usuario_cambios,
	  e.status
      from repecos_cf_inscritos_2010_Historial_Cambios a 
	  inner join repecos_cf_tarifa_2010 b on a.rango_anterior=b.rango   
      left join pad_contribuyentes c on a.rfc=c.rfc --dejar en inner
      join repecos_cf_tarifa_2010 d on a.rango_actual=d.rango 
	  inner join obl_detalle_cartas_invitacion  as e on a.rfc=e.rfc 
		and a.municipio=e.municipio 
where  a.baja='N' and  a.rfc=' EBU420114CN2' and a.municipio=01 and a.usuario_cambios='jsanchezc' 
				and fecha_ultima_actualizacion between '2010-09-14' and '2010-09-15'

---------------------------------------------------------------------------------

sacar los pagos de un  vehiculo requerido
select * FROM openquery (ADS_ING,'select NSE_CVDB06 as Serie,PLL_CVDB06 as Placa,
      TRA_CVDB06 as Rubro,
      FEC_CVDB06 as FechaCobro,
      HRC_CVDB06 as HoraCobro,
      IMP_CVDB06 as Importe,
      IAC_CVDB06 as Actualizacion,
      IRE_CVDB06 as Recargo,
      MUL_CVDB06 as Multa,
      NCA_CVDB06 as Caja,
      FOL_CVDB06 as Folio,
      ACO_CVDB06 as AnioCobro,
      STA_CVDB06 as Status,
      MPO_CVDB06 as Municipio,
      OFN_CVDB06 as Oficina,
      USU_CVDB06 as Usuario from cvdb06 where PLL_CVDB06 in (''UVH5274'')')
select * FROM openquery (ADS_ING,'select * from cvdb06 where PLL_CVDB06 in (''UUB2861'')')


select * from obl_detalle_vehiculo where numero_serie='W0LTG92F822287057'
select * from obl_control_emisiones where numero_emision='1006' and municipio='02' and oficina='02'
-------------------------------------------------------------------------------------
##QUERY PARA SABER CUANTOS CONTRIBUYENTES EXISTEN ACTUALMENTE EN EL PADRON POR OBLIGACION

select b.municipio,min(c.descripcion) as obligacion,count (*) from pad_obligacionesporestablecimiento as a 
inner join pad_establecimientos as b on a.rfc=b.rfc and a.numero_establecimiento=b.numero
inner join cat_obligaciones as c on a.clave=c.clave
where tipo_obligacion='Estatal' and a.situacion='Activo' and b.situacion='Activo' 
--and a.clave='010104'
group by b.municipio,a.clave
order by b.municipio,a.clave
----------------

##APLICAR UN WHILE EN UN PROCEDIMIENTO ALMACENADO

WHILE (@Mes_Inicial<11) 
begin
END


-----------------------------
## rfc para agregar a la emision de cozumel
angulo chim maria elena, rfc: AUCE5505088G2


---------------------------------

los folios son:  1233       emision: 1046 *
 
 6,-
 9, -
11,*
17, *
40,*
61 *  emision: 1101
 
105, *
109, *
116, *
117, *
120, *
123, *
124  *   emision: 1102
-----------------------------------
alma grisel

 C RO
 ES EL FOLIO 5414
 DE   EMISION 841
 APARECE COMO PAGO ESPONTANEO
 EL CUAL SE LO NOTIFICARON EL 8 DE OCTUBRE DEL 2008
 Y EL  LO PAGO EL 24 DE OCTUBRE
----------------------------------

*1.- FOLIO 168 EMISION 1016 MES MARZO 2010*
*2.-FOLIO 252 EMISION 1023 MES MAYO 2010*
*3.-FOLIO 286 EMISION 1027 MES JUNIO 2010*
*4.- FOLIO 328 EMISION 1030 MES JULIO 2010*
*5.- FOLIO 449 EMISION 1040 MES OCTUBRE 2010

----------------------------------------
##QUERY QUE VALIDA QUE LOS MOROSOS EN CVDB75 NO TENGA PAGO ESPONTANEO
select * 
FROM openquery (ADS_ING,'SELECT * FROM CVDB75 LEFT JOIN CVDB06 ON
NSE_CVDB75=NSE_CVDB06 AND ANM_CVDB75=ACO_CVDB06 AND TRA_CVDB06 IN (''TEN'')
WHERE ANM_CVDB75  = (2010)  AND NSE_CVDB06 IS NULL')


------------------------------------------
respaldo pruebas jorge sanchez de cartas de invitacion 14 de febrero 2011
01	01	1101	AAAB5503302X9	00	C1	1	C	A	2011-02-01 12:18:48.270	2011-02-08 12:36:51.637	2011-02-08 00:00:00.000	NULL	2011-02-01 00:00:00.000	NULL	2011-02-08 13:00:54.163	notificador	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL
01	01	1101	AAAL891006313	00	C1	2	A	D	2011-02-01 11:48:33.967	2011-02-01 12:22:49.030	NULL	NULL	2011-02-01 00:00:00.000	NULL	2011-02-01 13:52:27.717	jcervantes	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL
01	01	1101	AAAM451011H70	00	C1	3	A	D	2011-02-01 11:48:33.967	2011-02-01 12:22:49.153	NULL	NULL	2011-02-01 00:00:00.000	NULL	2011-02-01 13:52:27.890	jcervantes	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL
01	01	1101	AAAM560613Q90	00	C1	4	E	A	2011-02-01 11:48:33.983	2011-02-01 12:23:23.220	NULL	NULL	2011-02-04 00:00:00.000	NULL	2011-02-04 10:21:31.107	gcanul	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL
01	01	1101	AAAR5110057J2	00	C1	5	E	D	2011-02-01 11:48:33.997	2011-02-01 12:24:10.440	NULL	NULL	2011-02-01 00:00:00.000	NULL	2011-02-01 13:52:26.250	cmartin	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL
01	01	1101	AAAR611014CZ9	00	C1	6	E	D	2011-02-01 11:48:33.997	2011-02-01 12:24:10.470	NULL	NULL	2011-02-01 00:00:00.000	NULL	2011-02-01 13:52:26.950	cmartin	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL
01	01	1101	AAAR790319193	00	C1	7	E	D	2011-02-01 11:48:34.013	2011-02-01 12:23:23.267	NULL	NULL	2011-02-01 00:00:00.000	NULL	2011-02-01 13:52:27.200	gcanul	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL
01	01	1102	CACD550201CT2	00	C1	8	C	A	2011-02-14 15:14:20.240	2011-02-14 15:15:21.280	2011-02-14 00:00:00.000	NULL	NULL	NULL	2011-02-14 15:33:57.533	dbriceno	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL
01	01	1102	CACD631016FM7	00	C1	9	B	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	0.00	0.00	0.00	0.00	NULL	NULL	NULL	0	NULL

------------------------------------------

tabla de declaraciones de repecos
dec_ietu_isr_iva
-----------------------------------------------------

##query para morosos de repecos

SELECT pad_oblxest.RFC FROM pad_obligacionesporestablecimiento pad_oblxest 
JOIN pad_contribuyentes cont 
ON pad_oblxest.RFC = cont.RFC LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '03' AND obl_oblvigpre.Anio_Inicial = '2010' 
AND obl_oblvigpre.Mes_Inicial = '09' AND obl_oblvigpre.Mes_Final = '10' AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave in ('010610','010618','010623') 
AND fed.Anio_Moroso = '2010' 
AND fed.Mes_Inicial = '09' 
AND fed.Mes_Final = '10' 
AND fed.Clave_Periodicidad = '03'
 LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave in ('010610','010618','010623') 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2010-10-01',20) OR pad_oblxest.Fecha_Inicio = '' 
OR pad_oblxest.Fecha_Inicio IS NULL ) AND cont.Municipio = '01' AND pad_oblxest.Situacion = 'Activo' 
AND cont.Situacion = 'Activo' 
AND fed.RFC IS NULL 
AND cont.Localizable = 'S' 
AND obl_oblvigpre.RFC IS NULL 
AND oco.RFC IS NULL 
AND cont.Localidad = '0001' 
AND pad_oblxest.RFC not in (SELECT a.RFC FROM obl_detalle_documentos a 
JOIN obl_control_emisiones b ON a.Municipio = b.Municipio AND a.Oficina = b.Oficina 
AND a.Numero_Emision = b.Numero_Emision 
WHERE a.Municipio = '01' 
AND a.Oficina = '01' 
AND a.Status in ('X') 
AND a.Movimiento in ('R1','R2','R3') 
AND b.Clave_Obligacion in ('010610','010618','010623') GROUP BY a.RFC) 
--and pad_oblxest.rfc='PEFF611211RQ7'
GROUP BY pad_oblxest.RFC
order by pad_oblxest.RFC
----------------------------
-solicitud   marlenita
100651AN030345

solucion checar que la clasificacion coincida con la agrupacion

select * from sirref_co_detalle where numero_control='100651AN030345'
select * from sirref_cat_fundamentos where numero_emision='185' and concepto_ley='140028'

cuando no  pueden generar el formato hfm1
checar tambien aqui  pues debe haber unos I1 sino no va poder generar el formato hfmp1
select * from sirref_co_detalle 
where numero_control='103162DR000225'
-----------------------------------

instalar el team viewer 6 gratuita
descargar
en http://www.teamviewer.com/es/download/index.aspx
enviar al usuario lo siguiente la descarga del qsoport

 vamos a intentar otra cosa 
 http://www.teamviewer.com/download/TeamViewerQS_es.exe
 haz click y descarga el programa
 al terminar de descargar le das click a ejecutar
 se empieza a instalar, si te pregunta que debes desbloquear unos puertos le das click al boton que dice desbloquear 
 te va a generar un id y un password
 eso los escribes por aqui para que me pueda conectar
--------------------------------------------

sdatos del ex-director de patentes daniel sauri contreras
lic raúl omar gonzalez castilla
LIC. RAÚL OMAR GONZÁLEZ CASTILLA

------------------------------------------------

datos ex-recaudador solidaridad
LIC. ARTURO CASTRO DUARTE 02/04/2008 12:00:00 a.m. 31/12/2011 12:00:00 a.m.

datos ex-recaudadir cozumel
C. JUAN CARLOS ROQUE SANTANA
nuevo

-----------------------------
baja temporal visible N
01_04_05_03
01_04_05_01
01_04_05_07 entrega
'01_04_05_02' lista emisiones

------------------------------

CHECAME EL FOLIO 668 DE LA EMISION 1105 DE INTERMEDIOS DE CANCUN 
SE NOTIFICO EL 28 DE FEBRERO DE 2011 POR JULIO LARRAÑAGA 
28/04/2011  15:58:01  JORGE ALBERTO  LILI: INFORMATICA  PERO NO ME
 NECESITO REGISTRAR UNA ENTREGA DE ESE FOLIO, PERO YA LO INTENTE VARIAS VECES Y ME DICEN QUE NO PUEDEN IMPRIMIR LA MULTA
 NECESITO QUE LE CAMBIES EL ESTATUS A ASIGNADO, PARA QUE PUEDA REGISTRAR LA ENTREGA



----------------------------
'MAMR700220PJ4'
 oki
 folio 99 RFC PANJ540603IH8
 Y FOLIO 100 CON RFC PEAJ940910524
----------------------------------------------------------------------------------------------------------------------------------------------------------
nomina
-reportes\imprime_requerimientos2.php
*templtes\requerimiento_tpl.php
*templates\fundamento_nomina_tpl.php
*templates\constancia_notificacion_tpl.php
*templates\fundamento_hospedaje_tpl.php
*templates\fundamento_credito_nomina_tpl.php
*templates\fundamento_credito_hospedaje_tpl.php
*templates\constancia_notificacion_notifica_credito_tpl.php
*templates\notifica_credito_imprimir_tpl.php
reportes\notifica_credito_imprimir.php
---------------------------------------------------------------

solicitud arturo

SELECT     *, Numero_Emision AS Expr1, Folio_Impresion AS Expr2
FROM         dbo.obl_detalle_documentos
WHERE     (Numero_Emision = '1117') AND (Folio_Impresion = 1428)
----------------------------------------------------------------
deshabilitar un trigger
DISABLE TRIGGER actualiza_pagos
   ON  dbo.obl_detalle_sucursales


------------------------------------------------------
descripcion de un numero de control en sirref

1|tipo documento Requerimiento - orden de verificacion
0
0|circunscripcion regional hacendaria
6
5
8|año moroso 
5|periodicidad morosa
7
0|numero de folio
0
0
0
1
1	ultimo digito verificador puede ser un no. o letra
----------------------------------------------------------
ejecutar proc marcar pagos nomina y hospedaje

USE [ingresos]
GO
DECLARE	@return_value int

EXEC	@return_value = [dbo].[marcar_pagos_espontaneos]
		@rfc = N' ASU020117I89',
		@clave_periodicidad = N'02',
		@mes = N'01',
		@anio_moroso = N'2008',
		@clave_obligacion = N'010103'

SELECT	'Return Value' = @return_value
GO
------------------------------------------------------

ejecuta requerir repecos
USE [ingresos]
GO
DECLARE	@return_value int
EXEC	@return_value = [dbo].[Requerir_Morosos_Repecos]
@Limite ='100', 
@Clave_Obligacion ='010610,010618,010623', 
@Municipio ='02', 
@ClavePeriodicidad ='03', 
@EjercicioFiscal ='2011', 
@Mes ='01', 
@MesFinal = '02', 
@ClaveLocalidad = '0001', 
@ClaveZona = '0', 
@ClaveOficina = '01', 
@Anio ='2011', 
@Numero_Emision = '1004', 
@Separador = N','


 SELECT	'Return Value' = @return_value
GO





-------------------------------------------------------

40040
4545 que tienen pago >2007
----------------------------------------------------------
###querys para traer los requeridos con filtro y sin filtro de sirref con genaro

SELECT count(*)-- datos.*, mun.Nombre as Nombre_Municipio 
FROM sirref_co_datos datos JOIN sirref_co_documentos documento ON datos.RFC = documento.RFC 
AND datos.Numero_Control = documento.Numero_Control AND datos.ALR = documento.ALR 
AND documento.Movimiento = 'R1' AND documento.Status = 'B' JOIN cat_municipios mun 
ON datos.Municipio_Estatal = mun.Clave WHERE datos.Numero_Emision = '152' 
AND datos.Municipio_Estatal = '08' AND datos.RFC 
not in ( select datos.RFC from sirref_co_datos as datos join sirref_co_documentos as documento on datos.RFC = 
documento.RFC AND datos.Numero_Control = documento.Numero_Control AND datos.ALR = documento.ALR 
AND documento.Movimiento = 'R1' AND documento.Status != 'B' 
where municipio_estatal='08' 
and datos.numero_emision 
in (select numero_emision from sirref_co_emisiones 
where year(fecha_carga)=year(getdate()) group by numero_emision))


SELECT  datos.*, mun.Nombre as Nombre_Municipio 
FROM sirref_co_datos datos JOIN sirref_co_documentos documento ON datos.RFC = documento.RFC 
AND datos.Numero_Control = documento.Numero_Control AND datos.ALR = documento.ALR 
AND documento.Movimiento = 'R1' AND documento.Status = 'B' 
JOIN cat_municipios mun 
ON datos.Municipio_Estatal = mun.Clave 
WHERE datos.Numero_Emision = '152' AND datos.Municipio_Estatal = '08' 
------------------------------------------------------------------

traer el total de morosos repecos incluidos los que tienen un pago despues del 2007

-------------------------------------------------------------------
-- cuando el sirref no aparecen las obligaciones impresas checar que la agrupacion sea igual a la clasificacion

	SELECT cat.*, CONVERT(VARCHAR(10),cat.Fecha_Vencimiento_PF,20) as Vencimiento_Documento, det.RFC, det.Numero_Control
		FROM sirref_co_detalle det
		JOIN sirref_cat_fundamentos cat
			ON det.Numero_Emision = cat.Numero_Emision
			AND det.Concepto_Ley = cat.Concepto_Ley
			AND det.Ejercicio_Fiscal = cat.Ejercicio_Fiscal
			AND det.Numero_Pago = cat.Periodo
			AND det.Agrupacion = cat.Clasificacion --checar que la agrupacion sea igual a la clasificacion
		WHERE det.Numero_Control = '100651AR382934'
			AND det.ALR = '73'
			AND det.RFC = 'KUCT621012GD4'
			AND det.Pagado = 'N'
-------------------------------------------------------------------
query que me trae los campos ubicacion de los requeridos en 2011 de repecos
select  a.*, --a.municipio as MUNICIPIO, a.RFC, a.domicilio_fiscal_ubicacion, 
a.domicilio_ubicacion, b.domicilio_ubicacion
 from pad_contribuyentes as a join pad_establecimientos as b on  a.rfc=b.rfc
where a.rfc in (select RFC from obl_detalle_documentos 
where municipio='01' and numero_emision in ('1103','1110','1118'))

-------------------------------------------------------------------

archivos  para actualizar cambios de requerimientos multas y actas de notificacion


reportes/templates/fundamento_intermedios_tpl.php
reportes/templates/fundamento_repecos_tpl.php
reportes/imprime_requerimientos2_federales.php
reportes/templates/requerimiento_constancia_notificacion_federales_tpl.php
reportes/templates/requerimiento_federales_tpl.php
reportes/templates/requerimiento_federales_intermedios_tpl.php

*reportes/notifica_credito_imprimir.php
reportes/templates/fundamento_credito_I1_repecos_tpl.php
reportes/templates/notifica_credito_federal_imprimir_tpl.php
reportes/templates/multa_constancia_notificacion_federales_tpl.php

gasolinas

ejecutables/desglose_por_municipio.php
ejecutables/genera_emision_paquetes.php
reportes/imprime_requerimientos.php
reportes/imprime_requerimientos2_federales.php
reportes/templates/fundamento_ieps_tpl.php
reportes/templates/requerimiento_federales_ieps_tpl.php




istuv

reportes/imprime_requerimientos2_istuv.php
reportes/templates/requerimiento_istuv_tpl.php
reportes/templates/fundamento_istuv_tpl.php
reportes/templates/constancia_notificacion_istuv_tpl.php




*reportes/templates/fundamento_credito_I1_intermedios_tpl.php
reportes/notifica_credito_imprimir.php
reportes/templates/notifica_credito_federal_imprimir_tpl.php
reportes/templates/notifica_credito_intermedios_imprimir_tpl.php

*reportes/imposicion_multa_federal_imprimir.php
reportes/templates/imposicion_multas_federales_tpl.php
reportes/templates/fundamento_credito_repecos_tpl.php


reportes/templates/imposicion_multas_intermedios_tpl.php
reportes/templates/fundamento_credito_intermedios_tpl.php
reportes/templates/multa_constancia_notificacion_intermedios_tpl.php
reportes/templates/imposicion_multas_federales_tpl.php


sirref multa por extem
*reportes/templates/imprime_requerimientos_tpl.php
*reportes/templates/imposicion_multa_federal_tpl.php
r*eportes/templates/fundamento_creito_sirref_tpl.php
*reportes/imposicion_multa_federal_imprimir.php
*ejecutables/imposicion_multa.php
*ejecutables/genera_hoja_hfmp.php

sirref multa por incumplimiento
*ejecutables/notifica_credito.php
*reportes/templates/notifica_credito_federal_imprimir_tpl.php
*reportes/notifica_credito_imprimir.php
*reportes/templates/fundamento_credito_I1_sirref_tpl.php


modificacion gasolinas
---------------------------------------------

genera_emision_paquetes.php
claves_obligacion.php
funciones.php
desglose_por_municipio.php
imprime_requerimientos.php
imprime_requerimientos2_federales.php
fundamento_ieps_tpl.php
requerimiento_federales_ieps_tpl.php
requerimiento_federales_intermedios_tpl.php

imposicion_multa_federales.php
imposicion_multa.php
imposicion_multa_federal_imprimir.php
imposicion_multas_ieps_tpl.php
fundamento_credito_ieps_tpl.php

notifica_credito_imprimir.php
fundamento_credito_I1_ieps_tpl.php
notifica_credito_ieps_imprimir_tpl.php
imposicion_multas_ieps_tpl.php
multa_constancia_notificacion_ieps_tpl.php


*ejecutables/genera_emision_paquetes.php
*ejecutables/desglose_por_municipio.php

*includes/claves_obligacion.php
*funciones/funciones.php

*reportes/imprime_requerimientos.php
*reportes/imprime_requerimientos2_federales.php
reportes/templates/fundamento_ieps_tpl.php
reportes/templates/requerimiento_federales_ieps_tpl.php

*ejecutables/imposicion_multa_federales.php
*reportes/imposicion_multa_federal_imprimir.php
reportes/templates/imposicion_multas_ieps_tpl.php
reportes/templates/fundamento_credito_ieps_tpl.php

*reportes/notifica_credito_imprimir.php
*reportes/templates/fundamento_credito_I1_ieps_tpl.php
reportes/templates/notifica_credito_ieps_imprimir_tpl.php
reportes/templates/imposicion_multas_ieps_tpl.php
reportes/templates/multa_constancia_notificacion_ieps_tpl.php



ordenados para copiar mas rapido

+*includes/claves_obligacion.php
+*funciones/funciones.php


+*ejecutables/genera_emision_paquetes.php
+*ejecutables/desglose_por_municipio.php
+*ejecutables/imposicion_multa_federales.php


+*reportes/imprime_requerimientos.php
+*reportes/imprime_requerimientos2_federales.php
+*reportes/imposicion_multa_federal_imprimir.php
+*reportes/notifica_credito_imprimir.php

+reportes/templates/fundamento_ieps_tpl.php
+reportes/templates/requerimiento_federales_ieps_tpl.php
+reportes/templates/imposicion_multas_ieps_tpl.php
+reportes/templates/fundamento_credito_ieps_tpl.php
+reportes/templates/fundamento_credito_I1_ieps_tpl.php
+reportes/templates/notifica_credito_ieps_imprimir_tpl.php
+reportes/templates/imposicion_multas_ieps_tpl.php
+reportes/templates/multa_constancia_notificacion_ieps_tpl.php






#actualizar

fundamento_credito_I1_sirref_tpl.php
fundamento_credito_sirref_tpl.php
imposicion_multa_federal_tpl.php
notifica_credito_federal_imprimir_tpl.php

-------------------------------------------------------------------
##actualiza los domicilio extras
select a.rfc, a.DomicilioOpcional, b.DomicilioOpcional from obl_datos_federales as a join pad_contribuyentes as b on a.rfc=b.rfc
update obl_datos_federales
set DomicilioOpcional=b.DomicilioOpcional
from obl_datos_federales as a join pad_contribuyentes as b on a.rfc=b.rfc




----------------------------------------------------
orden de un numero de control en sirref arturo

1|Requerimiento
0|
0|circunscripcion regional hacendaria
6|
5|
8|año
5|   |peridodicidad morosa
7|   |
0|digito verificador que puede ser un numero o una letra
0|
0|
0|
1|
1|
-----------------------------------------------------
querys sirref multas
select * from sirref_co_documentos as a
join sirref_co_datos as b on a.rfc=b.rfc and a.numero_control=b.numero_control 
where a.movimiento='ME' and a.numero_emision like '53%' and b.municipio_estatal='01'

select * from sirref_co_documentos where numero_control='1004287S000990' --and movimiento='ME'
select * from sirref_co_datos where numero_control='103169JD012775' --and movimiento='ME'


delete from sirref_co_documentos where numero_control='1004287S000990' and movimiento='ME'
delete from sirref_co_detalle where numero_control='1004287S000990' and movimiento='ME'

---------------------------------------------------
detectar los documentos del sirref
SELECT *, mun.Nombre as Nombre_Municipio, 
documentos.fecha_entrega as Fecha_Entrega
FROM sirref_co_datos dat JOIN sirref_co_emisiones emi 
ON dat.ALR = emi.ALR AND dat.Municipio_Estatal = emi.Municipio_Estatal 
AND dat.Numero_Emision = emi.Numero_Emision JOIN cat_municipios mun ON emi.Municipio_Estatal = mun.Clave 
JOIN sirref_co_documentos documentos on dat.rfc=documentos.rfc 
AND dat.numero_control=documentos.numero_control
AND dat.numero_emision=documentos.numero_emision
WHERE --dat.Numero_Control = '1004287S000990' AND 
dat.Municipio_Estatal = '01' AND dat.ALR = '77' 
--AND dat.RFC = 'AUDW750918DC0'  
AND documentos.status='E' 
and documentos.movimiento='ME'
-------------------------------------------
requerir ieps

SELECT DISTINCT(s.RFC)  
FROM ( 
SELECT pad_oblxest.RFC, min(pad_oblxest.clave) as clave_obligacion, min(cont.localidad ) as localidad
FROM pad_obligacionesporestablecimiento pad_oblxest 
JOIN pad_contribuyentes cont 
ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '02' 
AND obl_oblvigpre.Anio_Inicial = '2011' 
AND obl_oblvigpre.Mes_Inicial = '01' 
AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave = fed.Clave_Obligacion 
AND fed.Anio_Moroso = '2011' 
AND fed.Mes_Inicial = '01' 
AND fed.Clave_Periodicidad = '02' 
WHERE pad_oblxest.Clave = '010622' 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2011-01-01',20) 
OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) 
AND cont.Municipio = '01' 
AND pad_oblxest.Situacion = 'Activo' 
AND cont.Situacion = 'Activo' 
AND fed.RFC IS NULL 
--AND cont.Localidad = '0001' --esta localidad debe ser variable
AND obl_oblvigpre.RFC IS NULL 
GROUP BY (pad_oblxest.RFC) 
) AS s 

-------------------------------------------------
###query para checar los pagados de istuv

select  a.*, b.*, c.status  from tenencias.dbo.repuve_cvdb06  as a
inner join ingresos.dbo.obl_detalle_vehiculo as b 
on a.NSE_CVDB06 COLLATE Modern_Spanish_CI_AS  =b.numero_serie COLLATE  Modern_Spanish_CI_AS
and a.ACO_CVDB06 = b.Anio_Moroso  
and TRA_CVDB06='TEN'
join obl_detalle_documentos as c 
on b.numero_emision=c.numero_emision
and  b.folio_impresion=c.folio_impresion 
and b.numero_serie=b.numero_serie
and c.movimiento='R1' 
and b.municipio=c.municipio
and b.oficina=c.oficina
where 
--='1A4GJ45R46B647812' 
--b.numero_emision like '1101' and
 b.municipio='01' 
and b.oficina='02'
and b.pagado='N'
and b.numero_emision like ('11%')

----------------------------------
estadistica y emisiones de un año por municipio


select b.nombre as Municipio, c.nombre as Oficina,  d.descripcion as Clave_Obligacion, a.Clave_Obligacion, Numero_Emision, 
numero_control_final as Total_Requeridos, 
case Clave_Periodicidad 
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
end as Tipo_Periodo,
case Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
case Periodo_Final 
when NULL then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Final,
anio_moroso as Año_Moroso,
Fecha_Emision
from obl_control_emisiones as a
join cat_municipios as b on a.municipio=b.clave
join cat_oficinas as c on a.municipio=c.clave_municipio and a.oficina=c.clave
join cat_obligaciones as d on a.clave_obligacion=d.clave
where ejercicio_fiscal='2011' 
and municipio='01' 
and oficina='02'
and a.clave_obligacion not in ('010611')
order by tipo_periodo desc , a.clave_obligacion, a.numero_emision


-------------------------------------

imprime 
select * from openquery( ADS_ING, 'SELECT * FROM CVDB75 WHERE ANM_CVDB75 = 2011 AND MPO_CVDB75 = 03 AND LOC_CVDB75 = 0001 ') 
as a inner join tenencias.dbo.repuve_cvdb06 as b on a.NSE_CVDB75=b.NSE_CVDB06 and a.ANC_CVDB75=b.ACO_CVDB06 and b.TRA_CVDB06 ='TEN'
SET @updquery = 'SELECT * FROM OPENQUERY(ADS_ING, ''SELECT * FROM CVDB75 WHERE  ANM_CVDB75=' + @Anio +'AND  MPO_CVDB75 = ' + @Municipio +'	and NSE_CVDB75 in (select serie from @SERIES)'')';
@updquery=lenght(@updquery)  a;
-----------------------------------------
##ejecutar un openquery con el envio parametros en un procedimiento almacenado
SET @sqlquery = 'SELECT NSE_CVDB75 FROM OPENQUERY(ADS_ING, ''SELECT * FROM CVDB75 WHERE ANM_CVDB75=' + @Anio + ' 
					AND  MPO_CVDB75 = ' + @Municipio + ' 
				  AND LOC_CVDB75 =' + @Localidad +  ''')';
select @sqlquery;
EXEC(@sqlquery)
---------------------
DELETE OPEN QUERY
1.DELETE FROM OPENQUERY(MYSQLservervincu,'select * FROM web_p123  2.where exists(select 1 from web_p_temp where web_p_temp.c=web_p123.c)')
---------------------------
coral
 f.4830 emision 1004
f.5482 emision 1004*
f.6688 emision 1005
--------------------------------
//CUANDO ME APARECE EL SIGUIENTE ERROR DE ANSI_WARNINGS Y ANSI_NULLS  CUANDO DESEO EJECUTAR UN OPENQUERY PONER ESTE CODIGO EN PHP ANTES DE CORRER EL PROCEDIMIENTO ALMACENADO

 	       $conexionBD->Seleccion("SET ANSI_WARNINGS ON");
               $conexionBD->Seleccion("SET ANSI_NULLS ON");
               $conexionBD->Seleccion($sql_pa_eliminar_falsos_morosos);



----------------------------------------
//MODIFICAR EL ARCHIVO ACCESOBD_CLASS.PHP EN INCLUDES LA FUNCION SELECCION

//$this -> Resultado = mssql_query($Consulta, $this->Enlace) or die("Error: $Consulta ". mssql_get_last_message(). "Servidor:{$this->Servidor} Usuario:{$this->Usuario}");
-----------------------------------------
modificar para incluir el nuevo formato de requerimiento de sirref

requerimiento_federales_tpl.php
fundamento_sirref_tpl.php sin repecos
fundamento_sirref_repecos_intermedios_tpl.php con repecos
imprime_requerimientos_2_federales.php

100659JD023619 otrs
'1006513S000653' no repecos ni intermedios

-------------------------------------------
###query para saber cuantos veces se han requerido los rfcs de un municipio de una emision

select rfc, count(rfc)-1 as cuantos from obl_detalle_documentos  as s
join obl_control_emisiones as g on
s.municipio=g.municipio 
and   s.oficina=g.oficina 
and   s.numero_emision=g.numero_emision 
where s.rfc in(
select rfc from obl_control_emisiones as a
join obl_detalle_documentos  as b on 
      a.municipio=b.municipio 
and   a.oficina=b.oficina 
and   a.numero_emision=b.numero_emision 
where a.periodo_inicial='06' 
and   a.ejercicio_fiscal='2011' 
and   a.clave_obligacion in ('010611') 
and   b.movimiento='R1' 
and   a.municipio='02' 
and   a.oficina='01') 
and s.movimiento='R1' 
and g.clave_obligacion='010611' 
and s.numero_emision>'0900'
group by rfc

------------------------------------------
## querys para checar que se carguen bien las emisiones federales

select * from obl_control_emisiones where ejercicio_fiscal='2011' and clave_obligacion='010611' and periodo_inicial='08'
select * from obl_detalle_documentos where numero_emision='1121' and municipio='08'
select * from obl_datos_federales where numero_emision='1121' and municipio='08'

mod 6290
-----------------------------------------

enlace ingresos

    $usuariomssql = "cobligaciones"; 
    $clave = "T¿¿9Nfh!YM";

    $usuariomssql = "padron";
    $clave = "z¡dp4DXBA3"

---------------------------------------
###querys para verificar la carga las emisiones de sirref
select * from sirref_co_documentos where numero_emision='1107'
select * from sirref_co_detalle where numero_emision='1107'
select * from sirref_co_datos where numero_emision='1107'
select * from sirref_co_emisiones where numero_emision='1107'
----------------------------------------------
maso funciona para reemplazar hasta aqui funciona solo con una linea
 
UPDATE  dbo.sirref_cat_fundamentos 

SET Descripcion_Fundamento = 
(SELECT REPLACE( SUBSTRING(Descripcion_Fundamento, 1, DATALENGTH(Descripcion_Fundamento)),  'Á', 'A') 
FROM dbo.sirref_cat_fundamentos 
WHERE     (Descripcion_Fundamento LIKE '%Á%')) 
WHERE     (Descripcion_Fundamento LIKE '%Á%')
                                                 
----------------------------------------------------------
usar varios rfcs en un query
// AHORA SACAMOS LOS DATOS DE CADA SUCURSAL MOROSA
 $sql = "SELECT e.RFC, sucursales.Numero_Establecimiento, 
		e.Municipio, e.Localidad, e.Zona, e.Nombre,
		e.Domicilio_Calle, e.Domicilio_Numero, 
		e.Domicilio_Colonia, e.Domicilio_Ubicacion, 
		e.Domicilio_Codigo_Postal, sucursales.Numero_Control, 
		sucursales.Clave_Obligacion
	FROM obl_datos_generales datos
	JOIN obl_detalle_sucursales sucursales
		ON datos.Municipio = sucursales.Municipio
		AND datos.Oficina = sucursales.Oficina
		AND datos.Numero_Emision = sucursales.Numero_Emision
		AND datos.RFC = sucursales.RFC
	JOIN pad_establecimientos e
		ON sucursales.RFC = e.RFC
		AND sucursales.Numero_Establecimiento = e.Numero
		AND sucursales.Pagado = 'N'
	WHERE datos.Municipio = '{$_REQUEST['municipio']}'
		AND datos.Oficina = '{$_SESSION['usuario_oficina']}'
		AND datos.Numero_emision = '{$_REQUEST['numero_emision']}'
		AND datos.RFC in ('" . implode( "', '", $array_rfcs ) . "') 

-------------------------------------------

9831266791 alex 
----------------------
compañerita, buien dia
 lo deja asignar
 y ya esta pagado
 y este
 de la emision 1125 folio 9807, se imprimio el dia 28 de julio,
 y estaba pagado desde el dia 5 de julio
 folio de pago 833854
 pago aqui en la recaudadora
 otr cso igual que el de ayer reporta cancun

---------------------------
trae los que no han sido marcados como pagados
SELECT     docu.Municipio, docu.Oficina, docu.Numero_Emision, docu.RFC, docu.Numero_Serie, docu.Movimiento, docu.Folio_Impresion, docu.Status, 
                      docu.SubStatus, docu.Fecha_Impresion, docu.Fecha_Asignacion, docu.Fecha_Citatorio, docu.Fecha_No_Localizado, docu.Fecha_Entrega, 
                      docu.Fecha_Vencimiento, docu.Fecha_Ultimo_Movimiento, docu.Clave_Notificador, docu.Gastos_Ejecucion, docu.Multa_Efectiva, 
                      docu.Multa_Programada, docu.Actualizacion, docu.Recargos, docu.Honorarios_Notificacion, docu.usuario_cancelacion, docu.Categoria_No_Loc, 
                      docu.Numero_No_Loc, docu.Num_Salarios_Gastos_Ejecucion, sucu.Municipio AS Expr1, sucu.Oficina AS Expr2, sucu.Numero_Emision AS Expr3, 
                      sucu.RFC AS Expr4, sucu.Numero_Establecimiento, sucu.Folio_Impresion AS Expr5, sucu.Ejercicio_Fiscal, sucu.Mes, sucu.Anio_Moroso, 
                      sucu.Numero_Operacion, sucu.Pagado, sucu.Clave_Obligacion, sucu.Clave_Periodicidad, sucu.Numero_Control, sucu.Tipo_Moroso, vig.RFC AS Expr6, 
                      vig.Numero_Serie AS Expr7, vig.REC, vig.Numero_Establecimiento AS Expr8, vig.Clave_Obligacion AS Expr9, vig.Anio_Inicial, vig.Mes_Inicial, 
                      vig.Fecha_Inicial, vig.Anio_Final, vig.Mes_Final, vig.Fecha_Final, vig.Fecha_Declarado, vig.No_Operacion, vig.Tipo_Periodo, vig.Estado, 
                      vig.Tipo_Presentacion, vig.Ejercicio_Fiscal AS Expr10, vig.Fuente_Informacion, vig.Municipio AS Expr11, vig.Oficina AS Expr12
FROM         dbo.obl_detalle_documentos AS docu INNER JOIN
                      dbo.obl_detalle_sucursales AS sucu ON docu.Municipio = sucu.Municipio AND docu.Oficina = sucu.Oficina AND 
                      docu.Numero_Emision = sucu.Numero_Emision AND docu.Folio_Impresion = sucu.Folio_Impresion AND docu.RFC = sucu.RFC INNER JOIN
                      dbo.obl_obligacion_vigilable_presentada AS vig ON docu.RFC = vig.RFC AND sucu.RFC = vig.RFC AND 
                      sucu.Numero_Establecimiento = vig.Numero_Establecimiento AND sucu.Mes = vig.Mes_Inicial AND sucu.Anio_Moroso = vig.Anio_Inicial AND 
                      sucu.Clave_Obligacion = vig.Clave_Obligacion AND sucu.Clave_Periodicidad = vig.Tipo_Periodo
WHERE     (docu.Status NOT IN ('T', 'P')) AND (docu.Municipio = '01') AND (docu.Oficina = '01') AND (docu.Numero_Emision LIKE '111%') AND 
                      (docu.Movimiento = 'R1') AND (vig.Estado IN ('T')) AND (sucu.Pagado = 'N')

-----------------------------------------------------
cambios nomina hosp anual y estatal

*imprime_requerimientos2.php
*notifica_credito_imprimir.php

fundamento_nomina_anual_tpl.php                                                                            0
fundamento_hospedaje_anual_tpl.php
requerimiento_tpl.php
notifica_credito_imprimir_tpl.php
constancia_notificacion_tpl.php
constancia_notificacion_notifica_credito_tpl.php
fundamento_credito_nomina_tpl.php
fundamento_credito_hospedaje_tpl.php
fundamento_nomina_tpl.php
fundamento_hospedaje_tpl.php



-------------------------------------------------------
###reporte que genera un total de documentos que aun se pueden cobrar de istuv municipio, oficina, ejercicio fiscal y total de documentos


select municipio,oficina, ejercicio_fiscal, count(*) as total from  (SELECT     emi.Municipio , emi.Oficina , emi.Numero_Emision , 
emi.Ejercicio_Fiscal , docu.Folio_Impresion , 
                      docu.Status , docu.SubStatus , docu.Fecha_Impresion , 
docu.Fecha_Asignacion , docu.Fecha_Citatorio , 
                      docu.Movimiento , 
docu.Numero_Serie , emi.Clave_Obligacion 
FROM         dbo.obl_control_emisiones AS emi 
INNER JOIN   dbo.obl_detalle_documentos AS docu ON emi.Municipio = docu.Municipio AND emi.Oficina = docu.Oficina AND 
                      emi.Numero_Emision = docu.Numero_Emision
WHERE     (emi.Municipio in ( '01','02','03','04','05','06','07','08')) AND (emi.Oficina in ( '01','02')) --and emi.ejercicio_fiscal='2011'  
AND (docu.Movimiento = 'R1') AND (emi.Clave_Obligacion = '010603')
                       AND (docu.Status IN ('I', 'A', 'D', 'E', 'V', 'C', 'N', 'X')) 
--order by emi.ejercicio_fiscal,emi.municipio, emi.oficina, emi.numero_emision, docu.folio_impresion 
)  as t
group by municipio,oficina,ejercicio_fiscal
order by municipio,ejercicio_fiscal
---------------------
paypal

Liza04081983
------------------------
##requerir morosos profesiones
SELECT pad_oblxest.RFC 
FROM pad_obligacionesporestablecimiento pad_oblxest 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC AND pad_oblxest.Numero_Establecimiento = obl_oblvigpre.Numero_Establecimiento 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion AND obl_oblvigpre.Tipo_Periodo = '07' 
AND obl_oblvigpre.Anio_Inicial = '2011' AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN pad_establecimientos pad_est ON pad_oblxest.RFC = pad_est.RFC 
AND pad_oblxest.Numero_Establecimiento = pad_est.Numero 
LEFT JOIN obl_detalle_sucursales obldetsuc ON pad_oblxest.RFC = obldetsuc.RFC 
AND pad_oblxest.Numero_Establecimiento = obldetsuc.Numero_Establecimiento 
AND obldetsuc.Clave_Obligacion = '010102' AND obldetsuc.Anio_Moroso = '2011' 
AND obldetsuc.Clave_Periodicidad = '07' 
LEFT JOIN obl_contribuyentes_omitidos oco 
ON pad_oblxest.RFC = oco.RFC AND pad_oblxest.Clave = oco.Clave_Obligacion 
AND oco.Activado = 'S' 
WHERE pad_oblxest.Situacion = 'Activo' 
AND pad_est.Situacion = 'Activo' 
AND pad_oblxest.Clave = '010102' 
AND pad_oblxest.RFC in ( SELECT RFC FROM pad_establecimientos pad_est 
WHERE pad_est.Municipio = '01' AND pad_est.Situacion='Activo' 
AND pad_est.Tipo_Establecimiento = 'Matriz' ) 
AND (pad_oblxest.Fecha_Inicio < CONVERT(datetime,'2012-01-01',20) 
OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) 
AND obl_oblvigpre.RFC IS NULL AND obldetsuc.RFC IS NULL 
AND oco.RFC IS NULL GROUP BY pad_oblxest.RFC 
-----------------------------------------

TRAER UNA PARTE DE TEXTO, ACTUALIZAR POR OTRA PARTE DE TEXTO
traer los contribuyentes q no tienen actualizado el pago con el numero de establecimiento de 08 de obligacion_vigilable_presentada

begin transaction 

select * from OBL_OBLIGACION_VIGILABLE_PRESENTADA as a
left join pad_establecimientos as b on 
a.rfc=b.rfc and a.numero_establecimiento=b.numero
left join pad_contribuyentes as e on 
a.rfc=e.rfc 
where b.rfc is null and 
e.rfc is not null and 
SUBSTRING (a.NUMERO_ESTABLECIMIENTO,1,2)='08'  and 
e.municipio='09' and e.localidad in( '0021',
       '0001',
		'0002',
		'0022',
		'0003',
		'0004',
		'0023',
		'0020',
		'0005',
		'0006',
		'0007',
		'0008',
		'0009',
		'0010',
		'0016')

update OBL_OBLIGACION_VIGILABLE_PRESENTADA
set numero_establecimiento='09'+substring(a.numero_establecimiento,3,3)
from OBL_OBLIGACION_VIGILABLE_PRESENTADA as a
left join pad_establecimientos as b on 
a.rfc=b.rfc and a.numero_establecimiento=b.numero
left join pad_contribuyentes as e on 
a.rfc=e.rfc 
where b.rfc is null and 
e.rfc is not null and 
SUBSTRING (a.NUMERO_ESTABLECIMIENTO,1,2)='08'  and 
e.municipio='09' and e.localidad in( '0021',
       '0001',
		'0002',
		'0022',
		'0003',
		'0004',
		'0023',
		'0020',
		'0005',
		'0006',
		'0007',
		'0008',
		'0009',
		'0010',
		'0016')


commit transaction 
-----------------------------------------------------------
### para saber fecha de carga en pagos bancos
 select * from cob_pagos_bancos where referencia like '%110716212658432%'
oficio bruno

select * from obl_detalle_documentos where folio_impresion='9807' and municipio='02' and numero_emision like '11%' and movimiento='R1' and substatus='A'
select * from obl_detalle_documentos where folio_impresion='9309' and municipio='02' and numero_emision like '11%' and movimiento='R1' and substatus='A'
select * from obl_detalle_documentos where folio_impresion='9761' and municipio='02' and numero_emision like '11%' and movimiento='R1' and substatus='A'

select * from obl_detalle_sucursales where folio_impresion in ('9761','9309','9807') and municipio='02' and numero_emision like '11%' 

select * from obl_obligacion_vigilable_presentada where no_operacion in ('02020183321772','02020183385417')

select * from obl_obligacion_vigilable_presentada where no_operacion like ('%10716212658432')
select * from obl_control_emisiones where numero_emision='1125' and municipio='02'


------------------------------------------------------------

estadistica de nomina y hospedaje total generados y entregados

select
Clave_Municipio,
Clave_Oficina, 
Municipio,
Oficina,
Clave_Obligacion ,
Obligacion,
Numero_Emision,
Fecha_Emision,
Dirigida,
Periodo_Inicial  as Mes_Inicial,
Periodo_Final as Mes_Final,
anio_moroso as Año_Moroso ,
Total,
t.Impresos,
t.Entregado 
--,t.clave_periodicidad
 from (SELECT min(d.Clave) as Clave_Municipio,
				min(e.Clave) as Clave_Oficina,
				min(d.Nombre) as Municipio,
				min(e.Nombre) as Oficina,
               b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               b.Numero_Emision,
		b.Clave_Periodicidad,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
					SUM(CASE WHEN Status is not null THEN 1 ELSE 0 END) AS Total, 
					SUM(CASE WHEN ((Fecha_Impresion is not null)) THEN 1 ELSE 0 END) AS Impresos,
					SUM(CASE WHEN ((Fecha_Entrega is not null)) THEN 1 ELSE 0 END) AS Entregado
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b 
				on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               inner join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
			   inner join cat_municipios as d on b.municipio=d.Clave
			   inner join cat_oficinas as e on b.oficina=e.Clave 
			   and b.municipio=e.Clave_Municipio 
               where --b.Municipio='06' and b.Oficina='01' and  
               b.Ejercicio_Fiscal='2011' and a.Movimiento='R1'
               and MONTH(b.Fecha_Emision) BETWEEN '01' and '12' and b.clave_obligacion in ('010103','010104')
               group by b.Municipio, b.Oficina, b.Numero_Emision,  b.Clave_Obligacion,c.Descripcion ) as t  
			   order by clave_obligacion,clave_municipio, clave_oficina,numero_emision

##es igual que el anterior solo de un mes en este caso agosto

select
Clave_Municipio,
Clave_Oficina, 
Municipio,
Oficina,
Clave_Obligacion ,
Obligacion,
Numero_Emision,
Fecha_Emision,
Dirigida,
Periodo_Inicial  as Mes_Inicial,
Periodo_Final as Mes_Final,
anio_moroso as Año_Moroso ,
Total,
t.Impresos,
t.Entregado 
 from (SELECT min(d.Clave) as Clave_Municipio,
				min(e.Clave) as Clave_Oficina,
				min(d.Nombre) as Municipio,
				min(e.Nombre) as Oficina,
               b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               b.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
					SUM(CASE WHEN Status is not null THEN 1 ELSE 0 END) AS Total, 
					SUM(CASE WHEN ((Fecha_Impresion is not null)) THEN 1 ELSE 0 END) AS Impresos,
					SUM(CASE WHEN ((Fecha_Entrega is not null)) THEN 1 ELSE 0 END) AS Entregado
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b 
				on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               inner join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
			   inner join cat_municipios as d on b.municipio=d.Clave
			   inner join cat_oficinas as e on b.oficina=e.Clave 
			   and b.municipio=e.Clave_Municipio 
               where --b.Municipio='06' and b.Oficina='01' and  
               b.periodo_inicial='08' and b.Ejercicio_Fiscal='2011' and a.Movimiento='R1'
               and MONTH(b.Fecha_Emision) BETWEEN '01' and '12' and b.clave_obligacion in ('010103','010104')
               group by b.Municipio, b.Oficina, b.Numero_Emision,  b.Clave_Obligacion,c.Descripcion ) as t  
			   order by clave_obligacion,clave_municipio, clave_oficina,numero_emision
------------------------------------------------------------
aplicar el convert de fecha a texto (datetime)
SELECT datos.numero_control+'|'+convert(char(10), documento.fecha_entrega, 111) as numero_control

FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
AND documento.Status != 'B'
WHERE datos.Numero_Emision = '11115'
AND datos.Municipio_Estatal = '02'
--GROUP BY documento.Numero_Control
------------------------------------------------------------
emisiones sirref que no son repecos ni intermedios

08	11115	6*
02	11115	8*
02	11103	54*
08	11103	16*
08	11067	3*
02	11067	5*
02	11043	19*
08	11043	4*
02	11031	9*
08	11031	2*
08	11019	1*
02	11007	143*
08	11007	25

 7, 19, 31, 43, 67, 79, 103, 115
--------------------------------------------------------------

## querys para checar los pagod de requeridos de nomina y hospedaje 

select * from cob_pagos_bancos where referencia like ('%41110212202740661%')
select * from dec_nominas where referencia in
(
--'41110617210819705'
--'41110803213554776'
--'41110212202740661'
--,'41101218222540401'
--,'41101021219092809'
--,'41100920217062203'
--,'41100720213344901'
--,'41100621211437205'
--,'41100524209642905'
--,'41100420207277704'
)

select * from obl_detalle_sucursales where rfc=' ROGM640526T92' and mes='01'
select * from obl_control_emisiones where numero_emision='1125' and municipio='02'

-----------------------------------------------------------------

generar el reporte de emisiones que no son repecos ni intermedios sirref
--aqui tengo los entregados
SELECT datos.municipio_estatal,datos.numero_control+'|'+ convert(char(10), documento.fecha_entrega, 111)+'||'  as numero_control 
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
AND documento.Status != 'B'
AND documento.fecha_entrega is not null
AND datos.numero_emision=documento.numero_emision
WHERE datos.numero_emision='11103'
--AND datos.Municipio_Estatal = '08'
--GROUP BY documento.Numero_Control

--los no localizados
SELECT datos.municipio_estatal,datos.numero_control+'|'+ convert(char(10), documento.fecha_no_localizado, 111)+'|16|'  as numero_control 
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
AND documento.Status != 'B'
AND documento.fecha_no_localizado is not null
AND datos.numero_emision=documento.numero_emision
WHERE datos.numero_emision='11103'
--AND datos.Municipio_Estatal = '08'
--GROUP BY documento.Numero_Control


--los pendientes
SELECT datos.municipio_estatal,datos.numero_control  as numero_control, datos.numero_emision, nombres.Nombre
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
--AND documento.Status in ( 'A','D','C')
AND ((documento.fecha_no_localizado is null) and documento.fecha_entrega is null)
AND datos.numero_emision=documento.numero_emision
join obl_nombres_estatus   as nombres on documento.Status=nombres.Clave 
--WHERE datos.numero_emision='11103'
WHERE datos.numero_emision IN (select DISTINCT(numero_emision) from sirref_co_emisiones 
where mes_moroso='07' and anio_moroso='2012')
order by  municipio_estatal, numero_emision

--el resto
SELECT datos.municipio_estatal,datos.numero_control  as numero_control, datos.numero_emision, documento.status
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
--AND documento.Status in ( 'A','D','C')
AND ((documento.fecha_no_localizado is null) and documento.fecha_entrega is null)
AND datos.numero_emision=documento.numero_emision
--WHERE datos.numero_emision='11103'
WHERE datos.numero_emision='11117'
AND datos.Municipio_Estatal = '02'
--GROUP BY documento.Numero_Control

####los que estan no se han entregado de la emision
SELECT datos.municipio_estatal,datos.numero_control  as numero_control, datos.numero_emision, documento.status
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
--AND documento.Status in ( 'A','D','C')
AND ((documento.fecha_no_localizado is null) and documento.fecha_entrega is null)
AND datos.numero_emision=documento.numero_emision
--WHERE datos.numero_emision='11103'
WHERE datos.numero_emision IN (select DISTINCT(numero_emision) from sirref_co_emisiones 
where mes_moroso='05' and anio_moroso='2012')
--AND datos.Municipio_Estatal = '08'
--GROUP BY documento.Numero_Control


--los que tienen menor fecha entrega o no loc a la de impresion
SELECT datos.municipio_estatal,datos.numero_control  as numero_control, datos.numero_emision, documento.status, 
documento.fecha_impresion, documento.fecha_no_localizado, documento.fecha_entrega
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
--AND documento.Status in ( 'A','D','C')
AND ((documento.fecha_no_localizado is not null) or documento.fecha_entrega is  not null)
AND datos.numero_emision=documento.numero_emision
--WHERE datos.numero_emision='11103'
WHERE datos.numero_emision IN (select DISTINCT(numero_emision) from sirref_co_emisiones 
where mes_moroso='05' and anio_moroso='2012')
and ((documento.fecha_no_localizado<documento.fecha_impresion and fecha_no_localizado is not null )or (documento.fecha_entrega+1<documento.fecha_impresion and fecha_entrega is not null))
--AND datos.Municipio_Estatal = '08'
--GROUP BY documento.Numero_Control

###los que tienen mayor fecha de entrega o no loc a la actual
SELECT datos.municipio_estatal,datos.numero_control  as numero_control, datos.numero_emision, documento.status, 
documento.fecha_impresion, documento.fecha_no_localizado, documento.fecha_entrega
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
--AND documento.Status in ( 'A','D','C')
AND ((documento.fecha_no_localizado is not null) or documento.fecha_entrega is  not null)
AND datos.numero_emision=documento.numero_emision
--WHERE datos.numero_emision='11103'
WHERE datos.numero_emision IN (select DISTINCT(numero_emision) from sirref_co_emisiones 
where mes_moroso='05' and anio_moroso='2012')
and ((documento.fecha_no_localizado>getdate() and fecha_no_localizado is not null )or (documento.fecha_entrega>getdate() and fecha_entrega is not null))
--AND datos.Municipio_Estatal = '08'
--GROUP BY documento.Numero_Control
----------------------------------------------
casos especiales estatales nomina
select * from obl_detalle_sucursales where rfc like '%PAG9202262R8%' and folio_impresion='1159' and numero_emision='0805'
select * from obl_detalle_documentos where rfc like '%PAG9202262R8%' and folio_impresion='1159' and numero_emision='0805'
select * from obl_obligacion_vigilable_presentada where rfc like '%PAG9202262R8%' and mes_inicial='09' and anio_inicial='2007'
 
 tengo 3 casos mas: DELGADO ACEVES CARLOS HORACIO, RFC: DEAC541117BZ8 REFERENCIA: 43110316200331079 ES HOSPEDAJE PERIODO FEBRERO 2011
ROBLES GUTIERREZ MARCO ANTONIO, RFC: ROGM640526T92 periodo octubre 2010 nomina num referencia: 41101218222540023 importe 233


-------------------------------------

caso ricardo
 emision 1101 folio 356
 es para que se le elimine la captura de una multa
 es que capturaron primero la multa, y ya no les deja capturar el requerimiento
 FIGG5012224B6
 es de este RFC
 es una multa de incumplimiento

SELECT     Municipio, Oficina, Numero_Emision, RFC, Folio_Impresion, Ejercicio_Fiscal, Anio_Moroso, Mes_Inicial, Mes_Final, Numero_Operacion, Movimiento, 
                      Pagado, Clave_Obligacion, Clave_Periodicidad
FROM         dbo.obl_detalle_federales
WHERE     (Numero_Emision = '1101') AND (Folio_Impresion = 356) AND (RFC = 'FIGG5012224B6')


SELECT     Municipio, Oficina, Numero_Emision, RFC, CURP, Numero_Serie, Folio_Impresion, Nombre_Contribuyente, Apellido_Paterno, Apellido_Materno, 
                      Localidad, Zona, Localidad_Federal, Colonia_Federal, Domicilio_Calle, Domicilio_Numero, Domicilio_Colonia, Domicilio_Ubicacion, 
                      Domicilio_Codigo_Postal, Ejercicio_Fiscal, Anio_Moroso, Mes_Inicial, Mes_Final, Pagado, Clave_Obligacion, Clave_Periodicidad, Numero_Control, 
                      Folio_Facturacion, Numero_Operacion, Nombre_Comercial
FROM         dbo.obl_datos_federales
WHERE     (Numero_Emision = '1101') AND (Folio_Impresion = 356) AND (RFC = 'FIGG5012224B6')


SELECT     *, Numero_Emision AS Expr1, Folio_Impresion AS Expr2, RFC AS Expr3
FROM         dbo.obl_detalle_documentos
WHERE     (Numero_Emision = '1101') AND (Folio_Impresion = 356) AND (RFC = 'FIGG5012224B6')
-------------------------------------------------------------------------------------
ady dice:
 el que cancele por error es el folio 182 y emision 1001 del impuesto sobre nominas
 debe ser documento pagado espontaneamente
SELECT     *, Numero_Emision AS Expr1, Folio_Impresion AS Expr2, Municipio AS Expr3
FROM         dbo.obl_detalle_documentos
WHERE     (Numero_Emision = '1001') AND (Folio_Impresion = 182) AND (Municipio = '03')

-------------------------------------------------------------
REQUERIMIENTOS QUE ADEUDA UN RFC EN PARTICULAR

select a.Municipio,b.Anio_moroso, case b.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Mes_Moroso, 'Nominas' as Obligacion,a.RFC,'Requerimiento' as Movimiento, a.Numero_emision,Folio_Impresion, c.Nombre 
from obl_detalle_documentos as a
join obl_control_emisiones as b on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
join obl_nombres_estatus as c on a.status=c.clave
where rfc in (' SCI981229TF3') and movimiento='R1' 
and b.clave_obligacion='010103' and status not in ('T','P','O')
order by a.numero_emision, a.folio_impresion
-------------------------------------------------------------
emisiones sirref que vienen incompletas de pipes

9 viene mal  * 
33-*
45-*
69-*
105 viene mal*
117-*
-----------------------------------------
######MAYUSCULAS EN HTML
<FONT STYLE="text-transform: uppercase;"><?=$moroso['Fecha_Entrega']?></font>
-------------------------------------
cambios jorge sanchez ninis

select *from sirref_co_documentos where numero_control in ('1031613T000646','1031613T000637','1031613T000486',
'1031618W00003A','1031616U000051')
------------------------------------
REPORTE DE VIGILANCIAS SIRREF AGOSTO 2011
11008--
11032--
11044--
11068--
11104--
11116--

11007--
11103--

checar el resultado de estas emisiones 
crear la entrega para las multas
reporteria multas
quitar señor contribuyente etc
agregar la nueva multa y 
validar cuando se le asigna al notificador en obl_actos_notificador
crear el reporteador de nomina y hosp
crear el reporteador de federales
-----------------------------
tomar en cuenta el cambio de municipio 09 en genera emision paquetes y desglose
---------------------------------------

Gerardo dice:
 un favorsote: sera posible que tu puedas investigar quien hizo estos pagos, es que esta persona desconocida pago en hsbc el impuesto al hospedaje, 
siendo que ese banco ni siquiera recepciona ese tipo de impuestos entonces no se han podido ingresar esos montos porque no se sabe quienes hicieron 
el deposito solamente tengo las referencias (4311072280250711-->$29,854 y 4311072280250711-->$ 75340)
--------------------------------
####QUERY PARA DETERMINAR DE QUE MUNICIPIO ES UN NUMERO DE CONTROL de los ninis o sirref para generar las multas

select a.rfc, a.numero_control, c.nombre
from sirref_co_datos  as a
join sirref_co_detalle as b on a.rfc=b.rfc and a.numero_control=b.numero_control --and a.Numero_Emision=b.Numero_Emision and a.ALR=b.ALR
join cat_municipios as c on a.municipio_estatal=c.clave
--checar si uso rfc o numero de control
where a.numero_control in (
'1006513S002086',
'1006513S002086',
'1006513S002086',
'1006513S002086',
'1006513S002086',
'1031613S000525',

) --and a.municipio_estatal='08' 
and movimiento='R1'
order by a.rfc




##este lo use cuando el archivo que me envian esta mal el rfc y el numero de control solo agregue una hoja extra con la ubicacion de los contribuyentes en el excel
select a.rfc, --a.numero_control, 
c.nombre
from sirref_co_datos  as a
join sirref_co_detalle as b on a.rfc=b.rfc and a.numero_control=b.numero_control --and a.Numero_Emision=b.Numero_Emision and a.ALR=b.ALR
join cat_municipios as c on a.municipio_estatal=c.clave
join sirref_co_emisiones as d on a.numero_emision=d.numero_emision and d.anio_moroso='2011' --and mes_moroso='11'
where  a.rfc in ('ACC0410212H0',
'ACM071108UMA',
'YEX9906188N3'
) --and a.municipio_estatal='08' 
and movimiento='R1'
group by a.rfc, c.nombre
order by a.rfc

##
-----------------------------------------------
##query para saber cuantas multas se han generado de playa del carmen de los sirref ninis

select * 
from sirref_co_documentos as a 
join sirref_co_datos as c on a.numero_emision=c.numero_emision 
and a.numero_control=c.numero_control  and a.rfc=c.rfc 
join obl_nombres_estatus  as b on a.status=b.clave
where a.numero_emision in ('11007',
'11007',
'11008',
'11008',
'11009',
'11009',
'11019',
'11031',
'11031',
'11032',
'11032',
'11033',
'11033',
'11043',
'11043',
'11044',
'11044',
'11045',
'11045',
'11067',
'11067',
'11068',
'11068',
'11069',
'11069',
'11103',
'11103',
'11104',
'11104',
'11105',
'11105',
'11115',
'11115',
'11116',
'11116',
'11117',
'11117') 
and a.movimiento like ('M%')  and c.municipio_estatal='08'
order by fecha_ultimo_movimiento desc

eliminar las multas que se han genrado se sirref ninis
--delete from sirref_co_documentos where numero_control in ('103161DX000257',
'103161DX00014A',
'1031613S000383',
'1031615T000017',
'1031615T000026',
'103161DX000275',
'103161DX000266',
'103161DX000239',
'103161DX000201',
'103161DX000195',
'103161DX000121',
'103161DX000168',
'103161DX000112',
'1031613T000628',
'1031613T00060A',
'1031613T000421',
'1031613T000575',
'1031613T000397',
'1031613T000548',
'1031613T000379',
'1031613T000477',
'1031613T000459',
'103161DY000494',
'103161DY000458',
'103161DY000449',
'1031613S000525',
'1031613S000516',
'1031613S000490',
'1031613S000300',
'1031613S000294',
'1031613S000463',
'1031613S000285',
'1031613S000543',
'1031613S000276',
'1031613S000427',
'1031613S000258',
'1031613S000329',
'103161EC000116',
'103161EC000072',
'103161EC000081',
'103161EB000013',
'103161EB000022',
'1031616U000051',
'1031618W00003A',
'1031615S00004A',
'1031615S000030',
'1031616T000048',
'1031616T000066') and movimiento like 'I%'
-------------------------------------------------

  c@rline    dice:
 si mira, el notificador miguel amalio por error en sistema aplico un req de tenencias como entregado, CUANDO FISICAMENTE LO tengo si entregar
 aplica como no localizado
 quiero pedirte
 si puedes asignarselo nuevamente para ke lo aplique correctamente
 por favor
lizardi_w@hotmail.com dice:
 pasame los datos por fa ahorita estoy checandoun pendiente urgente en cuanto lo tenga te confirmo
  c@rline    dice:
 sale
 folio 758 , emision 1151 istuv
 asignarselo al not miguel alonzo jimenez
-----------------------------------------------
--query para generar el reporte de istuv cuando no salen completos en la pantalla es del archivo detalles_emision2.php en reportes
SELECT datos.RFC, datos.Numero_Serie, datos.Placa,  det.Anio_Moroso , 
'Documento_No_Impreso' as ESTADO_DOCUMENTO, (CONVERT(VARCHAR(100),datos.Modelo) + ' - ' + datos.Marca + ' - ' + datos.Sub_Marca + ' - ' + Numero_Motor) 
AS Datos_Vehiculo, (datos.Nombre_Contribuyente + ' ' + datos.Apellido_Paterno + ' ' + datos.Apellido_Materno) AS Nombre_Contribuyente, 
(datos.Domicilio_Calle + ' ' + datos.Domicilio_Numero + ' ' + datos.Domicilio_Colonia) AS Domicilio, datos.Folio_Anterior, datos.Folio_Impresion, 
CONVERT( VARCHAR(10),documento.Fecha_Impresion,20) as Fecha_Impresion, 
CONVERT( VARCHAR(10),documento.Fecha_No_Localizado,20) as Fecha_No_Localizado, 
CONVERT( VARCHAR(10),documento.Fecha_Entrega,20) as Fecha_Entrega, 
CONVERT( VARCHAR(10),documento.Fecha_Vencimiento,20) as Fecha_Vencimiento
FROM obl_datos_vehiculo datos JOIN obl_detalle_documentos documento ON datos.Municipio = documento.Municipio 
AND datos.Oficina = documento.Oficina AND datos.Numero_Emision = documento.Numero_Emision 
AND datos.Numero_Serie = documento.Numero_Serie JOIN obl_detalle_vehiculo det ON datos.Municipio = det.Municipio 
AND datos.Oficina = det.Oficina AND datos.Numero_Emision = det.Numero_Emision AND datos.Numero_Serie = det.Numero_Serie 
WHERE datos.Numero_Emision = '1109' AND datos.Municipio = '02' AND datos.Oficina = '02' AND documento.Movimiento = 'R1' 
ORDER BY datos.Folio_Impresion ASC 


-----------------------------------------------------

generar emision federal

1.crear el registro de equivalencias verificar en el archivo rcoef77-... algo
en la tabla sirref_cat_equivalencias checar que año fiscal sea el que se esta requiriendo 

num emision					año fiscal    equivalencia
(deberia ser 55 por ekivocasion quedo 955)
955	    					2009		7U 
		   1006518V000029
                   100651DX000447
		   1006506Z000644
		   1004217V000019
		   1006513U001121
		   100651EE00001A
resulta de separar 1006597U000550
		   1006513V00038A

2.genaro carga el archivo txt- el excel Fundamentación Legal-Emisiones EF_ 2010\EMISION049.txt
de la fundamentacion que se carga en sirref_cat_fundamentos
si pasa pero guarda basura en la base de datos usar el txt 


checar que coincida el dato del numero de emision en las tablas de fundamentacion y en equivalencias


(si es nuevo año agregar el año en el combo para seleccionar el periodo)

3.genaro carga el archivo que contiene la emisión. 
Entid_Fed_Enero_010_rcoef77.001 (sur) y rcoef73.001 (norte)

ya pueden imprimir!!!!!!!!!


descripcion de un numero de control en sirref

1|tipo documento Requerimiento - orden de verificacion
0
0|circunscripcion regional hacendaria
6
5
8|año
5|periodicidad morosa
7
0|numero de folio
0
0
0
1
1	ultimo digito verificador puede ser un no. o letra
--------------------------------------------------------------------------------
query de istuv que utiliza un select in respeta los espacios finales del numero de serie es lo mismo

select * 
FROM openquery (ADS_ING,'SELECT  * FROM CVDB75X WHERE NSE_CVDB75 IN (''3SCTDSEA391009478'',
''1B3KC56B49N504848'',
''3HTZZAAR29N090193'',
''MD2DMS8ZX9FD00107'',
''MD2DMS8Z19FD00125'',
''MD2DMS8Z39FD00045'',
''MD2DMS8Z39FD00112   '',
''3SCTCSDA491000888   '',
''3CUT3AMD29X004390   '',
''JE3AU26U39U035243   '',
''3CUT3AMD79X003395   '',
''3SCTCSDA391006620   '',
''1J4FT47B99D110464   '',
''1FTRF14V99KA46896   '') AND (STA_CVDB75 is NULL OR STA_CVDB75='''') ')
---------------------------------------------------------------------------------------
##obligaciones de sirref ninis geenrar reporte para genaro
11009
11033
11045
11069
11105
11117

---------------------------------
###andrea
0118046170
Papacho29
clave secreta
677
1292100 no se ke es
-----------------------------

 voy
 folio 9202 emision 1134 repeco
----------------------------------
menu cartas invitacion

cartasinvitacion_central	01_04_06
cartasinvitacion_central	01_04_06_01
---------------------------------

ahora te digo
 11009
11033
11045
11069
11105
11117

-----------------
10.9.17.123 bruno
10.9.17.138 escaner

---------------------------

checar el unsplitstring hasta en elimina_falsos_morosos_istuv y adaptarlo para poner las tres obligaciones morosas

SET @sqlquery='';
SET @updquery='';
SET @queryback='';


SET @sqlquery = 'SELECT NSE_CVDB75 FROM OPENQUERY(ADS_ING, ''SELECT * FROM CVDB75 
                 WHERE ANM_CVDB75=' + @Anio + ' AND  MPO_CVDB75 = ' + @Municipio +  ''') AS a 
                 INNER JOIN TENENCIAS.DBO.REPUVE_CVDB06 AS b  
                 on a.NSE_CVDB75=b.NSE_CVDB06 and a.ANM_CVDB75=b.ACO_CVDB06 
                 and b.TRA_CVDB06 ='+'''TEN''';

DECLARE @tablaTokens TABLE
(
	serie varchar(50)
)

INSERT INTO @tablaTokens(serie)
EXEC(@sqlquery);


DECLARE @xmlTokens XML
DECLARE @resultado varchar(max)
DECLARE @total int

SET @xmlTokens = (
	select Serie from @tablaTokens
	FOR XML AUTO, Elements, Root('root')
)
	
SET @resultado = [dbo].[UnSplitString](@xmlTokens, ''''',''''')

--cuantos rfcs hay en el resultado
select @total = count(Serie) 
from @tablaTokens

select @resultado = ''''''+@resultado+ ''''''

--if @total > 1
--BEGIN
--	-- quitar la coma al final 
--	--select @resultado = left(@resultado, len(@resultado)-1)
--	print @resultado
--END
--else
--BEGIN -- si solo es un elemento ''9BFUT35F448591339   ''
--	select @resultado = @resultado + ''''''
--end

----creo un respaldo de los rfcs que voy a eliminar en una variable de tabla
SET @queryback = 'SELECT 	MPO_CVDB75, OFN_CVDB75, RFC_CVDB75, NSE_CVDB75, NOM_CVDB75, APE_CVDB75, 
								APM_CVDB75, LOC_CVDB75, DOM_CVDB75, NEX_CVDB75, BAR_CVDB75, CPO_CVDB75, CUR_CVDB75, 
								PLL_CVDB75, ANC_CVDB75, NMO_CVDB75, EJF_CVDB75, ANM_CVDB75, USU_CVDB75, FEG_CVDB75,
								MCA_CVDB75, SMC_CVDB75, IMP_CVDB75, IAC_CVDB75, IRE_CVDB75, FEC_CVDB75, FEV_CVDB75
FROM OPENQUERY(ADS_ING, ''SELECT * FROM CVDB75 WHERE  ANM_CVDB75=' + 
@Anio +' AND  MPO_CVDB75 = ' + @Municipio +'	and NSE_CVDB75 in ('+@resultado+')'')';
-------------------------------------------------------------

cargar el resto de formatos de multas de actas de inspeccion

-----------------------------------------------------------
checar estos estatus
 UN FAVOR PODRAS CAMBIARME EL ESTATUS DE ESTE CONTRIB NO PODEMOS GENERAR MULTA PORQUE EL NOTIFICADOR NO HABIA REGISTRADO LA ENTREGA DEL DOCTO
 ES EMISION 1112 FOLIO 835
 ENTREGADO CON FECHA 6 DE JULIO DEL 2011
 NOTIFICADOS FABIAN QUEVEDO

sip
 folio 7545 emision 1134 del 2011 notificador ramiro kumal  la notificaron el 10 noviembre
 2011

--------------------------------------------------------------
reporte sirref
11118
11070
11046
11034
11010
-----------------------------------------------------------------
## filtros para requerir
 es todo sobre los repecos
 para los intermedios
 los morosos activos de la localidad central en el municipio
 por ejemplo en opb solo los de chetumal
 que sean localizables
 hay un campo en el padron federal
 que indica si un contribuyente es localizable o no
 omite los que ya han sido requeridos y se marcaron como doble no localizado
 que tengan al menos un pago del 2008 en adelante
 al final los ordeno dando prioridad a los que no han sido requeridos en años 
 anteriores y de ahi los ordeno por monto de acuerdo a lo reportado en inscritos de cuota fija


asi quedaron con la ultima modificacion
## filtros para requerir
 es todo sobre los repecos
 para los intermedios
 los morosos activos de la localidad central en el municipio
 por ejemplo en opb solo los de chetumal
-- que sean localizables
-- hay un campo en el padron federal
-- que indica si un contribuyente es localizable o no
 omite los que ya han sido requeridos y se marcaron como doble no localizado
 que tengan al menos un pago del 2008 en adelante
-- al final los ordeno dando prioridad a los que no han sido requeridos en años 
 --anteriores y de ahi 
al final los ordeno por monto de acuerdo a lo reportado en inscritos de cuota fija

---------------------------------

captura declaraciones en ceros
modifica situacion declaraciones 
reporte subsidios


gonz valores
--------------------------------
morosos repecos sin filtros sin localizables, sin pagos año 2008 mayores, son localidad central etc.

select count(distinct(s.RFC) )
from ( SELECT pad_oblxest.RFC, min(pad_oblxest.clave) as clave_obligacion 
FROM pad_obligacionesporestablecimiento pad_oblxest 
JOIN pad_contribuyentes cont ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '03' 
AND obl_oblvigpre.Anio_Inicial = '2011' 
AND obl_oblvigpre.Mes_Inicial = '11' 
AND obl_oblvigpre.Mes_Final = '12' 
AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave in ('010610','010618','010623') 
AND fed.Anio_Moroso = '2011' 
AND fed.Mes_Inicial = '11' 
AND fed.Mes_Final = '12' 
AND fed.Clave_Periodicidad = '03' 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion 
AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave in ('010610','010618','010623') 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2011-12-01',20) 
OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) 
AND cont.Municipio = '09' 
AND pad_oblxest.Situacion = 'Activo' 
AND cont.Situacion = 'Activo' 
AND obl_oblvigpre.RFC IS NULL 
AND oco.RFC IS NULL 
GROUP BY pad_oblxest.RFC ) as s 

-------------------------------------
morosos intermedios  sin filtros sin localizables, sin pagos año 2008 mayores, son localidad central etc.

SELECT count(DISTINCT(s.RFC) )
FROM ( SELECT pad_oblxest.RFC, min(pad_oblxest.clave) as clave_obligacion 
FROM pad_obligacionesporestablecimiento pad_oblxest 
JOIN pad_contribuyentes cont ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON pad_oblxest.RFC = obl_oblvigpre.RFC 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '02' 
AND obl_oblvigpre.Anio_Inicial = '2011' 
AND obl_oblvigpre.Mes_Inicial = '12' 
AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave = fed.Clave_Obligacion 
AND fed.Anio_Moroso = '2011' 
AND fed.Mes_Inicial = '12' 
AND fed.Clave_Periodicidad = '02' 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion 
AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave = '010611' 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2011-12-01',20) OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) 
AND cont.Municipio = '09' 
AND pad_oblxest.Situacion = 'Activo' 
AND cont.Situacion = 'Activo' 
AND fed.RFC IS NULL AND oco.RFC IS NULL 
AND obl_oblvigpre.RFC IS NULL 
GROUP BY (pad_oblxest.RFC) 
) AS s 
-------------------------------------------
para generar un segundo o  tercer requerimiento de repecos e intermedios
select * 
from obl_detalle_documentos 
where folio_impresion='568' 
and numero_emision='0609' 
and municipio='01' and movimiento not in('R1')

select * 
from obl_detalle_federales 
where numero_emision='0609' 
and folio_impresion='568'

select * 
from obl_control_emisiones
where numero_emision='0609' and municipio='01'

--delete
--from obl_detalle_documentos 
--where folio_impresion='568' 
--and numero_emision='0609' 
--and municipio='01' and movimiento not in('R1')

--delete
--from obl_detalle_federales 
--where numero_emision='0609' 
--and folio_impresion='568'

select * 
from obl_datos_federales 
where numero_emision='0609' 
and folio_impresion='568'

update obl_detalle_documentos 
set status='V'
where folio_impresion='568' 
and numero_emision='0609' 
and municipio='01' and movimiento in('R3')
------------------------------------------
actualizar el contenido de las multas de actas de inspeccion
subir el modulo de total de emisiones
crear la captura de las actas de inspeccion
----------------------------------------------------
acceso sql sarh
padron
z¡dp4DXBA3
------------------------------------------------------

--proceso para saber los morosos en base a un listado desde el padron este es cruce con istuv 
--tabla generada desde padron
select top 10 * from temporal_cruce_padron_tenencias2012_rentadoras  where rfc=' ARA900411A96'
order by rfc

--para saber el total de rfcs que deben coincidir con el total del sum en rfcs
select DISTINCT(rfc)
from temporal_cruce_padron_tenencias2012_rentadoras  
where fecha_inicio is not null
order by rfc


--				select * from obl_obligacion_vigilable_presentada where rfc=' ARA900411A96' and clave_obligacion='010103' 
--				select * from pad_obligacionesporestablecimiento where rfc=' OVA9101105F8' and clave_obligacion='010103' 
--
--				select * from cat_periodos_ejercicio

--genero la tabla temporal dbo.temporal_obligaciones_cruce_padron_istuv_nomina_2012 
--con los periodos cumplidos e incumplidos 


--insertar en la tabla temporal todos los periodos
--insert into dbo.temp_nomina_istuv_rentadoras
select a.RFC, a.Numero_Establecimiento,a.Clave,a.Anual,a.Fecha_Inicio,a.Fecha_Baja,
a.Fecha_Suspension,a.Periodicidad,b.Ejercicio,b.Mes_Inicial,b.Mes_Final,--b.Descripcion,
b.Fecha_Declarado
from  dbo.temporal_cruce_padron_tenencias2012_rentadoras as a
cross apply  dbo.ftObligacionesPendientesTodos(a.RFC,a.Numero_Establecimiento,a.Clave,a.Periodicidad, 
YEAR(a.fecha_inicio_modificada),MONTH(a.Fecha_inicio_modificada)) as b
where a.Situacion in ('Activo') 
--and b.Fecha_Declarado is null comentar para saber pagados y no pagados
--and a.rfc=' ARA900411A96' 
and fecha_inicio is not null
order by RFC,Numero_Establecimiento,Clave,Ejercicio,Mes_Inicial

--select distinct(rfc) from temp_nomina_istuv_rentadoras 
--
--select * from temp_nomina_istuv_rentadoras 

--genero el total 
--insert INTO cumplidos_istuv_nomina
select RFC,count(*) as Periodos,
SUM(CASE WHEN Fecha_Declarado IS NOT NULL THEN 1 ELSE 0 END) AS Cumplidos, 
SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END) AS Debe 
from dbo.temp_nomina_istuv_rentadoras
where clave='010103' 
--and rfc='ENEM581225RV6'
group by rfc --having SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END)=0

--select * from cumplidos_istuv_nomina

------------------------------------------------------------------------------------------------------
estos son rfcs que comenzaron a laborar a partir del inicio del siguiente bimestre
RFC	Numero_Establecimiento	Clave	Anual	Fecha_Inicio	Fecha_Baja	Fecha_Suspension	Periodicidad	Ejercicio	Mes_Inicial	Mes_Final	Fecha_Declarado
CICD801030882	00000	010610	2005	2012-01-19 00:00:00.000	NULL	NULL	3	NULL	NULL	NULL	NULL
CICD801030882	00000	010618	2005	2012-01-19 00:00:00.000	NULL	NULL	3	NULL	NULL	NULL	NULL
CICD801030882	00000	010623	2005	2012-01-19 00:00:00.000	NULL	NULL	3	NULL	NULL	NULL	NULL
SOPC730501316	00000	010610	2005	2011-12-01 00:00:00.000	NULL	NULL	3	NULL	NULL	NULL	NULL
SOPC730501316	00000	010618	2005	2011-12-01 00:00:00.000	NULL	NULL	3	NULL	NULL	NULL	NULL
SOPC730501316	00000	010623	2005	2011-12-01 00:00:00.000	NULL	NULL	3	NULL	NULL	NULL	NULL
VAME511008584	00000	010623	2012	2012-01-31 00:00:00.000	NULL	NULL	3	NULL	NULL	NULL	NULL

-----------------------------------------------------------------------------------------------------------------
--querys  rfcs morosos o cumplidos de patentes


--Insert que me trae una tabla como la que me genera norberto para hacer la carga
--INSERT INTO temp_nomina_patentes_actualizacion
select  X.RFC,X.Numero_Establecimiento, X.Clave, X.Anual, X.Fecha_Inicio, X.Fecha_Baja, X.Fecha_Suspension, X.Periodicidad, Y.Ejercicio,
Y.Mes_Inicial, Y.Mes_Final,Y.Fecha_Declarado
from (
select  a.RFC
,a.REC, a.Numero_Establecimiento,a.Clave,a.Anual,
case when a.Fecha_Inicio<'01/01/2007' then '01/01/2007' else a.fecha_inicio end as Fecha_Inicio,
a.Fecha_Baja, 
a.Fecha_Suspension,
a.Situacion,
'3' as Periodicidad--,
--,.Ejercicio,b.Mes_Inicial,b.Mes_Final,--b.Descripcion,
--Fecha_Declarado
from [temporal_cruce_padron_nominas_actualizacion] as a --where a.RFc='VAME511008584'
) as X
cross apply  dbo.ftObligacionesPendientesTodos(X.RFC,X.Numero_Establecimiento,X.Clave,X.Periodicidad, 
YEAR(X.Fecha_Inicio),MONTH(X.Fecha_Inicio)) as Y
where X.Situacion in ('Activo') 
and (X.fecha_inicio is not null) AND (Y.Mes_Inicial IS NOT NULL )---este mes inicial  es por los que iniciaron despues 
order by X.RFC, X.Numero_Establecimiento, X.Clave,Ejercicio, Mes_Inicial

--querys  morosos o cumplidos de patentes
--insert para tener todos los rfcs con los periodos cumplidos y no cumplidos
--INSERT INTO temp_nomina_patentes_actualizacion
select  X.RFC,X.Numero_Establecimiento, X.Clave, X.Anual, X.Fecha_Inicio, X.Fecha_Baja, X.Fecha_Suspension, X.Periodicidad, Y.Ejercicio,
Y.Mes_Inicial, Y.Mes_Final,Y.Fecha_Declarado
from (
select  a.RFC
,a.REC, a.Numero_Establecimiento,a.Clave,a.Anual,
case when a.Fecha_Inicio<'01/01/2007' then '01/01/2007' else a.fecha_inicio end as Fecha_Inicio,
a.Fecha_Baja, 
a.Fecha_Suspension,
a.Situacion,
'3' as Periodicidad--,
--,.Ejercicio,b.Mes_Inicial,b.Mes_Final,--b.Descripcion,
--Fecha_Declarado
from [temporal_cruce_padron_nominas_actualizacion] as a --where a.RFc='VAME511008584'
) as X
cross apply  dbo.ftObligacionesPendientesTodos(X.RFC,X.Numero_Establecimiento,X.Clave,X.Periodicidad, 
YEAR(X.Fecha_Inicio),MONTH(X.Fecha_Inicio)) as Y
where X.Situacion in ('Activo') 
and (X.fecha_inicio is not null) AND (Y.Mes_Inicial IS NOT NULL )---este mes inicial  es por los que iniciaron despues 
order by X.RFC, X.Numero_Establecimiento, X.Clave,Ejercicio, Mes_Inicial




select * from [temporal_cruce_padron_nominas_actualizacion]


select * from temp_nomina_patentes_actualizacion
--delete from temp_nomina_patentes_actualizacion
--58 min - 63928

-- genero la estadistica
--insert INTO bebal.dbo.[cumplidos_actualizacion_diaria]
select RFC,count(*) as Periodos,
SUM(CASE WHEN Fecha_Declarado IS NOT NULL THEN 1 ELSE 0 END) AS Cumplidos, 
SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END) AS Debe,
getdate() as Fecha_Actualizacion
from dbo.temp_nomina_patentes_actualizacion
where clave='010610' 
group by rfc having SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END)=0

--query que elimina los cumplidos de la tabla incumplidos 
select * from bebal.dbo.incumplidos where RFC in (
select rfc from bebal.dbo.[cumplidos_actualizacion_diaria])

--para evitar que se hayan generado antes como cumplidos

select * from bebal.dbo.cumplidos_actualizacion_diaria where rfc in (select RFC
from dbo.temp_nomina_patentes_actualizacion
where clave='010610' 
group by rfc having SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END)=0)

--------------------------------------------------------------------------------
-- primer pase de informacion query morosos que me paso ramon
--Generamos una tabla con lo que tienen que cumplir
select a.RFC, a.Numero_Establecimiento,a.Clave,a.Anual,a.Fecha_Inicio,a.Fecha_Baja,
a.Fecha_Suspension,a.Periodicidad,b.Ejercicio,b.Mes_Inicial,b.Mes_Final,--b.Descripcion,
b.Fecha_Declarado into temp_repecos_cumplimiento_2012_sin
from temporal_obligaciones_cruce_padron_patentes_2012 as a
cross apply dbo.ftObligacionesPendientesTodos(a.RFC,a.Numero_Establecimiento,a.Clave,a.Periodicidad, 
YEAR(a.Fecha_Inicio),MONTH(a.Fecha_Inicio)) as b
where a.Situacion in ('Activo') 
--and b.Fecha_Declarado is null comentar para saber pagados y no pagados
--and a.rfc='CACX570125GHi'
order by RFC,Numero_Establecimiento,Clave,Ejercicio,Mes_Inicial
select top 100 * from temp_repecos_cumplimiento_2012_sin


--Checamos los que cumplieron incluyendo el Primer Bimestre
select RFC,count(*) as Periodos,
SUM(CASE WHEN Fecha_Declarado IS NOT NULL THEN 1 ELSE 0 END) AS Cumplidos, 
SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END) AS Debe from temp_repecos_cumplimiento_2012 where clave='010610'
group by rfc having SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END)=0;
--Checamos los que cumplieron primer bimestre y los que no cumplieron
select RFC,count(*) as Periodos,
SUM(CASE WHEN Fecha_Declarado IS NOT NULL THEN 1 ELSE 0 END) AS Cumplidos, 
SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END) AS Debe from temp_repecos_cumplimiento_2012_sin where clave='010610'
group by rfc having SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END)=0
select * from
(select RFC,count(*) as Bimestres,
SUM(CASE WHEN Fecha_Declarado IS NOT NULL THEN 1 ELSE 0 END) AS Cumplidos, 
SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END) AS Debe from temp_repecos_cumplimiento_2012_sin where clave='010610'
group by rfc having SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END)=0) x
left join
(select RFC,count(*) as Bimestres,
SUM(CASE WHEN Fecha_Declarado IS NOT NULL THEN 1 ELSE 0 END) AS Cumplidos, 
SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END) AS Debe from temp_repecos_cumplimiento_2012 where clave='010610'
group by rfc having SUM(CASE WHEN Fecha_Declarado IS NULL THEN 1 ELSE 0 END)=0) y
on x.RFC=y.RFC
WHERE y.RFC IS NULL


select * from temp_repecos_cumplimiento_2012 where rfc='EECF6701284T7' and clave='010610'
--Esto me lo paso lili
select a.RFC, a.Numero_Establecimiento,a.Clave,a.Anual,a.Fecha_Inicio,a.Fecha_Baja,
a.Fecha_Suspension,a.Periodicidad,b.Ejercicio,b.Mes_Inicial,b.Mes_Final,--b.Descripcion,
b.Fecha_Declarado 
from temporal_obligaciones_cruce_padron_patentes_2012 as a
cross apply dbo.ftObligacionesPendientesTodos(a.RFC,a.Numero_Establecimiento,a.Clave,a.Periodicidad, YEAR(a.Fecha_Inicio),MONTH(a.Fecha_Inicio)) as b
where a.Situacion in ('Activo') 
--and b.Fecha_Declarado is null comentar para saber pagados y no pagados
--and a.rfc='SALR730212JI8'
order by RFC,Numero_Establecimiento,Clave,Ejercicio,Mes_Inicial
select top 100 * from temporal_obligaciones_cruce_padron_patentes_2012
select clave,count(*) as cuenta from temporal_obligaciones_cruce_padron_patentes_2012
group by clave
select count(*) as contribuyentes from 
(select rfc,count(*) as cuenta from temporal_obligaciones_cruce_padron_patentes_2012
group by rfc) x
-----------------------------------------------------
ninis diciembre 2011
12, 12012
24, 12024
36, 12036
48, 12048
72, 12072
108 12108
120 12120 

------------------------------------------------------------
#saber que ha pagado peridos pagados tiene o adeuda un contribuyente desde su fecha de inicio

select  X.RFC,X.Numero_Establecimiento, X.Clave, X.Anual, X.Fecha_Inicio, X.Fecha_Baja, X.Fecha_Suspension, X.Periodicidad, Y.Ejercicio,
Y.Mes_Inicial, Y.Mes_Final,Y.Fecha_Declarado
from (select a.RFC,a.REC, a.Numero_Establecimiento,a.Clave,a.Anual,
a.Fecha_Inicio,
a.Fecha_Baja, 
a.Fecha_Suspension,
a.Situacion,
'3' as Periodicidad--,
--,.Ejercicio,b.Mes_Inicial,b.Mes_Final,--b.Descripcion,
--Fecha_Declarado
from pad_obligacionesporestablecimiento as a 
where rfc in  ('POEG611202I56')
and a.clave in ('010610','010618','010623')) as X
cross apply  dbo.ftObligacionesPendientesTodos(X.RFC,X.Numero_Establecimiento,X.Clave,X.Periodicidad, 
YEAR(X.Fecha_Inicio),MONTH(X.Fecha_Inicio)) as Y
where X.Situacion in ('Activo') 
and X.fecha_inicio is not null
order by X.RFC, X.Numero_Establecimiento, X.Clave,Ejercicio, Mes_Inicial
------------------------------------------------------------------


checar los datos en vehiculos de 93 94, 132 133, (929,930,931)
--------------------------------------------------------------------

'BEMB541113L70', 'HEQR700805542', 'CAGW9708308V8', 'TOMC5505032H2' ya  estan en cumplidos

SOMK771207MIA el pago no tenia fecha de declarado ya es cumplido

GOSE800407KA6 no tiene dadas de alta las obligaciones en el padron

AARC750722F64 adeuda el primer bimestre 2007 de repecos 

SOKK8306308E2 tenia 000000 en el numero de establecimiento de la declaracion y deberia ser 00000 ya es cumplido

AUMJ611204EL7 tenia 000000 en el numero de establecimiento de la declaracion y deberia ser 00000 ya  es cumplido  en mi tabla

'MAVC810919N6A', tenia 000000 en el numero de establecimiento de la declaracion y deberia ser 00000 ya  es cumplido  en mi tabla
'FOMR451217I86',--tenia 000000 en el numero de establecimiento de la declaracion y deberia ser 00000 ya  es cumplido  en mi tabla



where RFC IN 
('GOSE800407KA6',--
'AARC750722F64',--
'BEMB541113L70',--
'HEQR700805542',--
'SOKK8306308E2',--
'AUMJ611204EL7',
'CAGW9708308V8',--
'MAVC810919N6A',
'FOMR451217I86',--
'TOMC5505032H2',
'SOMK771207MIA'--
)
--------------------------------------------------------------------------------
respaldo no firmados por recaudador de playa ninis
Expr1	Expr2	Expr3	Expr4	Movimiento	Status	Municipio_Estatal	Fecha_Impresion	Fecha_Asignacion	Usuario_Impresion
73	AAA071011PB7	103161E3000474	12108	R1	A	08	2012-02-10 08:50:25.527	NULL	avargas
73	ADT090625HWA	103161E3000483	12108	R1	A	08	2012-02-10 08:50:25.580	NULL	avargas
73	AED040824HW3	1031613X00050A	12012	R1	A	08	2012-02-13 08:28:26.510	NULL	avargas
73	AICC590726SZ7	1031616Y000238	12048	R1	A	08	2012-02-13 08:06:06.497	NULL	avargas
73	AMC020930AP3	1031613X000519	12012	R1	A	08	2012-02-13 08:28:26.540	NULL	avargas
73	AMD061023863	103161E3000492	12108	R1	A	08	2012-02-10 08:50:25.590	NULL	avargas
73	APL0809185C7	103161E3000509	12108	R1	A	08	2012-02-10 08:50:25.600	NULL	avargas
73	ARI101015RM7	103161E3000518	12108	R1	A	08	2012-02-10 08:50:25.603	NULL	avargas
73	ARM0605256F2	1031613X000798	12012	R1	A	08	2012-02-13 08:28:26.547	NULL	avargas
73	ATA9906105G4	1031613X000804	12012	R1	A	08	2012-02-13 08:28:26.583	NULL	avargas
73	AUAR6809219A8	1031616Y000247	12048	R1	A	08	2012-02-13 08:06:06.570	NULL	avargas
73	BSE0709242M7	103161E3000527	12108	R1	A	08	2012-02-10 08:50:25.603	NULL	avargas
73	CAB0901169N9	103161E3000536	12108	R1	A	08	2012-02-10 08:50:25.610	NULL	avargas
73	CADA670210P53	103161EG000132	12120	R1	A	08	2012-02-09 15:32:06.060	NULL	avargas
73	CAF061013654	103161E3000545	12108	R1	A	08	2012-02-10 08:50:25.610	NULL	avargas
73	CAGE661212F93	1031619P000120	12072	R1	A	08	2012-02-10 11:32:51.477	NULL	AVARGAS
73	CAHN430428RE4	1031619P00013A	12072	R1	A	08	2012-02-10 11:32:51.513	NULL	AVARGAS
73	CAM0901162H9	103161E3000554	12108	R1	A	08	2012-02-10 08:50:25.617	NULL	avargas
73	CAS050225365	1031613X000528	12012	R1	A	08	2012-02-13 08:28:26.583	NULL	avargas
73	CATE461005SQ3	103161EG000203	12120	R1	A	08	2012-02-09 15:32:06.080	NULL	avargas
73	CCI050530974	1031613X000537	12012	R1	A	08	2012-02-13 08:28:26.610	NULL	avargas
73	CLU090127KA2	103161E3000563	12108	R1	A	08	2012-02-10 08:50:25.620	NULL	avargas
73	CME080313NU6	103161E3000939	12108	R1	A	08	2012-02-10 08:50:25.647	NULL	avargas
73	CMM011205AR1	1031613X000546	12012	R1	A	08	2012-02-13 08:28:26.623	NULL	avargas
73	CMT080331TH5	103161E3000572	12108	R1	A	08	2012-02-10 08:50:25.670	NULL	avargas
73	COAL610202TX7	103161EG000141	12120	R1	A	08	2012-02-09 15:32:06.083	NULL	avargas
73	CPM0609297V0	1031613X000813	12012	R1	A	08	2012-02-13 08:28:26.627	NULL	avargas
73	CRU101110D51	103161E3000581	12108	R1	A	08	2012-02-10 08:50:25.670	NULL	avargas
73	CTY0709105L8	103161E3000590	12108	R1	A	08	2012-02-10 08:50:25.687	NULL	avargas
73	CUCD560103H3A	1031619P000149	12072	R1	A	08	2012-02-10 11:32:51.517	NULL	AVARGAS
73	CUPL670701B32	103161EG000212	12120	R1	A	08	2012-02-09 15:32:06.087	NULL	avargas
73	CXX080414H59	103161E3000607	12108	R1	A	08	2012-02-10 08:50:25.687	NULL	avargas
73	DCA031022JM4	1031613X000555	12012	R1	A	08	2012-02-13 08:28:26.640	NULL	avargas
73	DDO080226NM1	103161E3000616	12108	R1	A	08	2012-02-10 08:50:25.687	NULL	avargas
73	DVC030909HZ7	1031613X000564	12012	R1	A	08	2012-02-13 08:28:26.650	NULL	avargas
73	EBE1006102M2	103161E3000625	12108	R1	A	08	2012-02-10 08:50:25.693	NULL	avargas
73	EEBA530427SQ4	1031619P000158	12072	R1	A	08	2012-02-10 11:32:51.530	NULL	AVARGAS
73	GCE030515Q49	1031613X000573	12012	R1	A	08	2012-02-13 08:28:26.650	NULL	avargas
73	GCO090225QY0	103161E3000634	12108	R1	A	08	2012-02-10 08:50:25.693	NULL	avargas
73	GME060829RW6	1031613X000582	12012	R1	A	08	2012-02-13 08:28:26.660	NULL	avargas
73	GOCS671027A15	103161EG000150	12120	R1	A	08	2012-02-09 15:32:06.093	NULL	avargas
73	HMT0512052VA	1031613X000591	12012	R1	A	08	2012-02-13 08:28:26.660	NULL	avargas
73	HSM081027IN8	103161E3000643	12108	R1	A	08	2012-02-10 08:50:25.703	NULL	avargas
73	IBL071026KG4	103161E3000652	12108	R1	A	08	2012-02-10 08:50:25.727	NULL	avargas
73	IBR091029PY4	103161E3000661	12108	R1	A	08	2012-02-10 08:50:25.727	NULL	avargas
73	ICD990423K97	1031613X000608	12012	R1	A	08	2012-02-13 08:28:26.677	NULL	avargas
73	ICO071122AE8	103161E3000670	12108	R1	A	08	2012-02-10 08:50:25.730	NULL	avargas
73	IQA070129H1A	103161E300068A	12108	R1	A	08	2012-02-10 08:50:25.730	NULL	avargas
73	JCA9309288U4	1031613X000617	12012	R1	A	08	2012-02-13 08:28:26.680	NULL	avargas
73	KPI041124KE7	1031613X000626	12012	R1	A	08	2012-02-13 08:28:26.683	NULL	avargas
73	KPV050914KR4	1031613X000635	12012	R1	A	08	2012-02-13 08:28:26.693	NULL	avargas
73	KRI1004274W6	103161E3000699	12108	R1	A	08	2012-02-10 08:50:25.730	NULL	avargas
73	LELI6909219U9	1031616Y00021A	12048	R1	A	08	2012-02-13 08:06:06.580	NULL	avargas
73	MAJO490128BW2	1031619P000167	12072	R1	A	08	2012-02-10 11:32:51.533	NULL	AVARGAS
73	MARA280223TYA	103161EG00016A	12120	R1	A	08	2012-02-09 15:32:06.100	NULL	avargas
73	MCA040614S29	1031613X000644	12012	R1	A	08	2012-02-13 08:28:26.697	NULL	avargas
73	MCA950724KC4	1031613X00077A	12012	R1	A	08	2012-02-13 08:28:26.700	NULL	avargas
73	MECI530322SV1	1031619P000176	12072	R1	A	08	2012-02-10 11:32:51.547	NULL	AVARGAS
73	PPA050622FW2	1031613X000653	12012	R1	A	08	2012-02-13 08:28:26.700	NULL	avargas
73	PPG960815C24	1031613X000662	12012	R1	A	08	2012-02-13 08:28:26.710	NULL	avargas
73	PRE0407063Q6	103161E3000705	12108	R1	A	08	2012-02-10 08:50:25.740	NULL	avargas
73	PRI0805217D5	103161E3000714	12108	R1	A	08	2012-02-10 10:07:03.040	NULL	avargas
73	PTR0803062B3	103161E3000723	12108	R1	A	08	2012-02-10 10:07:03.110	NULL	avargas
73	PYU100505EQ7	103161E3000732	12108	R1	A	08	2012-02-10 10:07:03.110	NULL	avargas
73	QUGL6610193B8	103161EG000179	12120	R1	A	08	2012-02-09 15:32:06.110	NULL	avargas
73	QUUJ4703142C4	1031619P000185	12072	R1	A	08	2012-02-10 11:32:51.557	NULL	AVARGAS
73	RAWM600529F79	1031619P000194	12072	R1	A	08	2012-02-10 11:32:51.567	NULL	AVARGAS
73	RCM090519QI1	103161E3000741	12108	R1	A	08	2012-02-10 10:07:03.120	NULL	avargas
73	RGO081008LF2	103161E3000750	12108	R1	A	08	2012-02-10 10:07:03.137	NULL	avargas
73	RGO090115I32	103161E300076A	12108	R1	A	08	2012-02-10 10:07:03.147	NULL	avargas
73	RIEC7408108W8	1031616Y000229	12048	R1	A	08	2012-02-13 08:06:06.590	NULL	avargas
73	RIN0911118H0	103161E3000779	12108	R1	A	08	2012-02-10 10:07:03.150	NULL	avargas
73	ROCM550814HM0	1031619P000200	12072	R1	A	08	2012-02-10 11:32:51.567	NULL	AVARGAS
73	RPM110125A61	103161E3000788	12108	R1	A	08	2012-02-10 10:07:03.160	NULL	avargas
73	SACV6404123K1	1031616Y000256	12048	R1	A	08	2012-02-13 08:06:06.607	NULL	avargas
73	SAGI670919TZ1	103161EG000221	12120	R1	A	08	2012-02-09 15:32:06.123	NULL	avargas
73	SAMR640721TF6	103161EG000230	12120	R1	A	08	2012-02-09 15:32:06.133	NULL	avargas
73	SAP000828U63	1031613X000822	12012	R1	A	08	2012-02-13 08:28:26.710	NULL	avargas
73	SCA0904147L2	103161E3000797	12108	R1	A	08	2012-02-10 10:07:03.173	NULL	avargas
73	SCH050609DR4	103161E3000803	12108	R1	A	08	2012-02-10 10:07:03.183	NULL	avargas
73	SCN961217PQ3	1031613X000671	12012	R1	A	08	2012-02-13 08:28:26.723	NULL	avargas
73	SCO020109767	1031613X000680	12012	R1	A	08	2012-02-13 08:28:26.727	NULL	avargas
73	SCO080725II4	103161E3000812	12108	R1	A	08	2012-02-10 10:07:03.183	NULL	avargas
73	SCR0403039I9	1031613X00069A	12012	R1	A	08	2012-02-13 08:28:26.727	NULL	avargas
73	SDC960815MS1	1031613X000706	12012	R1	A	08	2012-02-13 08:28:26.727	NULL	avargas
73	SFI0303035T6	1031613X000831	12012	R1	A	08	2012-02-13 08:28:26.727	NULL	avargas
73	SLR0906306R3	103161E3000821	12108	R1	A	08	2012-02-10 10:07:03.187	NULL	avargas
73	SMA0506065R0	1031613X000715	12012	R1	A	08	2012-02-13 08:28:26.733	NULL	avargas
73	SME100913QB3	103161E3000830	12108	R1	A	08	2012-02-10 10:07:03.197	NULL	avargas
73	SPA0503019M5	1031613X000724	12012	R1	A	08	2012-02-13 08:28:26.737	NULL	avargas
73	SPL090616B95	103161E300084A	12108	R1	A	08	2012-02-10 10:07:03.197	NULL	avargas
73	SSO010615AG0	1031613X000733	12012	R1	A	08	2012-02-13 08:28:26.737	NULL	avargas
73	ST&060403CR9	1031613X000742	12012	R1	A	08	2012-02-13 08:28:26.737	NULL	avargas
73	SVA071113U54	103161E3000948	12108	R1	A	08	2012-02-10 10:07:03.197	NULL	avargas
73	TAMC500113693	1031619P00021A	12072	R1	A	08	2012-02-10 11:32:51.567	NULL	AVARGAS
73	TEN091202813	103161E3000859	12108	R1	A	08	2012-02-10 10:07:03.200	NULL	avargas
73	TGA041108IUA	1031613X000751	12012	R1	A	08	2012-02-13 08:28:26.740	NULL	avargas
73	TIZR7707205S3	103161EG000188	12120	R1	A	08	2012-02-09 15:32:06.133	NULL	avargas
73	TMP060222238	1031613X000840	12012	R1	A	08	2012-02-13 08:28:26.740	NULL	avargas
73	TMT090225FY5	103161E3000957	12108	R1	A	08	2012-02-10 10:07:03.200	NULL	avargas
73	TPI0903304S3	103161E3000966	12108	R1	A	08	2012-02-10 10:07:03.200	NULL	avargas
73	TVG090716QI4	103161E3000868	12108	R1	A	08	2012-02-10 10:07:03.213	NULL	avargas
73	UNA041105U27	1031613X000760	12012	R1	A	08	2012-02-13 08:28:26.740	NULL	avargas
73	UNI080306U43	103161E3000877	12108	R1	A	08	2012-02-10 10:07:03.220	NULL	avargas
73	VEBV680806AY5	103161EG000197	12120	R1	A	08	2012-02-09 15:32:06.140	NULL	avargas
73	VIX0712132UA	103161E3000886	12108	R1	A	08	2012-02-10 10:07:03.223	NULL	avargas
73	VJV0703305W9	103161E3000975	12108	R1	A	08	2012-02-10 10:07:03.223	NULL	avargas
73	VTW0912187C7	103161E3000895	12108	R1	A	08	2012-02-10 10:07:03.223	NULL	avargas
73	XHO0704045Q5	103161E3000984	12108	R1	A	08	2012-02-10 10:07:03.227	NULL	avargas
73	YDI010523BM3	1031613X000789	12012	R1	A	08	2012-02-13 08:28:26.740	NULL	avargas
73	YEX9906188N3	103161E3000901	12108	R1	A	08	2012-02-10 10:07:03.227	NULL	avargas
73	ZPD060518HE6	103161E3000910	12108	R1	A	08	2012-02-10 10:07:03.237	NULL	avargas
73	ZUM070227QW0	103161E300092A	12108	R1	A	08	2012-02-10 10:07:03.237	NULL	avargas



ALR	RFC	Numero_Control	Numero_Emision	Movimiento	Status	SubStatus	Fecha_Impresion	Fecha_Asignacion	Fecha_Citatorio	Fecha_No_Localizado	Fecha_Entrega	Fecha_Vencimiento	Fecha_Ultimo_Movimiento	Gastos_Ejecucion	Multa_Efectiva	Multa_Programada	Usuario_Cancelacion	Usuario_Impresion
73	CAGE661212F93	1031619P000120	12072	R1	A	B	2012-02-10 11:32:51.477	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.477	NULL	NULL	NULL	NULL	AVARGAS
73	CAHN430428RE4	1031619P00013A	12072	R1	A	B	2012-02-10 11:32:51.513	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.513	NULL	NULL	NULL	NULL	AVARGAS
73	CUCD560103H3A	1031619P000149	12072	R1	A	B	2012-02-10 11:32:51.517	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.517	NULL	NULL	NULL	NULL	AVARGAS
73	EEBA530427SQ4	1031619P000158	12072	R1	A	B	2012-02-10 11:32:51.530	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.530	NULL	NULL	NULL	NULL	AVARGAS
73	MAJO490128BW2	1031619P000167	12072	R1	A	B	2012-02-10 11:32:51.533	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.533	NULL	NULL	NULL	NULL	AVARGAS
73	MECI530322SV1	1031619P000176	12072	R1	A	B	2012-02-10 11:32:51.547	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.547	NULL	NULL	NULL	NULL	AVARGAS
73	QUUJ4703142C4	1031619P000185	12072	R1	A	B	2012-02-10 11:32:51.557	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.557	NULL	NULL	NULL	NULL	AVARGAS
73	RAWM600529F79	1031619P000194	12072	R1	A	B	2012-02-10 11:32:51.567	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.567	NULL	NULL	NULL	NULL	AVARGAS
73	ROCM550814HM0	1031619P000200	12072	R1	A	B	2012-02-10 11:32:51.567	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.567	NULL	NULL	NULL	NULL	AVARGAS
73	TAMC500113693	1031619P00021A	12072	R1	A	B	2012-02-10 11:32:51.567	NULL	NULL	NULL	NULL	NULL	2012-02-10 11:32:51.567	NULL	NULL	NULL	NULL	AVARGAS
73	AED040824HW3	1031613X00050A	12012	R1	A	B	2012-02-13 08:28:26.510	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.510	NULL	NULL	NULL	NULL	avargas
73	AMC020930AP3	1031613X000519	12012	R1	A	B	2012-02-13 08:28:26.540	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.540	NULL	NULL	NULL	NULL	avargas
73	CAS050225365	1031613X000528	12012	R1	A	B	2012-02-13 08:28:26.583	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.583	NULL	NULL	NULL	NULL	avargas
73	CCI050530974	1031613X000537	12012	R1	A	B	2012-02-13 08:28:26.610	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.610	NULL	NULL	NULL	NULL	avargas
73	CMM011205AR1	1031613X000546	12012	R1	A	B	2012-02-13 08:28:26.623	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.623	NULL	NULL	NULL	NULL	avargas
73	DCA031022JM4	1031613X000555	12012	R1	A	B	2012-02-13 08:28:26.640	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.640	NULL	NULL	NULL	NULL	avargas
73	DVC030909HZ7	1031613X000564	12012	R1	A	B	2012-02-13 08:28:26.650	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.650	NULL	NULL	NULL	NULL	avargas
73	GCE030515Q49	1031613X000573	12012	R1	A	B	2012-02-13 08:28:26.650	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.650	NULL	NULL	NULL	NULL	avargas
73	GME060829RW6	1031613X000582	12012	R1	A	B	2012-02-13 08:28:26.660	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.660	NULL	NULL	NULL	NULL	avargas
73	HMT0512052VA	1031613X000591	12012	R1	A	B	2012-02-13 08:28:26.660	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.660	NULL	NULL	NULL	NULL	avargas
73	ICD990423K97	1031613X000608	12012	R1	A	B	2012-02-13 08:28:26.677	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.677	NULL	NULL	NULL	NULL	avargas
73	JCA9309288U4	1031613X000617	12012	R1	A	B	2012-02-13 08:28:26.680	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.680	NULL	NULL	NULL	NULL	avargas
73	KPI041124KE7	1031613X000626	12012	R1	A	B	2012-02-13 08:28:26.683	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.683	NULL	NULL	NULL	NULL	avargas
73	KPV050914KR4	1031613X000635	12012	R1	A	B	2012-02-13 08:28:26.693	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.693	NULL	NULL	NULL	NULL	avargas
73	MCA040614S29	1031613X000644	12012	R1	A	B	2012-02-13 08:28:26.697	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.697	NULL	NULL	NULL	NULL	avargas
73	PPA050622FW2	1031613X000653	12012	R1	A	B	2012-02-13 08:28:26.700	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.700	NULL	NULL	NULL	NULL	avargas
73	PPG960815C24	1031613X000662	12012	R1	A	B	2012-02-13 08:28:26.710	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.710	NULL	NULL	NULL	NULL	avargas
73	SCN961217PQ3	1031613X000671	12012	R1	A	B	2012-02-13 08:28:26.723	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.723	NULL	NULL	NULL	NULL	avargas
73	SCO020109767	1031613X000680	12012	R1	A	B	2012-02-13 08:28:26.727	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.727	NULL	NULL	NULL	NULL	avargas
73	SCR0403039I9	1031613X00069A	12012	R1	A	B	2012-02-13 08:28:26.727	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.727	NULL	NULL	NULL	NULL	avargas
73	SDC960815MS1	1031613X000706	12012	R1	A	B	2012-02-13 08:28:26.727	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.727	NULL	NULL	NULL	NULL	avargas
73	SMA0506065R0	1031613X000715	12012	R1	A	B	2012-02-13 08:28:26.733	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.733	NULL	NULL	NULL	NULL	avargas
73	SPA0503019M5	1031613X000724	12012	R1	A	B	2012-02-13 08:28:26.737	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.737	NULL	NULL	NULL	NULL	avargas
73	SSO010615AG0	1031613X000733	12012	R1	A	B	2012-02-13 08:28:26.737	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.737	NULL	NULL	NULL	NULL	avargas
73	ST&060403CR9	1031613X000742	12012	R1	A	B	2012-02-13 08:28:26.737	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.737	NULL	NULL	NULL	NULL	avargas
73	TGA041108IUA	1031613X000751	12012	R1	A	B	2012-02-13 08:28:26.740	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.740	NULL	NULL	NULL	NULL	avargas
73	UNA041105U27	1031613X000760	12012	R1	A	B	2012-02-13 08:28:26.740	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.740	NULL	NULL	NULL	NULL	avargas
73	MCA950724KC4	1031613X00077A	12012	R1	A	B	2012-02-13 08:28:26.700	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.700	NULL	NULL	NULL	NULL	avargas
73	YDI010523BM3	1031613X000789	12012	R1	A	B	2012-02-13 08:28:26.740	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.740	NULL	NULL	NULL	NULL	avargas
73	ARM0605256F2	1031613X000798	12012	R1	A	B	2012-02-13 08:28:26.547	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.547	NULL	NULL	NULL	NULL	avargas
73	ATA9906105G4	1031613X000804	12012	R1	A	B	2012-02-13 08:28:26.583	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.583	NULL	NULL	NULL	NULL	avargas
73	CPM0609297V0	1031613X000813	12012	R1	A	B	2012-02-13 08:28:26.627	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.627	NULL	NULL	NULL	NULL	avargas
73	SAP000828U63	1031613X000822	12012	R1	A	B	2012-02-13 08:28:26.710	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.710	NULL	NULL	NULL	NULL	avargas
73	SFI0303035T6	1031613X000831	12012	R1	A	B	2012-02-13 08:28:26.727	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.727	NULL	NULL	NULL	NULL	avargas
73	TMP060222238	1031613X000840	12012	R1	A	B	2012-02-13 08:28:26.740	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:28:26.740	NULL	NULL	NULL	NULL	avargas
73	AAA071011PB7	103161E3000474	12108	R1	A	B	2012-02-10 08:50:25.527	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.527	NULL	NULL	NULL	NULL	avargas
73	ADT090625HWA	103161E3000483	12108	R1	A	B	2012-02-10 08:50:25.580	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.580	NULL	NULL	NULL	NULL	avargas
73	AMD061023863	103161E3000492	12108	R1	A	B	2012-02-10 08:50:25.590	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.590	NULL	NULL	NULL	NULL	avargas
73	APL0809185C7	103161E3000509	12108	R1	A	B	2012-02-10 08:50:25.600	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.600	NULL	NULL	NULL	NULL	avargas
73	ARI101015RM7	103161E3000518	12108	R1	A	B	2012-02-10 08:50:25.603	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.603	NULL	NULL	NULL	NULL	avargas
73	BSE0709242M7	103161E3000527	12108	R1	A	B	2012-02-10 08:50:25.603	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.603	NULL	NULL	NULL	NULL	avargas
73	CAB0901169N9	103161E3000536	12108	R1	A	B	2012-02-10 08:50:25.610	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.610	NULL	NULL	NULL	NULL	avargas
73	CAF061013654	103161E3000545	12108	R1	A	B	2012-02-10 08:50:25.610	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.610	NULL	NULL	NULL	NULL	avargas
73	CAM0901162H9	103161E3000554	12108	R1	A	B	2012-02-10 08:50:25.617	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.617	NULL	NULL	NULL	NULL	avargas
73	CLU090127KA2	103161E3000563	12108	R1	A	B	2012-02-10 08:50:25.620	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.620	NULL	NULL	NULL	NULL	avargas
73	CMT080331TH5	103161E3000572	12108	R1	A	B	2012-02-10 08:50:25.670	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.670	NULL	NULL	NULL	NULL	avargas
73	CRU101110D51	103161E3000581	12108	R1	A	B	2012-02-10 08:50:25.670	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.670	NULL	NULL	NULL	NULL	avargas
73	CTY0709105L8	103161E3000590	12108	R1	A	B	2012-02-10 08:50:25.687	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.687	NULL	NULL	NULL	NULL	avargas
73	CXX080414H59	103161E3000607	12108	R1	A	B	2012-02-10 08:50:25.687	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.687	NULL	NULL	NULL	NULL	avargas
73	DDO080226NM1	103161E3000616	12108	R1	A	B	2012-02-10 08:50:25.687	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.687	NULL	NULL	NULL	NULL	avargas
73	EBE1006102M2	103161E3000625	12108	R1	A	B	2012-02-10 08:50:25.693	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.693	NULL	NULL	NULL	NULL	avargas
73	GCO090225QY0	103161E3000634	12108	R1	A	B	2012-02-10 08:50:25.693	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.693	NULL	NULL	NULL	NULL	avargas
73	HSM081027IN8	103161E3000643	12108	R1	A	B	2012-02-10 08:50:25.703	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.703	NULL	NULL	NULL	NULL	avargas
73	IBL071026KG4	103161E3000652	12108	R1	A	B	2012-02-10 08:50:25.727	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.727	NULL	NULL	NULL	NULL	avargas
73	IBR091029PY4	103161E3000661	12108	R1	A	B	2012-02-10 08:50:25.727	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.727	NULL	NULL	NULL	NULL	avargas
73	ICO071122AE8	103161E3000670	12108	R1	A	B	2012-02-10 08:50:25.730	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.730	NULL	NULL	NULL	NULL	avargas
73	IQA070129H1A	103161E300068A	12108	R1	A	B	2012-02-10 08:50:25.730	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.730	NULL	NULL	NULL	NULL	avargas
73	CADA670210P53	103161EG000132	12120	R1	A	B	2012-02-09 15:32:06.060	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.060	NULL	NULL	NULL	NULL	avargas
73	COAL610202TX7	103161EG000141	12120	R1	A	B	2012-02-09 15:32:06.083	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.083	NULL	NULL	NULL	NULL	avargas
73	GOCS671027A15	103161EG000150	12120	R1	A	B	2012-02-09 15:32:06.093	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.093	NULL	NULL	NULL	NULL	avargas
73	MARA280223TYA	103161EG00016A	12120	R1	A	B	2012-02-09 15:32:06.100	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.100	NULL	NULL	NULL	NULL	avargas
73	QUGL6610193B8	103161EG000179	12120	R1	A	B	2012-02-09 15:32:06.110	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.110	NULL	NULL	NULL	NULL	avargas
73	TIZR7707205S3	103161EG000188	12120	R1	A	B	2012-02-09 15:32:06.133	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.133	NULL	NULL	NULL	NULL	avargas
73	VEBV680806AY5	103161EG000197	12120	R1	A	B	2012-02-09 15:32:06.140	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.140	NULL	NULL	NULL	NULL	avargas
73	CATE461005SQ3	103161EG000203	12120	R1	A	B	2012-02-09 15:32:06.080	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.080	NULL	NULL	NULL	NULL	avargas
73	CUPL670701B32	103161EG000212	12120	R1	A	B	2012-02-09 15:32:06.087	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.087	NULL	NULL	NULL	NULL	avargas
73	SAGI670919TZ1	103161EG000221	12120	R1	A	B	2012-02-09 15:32:06.123	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.123	NULL	NULL	NULL	NULL	avargas
73	SAMR640721TF6	103161EG000230	12120	R1	A	B	2012-02-09 15:32:06.133	NULL	NULL	NULL	NULL	NULL	2012-02-09 15:32:06.133	NULL	NULL	NULL	NULL	avargas
73	KRI1004274W6	103161E3000699	12108	R1	A	B	2012-02-10 08:50:25.730	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.730	NULL	NULL	NULL	NULL	avargas
73	PRE0407063Q6	103161E3000705	12108	R1	A	B	2012-02-10 08:50:25.740	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.740	NULL	NULL	NULL	NULL	avargas
73	PRI0805217D5	103161E3000714	12108	R1	A	B	2012-02-10 10:07:03.040	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.040	NULL	NULL	NULL	NULL	avargas
73	PTR0803062B3	103161E3000723	12108	R1	A	B	2012-02-10 10:07:03.110	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.110	NULL	NULL	NULL	NULL	avargas
73	PYU100505EQ7	103161E3000732	12108	R1	A	B	2012-02-10 10:07:03.110	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.110	NULL	NULL	NULL	NULL	avargas
73	RCM090519QI1	103161E3000741	12108	R1	A	B	2012-02-10 10:07:03.120	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.120	NULL	NULL	NULL	NULL	avargas
73	RGO081008LF2	103161E3000750	12108	R1	A	B	2012-02-10 10:07:03.137	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.137	NULL	NULL	NULL	NULL	avargas
73	RGO090115I32	103161E300076A	12108	R1	A	B	2012-02-10 10:07:03.147	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.147	NULL	NULL	NULL	NULL	avargas
73	RIN0911118H0	103161E3000779	12108	R1	A	B	2012-02-10 10:07:03.150	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.150	NULL	NULL	NULL	NULL	avargas
73	RPM110125A61	103161E3000788	12108	R1	A	B	2012-02-10 10:07:03.160	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.160	NULL	NULL	NULL	NULL	avargas
73	SCA0904147L2	103161E3000797	12108	R1	A	B	2012-02-10 10:07:03.173	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.173	NULL	NULL	NULL	NULL	avargas
73	SCH050609DR4	103161E3000803	12108	R1	A	B	2012-02-10 10:07:03.183	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.183	NULL	NULL	NULL	NULL	avargas
73	SCO080725II4	103161E3000812	12108	R1	A	B	2012-02-10 10:07:03.183	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.183	NULL	NULL	NULL	NULL	avargas
73	SLR0906306R3	103161E3000821	12108	R1	A	B	2012-02-10 10:07:03.187	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.187	NULL	NULL	NULL	NULL	avargas
73	SME100913QB3	103161E3000830	12108	R1	A	B	2012-02-10 10:07:03.197	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.197	NULL	NULL	NULL	NULL	avargas
73	SPL090616B95	103161E300084A	12108	R1	A	B	2012-02-10 10:07:03.197	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.197	NULL	NULL	NULL	NULL	avargas
73	TEN091202813	103161E3000859	12108	R1	A	B	2012-02-10 10:07:03.200	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.200	NULL	NULL	NULL	NULL	avargas
73	TVG090716QI4	103161E3000868	12108	R1	A	B	2012-02-10 10:07:03.213	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.213	NULL	NULL	NULL	NULL	avargas
73	UNI080306U43	103161E3000877	12108	R1	A	B	2012-02-10 10:07:03.220	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.220	NULL	NULL	NULL	NULL	avargas
73	VIX0712132UA	103161E3000886	12108	R1	A	B	2012-02-10 10:07:03.223	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.223	NULL	NULL	NULL	NULL	avargas
73	VTW0912187C7	103161E3000895	12108	R1	A	B	2012-02-10 10:07:03.223	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.223	NULL	NULL	NULL	NULL	avargas
73	YEX9906188N3	103161E3000901	12108	R1	A	B	2012-02-10 10:07:03.227	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.227	NULL	NULL	NULL	NULL	avargas
73	ZPD060518HE6	103161E3000910	12108	R1	A	B	2012-02-10 10:07:03.237	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.237	NULL	NULL	NULL	NULL	avargas
73	ZUM070227QW0	103161E300092A	12108	R1	A	B	2012-02-10 10:07:03.237	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.237	NULL	NULL	NULL	NULL	avargas
73	CME080313NU6	103161E3000939	12108	R1	A	B	2012-02-10 08:50:25.647	NULL	NULL	NULL	NULL	NULL	2012-02-10 08:50:25.647	NULL	NULL	NULL	NULL	avargas
73	SVA071113U54	103161E3000948	12108	R1	A	B	2012-02-10 10:07:03.197	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.197	NULL	NULL	NULL	NULL	avargas
73	TMT090225FY5	103161E3000957	12108	R1	A	B	2012-02-10 10:07:03.200	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.200	NULL	NULL	NULL	NULL	avargas
73	TPI0903304S3	103161E3000966	12108	R1	A	B	2012-02-10 10:07:03.200	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.200	NULL	NULL	NULL	NULL	avargas
73	VJV0703305W9	103161E3000975	12108	R1	A	B	2012-02-10 10:07:03.223	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.223	NULL	NULL	NULL	NULL	avargas
73	XHO0704045Q5	103161E3000984	12108	R1	A	B	2012-02-10 10:07:03.227	NULL	NULL	NULL	NULL	NULL	2012-02-10 10:07:03.227	NULL	NULL	NULL	NULL	avargas
73	LELI6909219U9	1031616Y00021A	12048	R1	A	B	2012-02-13 08:06:06.580	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:06:06.580	NULL	NULL	NULL	NULL	avargas
73	RIEC7408108W8	1031616Y000229	12048	R1	A	B	2012-02-13 08:06:06.590	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:06:06.590	NULL	NULL	NULL	NULL	avargas
73	AICC590726SZ7	1031616Y000238	12048	R1	A	B	2012-02-13 08:06:06.497	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:06:06.497	NULL	NULL	NULL	NULL	avargas
73	AUAR6809219A8	1031616Y000247	12048	R1	A	B	2012-02-13 08:06:06.570	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:06:06.570	NULL	NULL	NULL	NULL	avargas
73	SACV6404123K1	1031616Y000256	12048	R1	A	B	2012-02-13 08:06:06.607	NULL	NULL	NULL	NULL	NULL	2012-02-13 08:06:06.607	NULL	NULL	NULL	NULL	avargas

----------------------------------------------------------------------------------
actualiza los documentos de varias emisiones de playa sirref a no impresos
--update sirref_co_documentos 
set status='B'
where rfc in (
select y.RFC from (SELECT     doc.ALR , doc.RFC , doc.Numero_Control, doc.Numero_Emision , doc.Movimiento, doc.Status, 
                      dat.Municipio_Estatal, doc.Fecha_Impresion, doc.Fecha_Asignacion, doc.Usuario_Impresion
FROM         dbo.sirref_co_documentos AS doc INNER JOIN
                      dbo.sirref_co_datos AS dat ON doc.ALR = dat.ALR AND doc.RFC = dat.RFC AND doc.Numero_Control = dat.Numero_Control AND 
                      doc.Numero_Emision = dat.Numero_Emision
WHERE     (doc.Numero_Emision IN
                          (SELECT     Numero_Emision
                            FROM          dbo.sirref_co_emisiones
                            WHERE      (Municipio_Estatal = '08') AND (Mes_Moroso = '12') AND (Anio_Moroso = '2011'))) AND (dat.Municipio_Estatal = '08') AND 
                      (doc.Movimiento = 'R1'))as y group by y.rfc) and numero_emision in (SELECT     Numero_Emision
                            FROM          dbo.sirref_co_emisiones
                            WHERE      (Municipio_Estatal = '08') AND (Mes_Moroso = '12') AND (Anio_Moroso = '2011') )
------------------------------------------------------------------
ultima solicitus de genaro para descuentos   15 feb 2012
select * from incumplidos where rfc in 
('CATJ470715H73',--en incumplidos checar listo en cumplidos forzado
--'OEGJ5111068L8', tienen el descuento
--'MOAY640905KMA', tienen el descuento
'AUCJ7411261WA',--ya esta en cumplidos
'CUPA540502KZ5',-- no esta en patentes PERO YA ESTA EN CUMPLIDOS
'GOBB460501958'-- ya esta en cumplidos. pero en padron no tiene dada de alta las obligaciones
)
---------------------------------------------------------------------------
HISTORIAL DE PAGOS DE UN CONTRIBUYENTE bancos y caja estado de cuenta  gabo

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[ObtenerHistorialPagosContribuyente2]
		@RFC = N'GOPJ900501P43'

SELECT	'Return Value' = @return_value

GO


[dbo].[ObtenerHistorialPagosContribuyente2_ActivosyCancelados]--este me dice el historial de pagos del contribuyente todos los pagos cancelados y pagados en bancos y caja

--listado de estatus en un pago

select distinct Estatus   from cob_cobros
a aplicado
b activo
c cancelado
t tunel
w web
x extraviado

select distinct aplicado from cob_pagos_bancos
G no se
N no aplicado
S aplicado
X cancelado



--------------------------------------------------------------------------------------------------------
NINIS ENERO 2012
12001
12013
12025
12037
12061
12097
12109
------------------------------------------------------------------------------------------
06	01	1142	CADP610429	3CCKB00595A002726	R1	431	E	D	14/12/2011 12:37:19 p.m.	19/12/2011 12:43:27 p.m.	NULL	NULL	29/02/2012 12:00:00 a.m.	21/03/2012 12:00:00 a.m.	09/03/2012 10:47:10 a.m.	jruizc	NULL	NULL	0.0000	0.0000	0.0000	0.0000	NULL	NULL	0	NULL	3CCKB00595A002726

-------------------------------------------------------------------------------------------
##PROCEDEMIENTO QUE EMITE DOCUMENTOS ORDENADOS POR VECES QUE SE LES HA REQUERIDO Y POR MONTO DE ACUERDO CON LO REPORTADO EN INSCRITOS
##ES EL QUE SE APLICABA CON EL LIC JORGE SANCHEZ SE QUITO EL 12 DE MARZO DE 2012
USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[Requerir_Morosos_Repecos]    Fecha de la secuencia de comandos: 03/12/2012 17:10:33 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Ramon Sosa, Lilí Lizardi
-- Create date: 14/01/2010
-- Actualizado : 22/07/2010
-- Description:	Requerir Morosos de REPECOS
-- =============================================
ALTER PROCEDURE [dbo].[Requerir_Morosos_Repecos]
	-- Add the parameters for the stored procedure here
		@Limite int,
		@Clave_Obligacion varchar(MAX),
		@Municipio varchar(2),
		@ClavePeriodicidad varchar(2),
		@EjercicioFiscal varchar(4),
		@Mes varchar(2),
		@MesFinal varchar (2),
		@ClaveLocalidad varchar(10),
		@ClaveZona varchar(10),
		@ClaveOficina varchar(10),
		@Anio varchar(4),
		@Numero_Emision varchar(10),
		@Separador varchar(3) 
		
AS
BEGIN
	-- SET NOCO NT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
		DECLARE @LimiteTriple int;
		DECLARE @LimiteCuadruple int;
		DECLARE @texto_zona varchar(50);
		DECLARE @FolioNumeroControl BIGINT;
		DECLARE @Total BIGINT;
		DECLARE @RFC_Final varchar (13);
		DECLARE @Contador_Morosos_Federales BIGINT;
		DECLARE @Folio_Impresion BIGINT;
		DECLARE @Cuantas_Obligaciones int;
		DECLARE @Total_Registros int;
		SET @Folio_Impresion=0
		SET @Contador_Morosos_Federales=0
		SET @FolioNumeroControl =0
		SET @RFC_Final=''
		SET @LimiteTriple =0	
		SET @LimiteCuadruple=0
		SET @Total =0
		SET @Cuantas_Obligaciones=0
		SET @Total_Registros=0

	    
		DECLARE  @RFCNoLoc TABLE(
		   RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS
		);
		
		DECLARE  @Requeridos_Ejercicio_Fiscal TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				cuantos BIGINT,
				ejercicio_fiscal VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS
		);
		
		DECLARE  @TMP_detalle_documentos TABLE(
				Municipio VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4) COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 		RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Movimiento VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Folio_Impresion BIGINT,
				Status VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				cuantos BIGINT,
				Monto  money
		);

		DECLARE  @TMP_detalle_documentos_limpio TABLE(
				Municipio VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4) COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 		RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Movimiento VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Folio_Impresion BIGINT,
				Status VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS
		);
		
		
		DECLARE  @TMP_datos_federales TABLE
		(
				Municipio VARCHAR (2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 		RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS,
				CURP VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Numero_Serie VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Folio_Impresion BIGINT ,
				Nombre_Contribuyente VARCHAR (200)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Apellido_Paterno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Apellido_Materno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Localidad VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Zona VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Localidad_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Colonia_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Calle VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--este esta muy pequeño y no caben,
				Domicilio_Numero VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Colonia VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--otro pequeño
				Domicilio_Ubicacion VARCHAR(255) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Codigo_Postal VARCHAR(8) COLLATE SQL_Latin1_General_CP1_CI_AS,--este tambien esta pequeño debe ser 8 
				Ejercicio_Fiscal VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Anio_Moroso VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Inicial VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Final VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Pagado VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Clave_Periodicidad VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Control VARCHAR(14) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Folio_Facturacion VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Numero_Operacion VARCHAR(14)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Nombre_Comercial VARCHAR(63)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
				cuantos BIGINT,
				Monto  money
		);

DECLARE  @TMP_datos_federales_morosos_completo TABLE
		(
				Municipio VARCHAR (2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 		RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS,
				CURP VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Numero_Serie VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Folio_Impresion BIGINT ,
				Nombre_Contribuyente VARCHAR (200)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Apellido_Paterno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Apellido_Materno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Localidad VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Zona VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Localidad_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Colonia_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Calle VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--este esta muy pequeño y no caben,
				Domicilio_Numero VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Colonia VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--otro pequeño
				Domicilio_Ubicacion VARCHAR(255) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Codigo_Postal VARCHAR(8) COLLATE SQL_Latin1_General_CP1_CI_AS,--este tambien esta pequeño debe ser 8 
				Ejercicio_Fiscal VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Anio_Moroso VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Inicial VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Final VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Pagado VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Clave_Periodicidad VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Control VARCHAR(14) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Folio_Facturacion VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Numero_Operacion VARCHAR(14)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Nombre_Comercial VARCHAR(63)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
				cuantos BIGINT
		);

		DEClARE @rfcs_datos_fed TABLE
		(		RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Monto  money
		);

		DECLARE  @TMP_datos_federales_sin_duplicados TABLE
		(		Municipio VARCHAR (2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 		RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS,
				CURP VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Numero_Serie VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Folio_Impresion BIGINT ,
				Nombre_Contribuyente VARCHAR (200)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Apellido_Paterno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Apellido_Materno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Localidad VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Zona VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Localidad_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Colonia_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Calle VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--este esta muy pequeño y no caben,
				Domicilio_Numero VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Colonia VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--otro pequeño
				Domicilio_Ubicacion VARCHAR(255) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Codigo_Postal VARCHAR(8) COLLATE SQL_Latin1_General_CP1_CI_AS,--este tambien esta pequeño debe ser 8 
				Ejercicio_Fiscal VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Anio_Moroso VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Inicial VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Final VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Pagado VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Clave_Periodicidad VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Control VARCHAR(14) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Folio_Facturacion VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Numero_Operacion VARCHAR(14)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Nombre_Comercial VARCHAR(63)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
				cuantos BIGINT,
				Monto  money
		);

		DECLARE  @TMP_datos_federales_ultimo TABLE
		(		Municipio VARCHAR (2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 		RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS,
				CURP VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Numero_Serie VARCHAR (20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Folio_Impresion BIGINT ,
				Nombre_Contribuyente VARCHAR (200)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Apellido_Paterno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Apellido_Materno VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Localidad VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Zona VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Localidad_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Colonia_Federal VARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Calle VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--este esta muy pequeño y no caben,
				Domicilio_Numero VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Colonia VARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS,--otro pequeño
				Domicilio_Ubicacion VARCHAR(255) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Domicilio_Codigo_Postal VARCHAR(8) COLLATE SQL_Latin1_General_CP1_CI_AS,--este tambien esta pequeño debe ser 8 
				Ejercicio_Fiscal VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Anio_Moroso VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Inicial VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Final VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Pagado VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Clave_Periodicidad VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Control VARCHAR(14) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Folio_Facturacion VARCHAR(3) COLLATE SQL_Latin1_General_CP1_CI_AS,
				--Numero_Operacion VARCHAR(14)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Nombre_Comercial VARCHAR(63)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL
				
		);
		--Guardamos en la tabla RFCNoLoc los rfc de contribuyentes 
		--Marcados como no localizados y doble no localizados
		

		INSERT INTO @RFCNoLoc
		SELECT a.RFC 
		FROM obl_detalle_documentos a
		JOIN obl_control_emisiones b
		ON a.Municipio = b.Municipio
		AND a.Oficina = b.Oficina
		AND a.Numero_Emision = b.Numero_Emision
		WHERE a.Municipio = @Municipio 
		AND a.Oficina = @ClaveOficina 
		AND a.Status in ('X')
		AND a.Movimiento in ('R1','R2','R3')
		AND b.Clave_Obligacion in ('010610','010618','010623')
		GROUP BY a.RFC
		
	
	--Multiplico el limite que ingresa el usuario para generar la emision triple
		
	--Sacamos si son mas de una obligacion
		select @Cuantas_Obligaciones= count(*)  from dbo.SplitString(@Clave_Obligacion, @Separador)
		
		IF (@Cuantas_Obligaciones>1)
		BEGIN
			--SET @LimiteCuadruple = @Limite * 4;--descartado
			SET @LimiteTriple = @Limite * 3; --con el limite triple me trae mas de los RFCS que necesito en el @limite
		END
		ELSE
		BEGIN
			SET @LimiteTriple = @Limite;
		END
	   
		--$numeroControl = generaNumeroControl( $municipio, $numeroEmision, $folioNumeroControl);

		--query que me trae el maximo folio impresion
		SELECT  @Folio_Impresion=Max(datos.Folio_Impresion)
		FROM obl_datos_federales datos
		LEFT JOIN obl_control_emisiones emision
			ON datos.Municipio = emision.Municipio
			AND datos.Oficina = emision.Oficina  
			AND datos.Numero_Emision = emision.Numero_Emision
		WHERE datos.Municipio = @Municipio 
			AND datos.Oficina = @ClaveOficina
			AND emision.Clave_Obligacion in ('010610','010618','010623')
			AND emision.Ejercicio_Fiscal = @Anio
	--
	
	   SET @Folio_Impresion= ISNULL(@Folio_Impresion,0)
		--   SELECT @Folio_Impresion;


INSERT INTO @TMP_datos_federales_morosos_completo
		select s.*, '0' as  cuantos
		from (select t.*, replace(Est.Nombre, '+chr(39)+', ' ') as Nombre_Comercial from
			(
				SELECT		--TOP (@LimiteCuadruple)
						@Municipio as Municipio, 
						@ClaveOficina as Oficina,
						@Numero_Emision as Numero_Emision, 
						pad_contribuyentes.RFC, 
						pad_contribuyentes.CURP,
						0 as Folio_Impresion,
						replace(pad_contribuyentes.Nombres, '+chr(39)+', ' ') as Nombre_Contribuyente, 
						replace(pad_contribuyentes.Apellido_Paterno, '+chr(39)+', ' ') as Apellido_Paterno, 
						replace(pad_contribuyentes.Apellido_Materno, '+chr(39)+', ' ') as Apellido_Materno,
						pad_contribuyentes.Localidad, 
						pad_contribuyentes.Zona, 
						pad_contribuyentes.Localidad_Federal, 
						pad_contribuyentes.Colonia_Federal, 
						replace(pad_contribuyentes.Domicilio_Fiscal_Calle, '+chr(39)+', ' ') as Domicilio_Calle,
						replace(pad_contribuyentes.Domicilio_Fiscal_Numero, '+chr(39)+', ' ') as Domicilio_Numero,
						Case pad_contribuyentes.Domicilio_Fiscal_Colonia
						when ''
						then replace(pad_contribuyentes.Domicilio_Fiscal_Colonia, '+chr(39)+', ' ') 
						else replace(pad_contribuyentes.Domicilio_Colonia, '+chr(39)+', ' ')
						END
						as Domicilio_Colonia, 
						replace(pad_contribuyentes.Domicilio_Fiscal_Ubicacion, '+chr(39)+', ' ') as Domicilio_Ubicacion,
						Case 
						when  (pad_contribuyentes.Localidad_Federal !='')
						then SUBSTRING ( pad_contribuyentes.Localidad_Federal,1,5)
						when  (pad_contribuyentes.Localidad_Federal ='')
						then SUBSTRING ( pad_contribuyentes.Colonia_Federal,1,5)
						END
						as Domicilio_Codigo_Postal,				
						@Anio as Ejercicio_Fiscal, 
						@EjercicioFiscal as Anio_Moroso,
						@Mes as Mes_Inicial,
						@MesFinal as Mes_Final,
						'N' as Pagado,
						pad_oblxest.Clave as Clave_Obligacion,
						@ClavePeriodicidad as Clave_Periodicidad,
						'' as Numero_Control
		FROM	pad_contribuyentes as pad_contribuyentes , 
				pad_obligacionesporestablecimiento as pad_oblxest ,
				cat_periodos as c
		WHERE	c.Tipo = @ClavePeriodicidad
				AND pad_contribuyentes.RFC=pad_oblxest.RFC
				AND pad_oblxest.Clave IN ('010610','010618','010623')
				AND pad_oblxest.Numero_Establecimiento='00000'
				AND pad_contribuyentes.Situacion='Activo'
				AND pad_oblxest.Situacion='Activo'
				AND c.Mes_Inicial= @Mes
				AND pad_contribuyentes.Municipio = @Municipio
				AND pad_contribuyentes.Localidad like ('%'+@ClaveLocalidad+'%')
				AND pad_contribuyentes.Localizable = 'S'
				AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,@EjercicioFiscal+'-'+@MesFinal+'-'+'01',20)
									OR pad_oblxest.Fecha_Inicio = ''
									OR pad_oblxest.Fecha_Inicio IS NULL )
				AND pad_contribuyentes.RFC NOT IN (	
						SELECT RFC 
						FROM obl_contribuyentes_omitidos 
						WHERE Clave_Obligacion in ('010610','010618','010623') and Activado='S')
				AND pad_contribuyentes.RFC NOT IN (	
						SELECT DISTINCT cont.RFC 
						FROM	obl_obligacion_vigilable_presentada as obl_oblvigpre
						INNER JOIN  pad_contribuyentes as cont 
						ON obl_oblvigpre.RFC=cont.RFC 
						INNER JOIN pad_obligacionesporestablecimiento	as pad_oblxest 
						ON obl_oblvigpre.RFC= pad_oblxest.RFC 
						AND obl_oblvigpre.Numero_Establecimiento= pad_oblxest.Numero_Establecimiento 
						WHERE obl_oblvigpre.Tipo_Periodo = @ClavePeriodicidad
						AND obl_oblvigpre.Anio_Inicial = @EjercicioFiscal
						AND obl_oblvigpre.Clave_Obligacion in ('010610','010618','010623')
						AND obl_oblvigpre.Mes_Inicial = @mes
						AND obl_oblvigpre.Estado = 'T'
						AND cont.Municipio =@Municipio)
				AND pad_contribuyentes.RFC NOT IN (
						SELECT RFC 
						FROM obl_datos_federales as fed 
						WHERE fed.Municipio= @Municipio
				AND fed.Anio_Moroso=@EjercicioFiscal
				AND fed.Mes_Inicial = @Mes
				AND fed.Clave_Periodicidad = @ClavePeriodicidad
				AND fed.Clave_Obligacion IN ('010610','010618','010623'))
				AND pad_contribuyentes.RFC NOT IN (	SELECT RFC FROM @RFCNoLoc)) as t 
		LEFT JOIN  ( SELECT DISTINCT(RFC),Nombre 
					 FROM pad_establecimientos Est
		 			 WHERE	Est.Municipio = @Municipio
							AND Est.Tipo_Establecimiento = 'Matriz'
							AND Est.Situacion = 'Activo') AS Est
		ON t.RFC = Est.RFC
) as s 


--hasta aqui 23 segs
--select * from @TMP_datos_federales_morosos_completo;

--select distinct (rfc) from @TMP_datos_federales_morosos_completo;


--saco los que al menos tienen un pago del 2008 para arriba
INSERT INTO @rfcs_datos_fed
select distinct(b.rfc),'0.00' as Monto--, fecha_declarado as clv 
from obl_obligacion_vigilable_presentada  as a
join @TMP_datos_federales_morosos_completo as b on
a.rfc=b.rfc 
and a.clave_obligacion=b.clave_obligacion
where a.anio_inicial>'2007' 
and a.tipo_periodo=@ClavePeriodicidad
and a.clave_obligacion='010610' 
and a.estado='T';

--hasta aqui 47 seg.
--select  * from @rfcs_datos_fed;

--select * from @TMP_datos_federales_morosos_completo

INSERT INTO @TMP_datos_federales
SELECT  a.*, '' as Monto   
FROM @TMP_datos_federales_morosos_completo AS A 
INNER JOIN @rfcs_datos_fed AS B ON A.RFC=B.RFC;

--select top 10 * from @TMP_datos_federales

--aqui tengo cuantas veces han sido requeridos de repecos los morosos en tres años
		Insert into @Requeridos_Ejercicio_Fiscal
		select  b.RFC, count(*) as cuantos, min (a.ejercicio_fiscal) as ejercicio_fiscal 
		from obl_control_emisiones as a
				join obl_detalle_documentos as b on
				a.Municipio=b.Municipio 
				and a.Oficina=b.Oficina 
				and a.numero_emision=b.numero_emision 
				where a.municipio=@Municipio 
				and a.ejercicio_fiscal in (year(getdate()), year(getdate())-1, year(getdate())-2)
				and a.oficina=@ClaveOficina
				and a.clave_obligacion IN ('010610') 
				and b.Movimiento in ('R1','R2','R3') 
				and b.rfc in (select rfc from @rfcs_datos_fed)
				group by b.RFC
				order by b.RFC;

UPDATE @TMP_datos_federales--actualizo los datos de cuantas veces se le ha requerido 
SET a.Cuantos= b.cuantos
from @TMP_datos_federales  as a 
join  @Requeridos_Ejercicio_Fiscal as b on 
a.rfc=b.rfc;

--select * from @TMP_datos_federales;
-- aqui ya tengo cuantos son morosos que tengan al menos un pago del 2008 
--y esta marcado cuantas veces se le requirio

UPDATE @rfcs_datos_fed
SET Monto= Cuota_IETU+Cuota_ISR+Cuota_IVA
from @rfcs_datos_fed  as a 
join  repecos_cf_inscritos_2008 as b on 
a.rfc=b.rfc and b.baja='N';

UPDATE @rfcs_datos_fed
SET Monto= Cuota_IETU+Cuota_ISR+Cuota_IVA
from @rfcs_datos_fed  as a 
join  repecos_cf_inscritos_2009 as b on 
a.rfc=b.rfc and b.baja='N';

UPDATE @rfcs_datos_fed
SET Monto= Cuota_IETU+Cuota_ISR+Cuota_IVA
from @rfcs_datos_fed  as a 
join  repecos_cf_inscritos_2010 as b on 
a.rfc=b.rfc and b.baja='N';

UPDATE @rfcs_datos_fed
SET Monto= Cuota_IETU+Cuota_ISR+Cuota_IVA
from @rfcs_datos_fed  as a 
join  repecos_cf_inscritos_2011 as b on 
a.rfc=b.rfc and b.baja='N';


UPDATE @TMP_datos_federales
set a.Monto= b.Monto
from @TMP_datos_federales as a
inner join @rfcs_datos_fed as b on
a.rfc=b.rfc;


--select * from @TMP_datos_federales
--order by cuantos,Monto desc;

--tengo los datos de los hits y de los montos
--Inserto en otra tabla temporal para quitar los RFCs que tienen 2 matrices o mas 
		INSERT INTO @TMP_datos_federales_sin_duplicados
			   ([Municipio]
			   ,[Oficina]
			   ,[Numero_Emision]
			   ,[RFC]
			   ,[CURP]
			   ,[Folio_Impresion]
			   ,[Nombre_Contribuyente]
			   ,[Apellido_Paterno]
			   ,[Apellido_Materno]
			   ,[Localidad]
			   ,[Zona]
			   ,[Localidad_Federal]
			   ,[Colonia_Federal]
			   ,[Domicilio_Calle]
			   ,[Domicilio_Numero]
			   ,[Domicilio_Colonia]
			   ,[Domicilio_Ubicacion]
			   ,[Domicilio_Codigo_Postal]
			   ,[Ejercicio_Fiscal]
			   ,[Anio_Moroso]
			   ,[Mes_Inicial]
			   ,[Mes_Final]
			   ,[Pagado]
			   ,[Clave_Obligacion]
			   ,[Clave_Periodicidad]
			   ,[Numero_Control]
			   ,[Nombre_Comercial]
			   ,[Cuantos]
			   ,[Monto] )
     		SELECT TOP (@LimiteTriple) 
				   Min(Municipio) as Municipio,
                   Min(Oficina) as Oficina,
                   Min(Numero_Emision) as Numero_Emision,
                   Min(RFC),
                   Min(CURP) as CURP,
                   Min(Folio_Impresion) as Folio_Impresion,
                   Min(Nombre_Contribuyente) as Nombre_Contribuyente,
                   Min(Apellido_Paterno) as Apellido_Paterno,
                   Min(Apellido_Materno) as Apellido_Materno,
					Min(Localidad) as Localidad,
					Min(Zona) as Zona, 
					Min(Localidad_Federal) as Localidad_Federal, 
					Min(Colonia_Federal) as Colonia_Federal,
					Min(Domicilio_Calle) as Domicilio_Calle,
					Min(Domicilio_Numero) as Domicilio_Numero,
					Min(Domicilio_Colonia) as Domicilio_Colonia,
					Min(Domicilio_Ubicacion) as Domicilio_Ubicacion,
					Min(Domicilio_Codigo_Postal) as Domicilio_Codigo_Postal,
					Min(Ejercicio_Fiscal) as Ejercicio_Fiscal,
					Min(Anio_Moroso) as Anio_Moroso,
					Min(Mes_Inicial) as Mes_Inicial,
					Min(Mes_Final) as Mes_Final,
					Min(Pagado) as Pagado,
					Clave_Obligacion,
					Min(Clave_Periodicidad) as Clave_Periodicidad,
					Min(Numero_Control) as Numero_Control,
					Max(Nombre_Comercial) as Nombre_Comercial,
					Max(cuantos) as cuantos,
					Max(Monto) as Monto
			FROM @TMP_datos_federales 
			GROUP BY RFC, Clave_Obligacion, cuantos, Monto
			ORDER BY cuantos, Monto desc;


--select * from @TMP_datos_federales_sin_duplicados;//hasta aqui ya tengo mis datos limpios y ordenados

		--Inserto en detalle documentos
		INSERT INTO @TMP_detalle_documentos
		SELECT  @Municipio as Municipio, 
						@ClaveOficina as Oficina, 
						@Numero_Emision as Numero_Emision, 
						RFC,
						'R1' as Movimiento, 
						0 as Folio_Impresion,
						'B' as Status,
						max(cuantos) as cuantos,
						max(Monto) as Monto
		FROM @TMP_datos_federales_sin_duplicados
		GROUP BY RFC
		order by cuantos, monto desc;

		--Generamos el Folio de Impresion para los requerimientos
		 WITH CTE
		 AS (SELECT Folio_Impresion,@Folio_Impresion+ROW_NUMBER()
				   OVER (ORDER BY cuantos, monto desc) AS ROWNUM FROM @TMP_detalle_documentos)
			  UPDATE CTE
			  SET Folio_Impresion = ROWNUM;

--select * from @TMP_detalle_documentos ;
--select * from @TMP_datos_federales_sin_duplicados;
		
		--Si estamos calculando los morosos REPECOS localizo el ultimo RFC del listado, y lo elimino de la tabla temporal
		--esto para volver a calcular cuantas obligaciones me debe y reinsertarlos en la tabla.
--		IF (@Cuantas_Obligaciones>1)
--		BEGIN
	/*		SELECT  TOP (1) @RFC_Final=RFC from @TMP_detalle_documentos order by RFC desc ;
			DELETE FROM @TMP_datos_federales_sin_duplicados where RFC = @RFC_Final;

			INSERT INTO @TMP_datos_federales_sin_duplicados
			select t.*, replace(Est.Nombre, '+chr(39)+', ' ') as Nombre_Comercial from
			(SELECT  	@Municipio as Municipio, 
						@ClaveOficina as Oficina,
						@Numero_Emision as Numero_Emision, 
						pad_contribuyentes.RFC, 
						pad_contribuyentes.CURP,
						0 as Folio_Impresion,
						replace(pad_contribuyentes.Nombres, '+chr(39)+', ' ') as Nombre_Contribuyente, 
						replace(pad_contribuyentes.Apellido_Paterno, '+chr(39)+', ' ') as Apellido_Paterno, 
						replace(pad_contribuyentes.Apellido_Materno, '+chr(39)+', ' ') as Apellido_Materno,
						pad_contribuyentes.Localidad, 
						pad_contribuyentes.Zona, 
						pad_contribuyentes.Localidad_Federal, 
						pad_contribuyentes.Colonia_Federal, 
						replace(pad_contribuyentes.Domicilio_Fiscal_Calle, '+chr(39)+', ' ') as Domicilio_Calle,
						replace(pad_contribuyentes.Domicilio_Fiscal_Numero, '+chr(39)+', ' ') as Domicilio_Numero,
						Case 
						when (pad_contribuyentes.Domicilio_Fiscal_Colonia !='')
						then replace(pad_contribuyentes.Domicilio_Fiscal_Colonia, '+chr(39)+', ' ') 
						when (pad_contribuyentes.Domicilio_Fiscal_Colonia ='')
						then replace(pad_contribuyentes.Domicilio_Colonia, '+chr(39)+', ' ')
						END
						as Domicilio_Colonia, 
						replace(pad_contribuyentes.Domicilio_Fiscal_Ubicacion, '+chr(39)+', ' ') as Domicilio_Ubicacion,
						Case 
						when  (pad_contribuyentes.Localidad_Federal !='')
						then SUBSTRING ( pad_contribuyentes.Localidad_Federal,1,5)
						when  (pad_contribuyentes.Localidad_Federal ='')
						then SUBSTRING ( pad_contribuyentes.Colonia_Federal,1,5)
						END
						as Domicilio_Codigo_Postal,					
						@Anio as Ejercicio_Fiscal, 
						@EjercicioFiscal as Anio_Moroso,
						@Mes as Mes_Inicial,
						@MesFinal as Mes_Final,
						'N' as Pagado,
						pad_oblxest.Clave as Clave_Obligacion,
						@ClavePeriodicidad as Clave_Periodicidad,
						'' as Numero_Control
				FROM	pad_contribuyentes as pad_contribuyentes , 
						pad_obligacionesporestablecimiento as pad_oblxest 
				WHERE	pad_contribuyentes.RFC=pad_oblxest.RFC
						AND pad_contribuyentes.RFC= @RFC_Final
						AND pad_oblxest.Clave in ('010610','010618','010623')
						AND pad_oblxest.Numero_Establecimiento='00000'
						AND pad_contribuyentes.Situacion='Activo'
						AND pad_oblxest.Situacion='Activo'
						AND pad_contribuyentes.Municipio = @Municipio
						AND pad_contribuyentes.Localidad like ('%'+@ClaveLocalidad+'%')
						AND pad_contribuyentes.Localizable = 'S'
			) as t
		LEFT JOIN  ( SELECT DISTINCT(RFC),Nombre FROM pad_establecimientos est
		 		 WHERE est.Municipio = @Municipio
					 AND est.Tipo_Establecimiento = 'Matriz'
					 AND est.Situacion = 'Activo') AS Est
		ON t.RFC = Est.RFC
		ORDER BY t.RFC
*/
		UPDATE @TMP_datos_federales_sin_duplicados
		SET a.Folio_Impresion=b.Folio_Impresion
		FROM @TMP_datos_federales_sin_duplicados as a 
		INNER JOIN @TMP_detalle_documentos as b
		ON a.RFC=b.RFC;

		--limpio es para que salgan solo el total de requerimientos ingresado es decir si el usuario ingreso 100
		--solo requerir a los 100
		INSERT INTO @TMP_detalle_documentos_limpio
		SELECT TOP (@limite) 
				Municipio, 
				Oficina, 
				Numero_Emision, 
				RFC,
				Movimiento, 
				Folio_Impresion,
				Status
		FROM @TMP_detalle_documentos
		order by folio_impresion;


		INSERT INTO @TMP_datos_federales_ultimo
		SELECT b.Municipio
			   ,b.Oficina
			   ,b.Numero_Emision
			   ,b.RFC
			   ,b.CURP
			   ,b.Folio_Impresion
			   ,b.Nombre_Contribuyente
			   ,b.Apellido_Paterno
			   ,b.Apellido_Materno
			   ,b.Localidad
			   ,b.Zona
			   ,b.Localidad_Federal
			   ,b.Colonia_Federal
			   ,b.Domicilio_Calle
			   ,b.Domicilio_Numero
			   ,b.Domicilio_Colonia
			   ,b.Domicilio_Ubicacion
			   ,b.Domicilio_Codigo_Postal
			   ,b.Ejercicio_Fiscal
			   ,b.Anio_Moroso
			   ,b.Mes_Inicial
			   ,b.Mes_Final
			   ,b.Pagado
			   ,b.Clave_Obligacion
			   ,b.Clave_Periodicidad
			   ,b.Numero_Control
			   ,b.Nombre_Comercial FROM @TMP_datos_federales_sin_duplicados AS b
		inner join @TMP_detalle_documentos_limpio AS a ON
		b.RFC=a.RFC;


--select * from @Requeridos_Ejercicio_Fiscal;
--select * from @TMP_detalle_documentos_limpio
--order by folio_impresion;
--select * from @TMP_datos_federales_ultimo 
--order by folio_impresion;


		INSERT INTO [obl_detalle_documentos]
			   ([Municipio]
			   ,[Oficina]
			   ,[Numero_Emision]
			   ,[RFC]
			   ,[Movimiento]
			   ,[Folio_Impresion]
			   ,[Status])
		SELECT  * from @TMP_detalle_documentos_limpio
		ORDER BY Folio_Impresion;
		
		INSERT INTO [obl_datos_federales]
			   ([Municipio]
			   ,[Oficina]
			   ,[Numero_Emision]
			   ,[RFC]
			   ,[CURP]
			   ,[Folio_Impresion]
			   ,[Nombre_Contribuyente]
			   ,[Apellido_Paterno]
			   ,[Apellido_Materno]
			   ,[Localidad]
			   ,[Zona]
			   ,[Localidad_Federal]
			   ,[Colonia_Federal]
			   ,[Domicilio_Calle]
			   ,[Domicilio_Numero]
			   ,[Domicilio_Colonia]
			   ,[Domicilio_Ubicacion]
			   ,[Domicilio_Codigo_Postal]
			   ,[Ejercicio_Fiscal]
			   ,[Anio_Moroso]
			   ,[Mes_Inicial]
			   ,[Mes_Final]
			   ,[Pagado]
			   ,[Clave_Obligacion]
			   ,[Clave_Periodicidad]
			   ,[Numero_Control]
			   ,[Nombre_Comercial])
     	SELECT  *  FROM @TMP_datos_federales_ultimo
		ORDER BY Folio_Impresion;

		--	SELECT count(*) as Total_Requerimientos from @TMP_detalle_documentos_limpio;
	
            COMMIT 
	 END TRY
  BEGIN CATCH
--     IF @@TRANCOUNT > 0
--		BEGIN
			ROLLBACK 
	 
--   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END
---------------------------------------------------------------------------------------------------------
##QUERY PARA SABER LOS DOBLE NO LOCALIZADOS MAS DE DOS VECES DE NOMINA OTHON P BLANCO
SELECT * FROM (SELECT RFC, count(*) as #_VECES_NO_LOCALIZADO, 'OTHON P. BCO' as Municipio, '010103' as Clave_Obligacion, 'Impuesto sobre Nominas' as Obligacion,
	MIN(Nombre_Contribuyente) AS Nombre_Contribuyente, min(Apellido_Paterno) AS Apellido_Paterno, MIN(Apellido_Materno) AS Apellido_Materno,  
	MIN(Numero_Establecimiento) AS Numero_Establecimiento,  min(Localidad) AS Localidad, 
    MIN(Zona) AS Zona, MIN(Domicilio_Matriz_Numero) AS Domicilio_Matriz_Numero, 
    MIN(Domicilio_Matriz_Calle) AS Domicilio_Matriz_Calle, MIN(Domicilio_Matriz_Colonia) AS Domicilio_Matriz_Colonia, 
    min(Domicilio_Matriz_Ubicacion) AS Domicilio_Matriz_Ubicacion,  min(Giro) AS GIRO
FROM (SELECT      emi.Numero_Emision, 
					  emi.Ejercicio_Fiscal,  
                      docu.Folio_Impresion,  
					  docu.Status, 
					docu.RFC, datos.Nombre_Contribuyente, 
                      datos.Apellido_Paterno, datos.Apellido_Materno,  datos.Numero_Establecimiento,  localidades.Nombre AS Localidad, 
                      zonas.Nombre  AS Zona,datos.Domicilio_Matriz_Numero, 
                      datos.Domicilio_Matriz_Calle, datos.Domicilio_Matriz_Colonia, datos.Domicilio_Matriz_Ubicacion, cat_giros.Descripcion AS Giro
FROM         obl_control_emisiones AS emi INNER JOIN
                      obl_detalle_documentos AS docu ON emi.Municipio = docu.Municipio AND emi.Oficina = docu.Oficina AND 
                      emi.Numero_Emision = docu.Numero_Emision INNER JOIN
                      obl_datos_generales AS datos ON docu.Municipio = datos.Municipio AND docu.Oficina = datos.Oficina AND 
                      docu.Numero_Emision = datos.Numero_Emision AND docu.RFC = datos.RFC AND docu.Folio_Impresion = datos.Folio_Impresion INNER JOIN
                      cat_localidades AS localidades ON datos.Municipio = localidades.Clave_Municipio AND datos.Localidad = localidades.Clave INNER JOIN
                      cat_zonas AS zonas ON datos.Municipio = zonas.Clave_Municipio AND datos.Localidad = zonas.Clave_Localidad AND 
                      datos.Zona = zonas.Clave INNER JOIN
                      cat_giros ON datos.Giro = cat_giros.Clave
WHERE     (emi.Municipio = '01') AND (emi.Oficina = '01') AND (emi.Clave_Obligacion = '010103') AND (docu.Movimiento = 'R1')
                       AND (docu.Status IN ('N', 'X')))AS X 
GROUP BY rfc ) as Z
WHERE #_VECES_NO_LOCALIZADO>1
ORDER BY RFC--emi.Numero_Emision, docu.Folio_Impresion 
----------------------------------------------------------------------------------------------------------------
checar estos

--'GABE7812017G0',
--'FOVI810325RU8 ',--FORZADO
'NOBD710916R79', SI EN PATENTES SOLO TIENE COMPLEMENTARIA EN 1-2 2008 
--'GOHA530920J80', SI EN PATENTES  forzado
'MASR681111DE9',
'MAVM641205QI1',
--'FEGJ550301FZ4',
--'RABA470826BM1',
'RETJ7509191R0', SI EN PATENTES
'PAAA761026RW9', SI EN PATENTES
--'PEKJ550819980',
'AOMA510715FU2'
-------------------------------------
ninis diciembre 2011
Municipio_Estatal	Numero_Emision	Numero_Control_Final
--02	12012	172 
--08	12012	35
--02	12024	6
--02	12036	14
--02	12048	50
--08	12048	5
--02	12072	20
--08	12072	10-- todos pendientes
--02	12108	120
--08	12108	52
--02	12120	26
--08	12120	11

----------------------------------------

Gerardo dice:
 por nada, cuando tengas tiempo podrias por favor revisar y decirme actualmente en control de obligaciones que requerimientos estan disponibles para que pueda emitir la recaudadora? para ver si me hace falta alguno por enviarte

----------------------------------------

"###query para saber el listado de morosos de tulum porque no se muestran en la pagina del listado de morosos

SELECT  cont.RFC, cont.Nombres+' '+cont.Apellido_Paterno+' '+ cont.Apellido_Materno as Nombre_Contribuyente,
						cont.Domicilio_Calle+', '+ cont.Domicilio_Numero+', '+cont.Domicilio_Ubicacion+', '+cont.Domicilio_Colonia+', '+cont.Domicilio_Codigo_Postal as Domicilio_Fiscal,
						cont.Municipio, mun.Nombre as Nombre_Municipio, cont.Localidad, 
						localidad.Nombre as Nombre_Localidad, cont.Zona, zona.Nombre as Nombre_Zona, pad_oblxest.Clave as Clave_Obligacion
				FROM pad_obligacionesporestablecimiento pad_oblxest
				JOIN pad_contribuyentes cont
					ON pad_oblxest.RFC = cont.RFC
				LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre
					ON pad_oblxest.RFC = obl_oblvigpre.RFC
					AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion
					AND obl_oblvigpre.Tipo_Periodo = '03'
					AND obl_oblvigpre.Anio_Inicial = '2012'
					AND obl_oblvigpre.Mes_Inicial = '01'
					AND obl_oblvigpre.Mes_Final = '02'
				LEFT JOIN obl_datos_federales fed
					ON pad_oblxest.RFC = fed.RFC
					AND pad_oblxest.Clave = fed.Clave_Obligacion
					AND fed.Ejercicio_Fiscal = '2012'
					AND fed.Mes_Inicial = '01'
					AND fed.Mes_Final = '02'
					AND fed.Clave_Periodicidad = '03'
					AND fed.Clave_Obligacion in ('010610','010618','010623')
				LEFT JOIN cat_municipios mun
					ON cont.Municipio = mun.Clave
				LEFT JOIN cat_localidades localidad
					ON cont.Municipio = localidad.Clave_Municipio
					AND cont.Localidad = localidad.Clave
				LEFT JOIN cat_zonas zona
					ON cont.Municipio = zona.Clave_Municipio
					AND cont.Localidad = zona.Clave_Localidad
					AND cont.Zona = zona.Clave
				WHERE pad_oblxest.Clave in ('010610','010618','010623')
					AND (pad_oblxest.Fecha_Inicio <= '2012-01-01'
					OR pad_oblxest.Fecha_Inicio = ''
					OR pad_oblxest.Fecha_Inicio IS NULL )
					AND cont.Municipio = '09' 
					AND pad_oblxest.Situacion IN ('Activo')
					AND cont.Situacion in ('Activo')
					AND fed.RFC IS NULL
					AND obl_oblvigpre.RFC IS NULL
----------------------------------------------------

query para saber los morosos bimestrales de ilepal

SELECT pad_oblxest.RFC 
FROM pad_obligacionesporestablecimiento pad_oblxest 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
ON ltrim(pad_oblxest.RFC)= ltrim(obl_oblvigpre.RFC) 
AND pad_oblxest.Numero_Establecimiento = obl_oblvigpre.Numero_Establecimiento 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
AND obl_oblvigpre.Tipo_Periodo = '03' 
AND obl_oblvigpre.Anio_Inicial = '2011' 
AND obl_oblvigpre.Mes_Inicial = '01' 
AND obl_oblvigpre.Mes_Final = '02' 
AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN pad_establecimientos pad_est ON pad_oblxest.RFC = pad_est.RFC 
AND pad_oblxest.Numero_Establecimiento = pad_est.Numero 
LEFT JOIN obl_detalle_sucursales obldetsuc ON pad_oblxest.RFC = obldetsuc.RFC 
AND pad_oblxest.Numero_Establecimiento = obldetsuc.Numero_Establecimiento 
AND pad_oblxest.Clave = obldetsuc.Clave_Obligacion 
AND obldetsuc.Anio_Moroso = '2011' 
AND obldetsuc.Mes = '01' 
AND obldetsuc.Clave_Periodicidad = '03' 
AND obldetsuc.Clave_Obligacion = '010102' 
LEFT JOIN obl_contribuyentes_omitidos oco 
ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion 
AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave = '010102' 
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2011-01-01',20) 
OR pad_oblxest.Fecha_Inicio = '' 
OR pad_oblxest.Fecha_Inicio IS NULL ) 
AND pad_oblxest.RFC in ( SELECT RFC FROM pad_establecimientos pad_est 
WHERE pad_est.Municipio = '06' AND pad_est.Situacion='Activo' 
AND pad_est.Tipo_Establecimiento = 'Matriz' ) 
AND pad_oblxest.Situacion = 'Activo' 
AND obl_oblvigpre.RFC IS NULL AND obldetsuc.RFC IS NULL 
AND oco.RFC IS NULL AND pad_est.Situacion = 'Activo' 

-----------------------------------------------

permitir al usuario escribir con el teclado numerico de la derecha
obl_cat_indices.php
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#############query para saber el listado de contribuyentes de nomina que salieron requeridos el listado que aparece al generar una emision
SELECT contrib.RFC, contrib.Nombres+' '+contrib.Apellido_Paterno+' '+contrib.Apellido_Materno as contribNombre, estab.Numero as estabNumero, estab.Nombre as estabNombre
        	        FROM pad_contribuyentes contrib
        	        LEFT JOIN pad_establecimientos estab 
						ON estab.RFC = contrib.RFC
        	        WHERE contrib.RFC in (
SELECT datos.RFC
FROM obl_datos_generales datos JOIN obl_detalle_documentos documento 
ON datos.Municipio = documento.Municipio AND datos.Oficina = documento.Oficina 
AND datos.Numero_Emision = documento.Numero_Emision AND datos.RFC = documento.RFC 
JOIN pad_establecimientos estab ON datos.RFC = estab.RFC AND datos.Numero_Establecimiento = estab.Numero 
LEFT JOIN cat_giros giro ON datos.Giro = giro.Clave 
LEFT JOIN cat_zonas zona ON datos.Municipio = zona.Clave_Municipio 
AND datos.Localidad = zona.Clave_Localidad AND datos.Zona = zona.Clave 
WHERE datos.Numero_Emision = '1210' AND datos.Municipio = '08' 
AND datos.Oficina = '01' AND documento.Movimiento = 'R1'  )
						AND estab.Municipio= '08'
and estab.RFC in (
SELECT datos.RFC
FROM obl_datos_generales datos JOIN obl_detalle_documentos documento 
ON datos.Municipio = documento.Municipio AND datos.Oficina = documento.Oficina 
AND datos.Numero_Emision = documento.Numero_Emision AND datos.RFC = documento.RFC 
JOIN pad_establecimientos estab ON datos.RFC = estab.RFC AND datos.Numero_Establecimiento = estab.Numero 
LEFT JOIN cat_giros giro ON datos.Giro = giro.Clave 
LEFT JOIN cat_zonas zona ON datos.Municipio = zona.Clave_Municipio 
AND datos.Localidad = zona.Clave_Localidad AND datos.Zona = zona.Clave 
WHERE datos.Numero_Emision = '1210' AND datos.Municipio = '08' 
AND datos.Oficina = '01' AND documento.Movimiento = 'R1'  )
---------------------------------------------------------------------------------
emisiones sirref marzo 2012
03-
27-
39-
99-
227-
15-
63-
111-
-----------------------------------------------------------------------------------
Cambio de Ricardo 7 mayo
SELECT     *, Numero_Emision AS Expr1, Folio_Impresion AS Expr2
FROM         dbo.obl_datos_federales
WHERE     (Numero_Emision = '1110') AND (Folio_Impresion = 1831)

01010183357960
------------------------------------------------------------------------------
## con el row number me devuelve los primeros 5 registros de cada contribuyente VICTOR victor 

select * from(
SELECT ROW_NUMBER() OVER(PARTITION BY rfc ORDER BY rfc, numero_establecimiento, clave,ejercicio desc, mes_inicial) AS num, 
*
FROM cumplidos_invitaciones
where municipio='01' and oficina='01' and fecha_declarado is null and rfc in ( SELECT top 5 rfc FROM cumplidos_invitaciones 
where municipio='01' and oficina='01' and fecha_declarado is null
group by rfc 
ORDER BY rfc)) as a
where num<=5
-----------------------------------------------------------

Ricardo Falcón dice:
 hola lili
 buen dia
 para la impresion de una multa de incumplimiento que aparece como pagoe spontaneo
  folio es 2997 
 fue notificado el dia 19/08/2011
 por salvador granados garcia 

 de opb
 ...

problema coral
-----------------------------------------------------
ninis febrero 2012
SELECT f.nombre as municipio,datos.numero_control  as numero_control, datos.numero_emision, e.nombre as estatus
FROM sirref_co_datos datos
JOIN sirref_co_documentos documento
ON datos.RFC = documento.RFC
AND datos.Numero_Control = documento.Numero_Control
AND datos.ALR = documento.ALR
AND documento.Movimiento = 'R1'
--AND documento.Status in ( 'P','T')
AND ((documento.fecha_no_localizado is null) and documento.fecha_entrega is null)
AND datos.numero_emision=documento.numero_emision
--WHERE datos.numero_emision='11103'
JOIN obl_nombres_estatus as e on  documento.status=e.clave
JOIN cat_municipios as f on datos.municipio_estatal=f.clave
WHERE datos.numero_emision in (select distinct (numero_emision)
from sirref_co_emisiones 
where ejercicio_fiscal='2012' 
and  mes_moroso='02' )
--AND datos.Municipio_Estatal = '02'
--GROUP BY documento.Numero_Control
order by municipio, numero_emision

------------------------------------------------------------------------
store procedure modificado reyes con ultimos cambios
USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[Generar_Invitaciones_Estatales_Total]    Fecha de la secuencia de comandos: 05/18/2012 11:57:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		 Lilí Lizardi
-- Create date: 21/03/2012
-- Actualizado : 21/03/2012
-- Description:	OBTIENE EL TOTAL DE PERSONAS MOROSOS EN LAS OBLIGACIONES ESTATALES para generar las invitaciones
--				inserta la lista de obligaciones que un contribuyente deberia presentar en una tabla
-- =============================================
 ALTER PROCEDURE [dbo].[Generar_Invitaciones_Estatales_Total]
	-- Add the parameters for the stored procedure here
		@Municipio varchar(2),
		@EjercicioFiscal varchar(4),
		@EjercicioFiscalFinal varchar(4),
		@ClaveLocalidad varchar(10),
		@ClaveZona varchar(10),
		@ClaveOficina varchar(10),
		@Anio varchar(4)
		
				
AS
BEGIN
	-- SET NOCO NT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
		DECLARE @Anio_Inicial varchar(4);
		DECLARE @Anio_Final varchar(4);
		DECLARE @Anio_Inicial_Moroso varchar(4);
	
		SET @Anio_Inicial='';
		SET @Anio_Final='';
		SET @Anio_Inicial_Moroso='';
		
		SET @Anio_Inicial=@Anio-5;
		SET @Anio_Final=@Anio;
		SET @Anio_Inicial_Moroso=@Anio-2;
		


		DECLARE  @TMP_documentos TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Establecimiento VARCHAR (6) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Inicio datetime ,
				Periodicidad VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Ejercicio_Fiscal VARCHAR(4) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Mes_Inicial int,
				Mes_Final int,
				Fecha_Declarado datetime 
		);
		DECLARE  @TMP_RFCS_ELIMINAR TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS
				--,Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS
				);


		--Elimino el listado de pagos del municipio para volver a cargarlos
		DELETE FROM cumplidos_invitaciones 
		WHERE Municipio=@Municipio AND Oficina=@ClaveOficina;


		INSERT INTO @TMP_documentos
		SELECT  X.RFC,X.Numero_Establecimiento, X.Clave, X.Fecha_Inicio,  
				X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final,Y.Fecha_Declarado
		FROM ( 
				SELECT  pad_oblxest.RFC,pad_oblxest.Numero_Establecimiento,pad_oblxest.Clave, obl.Periodicidad,
				case when pad_oblxest.Fecha_Inicio is NULL then '01/01/'+@EjercicioFiscal
					 when pad_oblxest.Fecha_Inicio='' then '01/01/'+@EjercicioFiscal
					 when (pad_oblxest.Fecha_Inicio < CONVERT(datetime,@EjercicioFiscal+'-'+'01'+'-'+'01',20))  then '01/01/'+@EjercicioFiscal
					 else pad_oblxest.Fecha_Inicio end as Fecha_Inicio, 
				pad_oblxest.situacion
				FROM pad_obligacionesporestablecimiento  as pad_oblxest
				LEFT JOIN pad_establecimientos AS EST ON pad_oblxest.RFC = EST.RFC  AND pad_oblxest.Numero_Establecimiento=EST.Numero 
				LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
				AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
				LEFT JOIN obl_cat_obligaciones AS obl ON pad_oblxest.Clave=obl.Clave_Obligacion AND obl.Ejercicio= year(getdate()) --checar eño aqui pues me pidieron que vigile de 2011 para atras
				LEFT JOIN obl_detalle_invitaciones_periodos_morosos  as periodos
				ON pad_oblxest.RFC = periodos.RFC
    			AND pad_oblxest.Numero_Establecimiento = periodos.Numero_Establecimiento
    			--AND pad_oblxest.Anio_Moroso =  periodos.Anio_Moroso									 
				--WHERE	pad_oblxest.Clave in  ('010104','010103','010106','010102')
				WHERE	pad_oblxest.Clave in  ('010104')
				--AND pad_oblxest.RFC  in ('CABL620222598','VALG560723BEA','VAAJ641007RD0',' CDS050118DE2',' ABC790601RC8') 
				--AND pad_oblxest.RFC  in (' ABC790601RC8')
				AND pad_oblxest.Situacion='Activo' 
				AND EST.Situacion='Activo'
				--AND (pad_oblxest.Fecha_Inicio >= CONVERT(datetime,@Anio_Inicial+'-'+'01'+'-'+'01',20) 
				AND  (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,@EjercicioFiscalFinal+'-'+'12'+'-'+'01',20)	
				OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL)
				AND Est.Tipo_Establecimiento ='Matriz' 
				AND EST.Municipio= @Municipio
				AND oco.RFC IS NULL 
				AND periodos.RFC IS NULL
		) as X 
		cross apply  dbo.ftObligacionesPendientesTodos_Por_Periodicidad(X.RFC,X.Numero_Establecimiento,X.Clave,X.Periodicidad, 
		YEAR(X.Fecha_Inicio),MONTH(X.Fecha_Inicio)) as Y
		WHERE X.Situacion in ('Activo') 
		and (X.fecha_inicio is not null) AND (Y.Mes_Inicial IS not NULL )---este mes inicial  es por los que iniciaron despues 
		GROUP BY x.RFC,X.Numero_Establecimiento, X.Clave,  X.Fecha_Inicio,  X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final,Y.Fecha_Declarado
		ORDER BY X.RFC, X.Clave,X.Numero_Establecimiento, Ejercicio, Mes_Inicial;

		--select * from @TMP_documentos;
		
/*
		--ELIMINO LOS QUE NO HICIERON NINGUNA DECLARACION EN 2010-2011 ILEPAL
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC, Clave_Obligacion
		FROM (
		SELECT rfc,	MIN(Clave_Obligacion) as  Clave_Obligacion,SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS DECLARADOS, 
							SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)  AS NO_DECLARADOS--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010102'	--and rfc=' ABC790601RC8'
		GROUP BY RFC
		) AS T WHERE DECLARADOS=0; 


		--ELIMINO LOS QUE NO HICIERON NINGUNA DECLARACION EN 2010-2011 NOMINA
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC, Clave_Obligacion
		FROM (
		SELECT rfc,	MIN(Clave_Obligacion) as  Clave_Obligacion,SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS DECLARADOS, 
							SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)  AS NO_DECLARADOS--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010103'	--and rfc=' ABC790601RC8'
		GROUP BY RFC
		) AS T WHERE DECLARADOS=0; 


		--ELIMINO LOS QUE NO HICIERON NINGUNA DECLARACION EN 2010-2011 HOSPEDAJE
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC, Clave_Obligacion
		FROM (
		SELECT rfc,	MIN(Clave_Obligacion) as  Clave_Obligacion,SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS DECLARADOS, 
							SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)  AS NO_DECLARADOS--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010104'	--and rfc=' ABC790601RC8'
		GROUP BY RFC
		) AS T WHERE DECLARADOS=0; 

*//*
		--ELIMINO LOS QUE NO HICIERON NINGUNA DECLARACION EN 2010-2011 MATERIALES
		--INSERT INTO @TMP_RFCS_ELIMINAR
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC, Clave_Obligacion
		FROM (
		SELECT rfc,	MIN(Clave_Obligacion) as  Clave_Obligacion,SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS DECLARADOS, 
							SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)  AS NO_DECLARADOS--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010106'	--and rfc=' ABC790601RC8'
		GROUP BY RFC
		) AS T WHERE DECLARADOS=0; 


		--ELIMINO LOS QUE TIENEN TODAS SUS DECLARACION EN 2010-2011 ILEPAL
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC,Clave_Obligacion
		FROM (
		SELECT rfc, MIN(Clave_Obligacion) as  Clave_Obligacion,	SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS DECLARADOS, 
							SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)  AS NO_DECLARADOS--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010102'	--and rfc=' ABC790601RC8'
		GROUP BY RFC
		) AS T WHERE DECLARADOS>'23' AND NO_DECLARADOS='0';

		--ELIMINO LOS QUE TIENEN TODAS SUS DECLARACION EN 2010-2011 NOMINA
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC,Clave_Obligacion
		FROM (
		SELECT rfc, MIN(Clave_Obligacion) as  Clave_Obligacion,	SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS DECLARADOS, 
							SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)  AS NO_DECLARADOS--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010103'	--and rfc=' ABC790601RC8'
		GROUP BY RFC
		) AS T WHERE DECLARADOS>'23' AND NO_DECLARADOS='0';


		--ELIMINO LOS QUE TIENEN TODAS SUS DECLARACION EN 2010-2011 HOSPEDAJE
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC,Clave_Obligacion
		FROM (
		SELECT rfc, MIN(Clave_Obligacion) as  Clave_Obligacion,	SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS DECLARADOS, 
							SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)  AS NO_DECLARADOS--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010104'	--and rfc=' ABC790601RC8'
		GROUP BY RFC
		) AS T WHERE DECLARADOS>'23' AND NO_DECLARADOS='0';


		--ELIMINO LOS QUE TIENEN TODAS SUS DECLARACION EN 2010-2011 MATERIALES
		
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC,Clave_Obligacion
		FROM (
		SELECT rfc, MIN(Clave_Obligacion) as  Clave_Obligacion,	SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS DECLARADOS, 
							SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)  AS NO_DECLARADOS--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010106'	--and rfc=' ABC790601RC8'
		GROUP BY RFC
		) AS T WHERE DECLARADOS>'23' AND NO_DECLARADOS='0';

			*/															

--		SELECT count(DISTINCT(rfc)) as total FROM @TMP_documentos ;
		--LOS RFCS QUE NO HAN DECLARADO NADA EN LOS DOS ULTIMOS ALÑOS DE TODAS LAS OBLIGACIONES

	/*	--Elimino los que no han declarado nada en 2010-2011 ilepal
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC--, min(clave_obligacion)as clave_obligacion, min(periodicidad) as periodicidad, min(ejercicio_fiscal) as ejercicio_fiscal,
		--SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS total  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010102'	
		GROUP BY RFC  HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)=0;
		
		--elimino los que no han declarado nada en 2010-2011 nomina
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC 
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010103'	
		GROUP BY RFC  HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)=0;

		--elimino los que no han declarado nada en 2010-2011 hospedaje
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC 
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010104'	
		GROUP BY RFC  HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)=0;

		--elimino los que no han declarado nada en 2010-2011 extraccion materiales
		--INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT rfc, SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END), SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010106'	--and rfc=' ABC790601RC8'
		GROUP BY RFC ; --HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)=0;

		SELECT rfc, SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END), SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)--RFC  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010103'	--and rfc=' ABC790601RC8'
		GROUP BY RFC ; --HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)=0;


*/
		
	/*	--Elimino los que declararon todo en 2010-2011
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT rfc
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010102'	
		GROUP BY RFC
		HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)>23 AND SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)=0;

		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT rfc
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010103'	
		GROUP BY RFC
		HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)>23 AND SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)=0;*/
		
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT rfc
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010104'	
		GROUP BY RFC
		HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)>23 AND SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)=0;

	/*	INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT rfc
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		AND Clave_Obligacion='010106'	
		GROUP BY RFC
		HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)>23 AND SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)=0;*/


--SELECT DISTINCT(rfc)) as total FROM @TMP_RFCS_ELIMINAR ;



		DELETE a
		FROM @TMP_documentos AS a
		INNER JOIN @TMP_RFCS_ELIMINAR as b  on a.RFC=b.RFC --and a.Clave_Obligacion=b.Clave_Obligacion;
--
		INSERT INTO cumplidos_invitaciones
		SELECT @Municipio as Municipio, @ClaveOficina as Oficina, a.* 
		FROM @TMP_documentos as a
		ORDER BY a.RFC, a.Numero_Establecimiento, a.Clave_Obligacion, a.Ejercicio_Fiscal, a.Mes_Inicial;

		--SELECT * FROM @TMP_RFCS_ELIMINAR;
		
		--SELECT count(distinct(RFC)) AS Total FROM @TMP_documentos;	

		--select * from @TMP_documentos as a ORDER BY a.RFC, a.Numero_Establecimiento, a.Clave_Obligacion, a.Ejercicio_Fiscal, a.Mes_Inicial;

		SELECT count(distinct(RFC)) AS Total 
		FROM @TMP_documentos 
		WHERE fecha_declarado is null;
--
--		SELECT * 
--		FROM @TMP_documentos 
--		WHERE fecha_declarado is null;

		--es demasiado el tiempo de ejecucion checar
	
            COMMIT 
	 END TRY
  BEGIN CATCH
--     IF @@TRANCOUNT > 0
--		BEGIN
			ROLLBACK 
	 
--   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END
---------------------------------------------------------------------------------------------------------------------------------------------------------

respaldo que funciona bien 
USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[Generar_Invitaciones_Estatales_Total]    Fecha de la secuencia de comandos: 05/18/2012 11:57:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		 Lilí Lizardi
-- Create date: 21/03/2012
-- Actualizado : 21/03/2012
-- Description:	OBTIENE EL TOTAL DE PERSONAS MOROSOS EN LAS OBLIGACIONES ESTATALES para generar las invitaciones
--				inserta la lista de obligaciones que un contribuyente deberia presentar en una tabla
-- =============================================
 ALTER PROCEDURE [dbo].[Generar_Invitaciones_Estatales_Total]
	-- Add the parameters for the stored procedure here
		@Municipio varchar(2),
		@EjercicioFiscal varchar(4),
		@EjercicioFiscalFinal varchar(4),
		@ClaveLocalidad varchar(10),
		@ClaveZona varchar(10),
		@ClaveOficina varchar(10),
		@Anio varchar(4)
		
				
AS
BEGIN
	-- SET NOCO NT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
		DECLARE @Anio_Inicial varchar(4);
		DECLARE @Anio_Final varchar(4);
		DECLARE @Anio_Inicial_Moroso varchar(4);
	
		SET @Anio_Inicial='';
		SET @Anio_Final='';
		SET @Anio_Inicial_Moroso='';
		
		SET @Anio_Inicial=@Anio-5;
		SET @Anio_Final=@Anio;
		SET @Anio_Inicial_Moroso=@Anio-2;
		


		DECLARE  @TMP_documentos TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Establecimiento VARCHAR (6) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Inicio datetime ,
				Periodicidad VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Ejercicio_Fiscal int,
				Mes_Inicial int,
				Mes_Final int,
				Fecha_Declarado datetime 
		);
		DECLARE  @TMP_RFCS_ELIMINAR TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS);


		--Elimino el listado de pagos del municipio para volver a cargarlos
		DELETE FROM cumplidos_invitaciones_nueva_nueva_nueva
		WHERE Municipio=@Municipio AND Oficina=@ClaveOficina;

		INSERT INTO @TMP_documentos
		SELECT  X.RFC,X.Numero_Establecimiento, X.Clave, X.Fecha_Inicio,  
				X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final,Y.Fecha_Declarado
		FROM ( 
				SELECT  pad_oblxest.RFC,pad_oblxest.Numero_Establecimiento,pad_oblxest.Clave, obl.Periodicidad,
				case when pad_oblxest.Fecha_Inicio is NULL then '01/01/'+@EjercicioFiscal
					 when pad_oblxest.Fecha_Inicio='' then '01/01/'+@EjercicioFiscal
					 when (pad_oblxest.Fecha_Inicio < CONVERT(datetime,@EjercicioFiscal+'-'+'01'+'-'+'01',20))  then '01/01/'+@EjercicioFiscal
					 else pad_oblxest.Fecha_Inicio end as Fecha_Inicio, 
				pad_oblxest.situacion
				FROM pad_obligacionesporestablecimiento  as pad_oblxest
				LEFT JOIN pad_establecimientos AS EST ON pad_oblxest.RFC = EST.RFC  AND pad_oblxest.Numero_Establecimiento=EST.Numero 
				LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
				AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
				LEFT JOIN obl_cat_obligaciones AS obl ON pad_oblxest.Clave=obl.Clave_Obligacion AND obl.Ejercicio= year(getdate()) --checar eño aqui pues me pidieron que vigile de 2011 para atras
				LEFT JOIN obl_detalle_invitaciones_periodos_morosos  as periodos
				ON pad_oblxest.RFC = periodos.RFC
    			AND pad_oblxest.Numero_Establecimiento = periodos.Numero_Establecimiento
    			--AND pad_oblxest.Anio_Moroso =  periodos.Anio_Moroso									 
				WHERE	pad_oblxest.Clave in  ('010104')--,'010103')--,'010106','010102')
				--AND pad_oblxest.RFC  in ('CABL620222598','VALG560723BEA','VAAJ641007RD0',' CDS050118DE2',' ABC790601RC8')
				--AND pad_oblxest.RFC  in ('CABL620222598')
				AND pad_oblxest.Situacion='Activo' 
				AND EST.Situacion='Activo'
				--AND (pad_oblxest.Fecha_Inicio >= CONVERT(datetime,@Anio_Inicial+'-'+'01'+'-'+'01',20) 
				AND  (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,@EjercicioFiscalFinal+'-'+'12'+'-'+'01',20)	
				OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL)
				AND Est.Tipo_Establecimiento ='Matriz' 
				AND EST.Municipio= @Municipio
				AND oco.RFC IS NULL 
				AND periodos.RFC IS NULL
		) as X 
		cross apply  dbo.ftObligacionesPendientesTodos_Por_Periodicidad(X.RFC,X.Numero_Establecimiento,X.Clave,X.Periodicidad, 
		YEAR(X.Fecha_Inicio),MONTH(X.Fecha_Inicio)) as Y
		WHERE X.Situacion in ('Activo') 
		and (X.fecha_inicio is not null) AND (Y.Mes_Inicial IS not NULL )---este mes inicial  es por los que iniciaron despues 
		GROUP BY x.RFC,X.Numero_Establecimiento, X.Clave,  X.Fecha_Inicio,  X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final,Y.Fecha_Declarado
		ORDER BY X.RFC, X.Numero_Establecimiento, X.Clave,Ejercicio, Mes_Inicial;





		--where rfc in ('CABL620222598') and Ejercicio_Fiscal>'2006'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		--AND Clave_Obligacion='010104'																	

--		SELECT count(DISTINCT(rfc)) as total FROM @TMP_documentos ;
		--LOS RFCS QUE NO HAN DECLARADO NADA EN LOS DOS ULTIMOS ALÑOS DE TODAS LAS OBLIGACIONES

		--Elimino los que no han declarado nada en 2010-2011
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT RFC--, min(clave_obligacion)as clave_obligacion, min(periodicidad) as periodicidad, min(ejercicio_fiscal) as ejercicio_fiscal,
		--SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END) AS total  
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		--AND Clave_Obligacion='010104'	
		GROUP BY RFC  HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)=0;

		
		--Elimino los que declararon todo en 2010-2011
		INSERT INTO @TMP_RFCS_ELIMINAR
		SELECT rfc
		FROM  @TMP_documentos
		WHERE  Ejercicio_Fiscal>'2009' and ejercicio_fiscal<'2012'--and Ejercicio_Fiscal>=@Anio_Inicial_Moroso;--checar aqui
		--AND Clave_Obligacion='010104'	
		--AND RFC IN (' CON051031NN9',' CCO950919AG2',' ICM040903FK0',' ADR070312SH0',' CCF960821NX8',' SDA980225G96') --AND fecha_declarado IS NOT NULL
		GROUP BY RFC--, clave_obligacion, periodicidad, ejercicio_fiscal,mes_inicial, mes_final
		HAVING SUM(CASE WHEN Fecha_Declarado is NULL THEN 0 ELSE 1 END)>23 AND SUM(CASE WHEN Fecha_Declarado is NULL THEN 1 ELSE 0 END)=0;


	--SELECT count(DISTINCT(rfc)) as total FROM @TMP_RFCS_ELIMINAR ;

		DELETE FROM @TMP_documentos
		WHERE rfc in (SELECT rfc FROM @TMP_RFCS_ELIMINAR);
--checar aqui porque tengo errores al usar la tabla


		INSERT INTO cumplidos_invitaciones_nueva_nueva_nueva
		(Municipio,Oficina,RFC,Numero_Establecimiento,Clave,Fecha_Inicio,Periodicidad,Ejercicio,Mes_Inicial,Mes_Final,Fecha_Declarado )
		SELECT @Municipio as Municipio, @ClaveOficina as Oficina, a.RFC,a.Numero_Establecimiento,a.Clave_Obligacion,a.Fecha_Inicio, a.Periodicidad,
				a.Ejercicio_Fiscal,Mes_Inicial,Mes_Final,Fecha_Declarado
		FROM @TMP_documentos as a
		ORDER BY a.RFC, a.Numero_Establecimiento, a.Clave_Obligacion, a.Ejercicio_Fiscal, a.Mes_Inicial;


		--SELECT * FROM @TMP_RFCS_ELIMINAR;
		
		--SELECT count(distinct(RFC)) AS Total FROM @TMP_documentos;	

		--select * from @TMP_documentos as a ORDER BY a.RFC, a.Numero_Establecimiento, a.Clave_Obligacion, a.Ejercicio_Fiscal, a.Mes_Inicial;

		SELECT count(distinct(RFC)) AS Total 
		FROM @TMP_documentos 
		WHERE fecha_declarado is null;

		--es demasiado el tiempo de ejecucion checar
	
            COMMIT 
	 END TRY
  BEGIN CATCH
--     IF @@TRANCOUNT > 0
--		BEGIN
			ROLLBACK 
	 
--   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END

-------------------------------------------
clinica carranza
8351440

231
400 
11-1:30

9838380592 celular

----------------------------------------------
concatenar
=CONCATENAR("'",A1,"',")
------------------------------------------------
store genera invitaciones federales total

USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[Generar_Invitaciones_Federales_Total]    Fecha de la secuencia de comandos: 06/07/2012 13:55:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		 Lilí Lizardi
-- Create date: 21/03/2012
-- Actualizado : 21/03/2012
-- Description:	OBTIENE EL TOTAL DE PERSONAS MOROSOS EN LAS OBLIGACIONES ESTATALES para generar las invitaciones
--				inserta la lista de obligaciones que un contribuyente deberia presentar en una tabla
-- ==========================================
ALTER PROCEDURE [dbo].[Generar_Invitaciones_Federales_Total]
	-- Add the parameters for the stored procedure here
		@Municipio varchar(2),
		@EjercicioFiscal varchar(4),
		@EjercicioFiscalFinal varchar(4),
		@ClaveLocalidad varchar(10),
		@ClaveZona varchar(10),
		@ClaveOficina varchar(10),
		@Anio varchar(4)
		
				
AS
BEGIN
	-- SET NOCO NT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
		DECLARE @Anio_Inicial varchar(4);
		DECLARE @Anio_Final varchar(4);
		DECLARE @Anio_Inicial_Moroso varchar(4);
	
		SET @Anio_Inicial='';
		SET @Anio_Final='';
		SET @Anio_Inicial_Moroso='';
		
		SET @Anio_Inicial=@Anio-5;
		SET @Anio_Final=@Anio;
		SET @Anio_Inicial_Moroso=@Anio-2;
		


		DECLARE  @TMP_declarados TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Establecimiento VARCHAR (6) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Inicio datetime ,
				Periodicidad VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Ejercicio_Fiscal int,
				Mes_Inicial int,
				Mes_Final int,
				Fecha_Declarado datetime
						
		);

	DECLARE  @TMP_documentos TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Establecimiento VARCHAR (6) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Periodicidad VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Inicio datetime,
				Situacion VARCHAR (10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Cuota_ISR money,
				Cuota_IVA money,
				Cuota_IETU money,
				Cuota_Total money,
				Rango int,
				Sin_Rango VARCHAR (1) COLLATE SQL_Latin1_General_CP1_CI_AS

		);

		DECLARE  @TMP_periodos_morosos TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Establecimiento VARCHAR (6) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Inicio datetime ,
				Periodicidad VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Ejercicio_Fiscal int,
				Mes_Inicial int,
				Mes_Final int,
				Fecha_Declarado datetime,
				Importe money
		);


		--Elimino el listado de pagos del municipio para volver a cargarlos
		DELETE FROM cumplidos_invitaciones_nueva_nueva_nueva
		WHERE Municipio=@Municipio AND Oficina=@ClaveOficina;




--preguntar a genaro como se va ver la hoja final
		INSERT INTO @TMP_documentos
		SELECT RFC, Numero_Establecimiento, Clave,Periodicidad, Fecha_Inicio,MIN(Situacion) AS Situacion, min(Cuota_ISR) as Cuota_ISR,
				min(Cuota_IVA) as Cuota_Iva,min(Cuota_IETU) as Cuota_IETU, min(Cuota_Total) as Cuota_Total, min(Rango) as Rango , 
				min(Sin_Rango) as Rango
		FROM (SELECT  pad_oblxest.RFC,pad_oblxest.Numero_Establecimiento,pad_oblxest.Clave, obl.Periodicidad,
				case when pad_oblxest.Fecha_Inicio is NULL then '01/01/'+@EjercicioFiscal
					 when pad_oblxest.Fecha_Inicio='' then '01/01/'+@EjercicioFiscal
					 when (pad_oblxest.Fecha_Inicio < CONVERT(datetime,@EjercicioFiscal+'-'+'01'+'-'+'01',20))  then '01/01/'+@EjercicioFiscal
					 else pad_oblxest.Fecha_Inicio end as Fecha_Inicio, 
				pad_oblxest.Situacion, 0.0 as Cuota_ISR, 0.0 as Cuota_IVA,  0.0 as Cuota_IETU, 
				'' as Cuota_Total, '' as Rango, 'N' as Sin_Rango
		FROM pad_obligacionesporestablecimiento  as pad_oblxest
				LEFT JOIN pad_establecimientos AS EST ON pad_oblxest.RFC = EST.RFC  
				LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
				AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
				LEFT JOIN obl_cat_obligaciones AS obl ON pad_oblxest.Clave=obl.Clave_Obligacion AND obl.Ejercicio= year(getdate()) --checar eño aqui pues me pidieron que vigile de 2011 para atras
				LEFT JOIN obl_detalle_invitaciones_periodos_morosos  as periodos
				ON pad_oblxest.RFC = periodos.RFC
    			AND pad_oblxest.Numero_Establecimiento = periodos.Numero_Establecimiento
    			--AND pad_oblxest.Anio_Moroso =  periodos.Anio_Moroso		
		WHERE	pad_oblxest.Clave in  ('010610','010618','010623')
				--WHERE	pad_oblxest.Clave in  ('010610')
				--AND pad_oblxest.RFC  in ('CABL620222598','VALG560723BEA','VAAJ641007RD0',' CDS050118DE2',' ABC790601RC8')
				--AND pad_oblxest.RFC  in ('FOCR680719PQ3')
				AND pad_oblxest.Situacion='Activo' 
				AND EST.Situacion='Activo'
				AND  (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,@EjercicioFiscalFinal+'-'+'12'+'-'+'01',20)	
				OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL)
				AND Est.Tipo_Establecimiento ='Matriz' 
				AND EST.Municipio= @Municipio
				AND oco.RFC IS NULL 
				AND periodos.RFC IS NULL) AS T
		GROUP BY RFC, Numero_Establecimiento, Clave,Periodicidad, Fecha_Inicio
		ORDER BY RFC;

--SELECT * 
--FROM @TMP_documentos as  a 
--join  repecos_cf_inscritos_2010 as b
--ON a.RFC=b.RFC and b.Rango between '1' and '10';

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2007 as b
ON a.RFC=b.RFC ;

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2008 as b
ON a.RFC=b.RFC ;

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2009 as b
ON a.RFC=b.RFC ;

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2010 as b
ON a.RFC=b.RFC;

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2011 as b
ON a.RFC=b.RFC;

--DESCOMENTAR SI QUIEREN REVISAR LOS INSCRITOS HASTA 2012
/*UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2012 as b
ON a.RFC=b.RFC;*/

--quito los que no son inscritos en el rango entre 1-10
delete from @TMP_documentos where rango>'10';
--quito los solo me deben una obligacion
delete from @TMP_documentos where rfc in (select rfc from @TMP_documentos group by rfc having count(*)=1);
 

update @TMP_documentos 
set Cuota_ISR= case when clave_obligacion='010610'then 114.00 end,
Cuota_IVA= case when clave_obligacion='010618'then 125.00 end,
Cuota_IETU= case when clave_obligacion='010623'then 117.00 end,
rango='1',
Sin_Rango='S'
where rango='0';


		
--select * from @TMP_documentos WHERE RFC='DIDJ730706K8A' order by rfc--rango, cuota_total;


--INSERT INTO @TMP_documentos
	/*	SELECT  X.RFC,X.Numero_Establecimiento, X.Clave, X.Fecha_Inicio,  
				X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final,max(Y.Fecha_Declarado) as FEcha_declarado
		FROM ( 
		SELECT  RFC,Numero_Establecimiento,Clave_Obligacion as Clave, Periodicidad,
				case when Fecha_Inicio is NULL then '01/01/'+@EjercicioFiscal
					 when Fecha_Inicio='' then '01/01/'+@EjercicioFiscal
					 when (Fecha_Inicio < CONVERT(datetime,@EjercicioFiscal+'-'+'01'+'-'+'01',20))  then '01/01/'+@EjercicioFiscal
					 else Fecha_Inicio end as Fecha_Inicio, situacion
				FROM @TMP_documentos --WHERE RFC='DIDJ730706K8A'
		) as X 
		cross apply  dbo.ftObligacionesPendientesTodos_Por_Periodicidad(X.RFC,X.Numero_Establecimiento,X.Clave,X.Periodicidad, 
		YEAR(X.Fecha_Inicio),MONTH(X.Fecha_Inicio)) as Y
		WHERE X.Situacion in ('Activo') 
		and (X.fecha_inicio is not null) AND (Y.Mes_Inicial IS not NULL )---este mes inicial  es por los que iniciaron despues 
		GROUP BY x.RFC,X.Numero_Establecimiento, X.Clave,  X.Fecha_Inicio,  X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final--,Y.Fecha_Declarado
		ORDER BY X.RFC, X.Numero_Establecimiento, X.Clave,Ejercicio, Mes_Inicial;*/


--actualizar arriba la fecha de inicio como se muestra aqui abajo comentado para que los que no tienen fecha de inicio la tengan
		INSERT INTO @TMP_periodos_morosos
		SELECT  docu.RFC,docu.Numero_Establecimiento,docu.Clave_obligacion,docu.Fecha_Inicio, docu.Periodicidad, 
				b.Ejercicio,b.Mes_Inicial,b.Mes_Final,max(c.Fecha_Declarado) as Fecha_Declarado, 0.0 as Importe
		FROM @TMP_documentos as docu
		JOIN pad_obligacionesporestablecimiento as a on  docu.RFC=a.RFC AND docu.Numero_Establecimiento=a.Numero_Establecimiento
		AND docu.Clave_Obligacion=a.Clave
		LEFT JOIN cat_periodos_ejercicio as b on docu.periodicidad=b.Tipo 
		and (b.Ejercicio>YEAR(docu.Fecha_Inicio) or (b.Ejercicio=YEAR(docu.Fecha_Inicio) and (b.Mes_Inicial>=MONTH(docu.Fecha_Inicio))))
		LEFT JOIN obl_obligacion_vigilable_presentada as c 
		on docu.RFC=c.RFC
		AND a.Numero_Establecimiento=c.Numero_Establecimiento
		AND a.Clave=c.Clave_Obligacion  and b.Ejercicio=c.Anio_Inicial 
		AND b.Mes_Inicial=c.Mes_Inicial 
		AND c.Estado='T' 
		AND c.Tipo_Presentacion not in ('Co')
		WHERE docu.Situacion in ('Activo')-- and docu.RFC='DIDJ730706K8A'
		and (docu.fecha_inicio is not null) AND (b.Mes_Inicial IS not NULL )--checar aqui que hay
		--checar aqui como va el group y el order
		GROUP BY docu.RFC,docu.Numero_Establecimiento, docu.Clave_obligacion, docu.fecha_inicio, docu.Periodicidad, b.Ejercicio, b.Mes_Inicial, b.Mes_Final
		ORDER BY docu.RFC,docu.Numero_Establecimiento;
		


--
update @TMP_periodos_morosos 
set importe= case when a.Clave_Obligacion='010610' then b.Cuota_ISR when a.Clave_Obligacion='010618' then b.Cuota_IVA 
				 when a.Clave_Obligacion='010623' then b.Cuota_IETU END from 
@TMP_periodos_morosos  as a
JOIN @TMP_documentos as b on a.RFC=b.RFC and a.Numero_Establecimiento=b.Numero_Establecimiento 
and a.clave_obligacion=b.clave_obligacion and a.Periodicidad=b.Periodicidad
WHERE a.fecha_declarado is null;

select * from @TMP_periodos_morosos;

		--es demasiado el tiempo de ejecucion checar
	
            COMMIT 
	 END TRY
  BEGIN CATCH
--     IF @@TRANCOUNT > 0
--		BEGIN
			ROLLBACK 
	 
--   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END
-------------------------------------------------------------------------------------
listado de requeridos de nomina y hospedaje de enero-mayo año 2012

select c.Nombre as Municipio, c.Nombre as Oficina, 	 Clave_Obligacion,e.Descripcion as Obligacion,
a.Numero_Emision,	a.Fecha_Emision,	b.Folio_Impresion,	a.Anio_Moroso,	a.Periodo_Inicial as Mes_Moroso,	
'Mensual' as Periodicidad,	b.RFC,	g.Nombre_Contribuyente,	g.Apellido_Paterno,	
g.Apellido_Materno,	f.Nombre as Estatus
 from obl_control_emisiones as a
join obl_detalle_documentos as b on 
a.municipio=b.municipio and a.oficina=b.oficina and a.numero_emision=b.numero_emision
join cat_municipios as c on a.municipio=c.clave
join cat_oficinas as d on a.municipio=d.clave_municipio and a.oficina=d.clave
join cat_obligaciones as e on a.clave_obligacion=e.clave
join obl_nombres_estatus as f on b.status=f.clave
join obl_datos_generales as g on b.folio_impresion=g.folio_impresion 
and b.municipio=g.municipio and b.oficina=g.oficina and b.numero_emision=g.numero_emision
where a.clave_obligacion='010104' 
and a.municipio='03' and a.ejercicio_fiscal='2012' and b.movimiento='R1' 
order by a.numero_emision, b.folio_impresion
--checar si hay emisiones anuales y adaptar
------------------------------------------------------------------------------
corregidos de ninis marzo 2012
municipio_estatal	NUMERO_EMISION	numero_control	fecha_IMPRESION	fecha_ENTREGA	fecha_no_localizado	STATUS
08	12099	103162DT000411	2012-05-07 13:34:35.203	NULL	2011-05-16 00:00:00.000	N
09	12099	103162DT000592	2012-06-05 16:28:36.020	2012-05-07 00:00:00.000	NULL	V
02	12099	100652DT002212	2012-05-03 15:41:38.330	2012-08-07 00:00:00.000	NULL	E


----------------------

pendientes ricardo  22 junio 2012

select * from obl_control_emisiones where numero_emision='1206' and municipio='05'
select * from seg_usuarios where nombre like '%ricardo'


select * from obl_detalle_documentos 
where folio_impresion='317'and numero_emision='1228' and municipio='04'


select * from obl_actos_notificador 
where folio_impresion='317'and numero_emision='1228' and municipio='04'



select * from obl_detalle_documentos 
where folio_impresion='7291'and numero_emision='1127' and municipio='02'


select * from OBL_datos_federales 
where folio_impresion='7291'and numero_emision='1127' and municipio='02'


select * from obl_obligacion_vigilable_presentada 
where rfc='VESC680803PLA' and mes_inicial='05' and mes_final='06' and anio_inicial='2011'

--update obl_obligacion_vigilable_presentada 
--set estado='N' 
--where rfc='VESC680803PLA' and mes_inicial='05' and mes_final='06' and anio_inicial='2011'
--
--update  OBL_datos_federales 
--set pagado='N'
--where folio_impresion='7291'and numero_emision='1127' and municipio='02'
--
--UPDATE  obl_detalle_documentos 
--SET STATUS='A'
--where folio_impresion='7291'and numero_emision='1127' and municipio='02'


select * from obl_detalle_documentos 
where folio_impresion='2496'and numero_emision='1110' and municipio='02'


select * from OBL_datos_federales 
where folio_impresion='2496'and numero_emision='1110' and municipio='02'


select * from obl_obligacion_vigilable_presentada 
where no_operacion='02020178490719'


select * from obl_obligacion_vigilable_presentada 
where no_operacion='02020184689624'


update obl_obligacion_vigilable_presentada 
set estado='S' 
where no_operacion='02020184689624'
------
--
--update  OBL_datos_federales 
--set pagado='N'
--where folio_impresion='2496'and numero_emision='1110' and municipio='02'
--
--
--UPDATE  obl_detalle_documentos 
--SET STATUS='A'
--where folio_impresion='2496'and numero_emision='1110' and municipio='02'


--update obl_detalle_documentos 
--set status='A', fecha_entrega=NULL, fecha_vencimiento=NULL
--where folio_impresion='317'and numero_emision='1227' and municipio='02'


select * from obl_actos_notificador 
where folio_impresion='7291'and numero_emision='1127' and municipio='02'

--DELETE from obl_actos_notificador 
where folio_impresion='317'and numero_emision='1228' and municipio='04' and status='E'




02020178490719
02020184689624

select * from obl_detalle_documentos 
where folio_impresion='1562'and numero_emision='1110' and municipio='01'

select * from OBL_datos_federales 
where folio_impresion='1562'and numero_emision='1110' and municipio='01'

select * from obl_obligacion_vigilable_presentada 
where no_operacion='01010182118973'

--update OBL_datos_federales 
--set pagado='N'
--where folio_impresion='1562'and numero_emision='1110' and municipio='01'
--
--update obl_obligacion_vigilable_presentada 
--set estado='N'
--where no_operacion='01010182118973'


FOLIO 1562 EMISION 1110 SE NOTIFICO EL EL DIA 18/04/2011 
 SEGUNDO 


select * from obl_detalle_documentos 
where folio_impresion='197'and numero_emision='1209' and municipio='01'


select * from OBL_datos_federales 
where folio_impresion='197'and numero_emision='1209' and municipio='01'

select * from obl_obligacion_vigilable_presentada 
where no_operacion='01010198182687'

--update obl_detalle_documentos 
--set status=substatus 
--where folio_impresion='197'and numero_emision='1209' and municipio='01'
--
--
--update OBL_datos_federales 
--set pagado='N'
--where folio_impresion='197'and numero_emision='1209' and municipio='01'
--
--
--update obl_obligacion_vigilable_presentada 
--set estado='N'
--where no_operacion='01010198182687'


FOLIO 197 EMISION 1209 FECHA DE NOTIFICACION 17/.

select * from obl_detalle_documentos 
where folio_impresion='262'and numero_emision='1209' and municipio='01'


select * from OBL_datos_federales 
where folio_impresion='262'and numero_emision='1209' and municipio='01'

select * from obl_obligacion_vigilable_presentada 
where no_operacion='01010198182780'
-------------------------------------------------------------------------
## query para sacar la  estadistica de prospectos para las invitaciones estatales
## antes de esto llene la tabla cumplidos_invitaciones_nueva_nueva_nueva con el store Generar_Invitaciones_Estatales_Total_REP_IMPRESION
## en el servidor ch-sarh

--desglosado por obligacion
--sin importe general 

SELECT a.Municipio as Clave_Municipio,min( b.Nombre) as Municipio, a.RFC, 
a.Clave as Clave_Obligacion, min(c.Descripcion) as Obligacion, count(*)  as Periodos_Morosos
FROM cumplidos_invitaciones_nueva_nueva_nueva  as a 
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
where a.Municipio='09' AND Fecha_Declarado is null
group BY a.Municipio, a.Oficina, a.RFC, a.clave
order BY a.RFC, a.Clave

--agrupado por rfc sin importar la obligacion
SELECT a.Municipio as Clave_Municipio,min( b.Nombre) as Municipio, a.RFC, 
'Estatales' as Impuestos, min(c.Descripcion) as Obligacion, count(*)  as Periodos_Morosos, sum(importe) as Total
FROM cumplidos_invitaciones_nueva_nueva_nueva  as a 
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
where a.Municipio='01' AND Fecha_Declarado is null
group BY a.Municipio, a.Oficina, a.RFC
order BY a.RFC

--con importe general y agrupado todas las obligaciones
SELECT a.Municipio as Clave_Municipio,min( b.Nombre) as Municipio, a.RFC, 
'Estatales' as Impuestos, min(c.Descripcion) as Obligacion, count(*)  as Periodos_Morosos, sum(importe) as Total
FROM cumplidos_invitaciones_nueva_nueva_nueva  as a 
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
where a.Municipio='08' AND Fecha_Declarado is null and a.no_operacion is null  
group BY a.Municipio, a.Oficina, a.RFC
order BY a.RFC

--con importe detalle 
SELECT a.Municipio as Clave_Municipio, b.Nombre as Municipio, a.RFC, a.Numero_Establecimiento,a.Clave as Clave_Obligacion, c.Descripcion as Obligacion, a.Fecha_Inicio , 
CASE  when a.Periodicidad='02' THEN 'Mensual' 
WHEN a.Periodicidad='07' then 'Anual' WHEN a.Periodicidad='03' then 'Bimestral' END as Periodicidad, Ejercicio as Año_Moroso, Mes_Inicial, Mes_Final, Fecha_Declarado, Importe
FROM cumplidos_invitaciones_nueva_nueva_nueva AS a
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
where a.Municipio='08' AND a.Fecha_Declarado is null and a.no_operacion is null  --and RFC=' ACI060201JG1'
order BY a.RFC, a.Clave, a.periodicidad desc, a.Ejercicio, a.mes_inicial

--wl detalle general

SELECT a.Municipio as Clave_Municipio, b.Nombre as Municipio, a.RFC, a.Numero_Establecimiento,a.Clave as Clave_Obligacion, c.Descripcion as Obligacion, a.Fecha_Inicio , 
CASE  when a.Periodicidad='02' THEN 'Mensual' 
WHEN a.Periodicidad='07' then 'Anual' WHEN a.Periodicidad='03' then 'Bimestral' END as Periodicidad, Ejercicio as Año_Moroso, Mes_Inicial, Mes_Final, Fecha_Declarado
FROM cumplidos_invitaciones_nueva_nueva_nueva AS a
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
where a.Municipio='09' AND a.Fecha_Declarado is null --and RFC=' BLI051014B15'
order BY a.RFC, a.Clave, a.periodicidad desc, a.Ejercicio, a.mes_inicial


--muestra los importes del ultimo pago de cada contribuyente

--mensual nomina
select top 100  a.*, (select top 1 Concepto_L from dec_nominas as b
where  rfc=a.rfc  and b.status!=0 
order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='07' 
and a.periodicidad='02' and a.clave='010103' and fecha_declarado is null
order by a.rfc,a.clave,a.periodicidad,  a.ejercicio, a.mes_inicial


--anual nomina
select a.*, (select top 1 Concepto_J from dec_nomina_anual as b
where  rfc=a.rfc  and b.status!=0 
order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='07' 
--and periodicidad='07' 
--and rfc=' VIL0808299D1'
and a.periodicidad='07' and a.clave='010103' and fecha_declarado is null
order by a.rfc,a.clave,a.periodicidad,  a.ejercicio, a.mes_inicial

--mensual hosp
select a.*, (select top 1 Concepto_K from dec_hospedaje as b
where  rfc=a.rfc  and b.status!=0 
order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='07' 
and a.periodicidad='02' and a.clave='010104' and fecha_declarado is null
order by a.rfc,a.clave,a.periodicidad,  a.ejercicio, a.mes_inicial


--anual hosp
select a.*, (select top 1 Concepto_J from dec_nomina_anual as b
where  rfc=a.rfc  and b.status!=0 
order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='07' 
--and periodicidad='07' 
--and rfc=' VIL0808299D1'
and a.periodicidad='07' and a.clave='010104' and fecha_declarado is null
order by a.rfc,a.clave,a.periodicidad,  a.ejercicio, a.mes_inicial



--anual ilepal
select a.*,  (select top 1 Concepto_K from dec_ilepal as b
where  rfc=a.rfc  and b.status!=0 
order by pago_fecha desc) as Importe_Real
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='07' 
--and periodicidad='07' 
--and rfc=' VIL0808299D1'
and a.periodicidad='07' and a.clave='010102' and fecha_declarado is null
order by a.rfc,a.clave,a.periodicidad,  a.ejercicio, a.mes_inicial

--anual EXTRACCION
select a.*, (select top 1 Concepto_K from dec_extraccion as b
where  rfc=a.rfc  and b.status!=0 
order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='07' 
and a.periodicidad='02' and a.clave='010106' and fecha_declarado is null
order by a.rfc,a.clave,a.periodicidad,  a.ejercicio, a.mes_inicial


####################
actuazliza los importes del ultimo pago de cada contribuyente
--actualiza nomina mensual
update cumplidos_invitaciones_nueva_nueva_nueva
	set importe=(select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='09' 
	and a.periodicidad='02' 
	and a.clave='010103' 
	and fecha_declarado is null

--actualiza nomina anual
update cumplidos_invitaciones_nueva_nueva_nueva
	set importe=(select top 1 Concepto_J from dec_nomina_anual as b where  rfc=a.rfc  and b.status!=0  order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='09' 
	and a.periodicidad='07' 
	and a.clave='010103' 
	and fecha_declarado is null

--actualiza mensual hospedaje
update cumplidos_invitaciones_nueva_nueva_nueva
	set importe= (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='09' 
and a.periodicidad='02' 
and a.clave='010104' 
and fecha_declarado is null



--anual hosp
update cumplidos_invitaciones_nueva_nueva_nueva
	set importe= (select top 1 Concepto_J from dec_nomina_anual as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='09' 
	and a.periodicidad='07' 
	and a.clave='010104' 
	and fecha_declarado is null


--anual ilepal
update cumplidos_invitaciones_nueva_nueva_nueva
	set importe= (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='09' 
	and a.periodicidad='07' 
	and a.clave='010102' 
	and fecha_declarado is null


--mensual extraccion
update cumplidos_invitaciones_nueva_nueva_nueva
	set importe=  (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
from cumplidos_invitaciones_nueva_nueva_nueva as a
where municipio='09' 
	and a.periodicidad='02' 
	and a.clave='010106' 
	and fecha_declarado is null

##select de los que si pagaron pero no tiene el rfc al inicio
SELECT a.Municipio as Clave_Municipio, b.Nombre as Municipio, a.RFC, a.Numero_Establecimiento,a.Clave as Clave_Obligacion, c.Descripcion as Obligacion, a.Fecha_Inicio , 
CASE  when a.Periodicidad='02' THEN 'Mensual' 
WHEN a.Periodicidad='07' then 'Anual' WHEN a.Periodicidad='03' then 'Bimestral' END as Periodicidad, Ejercicio as Año_Moroso, a.Mes_Inicial, 
a.Mes_Final, a.Fecha_Declarado, Importe, a.no_operacion,v.*
FROM cumplidos_invitaciones_nueva_nueva_nueva AS a
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
inner join obl_obligacion_vigilable_presentada as v on 
ltrim(a.rfc)=ltrim(v.rfc) 
AND a.Numero_Establecimiento=v.Numero_Establecimiento
and a.Clave=v.clave_obligacion 
and a.periodicidad=v.tipo_periodo
and a.Ejercicio=v.anio_inicial 
and a.mes_inicial=v.mes_inicial
and a.mes_final=v.mes_final
and v.Estado='T' 
and v.Tipo_Presentacion not in ('Co')
where a.Municipio='09' AND A.RFC=' AST020312IE4' AND
a.Fecha_Declarado is null  and a.no_operacion is null  
order BY a.RFC, a.Clave, a.periodicidad desc, a.Ejercicio, a.mes_inicial


##update de los que si pagaron pero no tiene el rfc al inicio
--update cumplidos_invitaciones_nueva_nueva_nueva  
set fecha_declarado=v.fecha_declarado, no_operacion=v.no_operacion
FROM cumplidos_invitaciones_nueva_nueva_nueva AS a
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
inner join obl_obligacion_vigilable_presentada as v on 
ltrim(a.rfc)=ltrim(v.rfc) 
AND a.Numero_Establecimiento=v.Numero_Establecimiento
and a.Clave=v.clave_obligacion 
and a.periodicidad=v.tipo_periodo
and a.Ejercicio=v.anio_inicial 
and a.mes_inicial=v.mes_inicial
and a.mes_final=v.mes_final
and v.Estado='T' 
and v.Tipo_Presentacion not in ('Co')
where a.Municipio='08' AND a.Fecha_Declarado is null and a.no_operacion is null  





-----------------------------------------------------------------------------------
## query para sacar la  estadistica de prospectos para las invitaciones federales
## antes de esto llene la tabla cumplidos_invitaciones_nueva con el store
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Generar_Invitaciones_Federales_Total]
		@Municipio = N'02',
		@EjercicioFiscal = N'2007',
		@EjercicioFiscalFinal = N'2011',
		@ClaveLocalidad = N'0',
		@ClaveZona = N'0',
		@ClaveOficina = N'01',
		@Anio = N'2012'

SELECT	'Return Value' = @return_value
GO

## en el servidor ch-sarh

SELECT a.Municipio as Clave_Municipio,min( b.Nombre) as Municipio, a.RFC, '010610- ISR REPECOS' AS OBLIGACION,
--min(a.Clave) as Clave_Obligacion, CASE when min(a.Clave)='010610' then 'ISR REPECOS' when min(a.Clave)='010618' then 'ISR IVA'
--END  as Obligacion,
 count(*)  as Periodos_Morosos, sum(a.importe) as Importe
FROM cumplidos_invitaciones_nueva  as a 
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
where a.Municipio='02' AND Fecha_Declarado is null --and a.RFC='BAFC360603MF3'
group BY a.Municipio, a.Oficina, a.RFC
order BY a.RFC--, a.Clave

SELECT a.Municipio as Clave_Municipio, b.Nombre as Municipio, 
a.RFC, a.Numero_Establecimiento,a.Clave as Clave_Obligacion, c.Descripcion as Obligacion, a.Fecha_Inicio , 
CASE  when a.Periodicidad='02' THEN 'Mensual'
WHEN a.Periodicidad='07' then 'Anual' WHEN a.Periodicidad='03' then 'Bimestral' END as Periodicidad, Ejercicio as Año_Moroso,
Mes_Inicial, Mes_Final, Fecha_Declarado, a.Importe, a.Rango
FROM cumplidos_invitaciones_nueva AS a
JOIN cat_municipios as b on a.Municipio=b.Clave 
join cat_obligaciones AS c ON a.Clave=c.Clave 
where a.Municipio='02' AND a.Fecha_Declarado is null --and RFC='BAFC360603MF3'
order BY a.RFC, a.periodicidad desc, a.Ejercicio, a.mes_inicial, a.clave
----------------------------------------------------------------
ninis abril 2012
numero_emision	municipio_estatal	numero_control_final
--12004	01	1
--12004	02	97
--12004	03	17
--12004	04	1
12004	07	2
--12004	08	22
--12004	09	4
--12016	02	2
--12028	01	1
--12028	02	7
--12028	03	2
--12028	08	2
--12040	01	7
--12040	02	17
--12040	03	3
--12040	08	5
--12064	01	1
--12064	02	6
--12064	03	1
--12064	08	5
--12100	01	1
--12100	02	53
--12100	03	2
--12100	04	1
--12100	08	25
--12100	09	2
--12112	02	9
--12112	03	1
--12112	08	8
------------------------------------------------------------------------------------------------------------------------------------

 Hola
 me apoyas para q puedan generar una multa de incunplimiento por fas
 num de control 103162dr000225  multa de incumplimiento, solo quiero imprimir el formato hfmp para que pague.   emision 12097,   mi usuario es fcarvajal
 es de tulum

C:\Documents and Settings\Administrador\Mis documentos\Lizardi\SH_2010\solventacion de req\multas pagadas\multas pagadas

GERARDO dice:
 se trata del formato de multa por caso omiso al requerimiento
 es anual de lepal
----------------------------------------------------------------------------------------------------------------------------------

store para generar las invitaciones de federales el total con importes

USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[Generar_Invitaciones_Federales_Total]    Fecha de la secuencia de comandos: 07/13/2012 14:06:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		 Lilí Lizardi
-- Create date: 21/03/2012
-- Actualizado : 21/03/2012
-- Description:	OBTIENE EL TOTAL DE PERSONAS MOROSOS EN LAS OBLIGACIONES ESTATALES para generar las invitaciones
--				inserta la lista de obligaciones que un contribuyente deberia presentar en una tabla
-- ==========================================
ALTER PROCEDURE [dbo].[Generar_Invitaciones_Federales_Total]
	-- Add the parameters for the stored procedure here
		@Municipio varchar(2),
		@EjercicioFiscal varchar(4),
		@EjercicioFiscalFinal varchar(4),
		@ClaveLocalidad varchar(10),
		@ClaveZona varchar(10),
		@ClaveOficina varchar(10),
		@Anio varchar(4)
		
				
AS
BEGIN
	-- SET NOCO NT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
		DECLARE @Anio_Inicial varchar(4);
		DECLARE @Anio_Final varchar(4);
		DECLARE @Anio_Inicial_Moroso varchar(4);
	
		SET @Anio_Inicial='';
		SET @Anio_Final='';
		SET @Anio_Inicial_Moroso='';
		
		SET @Anio_Inicial=@Anio-5;
		SET @Anio_Final=@Anio;
		SET @Anio_Inicial_Moroso=@Anio-2;
		


		DECLARE  @TMP_declarados TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Establecimiento VARCHAR (6) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Inicio datetime ,
				Periodicidad VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Ejercicio_Fiscal int,
				Mes_Inicial int,
				Mes_Final int,
				Fecha_Declarado datetime
						
		);

	DECLARE  @TMP_documentos TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Establecimiento VARCHAR (6) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Periodicidad VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Inicio datetime,
				Situacion VARCHAR (10) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Cuota_ISR money,
				Cuota_IVA money,
				Cuota_IETU money,
				Cuota_Total money,
				Rango int,
				Sin_Rango VARCHAR (1) COLLATE SQL_Latin1_General_CP1_CI_AS

		);

		DECLARE  @TMP_periodos_morosos TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Numero_Establecimiento VARCHAR (6) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Clave_Obligacion VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Fecha_Inicio datetime ,
				Periodicidad VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Ejercicio_Fiscal int,
				Mes_Inicial int,
				Mes_Final int,
				Fecha_Declarado datetime,
				Importe money,
				Rango CHAR (1) COLLATE SQL_Latin1_General_CP1_CI_AS
		);
	DECLARE  @RFCS_DEL TABLE(
				RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS
		);


		--Elimino el listado de pagos del municipio para volver a cargarlos
		DELETE FROM cumplidos_invitaciones_nueva_nueva_nueva
		WHERE Municipio=@Municipio AND Oficina=@ClaveOficina;




--preguntar a genaro como se va ver la hoja final
		INSERT INTO @TMP_documentos
		SELECT RFC, Numero_Establecimiento, Clave,Periodicidad, Fecha_Inicio,MIN(Situacion) AS Situacion, min(Cuota_ISR) as Cuota_ISR,
				min(Cuota_IVA) as Cuota_Iva,min(Cuota_IETU) as Cuota_IETU, min(Cuota_Total) as Cuota_Total, min(Rango) as Rango , 
				min(Sin_Rango) as Rango
		FROM (SELECT  pad_oblxest.RFC,pad_oblxest.Numero_Establecimiento,pad_oblxest.Clave, obl.Periodicidad,
				case when pad_oblxest.Fecha_Inicio is NULL then '01/01/'+@EjercicioFiscal
					 when pad_oblxest.Fecha_Inicio='' then '01/01/'+@EjercicioFiscal
					 when (pad_oblxest.Fecha_Inicio < CONVERT(datetime,@EjercicioFiscal+'-'+'01'+'-'+'01',20))  then '01/01/'+@EjercicioFiscal
					 else pad_oblxest.Fecha_Inicio end as Fecha_Inicio, 
				pad_oblxest.Situacion, 0.0 as Cuota_ISR, 0.0 as Cuota_IVA,  0.0 as Cuota_IETU, 
				'' as Cuota_Total, '' as Rango, 'N' as Sin_Rango
		FROM pad_obligacionesporestablecimiento  as pad_oblxest
				LEFT JOIN pad_establecimientos AS EST ON pad_oblxest.RFC = EST.RFC  
				LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
				AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
				LEFT JOIN obl_cat_obligaciones AS obl ON pad_oblxest.Clave=obl.Clave_Obligacion AND obl.Ejercicio= year(getdate()) --checar eño aqui pues me pidieron que vigile de 2011 para atras
				LEFT JOIN obl_detalle_invitaciones_periodos_morosos  as periodos
				ON pad_oblxest.RFC = periodos.RFC
    			AND pad_oblxest.Numero_Establecimiento = periodos.Numero_Establecimiento
    			--AND pad_oblxest.Anio_Moroso =  periodos.Anio_Moroso		
		WHERE	pad_oblxest.Clave in  ('010610','010618','010623')
				--WHERE	pad_oblxest.Clave in  ('010610')
				--AND pad_oblxest.RFC  in ('AAMZ9001029EA','AULB750709HS0')
				AND pad_oblxest.RFC  in ('AAAB650622C65')
				AND pad_oblxest.Situacion='Activo' 
				AND EST.Situacion='Activo'
				AND  (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,@EjercicioFiscalFinal+'-'+'12'+'-'+'01',20)	
				OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL)
				AND Est.Tipo_Establecimiento ='Matriz' 
				AND EST.Municipio= @Municipio
				AND oco.RFC IS NULL 
				AND periodos.RFC IS NULL) AS T
		GROUP BY RFC, Numero_Establecimiento, Clave,Periodicidad, Fecha_Inicio
		ORDER BY RFC;

--SELECT * 
--FROM @TMP_documentos as  a 
--join  repecos_cf_inscritos_2010 as b
--ON a.RFC=b.RFC and b.Rango between '1' and '10';

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2007 as b
ON a.RFC=b.RFC ;

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2008 as b
ON a.RFC=b.RFC ;

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2009 as b
ON a.RFC=b.RFC ;

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2010 as b
ON a.RFC=b.RFC;

UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2011 as b
ON a.RFC=b.RFC;

--DESCOMENTAR SI QUIEREN REVISAR LOS INSCRITOS HASTA 2012
/*UPDATE @TMP_documentos
set  a.Cuota_ISR= case when a.clave_obligacion='010610'then b.Cuota_ISR end,
a.Cuota_IVA= case when a.clave_obligacion='010618'then b.Cuota_IVA end,
a.Cuota_IETU= case when a.clave_obligacion='010623'then b.Cuota_IETU end,
a.Rango=b.Rango
FROM @TMP_documentos as  a
join  repecos_cf_inscritos_2012 as b
ON a.RFC=b.RFC;*/

 
--quito los que no son inscritos en el rango entre 1-10
delete from @TMP_documentos where rango>'10';



update @TMP_documentos 
set Cuota_ISR= case when clave_obligacion='010610'then 114.00 end,
Cuota_IVA= case when clave_obligacion='010618'then 125.00 end,
Cuota_IETU= case when clave_obligacion='010623'then 117.00 end,
rango='1',
Sin_Rango='S'
where rango='0';


		
--select * from @TMP_documentos WHERE RFC='DIDJ730706K8A' order by rfc--rango, cuota_total;


--INSERT INTO @TMP_documentos
	/*	SELECT  X.RFC,X.Numero_Establecimiento, X.Clave, X.Fecha_Inicio,  
				X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final,max(Y.Fecha_Declarado) as FEcha_declarado
		FROM ( 
		SELECT  RFC,Numero_Establecimiento,Clave_Obligacion as Clave, Periodicidad,
				case when Fecha_Inicio is NULL then '01/01/'+@EjercicioFiscal
					 when Fecha_Inicio='' then '01/01/'+@EjercicioFiscal
					 when (Fecha_Inicio < CONVERT(datetime,@EjercicioFiscal+'-'+'01'+'-'+'01',20))  then '01/01/'+@EjercicioFiscal
					 else Fecha_Inicio end as Fecha_Inicio, situacion
				FROM @TMP_documentos --WHERE RFC='DIDJ730706K8A'
		) as X 
		cross apply  dbo.ftObligacionesPendientesTodos_Por_Periodicidad(X.RFC,X.Numero_Establecimiento,X.Clave,X.Periodicidad, 
		YEAR(X.Fecha_Inicio),MONTH(X.Fecha_Inicio)) as Y
		WHERE X.Situacion in ('Activo') 
		and (X.fecha_inicio is not null) AND (Y.Mes_Inicial IS not NULL )---este mes inicial  es por los que iniciaron despues 
		GROUP BY x.RFC,X.Numero_Establecimiento, X.Clave,  X.Fecha_Inicio,  X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final--,Y.Fecha_Declarado
		ORDER BY X.RFC, X.Numero_Establecimiento, X.Clave,Ejercicio, Mes_Inicial;*/


--actualizar arriba la fecha de inicio como se muestra aqui abajo comentado para que los que no tienen fecha de inicio la tengan
		INSERT INTO @TMP_periodos_morosos
		SELECT  docu.RFC,docu.Numero_Establecimiento,docu.Clave_obligacion,docu.Fecha_Inicio, docu.Periodicidad, 
				b.Ejercicio,b.Mes_Inicial,b.Mes_Final,max(c.Fecha_Declarado) as Fecha_Declarado, 0.0 as Importe, max(docu.Rango) as Rango
		FROM @TMP_documentos as docu
		JOIN pad_obligacionesporestablecimiento as a on  docu.RFC=a.RFC AND docu.Numero_Establecimiento=a.Numero_Establecimiento
		AND docu.Clave_Obligacion=a.Clave
		LEFT JOIN cat_periodos_ejercicio as b on docu.periodicidad=b.Tipo 
		and (b.Ejercicio>YEAR(docu.Fecha_Inicio) or (b.Ejercicio=YEAR(docu.Fecha_Inicio) and (b.Mes_Inicial>=MONTH(docu.Fecha_Inicio))))
		LEFT JOIN obl_obligacion_vigilable_presentada as c 
		on docu.RFC=c.RFC
		AND a.Numero_Establecimiento=c.Numero_Establecimiento
		AND a.Clave=c.Clave_Obligacion  and b.Ejercicio=c.Anio_Inicial 
		AND b.Mes_Inicial=c.Mes_Inicial 
		AND c.Estado='T' 
		AND c.Tipo_Presentacion not in ('Co')
		WHERE docu.Situacion in ('Activo')-- and docu.RFC='DIDJ730706K8A'
		and (docu.fecha_inicio is not null) AND (b.Mes_Inicial IS not NULL )--checar aqui que hay
		--checar aqui como va el group y el order
		GROUP BY docu.RFC,docu.Numero_Establecimiento, docu.Clave_obligacion, docu.fecha_inicio, docu.Periodicidad, b.Ejercicio, b.Mes_Inicial, b.Mes_Final
		ORDER BY docu.RFC,docu.Numero_Establecimiento;
		

--select rfc from @TMP_periodos_morosos where fecha_declarado is null group by rfc having count(*)=1;
--select * from @TMP_documentos where rfc in (select rfc from @TMP_periodos_morosos where fecha_declarado is null group by rfc having count(*)=1);
--select * from @TMP_periodos_morosos where rfc in (select rfc from @TMP_periodos_morosos where fecha_declarado is null group by rfc having count(*)=1);

--
--select rfc,count(*) as total from @TMP_documentos group by rfc ;
--
--quito los solo me deben una obligacion

INSERT INTO @RFCS_DEL
select rfc from @TMP_periodos_morosos where fecha_declarado is null group by rfc having count(*)=1;

DELETE @TMP_documentos
FROM @TMP_documentos as a 
JOIN @RFCS_DEL as b ON a.RFC=b.RFC


DELETE @TMP_periodos_morosos
FROM @TMP_periodos_morosos as a 
JOIN @RFCS_DEL as b ON a.RFC=b.RFC

--where rfc in (select rfc from @TMP_periodos_morosos where fecha_declarado is null group by rfc having count(*)=1);
--delete from @TMP_periodos_morosos where rfc in (select rfc from @TMP_periodos_morosos where fecha_declarado is null group by rfc having count(*)=1);
-- 

update @TMP_periodos_morosos 
set importe= case when a.Clave_Obligacion='010610' then b.Cuota_ISR when a.Clave_Obligacion='010618' then b.Cuota_IVA 
				 when a.Clave_Obligacion='010623' then b.Cuota_IETU END from 
@TMP_periodos_morosos  as a
JOIN @TMP_documentos as b on a.RFC=b.RFC and a.Numero_Establecimiento=b.Numero_Establecimiento 
and a.clave_obligacion=b.clave_obligacion and a.Periodicidad=b.Periodicidad
WHERE a.fecha_declarado is null;



/*
select X.Ejercicio_Fiscal, X.Mes_Inicial,X.RFC 
from (select top 1 Ejercicio_Fiscal, Mes_Inicial,RFC from @TMP_periodos_morosos where fecha_declarado is null) as X
cross apply  dbo.ftCalculaActualizacionesRecargosInvitaciones(X.Ejercicio_Fiscal,X.Mes_Inicial,X.RFC) as Y;
*/
--insert into cumplidos_invitaciones_nueva_nueva_nueva
--select @Municipio as Municipio,@ClaveOficina as Oficina,* from @TMP_periodos_morosos;


declare @tem int
set @tem=@@DATEFIRST
set datefirst 7

select cast(Ejercicio_Fiscal as INT) as Anio,cast((Mes_Inicial) as INT) as Mes,RFC 
from @TMP_periodos_morosos
WHERE fecha_declarado is null;
--

--Determino las cantidades a pagar por importe y actualizacion
SELECT *,	round((Importe*Actualizacion),0,0) as Actualizacion,
			round(((((Importe*Actualizacion)+Importe)*Recargo)/100),0,0) as Recargo,
(			(round(((((Importe*Actualizacion)+Importe)*Recargo)/100),0,0) + (round(((Importe*Actualizacion)+Importe),0,0)))) as Cantidad_a_pagar
FROM @TMP_periodos_morosos as t 
cross apply dbo.ftCalculaActualizacionesRecargosInvitaciones_DAVID(cast(t.Ejercicio_Fiscal as int),
cast(mes_inicial as int),t.rfc)
WHERE t.fecha_declarado is null and t.rfc='AAAB650622C65';




--SELECT * FROM dbo.RegresaRECARGOACTUALIZACION2_Invitaciones(@EjercicioFiscal,1,'AAAB650622C65');


select count(distinct(rfc)) as Total 
from @TMP_periodos_morosos
WHERE fecha_declarado is null;

--es demasiado el tiempo de ejecucion checar
	
            COMMIT 
	 END TRY
  BEGIN CATCH
--     IF @@TRANCOUNT > 0
--		BEGIN
			ROLLBACK 
	 
--   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END


----------------------------------------------------------------------------
## Query para dejar pasar la generacion de multas de incumplimiento de los repecos AUN CUANDO HA PAGADO EL CONTRIBUYENTE SI PAGO DESPUES DE VENCIDO

en notifica_credito_imprimir.php



SELECT  
		min(datos.Nombre_Contribuyente)+' '+min(datos.Apellido_Paterno)+' '+min(datos.Apellido_Materno) as Nombre_Contribuyente,
			min(datos.Domicilio_Ubicacion) as Domicilio_Ubicacion, min(datos.Domicilio_Codigo_Postal) as Domicilio_Codigo_Postal, 
			min(col.Nombre) as Nombre_Colonia,
			min(loc.Nombre) as Nombre_Localidad, min(CONVERT( VARCHAR(10), doc.Fecha_Impresion,20)) as Fecha_Impresion, 
			min(CONVERT( VARCHAR(10), doc.Fecha_Entrega, 20)) as Fecha_Entrega, min(datos.Clave_Obligacion) as Clave_Obligacion,
			min(emision.Anio_Moroso) as Anio_Moroso, 
			min(emision.Municipio) as Municipio,
			min(emision.Oficina) as Oficina,
			min (emision.Numero_Emision) as Numero_Emision,
			min(datos.RFC) as RFC,
			min(datos.Folio_Impresion) as Folio_Impresion,
			min(emision.Ejercicio_Fiscal) as Ejercicio_Fiscal,
			min(emision.Anio_Moroso) as Anio_Moroso,
			min(emision.Periodo_Inicial) as Mes_Inicial ,
			min(emision.Periodo_Final) as Mes_Final,
			min(datos.Nombre_Comercial) as Nombre_Comercial
		FROM obl_datos_federales datos
		JOIN obl_control_emisiones emision
			ON datos.Municipio = emision.Municipio
			AND datos.Oficina = emision.Oficina
			AND datos.Numero_Emision = emision.Numero_Emision
			AND datos.Clave_Obligacion = emision.Clave_Obligacion
		JOIN obl_detalle_documentos doc
		     ON datos.Municipio = doc.Municipio
		     AND datos.Oficina = doc.Oficina
		     AND datos.Numero_Emision = doc.Numero_Emision
		     AND datos.RFC = doc.RFC
		     AND doc.Movimiento = 'R1'
		LEFT JOIN cat_municipios_fed mun
			ON datos.Municipio = mun.Clave_Cat_Mun_Estatal
		LEFT JOIN cat_colonias_fed loc
			ON datos.Localidad_Federal = loc.Clave
			AND loc.Tipo_Asentamiento = '2'
		LEFT JOIN cat_colonias_fed col
			ON datos.Colonia_Federal = col.Clave
			AND col.Tipo_Asentamiento = '1'
		LEFT JOIN obl_obligacion_vigilable_presentada as vig ON doc.RFC=vig.RFC AND emision.Clave_Obligacion =vig.clave_obligacion 
			AND emision.Anio_Moroso = vig.Anio_Inicial 
			AND emision.Periodo_Inicial = vig.Mes_Inicial
			AND emision.Clave_Periodicidad = vig.Tipo_Periodo
		WHERE datos.Folio_Impresion = '133'	AND
			datos.Numero_Emision = '1209'	AND 
			datos.Municipio = '01'
			AND datos.Oficina = '01'
			AND emision.Clave_Obligacion in ('010610','010618','010623')
			AND emision.Anio_Moroso = '2011'
			AND emision.Ejercicio_Fiscal = '2012'
			AND (vig.Tipo_Presentacion not in ('Co') OR vig.Tipo_Presentacion IS NULL OR vig.Tipo_Presentacion='')
			AND (vig.Estado = 'T' or vig.Estado is NULL OR vig.Estado='')
			AND (doc.fecha_vencimiento is not NULL and (doc.fecha_vencimiento<vig.fecha_declarado or vig.fecha_declarado is  NULL))
		group by datos.rfc

---------------------------------------------------------------------------------------------
no_operacion ricardo

 ES LA EMISION 1043 FOLIO 10472 DEL REGIMEN INTERMEDIO ME APARECE COMO PAGO ESPONTANEO SE NOTIFICO EL 14 DE DICIEMBRE DEL 2010POR EL NOTIFICADOR LEONEL RAMIREZ
 De cncun


02020162267802

-----------------------------

nomina
opb 
marzo a la fecha

------------------------------------

Hola lili, buen dia
 Te molesto con otra multa por fa
 te regimen de repeco
 la emision es 1110
 de folio 2285
 este fue notificado el 6 de mayo del 2011
 por ramiro kuman
 y este pago hasta
 el 27 de mayo del 2011
 Es de cancun


---------------------------------------
todos los no loc de un municipio
select  a.municipio as Clave_Municipio,'OTHÓN P. BLANCO' as Municipio,   
a.Numero_Emision, b.Folio_Impresion , a.Fecha_Emision, a.Clave_Obligacion, 'IMPUESTO SOBRE NÓMINA' as Obligacion, 
a.Ejercicio_Fiscal, 'Doble No Localizado' as Estatus, b.Fecha_Impresion, b.Fecha_Asignacion, b.Fecha_No_Localizado, b.Clave_Notificador
from obl_control_emisiones as a 
join obl_detalle_documentos as b on a.numero_emision=b.numero_emision and a.municipio=b.municipio and a.oficina=b.oficina
where clave_obligacion='010103' 
and a.municipio='01' 
and a.oficina='01'
and a.fecha_emision>='20120301' 
and a.clave_periodicidad='02'
and a.ejercicio_fiscal='2012'
and b.status='X'
order by numero_emision, folio_impresion


---------------------
cambio lilyana
500113	1	31/07/2012 12:00:00 a.m.	0110	1	420403	820004			500113	31/07/2012 12:00:00 a.m.
500113	1	31/07/2012 12:00:00 a.m.	0120	1	1635498	820004			500113	31/07/2012 12:00:00 a.m.
500113	1	31/07/2012 12:00:00 a.m.	0130	1	34698	820004			500113	31/07/2012 12:00:00 a.m.
500113	1	31/07/2012 12:00:00 a.m.	0140	1	10998	820004			500113	31/07/2012 12:00:00 a.m.
500113	1	31/07/2012 12:00:00 a.m.	0150	1	111690	820004			500113	31/07/2012 12:00:00 a.m.
500113	1	31/07/2012 12:00:00 a.m.	0160	1	451343	820004			500113	31/07/2012 12:00:00 a.m.
500113	1	31/07/2012 12:00:00 a.m.	0170	1	11917	820004			500113	31/07/2012 12:00:00 a.m.
500113	1	31/07/2012 12:00:00 a.m.	0180	1	27500	820004			500113	31/07/2012 12:00:00 a.m.
500113	1	31/07/2012 12:00:00 a.m.	0190	1	66443	820004			500113	31/07/2012 12:00:00 a.m.
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL



-------------------------------------------------------------------------------------------------
##DOCUMENTOS PARA HACER PRUEBA DE NO LOC EN EL PADRON

05	01	1201	 HMA041125IH9	00	R1	1	X	D
05	01	1201	 IMS080705D62	00	R1	2	E	D

USUARIO IMPRIMIR LIST OBL EST

HINTERIAN - Hnairetni5
DUITZIL - datanael1*
-------------------------------------------------------------------------------------------------

VERIFICAR ESTOS FOLIOS DE PAGO DESMARCADOS POR GENARO 13 AGO 2012
'01080171249539'

90022404609067
01090101219828

--------------------------------------------------------------
actualizar los rfcs que no han cumplido DAVID 

UPDATE obl_obligacion_vigilable_presentada set RFC=right('  '+ltrim(RFC),13)
where 
len(ltrim(RFC))=12 AND Fecha_Declarado	>='20120101' 

UPDATE obl_obligacion_vigilable_presentada 
set RFC=right('  '+rtrim(ltrim(RFC)),13)
where len(ltrim(RFC))=12 AND Fecha_Declarado >='20130101'

*--------------
Matica007
-------------------------------------------------------------
chica playa
1031607Q000564

-----------------------------------------------------------------
para el tema nolocalizados
--actualizo los contribuyentes no localizados
update  pad_contribuyentes 
set Localizable_estatal='N'
where RFC IN(
SELECT distinct(rfc) as rfc
                      --emi.Ejercicio_Fiscal, doc.RFC
FROM         obl_control_emisiones AS emi INNER JOIN
                      obl_detalle_documentos AS doc ON emi.Municipio = doc.Municipio AND emi.Oficina = doc.Oficina AND 
                      emi.Numero_Emision = doc.Numero_Emision
WHERE     emi.Clave_Obligacion in ('010103','010104','010102','010106') AND (doc.Movimiento = 'R1') 
		AND (emi.Ejercicio_Fiscal in ('2012') ) --and emi.periodo_inicial='01' 
		AND (doc.Status = 'X') 
)

--actualizo los que tienen una entrega

update  pad_contribuyentes 
set Localizable_estatal=NULL
where RFC IN(
SELECT distinct(rfc) as rfc
                      --emi.Ejercicio_Fiscal, doc.RFC
FROM         obl_control_emisiones AS emi INNER JOIN
                      obl_detalle_documentos AS doc ON emi.Municipio = doc.Municipio AND emi.Oficina = doc.Oficina AND 
                      emi.Numero_Emision = doc.Numero_Emision
WHERE     emi.Clave_Obligacion in ('010103','010104','010102','010106') AND (doc.Movimiento = 'R1') 
		AND (emi.Ejercicio_Fiscal in ('2012') ) --and emi.periodo_inicial='01' 
		AND Fecha_Entrega IS not null and fecha_vencimiento is not null AND  
RFC in ( select rfc FROM pad_contribuyentes where Localizable_estatal='N')
)
----------------------------------------------------
pic
100MSDCF

---------------------------
solicitud ricardo
SELECT     TOP (200) Municipio, Oficina, Numero_Emision, RFC, CURP, Numero_Serie, Folio_Impresion, Nombre_Contribuyente, Apellido_Paterno, 
                      Apellido_Materno, Localidad, Zona, Localidad_Federal, Colonia_Federal, Domicilio_Calle, Domicilio_Numero, Domicilio_Colonia, Domicilio_Ubicacion, 
                      Domicilio_Codigo_Postal, Ejercicio_Fiscal, Anio_Moroso, Mes_Inicial, Mes_Final, Pagado, Clave_Obligacion, Clave_Periodicidad, Numero_Control, 
                      Folio_Facturacion, Numero_Operacion, Nombre_Comercial
FROM         dbo.obl_datos_federales
WHERE     (Numero_Emision = '1128') AND (Folio_Impresion = 6712) OR
                      (Numero_Emision = '1145') AND (Folio_Impresion = 11952)
----------------------------------------------------

cambio de direccion de una licencia de bebidas alcoholicas aprobada 
checar con el numero de liciencia en el padron y obtener el numero de solicitud 
ir a pad_patentes y buscar por el numero de licencia checar los campos sma mza lte y domicilio_establecimiento que sean iguales
en la tabla pad_socilicitudes en los mismos campos el quer reina es el padron
--9115 3148 01  016  005  AV. HIDALGO N° 026 INTERIOR LOCALES 26,27 Y 28   SMA:01 MZA:19 LOTE:4 AV. HIDALGO No. 26 CENTRO

--9116 3147 01  18   16  AV. HIDALGO N° 27 
--9117 3146 01  19  4  AV. HIDALGO N° 24 
--9118 3144 08  62  01  AV PERIMETRAL PONIENTE N°84 CARRETERA AL GARRAFON 
--9119 3143      CENTRO 
--9120 3142      CENTRO 
.
-------------------------------------------------------------------------------

store que me devuelve los periodos  morosos  de las obligaciones de un contribuyente
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_determina_morosidad]
		@Anio_Inicial = N'2007',
		--@Anio_Final = N'2011',
		@RFC = N'MONJ5206236J6'

SELECT	'Return Value' = @return_value

GO

--CAMG840831A52 ILEPAL DESPUES 2012
--EAGR660921PS3 ILEPAL ANTES 2012
--AIBJ6612273E5 ilepal inicia en 2008 sin fecha de inicio
-- ILEPAL Y NOMINA

--SELECT * FROM pad_obligacionesporestablecimiento WHERE RFC='MONJ5206236J6'


--cuerpo del procedimiento


USE [ingresos]
GO
/****** Objeto:  StoredProcedure [dbo].[pa_determina_morosidad]    Fecha de la secuencia de comandos: 09/21/2012 11:01:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[pa_determina_morosidad]
	-- Add the parameters for the stored procedure here
		
		--@Anio_Inicial varchar(4),
		--@Anio_Final varchar(4),
		@RFC varchar(13)
		
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.

SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
SET CONCAT_NULL_YIELDS_NULL ON
SET ANSI_PADDING ON
SET ANSI_WARNINGS ON
SET NOCOUNT ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        --BEGIN TRANSACTION
		Declare @Anio_Inicial varchar(4);
		
		set @Anio_Inicial=year(getdate())-5;
		
			
		DECLARE @SERIES TABLE
		(		SERIE VARCHAR(30)COLLATE SQL_Latin1_General_CP1_CI_AS
				
		);

/*X.RFC,X., X.Clave, max(X.Fecha_Inicio) as Fecha_Inicio,
			X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final,max(Y.Fecha_Declarado) as FEcha_declarado, 
			MAX(y.No_Operacion ) AS No_Operacion*/

		DECLARE @DATOS_CONT TABLE
		(		MPO_CON VARCHAR(2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				MPO_EST VARCHAR(2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				REC VARCHAR(25)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Establecimiento VARCHAR(5)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				CLAVE VARCHAR(6)COLLATE SQL_Latin1_General_CP1_CI_AS,
				Ejercicio VARCHAR(4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Fecha_Inicio DATETIME, 
				FEC_BAJ DATETIME, 
				FEC_SUS DATETIME, 
				SIT_CON VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				PATENT VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS,
				VIG VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				AUT_CONT VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				VIG_CE VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Periodicidad VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Fecha_Inicio_Nueva DATETIME,
				Situacion VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS
			);




	DECLARE @PERIODOS_MOROSOS TABLE
		(		RFC VARCHAR(13)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				NUMERO_ESTABLECIMIENTO VARCHAR(6)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				CLAVE VARCHAR(6)COLLATE SQL_Latin1_General_CP1_CI_AS,
				FECHA_INICIO DATETIME, 
				PERIODICIDAD  VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS,  
				EJERCICIO VARCHAR(4)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				MES_INICIAL VARCHAR(2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				MES_FINAL VARCHAR(2)COLLATE SQL_Latin1_General_CP1_CI_AS, 
				FECHA_DECLARADO DATETIME, 
				NO_OPERACION VARCHAR(50)COLLATE SQL_Latin1_General_CP1_CI_AS
			);
--bimestral ilepal
INSERT INTO @DATOS_CONT
			SELECT 
					a.municipio as municipioContribuyente,
					substring(Numero_Establecimiento,1,2) as MunicipioEsta,
					c.*,
					D.periodicidad,
					CASE 
					WHEN c.Fecha_Inicio>='01/01/2012' THEN c.Fecha_Inicio
					WHEN c.Fecha_Inicio IS NULL  THEN '01/01/2012'
					ELSE c.fecha_inicio END as Fecha_Inicio_Nueva,
					a.Situacion
			  FROM  pad_contribuyentes as a
					inner JOIN pad_establecimientos as b ON a.rfc=b.rfc 
					inner join pad_obligacionesporestablecimiento as c ON b.RFC=c.rfc AND b.Numero =c.Numero_Establecimiento 
					INNER JOIN obl_cat_obligaciones as d ON c.Clave=d.Clave_Obligacion  and d.Ejercicio =year(getdate()) 
			  WHERE a.rfc in (@RFC) and --a.rfc in (' CVV910525F56','JISD781011U4A',' ACS990428R48') 
					c.Clave IN('010102') --agregar el resto de obligaciones
					AND a.Situacion='Activo' AND b.Situacion='Activo' 
					AND c.Situacion='Activo' AND d.Periodicidad='03' and (c.Fecha_Inicio>='01/01/2012');





--Anual ilepal pues a hasta 2012 era anual
INSERT INTO @DATOS_CONT
SELECT 
					a.municipio as municipioContribuyente,
					substring(Numero_Establecimiento,1,2) as MunicipioEsta,
					c.*,
					D.periodicidad,
					CASE 
					WHEN c.Fecha_Inicio<'01/01/2012' AND d.Periodicidad='03' THEN '01/01/2012'--checar aqui
					WHEN c.Fecha_Inicio<'01/01/'+@Anio_Inicial AND d.Periodicidad='07' THEN '01/01/'+@Anio_Inicial
					WHEN c.Fecha_Inicio IS NULL   AND d.Periodicidad='03' THEN '01/01/2012'
					WHEN c.Fecha_Inicio IS NULL  AND d.Periodicidad='07' THEN '01/01/'+@Anio_Inicial
					ELSE c.fecha_inicio END as Fecha_Inicio_Nueva,
					a.Situacion 
			  FROM  pad_contribuyentes as a
					inner JOIN pad_establecimientos as b ON a.rfc=b.rfc 
					inner join pad_obligacionesporestablecimiento as c ON b.RFC=c.rfc AND b.Numero =c.Numero_Establecimiento 
					INNER JOIN obl_cat_obligaciones as d ON c.Clave=d.Clave_Obligacion  and d.Ejercicio =year(getdate())
			  WHERE a.rfc in (@RFC) and --a.rfc in (' CVV910525F56','JISD781011U4A',' ACS990428R48') 
					c.Clave IN('010102') --agregar el resto de obligaciones
					AND a.Situacion='Activo' AND b.Situacion='Activo' 
					AND c.Situacion='Activo'AND (c.Fecha_Inicio<'01/01/2012' OR c.Fecha_Inicio IS NULL );



	INSERT INTO @DATOS_CONT
	SELECT 
					a.municipio as municipioContribuyente,
					substring(Numero_Establecimiento,1,2) as MunicipioEsta,
					c.*,
					d.Periodicidad,
					CASE 
					WHEN c.Fecha_Inicio<'01/01/'+@Anio_Inicial THEN '01/01/'+@Anio_Inicial  
					WHEN c.Fecha_Inicio IS NULL  THEN '01/01/'+@Anio_Inicial  
					ELSE c.fecha_inicio END as Fecha_Inicio_Nueva,
					a.Situacion
			  FROM  pad_contribuyentes as a
					inner JOIN pad_establecimientos as b ON a.rfc=b.rfc 
					inner join pad_obligacionesporestablecimiento as c ON b.RFC=c.rfc AND b.Numero =c.Numero_Establecimiento 
					INNER JOIN obl_cat_obligaciones as d ON c.Clave=d.Clave_Obligacion  and d.Ejercicio =year(getdate())
			  WHERE a.rfc in (@RFC) and --
					--a.rfc in (' CVV910525F56','JISD781011U4A',' ACS990428R48')  and
					c.Clave IN('010103','010104','010106','010610','010611','010618','010622','010623') --agregar el resto de obligaciones
					AND a.Situacion='Activo' AND b.Situacion='Activo' AND c.Situacion='Activo';

--select *  from @DATOS_CONT;

			INSERT INTO @PERIODOS_MOROSOS
			SELECT *
			FROM (
					SELECT		X.RFC,X.Numero_Establecimiento, X.Clave, max(X.Fecha_Inicio) as Fecha_Inicio,
								X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final,max(Y.Fecha_Declarado) as Fecha_declarado, 
								MAX(y.No_Operacion ) AS No_Operacion
					FROM 	@DATOS_CONT	 as X 
					CROSS APPLY  dbo.ftObligacionesPendientesTodos(X.RFC,X.Numero_Establecimiento,X.Clave,X.Periodicidad,
																  YEAR(X.Fecha_Inicio_nueva),MONTH(X.Fecha_Inicio_nueva)) as y
					WHERE X.Situacion in ('Activo') 
							AND (X.fecha_inicio_nueva IS NOT NULL) 
							AND (Y.Mes_Inicial IS NOT NULL )---este mes inicial  es por los que iniciaron despues 
							GROUP BY x.RFC,X.Numero_Establecimiento, X.Clave,  X.Fecha_Inicio_Nueva,X.Periodicidad, Y.Ejercicio,Y.Mes_Inicial, Y.Mes_Final--,Y.Fecha_Declarado
					) AS Y
			WHERE No_Operacion is null
			ORDER BY RFC, Numero_Establecimiento, Clave,periodicidad,Ejercicio;

		--ELIMINO LOS MESES MOROSOS DE ILEPAL DE 2012 EN ADELANTE PUES YA NO HAY DECLARACION ANUAL DE ILEPAL
		DELETE FROM @PERIODOS_MOROSOS WHERE CLAVE='010102' AND periodicidad='07' AND EJERCICIO>='2012';


		SELECT a.RFC, a.Numero_Establecimiento, b.Descripcion as Obligacion, c.Descripcion_Tipo_Periodo  as Periodicidad, 
			   c.Descripcion as Periodo_Moroso, a.Ejercicio
		FROM @PERIODOS_MOROSOS as a
		JOIN cat_obligaciones as b on a.Clave=b.Clave 
		JOIN cat_periodos as c ON a.Periodicidad=c.Tipo and a.Mes_Inicial =c.Mes_Inicial and a.Mes_Final=c.Mes_Final ;

          --  COMMIT 
	 END TRY
  BEGIN CATCH
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END










-----------------------------------------

--Con este query se crea el pivote para saber quienes tienen la obligacion licencias de funcionamiento de norberto
select a.rfc 
into cont_con_licfuncionamiento
from pad_obligacionesporestablecimiento  as a
inner JOIN pad_establecimientos as b ON a.rfc=b.rfc AND a.Numero_Establecimiento=b.Numero
INNER JOIN pad_contribuyentes as c on b.RFC=c.rfc
where Clave='010208' and a.Situacion='Activo' and b.Situacion='Activo' and c.Situacion='Activo'
GROUP BY a.rfc




--Se crea la tabla con todas las obligaciones para armar los datos del contribuyente en base a las licencias de funcionamiento de norberto

select c.municipio as municipioContribuyente,substring(Numero_Establecimiento,1,2) as MunicipioEsta,b.*,
CASE Clave
when '010103' then '02' 
when '010104' then '02' 
when '010106' then '02'
when '010610' then '03'  
when '010611' then '02'
when '010618' then '03'
when '010622' then '02'
when '010623' then '03'
when '010102' then '03'     
END as Periodicidad,
case 
when Fecha_Inicio<'01/01/2008' then '01/01/2008' 
when Fecha_Inicio IS NULL  then '01/01/2008' 
else fecha_inicio end as Fecha_Inicio_Nueva
into temp_cont_con_licfuncionamiento
from cont_con_licfuncionamiento as a 
inner join pad_obligacionesporestablecimiento as b ON a.rfc=b.rfc
inner JOIN pad_contribuyentes as c on a.rfc=c.rfc
where b.Situacion='Activo' and Clave NOT IN('010208','010206','010603','010105','010107')

-------------------------------------------------------------------------------------
checar esto de gerardo
select * from
FROM         dbo.obl_detalle_documentos
WHERE     (Folio_Impresion = 363) AND (Numero_Emision = '1236') AND (Municipio = '02')

SELECT     TOP (200) RFC, Numero_Serie, REC, Numero_Establecimiento, Clave_Obligacion, Anio_Inicial, Mes_Inicial, Fecha_Inicial, Anio_Final, Mes_Final, 
                      Fecha_Final, Fecha_Declarado, No_Operacion, Tipo_Periodo, Estado, Tipo_Presentacion, Ejercicio_Fiscal, Fuente_Informacion, Municipio, 
                      Oficina
FROM         dbo.obl_obligacion_vigilable_presentada
WHERE     (No_Operacion = '03020120206398')
-------------------------------------------

checar la tabla vig_morosos_estatales_2007_2011 para el reporte de morosos
-----------------------------------------------------------------------------------
dejar siempre seleccionado un checkbox

  echo "<tr>";//el onclick=this.checked=true; es para dejar siempre seleccionado
              echo "<td align='right'colspan='1'><input type='checkbox'  name='Movimiento[]' value='".$Movimientos['Movimiento']."' checked onclick=this.checked=true; ></td>";
---------------------
reporte morosos
[pa_coDetermina_Morosidad_RFC]


----------------------------------
falla ilepal
ERARDO dice:
 Hola Lili, buenas tardes, me estan reportando de la recauadadora de benito juarez que los pagos de lepal que se hacen en bancos de alguna manera no se reflejan en conrol de obligaciones como pagado, y esto ocasiona que los contribuyentes salgan requeridos...por otra parte tambien en el caso de contribuyentes que pagan antes de que les entreguen algun requerimiento, no se refleja como pago espontae
Lili dice:
 buenas tardes
 por favor que te pasen algunos casos
 para checarlo
GERARDO dice:
 por ejemplo la emision 1241 folio 945
Lili dice:
   lo checo y te comento
GERARDO dice:
 mas detalles, me dicen que esto ocurrio en el ultimo bimestre, en los anteriores  no hubo problemas, me dicen la maroria de la emision 1241 habian cumpplido a tiempo, y lo han estado solventando manualmente
Lili dice:
   
 lo checo
 el ejemplo que me pasas es un pago espontaneo
 que no se marco
 tienes algun requerido
 de ejemplo de los que no eran morosos 
GERARDO dice:
 un ejemplo: el folio 892 de la emison 1241
Lili dice:
 este caso si era moroso
 se le requirio el 21 de sep y se declarp el 24 de sep 
GERARDO dice:
 es que el procedimiento es segun me comentaron, se imprimio el requerimiento, pero en lo que lo firmaban etc, pasaron los dias entonces el contribuyente pago sin que antes haya recido el requerimiento, entonces el pago fue espontaneo
 pero aun asi el sistema nunca cambio de status, me dicen que antes en todos los casos mientras no se le entregue el requerimiento, y se pague el sistema marca como pago espontaneo
Lili dice:
   si lo   a revisar
 pero al inicio me comentabas
 que salieron requeridos 
 quienes ya habian pagado
 te checo porque no se marcan como espontaneos
 y te confirmo cuando quede
GERARDO dice:
 si, inclive unos de bancos
Lili dice:
 el primero era de bancos
 lo checo
GERARDO dice:
 ok

-----------------------
contribuyente que no debe nada GOMB651104MQ8 para la prueba de validar si puede o no tener licencia de funcionamiento en linea
-----------------------------------------------
elimina el borde creando una tabla que le aplico el borde desde una clase padre
style="border-bottom:none; border-left:none; border-top:none; border-right:none; border-collapse:collapse;"
-------------------------------------------------------------------
solicitud gerardo

select * from obl_detalle_documentos 
where folio_impresion in ('968','971','991','1009','1016','1031','1036','1043','1047','1051','1102','1110','1138','1139') 
and Numero_Emision='1241' and Movimiento='R1' and Status='T'

select * from obl_detalle_sucursales 
where folio_impresion in ('876','879','894','947','1055','1058','1068','1071','1093','1123') 
and Numero_Emision='1241' 

-------------------------------------------

pentoxixilina
difenidol 
-------------
store para devolver una referencia
David Aguilar dice:
 USE [ingresos]
GO

DECLARE	@return_value int,
		@referencia varchar(17),
		@folioC varchar 

EXEC	@return_value = [dbo].[pa_Tributanet_regresaFolioReferencia]
		@tipo = N'73',
		@anio = 2012,
		@fecha_vigencia = N'20121024',
		@mun = N'01',
		@importe = 100,
		@referencia = @referencia OUTPUT,
		@folioC = @folioC OUTPUT

SELECT	@referencia as N'@referencia',
		@folioC as N'@folioC'

SELECT	'Return'
-----------------------------------------------------------

reimprimir una multa en la pantalla de multas

-------------------------------------------------------------
decompone_fecha_juliana para saber la fecha de vencimiento de una referencia

--------------------------------------------------------------
###para hacer una actualizacion y guardar la fecha de un varchar convertirlo a datetime y guarda la fecha en año mes dia RAMON
 $upd_actualiza_referencia="update obl_detalle_documentos_actas_inspeccion set referencia='$referencia',fecha_vencimiento_referencia=convert(datetime,'$referencia_fecha_vencimiento',20) where Id = '$id_mov'  ";
--------------------------------------------------------------------
### 
--query de jorge baroudi que me crea con un pivote los que tienen un campo que cae en ene, feb, marz etc ES DECIR SI EL CAMPO ES ALGO ME PONE 1
## STUFF REEMPLAZA UNA CADENA DENTRO DE OTRA DONDE YO LE INDIQUE LA POSICION COMIENZA EL REEMPLAZO RAMON
SELECT RFC,	Numero_Establecimiento	,Obligacion	,Periodicidad , stuff(COALESCE(', '+ENE, '')+COALESCE(', '+FEB, '')+
																	  COALESCE(', '+MAR, '')+COALESCE(', '+ABR, '')+ 
																	  COALESCE(', '+MAY, '')+COALESCE(', '+JUN, '')+
																	  COALESCE(', '+JUL, '')+COALESCE(', '+AGO, '')+
																	  COALESCE(', '+SEP, '')+COALESCE(', '+OCT, '')+ 
																	  COALESCE( ','+NOV, '')+COALESCE(', '+DIC ,'')+
																	  COALESCE( ','+ENEFEB, '')+COALESCE(', '+MARABR ,'')+
																	  COALESCE( ','+MAYJUN, '')+COALESCE(', '+JULAGO ,'')+
																	  COALESCE( ','+SEPOCT, '')+COALESCE(', '+NOVDIC ,'')+
																	  COALESCE(', '+ANUAL , ''),1,1,'') AS PERIODOS_MOROSOS, Ejercicio 
FROM(
	SELECT RFC,	Numero_Establecimiento	,Obligacion	,Periodicidad ,
	Ejercicio, case when (ENE=1) then 'ENE' end as ENE, 
				case when (FEB=1) THEN 'FEB'end as FEB,
				case when (MAR=1) THEN 'MAR'end as  MAR,
				case when (ABR=1) THEN 'ABR'end as  ABR, 
				case when (MAY=1) THEN 'MAY'end as  MAY, 
				case when (JUN=1) THEN 'JUN'end as  JUN, 
				case when (JUL=1) THEN 'JUL'end as  JUL,
				case when (AGO=1) THEN 'AGO'end as  AGO,
				case when (SEP=1) THEN 'SEP'end as  SEP,
				case when (OCT=1) THEN 'OCT'end as  OCT,
				case when (NOV=1) THEN 'NOV'end as  NOV,
				case when (DIC=1) THEN 'DIC'end as  DIC,
				case when ([ENE-FEB]=1) THEN 'ENE-FEB'end as  ENEFEB,
				case when ([MAR-ABR]=1) THEN 'MAR-ABR'end as  MARABR,
				case when ([MAY-JUN]=1) THEN 'MAY-JUN'end as  MAYJUN,
				case when ([JUL-AGO]=1) THEN 'JUL-AGO'end as  JULAGO,
				case when ([SEP-OCT]=1) THEN 'SEP-OCT'end as  SEPOCT,
				case when ([NOV-DIC]=1) THEN 'NOV-DIC'end as  NOVDIC,
				case when ([ENE-DIC]=1) THEN 'ANUAL'end as  ANUAL
	FROM (
		select a.RFC, a.Numero_Establecimiento, b.Descripcion as Obligacion, 
			c.Descripcion_Tipo_Periodo  as Periodicidad, c.Descripcion as Periodo_Moroso, a.Ejercicio, 1 as Conteo
		from @PERIODOS_MOROSOS as a
		JOIN cat_obligaciones as b on a.Clave=b.Clave 
		JOIN cat_periodos as c ON a.Periodicidad=c.Tipo and a.Mes_Inicial =c.Mes_Inicial and a.Mes_Final=c.Mes_Final 
	) AS periodosMorosos
	PIVOT (
		COUNT(Conteo) FOR periodo_moroso in (ENE, FEB, MAR, ABR,MAY,JUN, JUL, AGO, SEP, OCT, NOV, DIC, 
											[ENE-DIC],
											[ENE-FEB],[MAR-ABR],[MAY-JUN],[JUL-AGO],[SEP-OCT],[NOV-DIC]) 
	) pvt) AS T


-----------------------------------------------------------------------------
### DEVUELVO UN CAMPO CAMPO LA CONCATENACION DE VARIAS COLUMNAS EN UNA SOLA LA CONCATENACION DEL MISMO RAMON

SELECT G.RFC, G.Numero_Establecimiento,
STUFF( (SELECT ', ' + c.Descripcion
  FROM @PERIODOS_MOROSOS as a
		JOIN cat_obligaciones as b on a.Clave=b.Clave 
		JOIN cat_periodos as c ON a.Periodicidad=c.Tipo and a.Mes_Inicial =c.Mes_Inicial and a.Mes_Final=c.Mes_Final            
	WHERE a.RFC=G.RFC and a.Numero_Establecimiento=G.Numero_Establecimiento and a.Clave=G.Clave and a.Ejercicio=G.Ejercicio AND a.Periodicidad=G.Periodicidad
  ORDER BY c.Mes_Inicial
  FOR XML PATH('') ), 1, 1, '') AS Periodos_Morosos,
min(b.Descripcion) as Obligacion, c.Descripcion_Tipo_Periodo,G.Ejercicio
FROM @PERIODOS_MOROSOS AS G
JOIN cat_obligaciones as b on G.Clave=b.Clave 
JOIN cat_periodos as c ON G.Periodicidad=c.Tipo and G.Mes_Inicial =c.Mes_Inicial and G.Mes_Final=c.Mes_Final      
GROUP BY G.RFC, G.Numero_Establecimiento, G.Clave, G.Periodicidad, c.Descripcion_Tipo_Periodo,G.Ejercicio
-----------------------------------------------------------------------------------
COALESCE SI UN CAMPO ES NULL O NULO PONE ALGO SI NO PONE OTRA COSA DE IGUAL MANERA SE PUEDE USAR ISNULL ES EXACTAMENTE LA MISMA SINTAXIS
select a.RFC, a.Numero_Establecimiento, b.Descripcion as Obligacion, 
			c.Descripcion_Tipo_Periodo  as Periodicidad, c.Descripcion as Periodo_Moroso, a.Ejercicio, 
			@Names = COALESCE(@Names + ', ', '') + a.Periodo_Moroso
		from @PERIODOS_MOROSOS as a
		JOIN cat_obligaciones as b on a.Clave=b.Clave 
		JOIN cat_periodos as c ON a.Periodicidad=c.Tipo and a.Mes_Inicial =c.Mes_Inicial and a.Mes_Final=c.Mes_Final
---------------------------------------------------------------------------
determina morosidad
[paCo_Determina_Morosidad_padron_CPY]

-------------------------------------------------------------------------------------
VERIFICAR LAS CAJAS QUE SE ENCUENTRAN ABIERTAS Y CERRADAS RAMON recaudoras cierre


select * from cob_bitacora where Fecha_Apertura >='20121128'

LAS QUE SEAN IGUALES A 1 NO HAN CERRADO el numero de filas es el resto de cajas abiertas
select municipio, oficina, caja, min(transaccion), max(Transaccion) 
from cob_tira_auditora where Fecha  >='20121128'
group by Municipio, Oficina,caja 
having min(transaccion)= max(Transaccion) 

AQUI ESTAN LOS CAJEROS
select * from est_cat_cajas  
--------------------------------
claudia jazmin soli

-----------------------------
CAPA
Disculpe, la operación no se ha podido completarPago de Servicios  
Causa: VERIFICAR EN MOVTOS. DEL DIA SI LA OPERACION FUE REALIZADA 


Empresa: CAPA QROO BANCANET, COMISION DE AGUA POTABLE Y ALCANTARILLADO DEL EDO DE QR 


¿Qué puedo hacer?
Si deseas comunícate a servicio a clientes al 1226 3990 (D.F y Área Metropolitana) ó al
01 800 110 3990 (Del interior de la República).

Es importante tener a la mano el siguiente código: 0001 0701 010 4080 0001 


0001 0701 010 4080 0001 

------------------------------------------------------------------------------

--ejecuta el listado de la vigilancia de contribuyentes en base a un listados de rfcs cargado en la tabla rfcs_noloc morosos norberto

--llenar la tabla ingresos.dbo.RFCNoLoc

USE [ingresos]
GO
DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY]

SELECT	'Return Value' = @return_value
GO

--trae los contribuyentes que no tienen obligaciones vigilables
 select municipiocontribuyente, municipioesta, rfc, numero_establecimiento, 
 max(localizable_estatal) as localizable_estatal,'No' Obligacion_Vigilable
 from temp_cont_con_licfuncionamiento_nov2012 
 where rfc in (select (rfc )
from RFCNoLoc
where rfc  not in (
SELECT  distinct(RFC)
FROM RES_VIG_MOROSIDAD_LIC)) 
and clave='010208' --and rfc=' ORS040601PA2'
group by municipiocontribuyente, municipioesta, rfc, numero_establecimiento
order by rfc

--el listado  de la vigilancia de los contribuyentes que si tienen obl vigilables
select a.*, b.Localizable_Estatal  from (
SELECT  min(municipio) as Municipio,  RFC,count(*) as Periodos,
SUM(CASE WHEN No_Operacion IS NOT NULL  THEN 1 ELSE 0 END) AS Cumplidos, 
SUM(CASE WHEN No_Operacion IS NULL THEN 1 ELSE 0 END) AS Debe,
min(fecha_inicio) as Fecha_Inicio
FROM RES_VIG_MOROSIDAD_LIC
--where clave='010610' 
GROUP BY municipio,municipio_estab,rfc 
--having SUM(CASE WHEN No_Operacion IS NULL THEN 1 ELSE 0 END)=0
) as a 
join pad_contribuyentes as b on a.rfc=b.rfc
order by a.municipio,a.rfc
--------------------------------------------------------------------

bebal 7 de enero

select distinct(movimiento) from obl_detalle_federales

kilos

select *
from bebal.dbo.cumplidos_actualizacion_diaria_2013  
where  aplicado='N'

--actualizo los que tienen requerimientos pendientes
update  bebal.dbo.cumplidos_actualizacion_diaria_2013  
set requerimientos='S'
where rfc in (
select distinct(a.RFC)
from bebal.dbo.cumplidos_actualizacion_diaria_2013  as a
join obl_detalle_documentos  as b ON a.RFC=b.RFC 
where  --Status in ('E','V','N','X','C') and Movimiento like 'R%'
Status in ('E','V','C') and Movimiento like 'R%'
and Numero_Emision>=0801)

--actualizo los que tienen multas pendientes
update  bebal.dbo.cumplidos_actualizacion_diaria_2013  
set multas='S'
where rfc in (
select distinct(a.RFC)
from bebal.dbo.cumplidos_actualizacion_diaria_2013  as a
join obl_detalle_documentos  as b ON a.RFC=b.RFC 
where  Status in ('E','V','N','X','C') and (Movimiento like ('M%') or Movimiento like ('I%'))
--Status in ('E','V','C') and Movimiento like 'R%'
and Numero_Emision>=0801)




select * from bebal.dbo.cumplidos_actualizacion_diaria_2013   
where Candidato='S' and Debe=0 and requerimientos is null 
and multas is null


select * from bebal.dbo.cumplidos_actualizacion_diaria_2013   
where  Candidato='S' and 
Debe=0 and requerimientos='S'
and multas='S'


select * from obl_nombres_estatus 



select * fro
____________________________________________________________________

incump repecos 550
incum intermedios
incump ieps
me repecos
me sirref
incum sirref

checar actos notificador de las multas para requerimientos no aplica
poner un mes mas para la vigilancia hasta el 22
poner solo federales y estatales en situacion del contribuyente
checar el cambio de año para los morosos  en el catalogo de periodos
preguntar genaro navarro sobre registro de documentos sirref




------------------------------------------------------------
## QUERY GENERAR REFERENCIAS
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Determina_Referencia_Actas_Inspeccion]
		@Id = '142',
		@Multa=1477,
		@Honorarios=236

SELECT	'Return Value' = @return_value

GO

---------------------------------------------------------------------------
## query que devuelve el reporte de reyes emisiones de morosos de octubre 2012, agradeceré nos hagan 
el favor de proporcionarnos el informe correspondiente al mes de Noviembre 12 por los impuestos al Hospedaje y sobre Nomina.

SELECT --*
		b. Municipio,
		b.Oficina,
		a.Numero_Emision,
		b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
               min(b.Fecha_Emision) as Fecha_Emision,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Status='F') THEN 1 ELSE 0 END) AS Cancelado_Por_Autoridad,
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Notificados
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               where a.Movimiento='R1' and 
			   b.Clave_Obligacion='010102' and 
			   b.Anio_Moroso='2012' and 
			   b.periodo_inicial='09' --and
			   --b.Periodo_Final ='10'
			   --and a.Municipio='01'
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision ,c.Descripcion 

este me dice todas las emisiones de obligaciones estatales de todo el año 2012 de todas las recaudadoras reyes gerardo
SELECT --*
		min(d.Nombre) as Municipio ,
		a.Numero_Emision,
		b.Clave_Obligacion as Clave_Obligacion,
               min(c.Descripcion) as Obligacion,
               min(b.Dirigida) as Dirigida,
               b.Periodo_Inicial,
               b.Periodo_Final,
               b.anio_moroso,
               min(b.Fecha_Emision) as Fecha_Emision,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Status='F') THEN 1 ELSE 0 END) AS Cancelado_Por_Autoridad,
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Notificados,
	       SUM(CASE WHEN a.Status in ('N','X')  THEN 1 ELSE 0 END) AS No_Localizados,
               clave_periodicidad
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               join cat_municipios as d on b.Municipio=d.Clave  
               where a.Movimiento='R1' and 
			  -- b.Clave_Obligacion='010102' and 
			   b.Anio_Moroso in ('2012','2013') --and 
			  -- b.periodo_inicial='01' --and
			   --b.Periodo_Final ='10'
			   --and a.Municipio='01'
			   --and b.Numero_Emision ='1134'
			   and Clave_Obligacion in ('010103','010104','010102','010106')
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision,b.Anio_Moroso,
                b.Periodo_Inicial,b.Periodo_Final, Clave_Periodicidad  
               order by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision


##este procedimiento almacenado es lo mismo solo hay que enviarle los parametros
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_co_informe_emisiones_estatales]
		@Ejercicio = N'2013',
		@Mes_Inicial =1,
		@Mes_Final = 8,
		@Tipo_Periodo = 2,
		@Clave_Obligacion_Est = N'010104'

SELECT	'Return Value' = @return_value

GO



----este es el reporte que le envie al lic. mario en su reunion con recaudadores

SELECT --*
		min(d.Nombre) as Municipio ,
		a.Numero_Emision,
		b.Clave_Obligacion as Clave_Obligacion,
               min(c.Descripcion) as Obligacion,
               'Mensual' as periodicidad,
               min(b.Dirigida) as Dirigida,
               b.Periodo_Inicial as Mes_Inicial,
               b.anio_moroso,
               min(b.Fecha_Emision) as Fecha_Emision,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN a.Status in ('A','D')  THEN 1 ELSE 0 END) AS Pendientes,
               SUM(CASE WHEN (a.Status='F') THEN 1 ELSE 0 END) AS Cancelado_Por_Autoridad,
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Notificados,
	       SUM(CASE WHEN a.Status in ('N','X')  THEN 1 ELSE 0 END) AS No_Localizados_y_Doble_No_localizados,
	       
	       SUM(CASE WHEN a.Status in ('T')  THEN 1 ELSE 0 END) AS Pago_Espontaneo,
	       SUM(CASE WHEN a.Status in ('P')  THEN 1 ELSE 0 END) AS Pagados
	       
               
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               join cat_municipios as d on b.Municipio=d.Clave  
               where a.Movimiento='R1' and 
			   year(b.Fecha_Emision ) in ('2013') --and 
			   and a.Municipio='02'
			   and Clave_Obligacion in ('010103')
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision,b.Anio_Moroso,
                b.Periodo_Inicial,b.Periodo_Final, Clave_Periodicidad  
               order by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision

----------------------------------------------------------------
## este procedimiento almacenado me genera los pagos y adeudos de todos los contribuyentes estatales y federales morosos por obligacion
##checar el archivo determinar morosos estatales y federales

USE [ingresos]
GO
DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY]

SELECT	'Return Value' = @return_value
GO
---------------------------------------------------------------------------

procedimientos almacenados para dispositivo
cambios en formato de actas de inspeccion
estado de cuenta del contribuyente
reportes de emisiones nuevos


-*------------------------------------------------------------------------

revisar [paPadron_Generar_Licencia] para armar el update mio


---------------------------------------------

ejecuta el procedimiento para registrar la entrega de documentos
USE [ingresos]
GO
DECLARE @return_value int
EXEC @return_value = [dbo].[paPadron_App_Registra_Entrega]
  @Usuario = N'duitzil',
  --@Municipio = N'05',
  --@Oficina = N'01',
  @RFC = N'CAAC4605207Y5',
  @Movimiento = N'R1',
  @Numero_Emision = N'0721',
  @Folio_Impresion = N'121',
  @Estatus = N'E',
  @Fecha_Movimiento = N''
SELECT 'Return Value' = @return_value
GO



---------------------------------
cambiar a co
este numero de establecimiento=03020137192848
-------------------------------------------
este es el que determina la fecha de vencimiento el sigueinte dia habil
declare @tem int
set @tem=@@DATEFIRST
set datefirst 7

         --set @actual=convert(datetime,@fecha_Actual)

           set @fecha_vencimiento=([dbo].[SiguienteHabil](@fecha_vencimiento,@diasextras))


set datefirst @tem

select   @fecha_vencimiento as Fecha

-------------------------------------
ESTE DETERMINA LA FECHA DEL SIGUIENTE DIA HABIL

--Determino  la fecha de vencimiento
	declare @tem int
	set @tem=@@DATEFIRST
	set datefirst 7;
    set @actual=convert(datetime,@Fecha_Movimiento)
	set @Fecha_Vencimiento=([dbo].[SiguienteHabil](@Actual,@Incremento))
	set datefirst @tem

	select   @Fecha_Vencimiento as Fecha


------------------------------------------------------
CHECAR ESTE NUMERO DE OPERACION PARA CARLINE DE ISLA
 No_Operacion='01040109091304'

-------------------------------------------------------------------
este procedimiento sera invocado cada vez que quieran actualizar un estatus del documento
@Usuario = N'duitzil',       usuario logeado
  @RFC = N'OOCV730226GX5',   rfc del documento pendiente de notificar
  @Movimiento = N'R1',       tipo de  movimiento del documento pendiente de notificar
  @Numero_Emision = N'0721', numero de emision del documento pendiente de notificar
  @Folio_Impresion = N'121', folio de impresion del documento pendiente de notificar
  @Estatus = N'E',	 	 	indicado por el notificador	E-entregado C-Citatorio G-Diligenciado sin recepcion N-No Localizado
  @Fecha_Movimiento = N'20120117', 	indicado por el notificador
  @Persona_Recibe_Nombre='rosa maria',	indicado por el notificador si selecciono estatus citatorio
  @Persona_Recibe_Identificacion='123589', indicado por el notificador si selecciono estatus citatorio
  @Observaciones='Se encuentra de viaje'   indicado por el notificador en cualquier estatus


-----------------------------
EJECUTA REGISTRA ENTREGA 

USE [ingresos]
GO
DECLARE @return_value int
EXEC @return_value = [dbo].[paPadron_App_Registra_Entrega_16012013]
  @Usuario = N'duitzil',
  @RFC = N'OOCV730226GX5',
  @Movimiento = N'R1',
  @Numero_Emision = N'0721',
  @Folio_Impresion = N'121',
  @Estatus = N'E',
  @Fecha_Movimiento = N'20120117',
  @Persona_Recibe_Nombre='rosa maria',
  @Persona_Recibe_Identificacion='123589',
  @Observaciones='Se encuentra de viaje'
SELECT 'Return Value' = @return_value
GO
----------------------------------------------------
La sintaxis básica para modificar la longitud de un campo existente es la siguiente:

 alter table NOMBRETABLA
  alter column CAMPO NUEVADEFINICION;

Modificamos el campo "titulo" extendiendo su longitud y para que NO admita valores nulos:

 alter table libros
  alter column titulo varchar(40) not null;


----------------------------------------------------------
hacer correo de pendientes para agregar al sire
telefono que se comunica 
actas de inspeccion
cartas de invitacion
descuentos de patentes
descuentos de licencias
filtros para requerir con cruce con obligaciones complementarias
----------------------------------------------
lizardi_w@hotmail.com dijo (04:15 p.m.):
 HOLA ESTE CASO
 SASP680723C98
 APARECE MOROSO PORel establecimiento 05001
 y veo la declaracion pero del establecimiento 05002
lizardi_w@hotmail.com dijo (04:17 p.m.):
 ESTE CASO TUYS470407T28
 ADEUDA 2008,2009 Y ENERO FEBRERO 2010
 CREO QUE SUSPENDIO O ALGO ASI
lizardi_w@hotmail.com dijo (04:25 p.m.):
 LOS DEMÁS YA QUEDARON TODOS
 SOLO ESOS CASOS

-------------------------------------------
CASOS GENARO CORREO RE: DESC. BEBAL

CALN630216CT5  PEDIR APLICAR CON LILYANA




AEAA7307019I0 ESTE YA ESTA APLICADO CON DESCUENTO CHECAR SI TIENE OTRA LICENCIA



CALL490825JU1  PEDIR APLICAR CON LILYANA


EAQA501020AV3 REVISAR CON LILYANA PUES YA ESTA EN LA LISTA DE DESCUENTOS



 LOCE5104149Y5 PEDIR APLICAR CON LILYANA



TULS510221BL4  ESTE YA ESTA APLICADO CON DESCUENTO CHECAR SI TIENE OTRA LICENCIA

CASOS REVISADOS

CANG400110RI2
COCL670623DX5
AOSC530202HX1
KACB670506G37
KUMS601006B13
CIKL710531QB9
CALN630216CT5
CALL490825JU1
LOCE5104149Y5


-------------------------------------------

Id	Id_Acta	Municipio	Oficina	Numero_Emision	RFC	Numero_Serie	Movimiento	Folio_Impresion	Status	SubStatus	Fecha_Impresion	Fecha_Asignacion	Fecha_Citatorio	Fecha_No_Localizado	Fecha_Entrega	Fecha_Captura	Fecha_Vencimiento	Fecha_Cancelacion	Fecha_Ultimo_Movimiento	Clave_Notificador	Gastos_Ejecucion	Multa_Efectiva	Multa_Programada	Num_Salarios_Multa	Actualizacion	Recargos	Honorarios_Notificacion	usuario_cancelacion	Usuario_Cambio_Estatus	Categoria_No_Loc	Numero_No_loc	Num_Salarios_Gastos_Ejecucion	Descuento_Multa_SMG	Descuento_Gastos_Ejecucion_SMG	Descuento_Multa	Descuento_Gastos_Ejecucion	Subtotal	Total	Referencia	Observaciones_Cancelacion	Fecha_Vencimiento_Referencia
24	24	1	1	1202		0	A1 	24	A	B	16:09.6	16:09.6	NULL	NULL	NULL	NULL	NULL	NULL	16:09.6	ccolli	NULL	NULL	0	NULL	0	0	0	NULL	NULL	NULL	0	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
27	27	1	1	1202		0	A1 	27	A	B	16:09.6	16:09.6	NULL	NULL	NULL	NULL	NULL	NULL	16:09.6	ccolli	NULL	NULL	0	NULL	0	0	0	NULL	NULL	NULL	0	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
30	30	1	1	1202		0	A1 	30	A	B	16:09.6	16:09.6	NULL	NULL	NULL	NULL	NULL	NULL	16:09.6	ccolli	NULL	NULL	0	NULL	0	0	0	NULL	NULL	NULL	0	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL

---------------------------------------------


select * from obl_obligacion_vigilable_presentada where (Tipo_Presentacion='' or tipo_presentacion=NULL) and Estado ='T' and Anio_Inicial>'2007'
order by ejercicio_fiscal


---------------------------------------------


marcado de obligaciones estatales
select * from cob_cobros as a 
                  inner join cob_desglose as b
                  on a.No_Operacion=b.No_Operacion 
                  where a.No_Operacion='01030125907486' AND a.RFC='SATG9603234E3'
-----------------------------------------------------
--pendientes  de marcar como tipo de presentacion
select Clave_Obligacion , count(* )from obl_obligacion_vigilable_presentada 
where --Clave_Obligacion='010103' and 
(Tipo_Presentacion='' or Tipo_Presentacion is null) 
and Estado='T' and Clave_Obligacion  not in ('010107','010612')
group by Clave_Obligacion 
order by Fecha_Declarado 

----------------------------------------------------


-------------------------------------------------------
historial de pagos del contribuyente

 exec [dbo].[ObtenerHistorialPagosContribuyente2] 
	@RFC = N'CFE370814QI0',
		@Rubro = N'';



--------------------------------------------------------
casos parcialidades verificar nomina y hospedaje

primera parte david 
//////////////
select  rfc,referencia,Fecha_Inicial 
from dec_nominas where --(Inscrito='Inscribir' or Inscrito='inscrito')and 
rfc in (
select distinct RFC 
from dec_detalle_parcialidades 
where Numero_Parcialidad=Parcialidades_Avaladas and Pagado='S' and rfc=' CIC760914551'
) and Fecha_Inicial between '20090401' and '20090601' 


select  rfc,referencia,Fecha_Inicial 
from dec_hospedaje where --(Inscrito='Inscribir' or Inscrito='inscrito')and 
rfc in (
select distinct RFC 
from dec_detalle_parcialidades 
where Numero_Parcialidad=Parcialidades_Avaladas and Pagado='S' and rfc=' CIC760914551'
) and Fecha_Inicial between '20090401' and '20090601' 

//////////////
verifica hospedaje marcado correcto

select  a.rfc,'00000000000000000000' as Numero_Serie,'' as REC, b.Establecimiento AS Numero_establecimiento,
 '010104' as Clave_Obligacion,
YEAR( a.fecha_inicial) as Anio_Inicial, MONTH(a.Fecha_Inicial) as MEs_Inicial,a.Fecha_Inicial,
 YEAR(a.Fecha_Inicial) as Anio_Final, 
MONTH(a.Fecha_Inicial) as Mes_Final,
case when month(a.Fecha_Inicial)='4' then DATEADD(day, 29, a.fecha_inicial) 
when month(a.Fecha_Inicial)='5' then DATEADD(day, 30, a.fecha_inicial) 
when month(a.Fecha_Inicial)='6' then DATEADD(day, 29, a.fecha_inicial) 
end as fecha_final,
a.Fecha_Alta as Fecha_Declarado,
substring(a.referencia,4,17) as no_operacion,
'2' as Tipo_Periodo,
'T' as Estado,
'Mn' as Tipo_Presentacion,
YEAR(getdate()) as Ejercicio_Fiscal,
'PARCIA' as Fuente_Informacion,
a.Municipio, 
a.Municipio
from dec_hospedaje as a
join dec_hospedaje_det  as b on a.Referencia =b.referencia 
left join obl_obligacion_vigilable_presentada as c on a.RFC=c.RFC and c.clave_obligacion='010104'
and a.Fecha_Inicial=c.Fecha_Inicial 
where --(Inscrito='Inscribir' or Inscrito='inscrito')and 
a.rfc in (
select distinct RFC 
from dec_detalle_parcialidades 
where Numero_Parcialidad=Parcialidades_Avaladas and Pagado='S' --and rfc=' EGM040324RT0' 
and Clave_Obligacion='010104'
) and a.Fecha_Inicial between '20090401' and '20090601'
and c.No_Operacion is null
order by a.rfc, b.Establecimiento, a.Fecha_Inicial 


----------------------------------------
Lili dijo (04:01 p.m.):
 tienes el nombre del dueño de la 03834
 me dicen que el rfc no coincide
Lili dijo (04:08 p.m.):
 no hay una solicitud de comodato aun para esta persona
 no hay a que aplicarle el descuento

------------------------------------------
rfc a checar con lilyana

RIPC870115SN9pasara descuento
CACM7605087C1pasar a descuento ya pago
AOLM500315C38 REVISAR NO ESTA BIEN EL RFC
TUYS470407T28 ADEUDA 2008 2009 2010
COCL670623DX5 NO TIENE NUMERO DE LICENCIA
EECH6410029V3  pasar a descuento
--------------------------------
caso pago en municipio 08 y ahora es 09
CMA850228973
------------------------------------------
ejcuta pendientes pae

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_Determina_Morosidad_PAE]
		@RFC = N'IIC000428GS1'

SELECT	'Return Value' = @return_value

GO

--------------------------------
Para saber si alguien salio requerido y ya habia pagado
select * from dec_nominas  where MONTH(Fecha_Inicial)='01' and year(Fecha_Inicial)='2013'
and rfc in(SELECT distinct rfc FROM obl_detalle_sucursales WHERE (Numero_Emision = '1310') AND (MUNICIPIO='04'))


select * from dec_hospedaje   where MONTH(Fecha_Inicial)='01' and year(Fecha_Inicial)='2013'
and rfc in(SELECT distinct rfc FROM obl_detalle_sucursales WHERE (Numero_Emision = '1312') AND (MUNICIPIO='04'))
----------------------------------
pasos para hacer el movimiento entre tulum y solidaridad de los pagos 

respaldar los datos en una tabla

select a.*, '09'+SUBSTRING (a.Numero_Establecimiento,3,5)  as numero_establecimiento_nuevo
-- distinct a.RFC 
--into ingresos.dbo.obl_resp_vigilable_presentada_tulum
from obl_obligacion_vigilable_presentada as a
left join pad_obligacionesporestablecimiento as b on a.RFC=b.RFC 
and a.Numero_Establecimiento=b.Numero_Establecimiento 
and a.Clave_Obligacion=b.Clave
where b.RFC is null
and substring(a.Numero_Establecimiento,1,2)='08'
and a.rfc not in ('LECE760221HP4',' BPC980311VA2')


update obl_obligacion_vigilable_presentada 
set numero_establecimiento_anterior=a.Numero_Establecimiento,
Numero_Establecimiento='09'+SUBSTRING (a.Numero_Establecimiento,3,5)
from obl_obligacion_vigilable_presentada as a
left join pad_obligacionesporestablecimiento as b on a.RFC=b.RFC 
and a.Numero_Establecimiento=b.Numero_Establecimiento 
and a.Clave_Obligacion=b.Clave
where b.RFC is null
and substring(a.Numero_Establecimiento,1,2)='08'
and a.rfc not in ('LECE760221HP4',' BPC980311VA2')


select* from ob l_obligacion_vigilable_presentada 
where --rfc=' CMA850228973' and 
substring(Numero_Establecimiento,1,2)='09'  and Numero_Establecimiento_anterior is not null



verificar casos tulum

select a.*, '09'+SUBSTRING (a.Numero_Establecimiento,3,5)  as numero_establecimiento_nuevo
-- distinct a.RFC 
--into ingresos.dbo.obl_resp_vigilable_presentada_tulum
from obl_obligacion_vigilable_presentada as a
left join pad_obligacionesporestablecimiento as b on a.RFC=b.RFC 
and a.Numero_Establecimiento=b.Numero_Establecimiento 
and a.Clave_Obligacion=b.Clave
where b.RFC is null
and substring(a.Numero_Establecimiento,1,2)='08'
and a.rfc  in (' UNA041105U27')

select * from obl_obligacion_vigilable_presentada where rfc  in (' UNA041105U27')  
and Anio_Inicial='2012' and Clave_Obligacion='010103'

select * from pad_obligacionesporestablecimiento where rfc  in (' UNA041105U27')

select * from pad_establecimientos where rfc  in (' UNA041105U27')
**********************************************************************
--procedimiento que aplique despues cuando el establecimiento no esta activo y la obligacion del establecimiento si

--insert into ingresos.dbo.obl_resp_vigilable_presentada_tulum
select  a.*, '09'+SUBSTRING (a.Numero_Establecimiento,3,5)  as numero_establecimiento_nuevo
-- distinct a.RFC 
from obl_obligacion_vigilable_presentada as a
left join pad_obligacionesporestablecimiento as b on a.RFC=b.RFC 
and a.Numero_Establecimiento=b.Numero_Establecimiento 
and a.Clave_Obligacion=b.Clave
left join pad_establecimientos as c on a.RFC=c.RFC  and  a.Numero_Establecimiento=c.Numero 
where --b.RFC is null And 
substring(a.Numero_Establecimiento,1,2)='08'
--and a.rfc  in (' ACA050616IM9')
and c.RFC IS NULL
 --and a.No_Operacion='01080202514953'
 and b.Situacion='Activo'
 and Tipo_Presentacion not in ('An')

*****************************************************************
procedimiento que aplique sobre un numero de establecimiento en especifico quite que tenga como situacion activo notese
update obl_obligacion_vigilable_presentada 
set numero_establecimiento_anterior=a.Numero_Establecimiento,
Numero_Establecimiento='09'+SUBSTRING (a.Numero_Establecimiento,3,5)
from obl_obligacion_vigilable_presentada as a
left join pad_obligacionesporestablecimiento as b on a.RFC=b.RFC 
and a.Numero_Establecimiento=b.Numero_Establecimiento 
and a.Clave_Obligacion=b.Clave
left join pad_establecimientos as c on a.RFC=c.RFC  and  a.Numero_Establecimiento=c.Numero 
where --b.RFC is null And 
substring(a.Numero_Establecimiento,1,2)='08'
and a.rfc  in (' BPC980311VA2')
and Tipo_Presentacion not in ('An')
and a.Numero_Establecimiento ='08004'
-- and b.Situacion='Activo'-------notese




*----------------------------------------------------------
checar casos bebal que no pueden cobrar cuando tienen dos referencias
select * from beb_referencias as a
inner join beb_referencias_licencias as b
on a.Id=b.Id_Referencia where b.RFC='BAXA8711171I7'

select * from beb_referencias where Referencia='74050005294894214'

--update beb_referencias 
set Estatus='I'
where Referencia='74050005294894214'


------------------------------------------------------------------
CASOS DE LILYANA
CAAA630915BS3
PAMC540511DE9
PADM570623GF9
MAVJ711220JB6 comodato
VANR4902158EA comodato
MACM401103CX1 comodato
EETC6204011F4 comodato
GAAV731026KX9 comodato
SUUV511111C91 
TUPG7504138H9 comodato
ROMG500826R50 comodato
LOCM711104E35 comodato
MAON881205MK7
BIRO740821N60

--------------------------------------------------------------------
pendientes ricardo
referencia 20081119211544139  no pagada 09-10- del 2008



con este contribuyente tengo el problema  de no k no se ve cuando fue pagado RFC: gagd581101ey8 de nombre: 
gamboa gamboa dulce maria de los santos periodo 07-08 del 2010 (no esta)


no pagada 00022020224664565082


este contribuyente con RFC: UIHH6905066N1 DE NOMBRE : UICAB HU HELIODORO  pago el periodo 01-02 del 2009 por la cantidad de $360  
en la recaudadora folio de emisión 02020104777811 el 16 de junio del 2009  folio de recibo 4736750

referencia 20090614221604717 pero no esta cargada en ctrl de obligaciones



este contribuyente con RFC:DIGJ600110VD8 DE NOMBRE:DIAZ GUIZAR MARIA JESUS  pago en el banco bancomer referencia 00022020224664565082  el dia 30/03/2012 
suc.4640 periodo 01-02 del 2012 del régimen de pequeño contribuyente





---------------------------------------
modificar  los siguientes procedimientos para saber la morosidad

paPadron_Situacion_Contribuyente situacion contribuyente
paPadron_Situacion_Contribuyente_todo situacion contribuyente
[paCO_Determina_Morosidad_Estatales_cpy] estatales eladio
[paPadron_Determina_Morosidad_CPY] licencias funcionamiento
[paPadron_Determina_Morosidad_CPY_CPY]
[paCo_Determina_Morosidad_padron_CPY] procedimiento descuentos licencias
[paCO_Determina_Morosidad_Estatales] ISTUV
[paCo_Determina_Morosidad_padron_CPY_Estatales] MOROSIDAD DE LOS ESTATALES
[paCo_Determina_Morosidad_padron_CPY_Patentes_General] MOROSIDAD PATENTES GENERAL
-----------------------------------------

pagar en convenio ricardo

C:\Documents and Settings\Administrador\Mis documentos\Lizardi\SH_2010\AUTORIZACION PARA IMPRIMIR LICENCIA DE FUNCIONAMIENTO
------------------------------------------------
###insertar un salto de linea en php

echo $fila2['numero_control']."\r\n";

----------------------------------------------
gerardo
 buenas tardes, me podrias ayudar con este contribuyente BPC980311VA2, hizo los pagos del impuesto al hospedaje en su momento en solidaridad y por la creacion del municipio de tulum ahora lo paga en tulum...sin embargo ahora aparece como deudor de todo 2008, 2009, 2010, 2011 y parte de 2012...


1006531I001102
----------------------------------------------------
generar completo el procedimiento de cumplidos lilyana patentes bebal
USE [ingresos]
GO
DECLARE @return_value int
EXEC @return_value = [dbo].[paCo_Generar_Cumplidos_Repecos_Bebal]
SELECT 'Return Value' = @return_value
GO

----------------------------------------------------
usuarios que son notificadores
select * from seg_grupos where Grupo='obl_notificadores'
----------------------------------------------------
estadistica de no localizados estatales gerardo reyes 

select a.Municipio as Clave_Municipio, b.Nombre as Municipio, Total
from (select Municipio, COUNT(*) as Total  
from pad_contribuyentes 
where Localizable_Estatal='N'
group by Municipio ) as a join 
cat_municipios as b on a.Municipio=b.Clave 
order by Clave_Municipio

------------------------------------------------
me dice las tablas de los cobros david y campos del importe

 select * 			   from cob_tipos_referencias3

procedimiento para las referencias de actas de insp
[pa_Determina_Referencia_Actas_Inspeccion]
promedios
[Obtiene_Promedio_Por_Obligacion]

------------------------------------------
pendientes siregob
21.-DENTRO DE LA BASE DE DATOS INGRESOS (SQL SERVER) QUE PERTENECE AL SISTEMA SARH, 
EN LA TABLA PAD_CONTRIBUYENTES, SE ENCONTRÓ UN CAMPO LLAMADO HOMONIMIA_CREADA , 
EL CUAL CONTIENE INFORMACIÓN (VACÍO, N, S), SE REQUIERE SABER CUÁL ES EL OBJETIVO 
DE ESTE CAMPO, YA QUE EN LA MIGRACIÓN DEL PADRÓN DE CONTRIBUYENTES ES NECESARIO 
IDENTIFICARLO PARA PODER HACER LA RELACIÓN Y MAPEO HACIA EL PADRÓN DE SIRE GOB, 
ADEMÁS SE NECESITA SABER QUE FUNCIÓN TIENE DENTRO DEL SISTEMA.

23.-EN EL MÓDULO DE CONTROL DE OBLIGACIONES DEL SISTEMA SARH, CUANDO SE INGRESA A LA 
OPCIÓN CONTROL DE OBLIGACIONES->DETECCIÓN DE MOROSOS->GENERADOR DE EMISIONES MOROSOS, 
DENTRO DE ESTA OPCIÓN SE GENERA LA EMISIÓN QUE CONTIENE LOS MOROSOS DE ALGUNA OBLIGACIÓN, 
PARA LAS OBLIGACIONES DEL IMPUESTO SOBRE NÓMINA Y HOSPEDAJE MENSUAL, EL SISTEMA DA LA OPCIÓN 
DE GENERAR UNA EMISIÓN DIRIGIDA, EN BASE A QUÉ CRITERIOS SE DETERMINA EL ORDEN DE LOS 
CONTRIBUYENTES A REQUERIR CUANDO SE REALIZA UNA EMISIÓN DIRIGIDA, SE TENÍA EL ENTENDIMIENTO 
QUE EL ORDEN ERA EN BASE A LOS QUE MÁS APORTAN, SE NECESITA SABER LA TABLA QUE DETERMINA 
QUE CONTRIBUYENTES APORTAN MÁS.%0d

---------------------------------------------
estos archivos para subir cambio de estatables ordenados por zona e importe desde el 125 y que no sean los mismos que se imprimen
genera_emision_paquetes.php
genera_emisionm_paquetes_tpl.php
selecciona_periodo.hp
selecciona_periodo_opciones.php
imposicion_multa_incumplimiento_general_imprimir.php-- imprimir las multas totales de la emision
notifica_credito_general.php--imprimir las multas totales de la emision

---------------------------------------------------
licenciatura en derecho burocratico

INFORMES E INSCRIPCIONES 
55 92 85 59 
55 66 54 29 
e-mail 
fstse.inesap@fstse.com 
inesap_fstse@yahoo.com.mx 
Calle Antonio caso #35 4º piso Col. Tabacalera, del Cuauhtémoc, cp. 06030, de lunes a viernes de 10:00 a 14:00 y de 16:00 20:00 hrs. 


FSTSE
AVE INDEPENDENCIA 87, CHETUMAL CENTRO, CHETUMAL, C.P 77000, QR
TEL: (983) 832 1087



----------------------------------------------------------------------
archivos actualizados de los cambios de reyes al requerir imprimir y generar las multas
--ejecutables/genera_emision_paquetes.php
--ejecutables/seleccionar_periodo.php
--ejecutables/notifica_credito_general.php //no existe aun
--ejecutables/desglose_por_municipio.php
--ejecutables/genera_emision_paquetes_previo.php
--plantillas/desglose_obligacion_mensual_tpl.php
--plantillas/genera_emision_paquetes_tpl.php
--plantillas/genera_emision_previo_tpl.php
--plantillas/desglose_obligacion_bimestral_tpl.php
--plantillas/seleccionar-periodo_opciones_tpl.php
--reportes/imposicion_multa_incumplimiento_general_imprimir.php  //no existe aun
--reportes/imprime_requerimientos.php
--reportes/imprime_requerimientos2.php
--reportes/templates/imprime_requerimientos_tpl.php
--reportes/templates/fundamento_credito_extraccion_materiales_tpl.php // no existe aun
reportes/templates/notifica_credito_imprimir_tpl.php
--reportes/templates/detalles_emision_tpl.php


-------------------------------------------------------------------------------------------------------
actualizar los datos de una tabla en el 125 desde 10.9.3.31

CON EL PROCEDIMIENTO ALMACENADO EN RAMON_INSERT_VARIABLES





-------------------------------------------------------------------------------------------------------
--informativas reyes gerardo ramon


insertar los que han declarado a vig presentada


INSERT INTO obl_obligacion_vigilable_presentada

(

            [RFC],

            [Numero_Serie],

            [REC],

            [Numero_Establecimiento],

            [Clave_Obligacion],

            [Anio_Inicial],

            [Mes_Inicial],

            [Fecha_Inicial],

            [Anio_Final],

            [Mes_Final],

            [Fecha_Final],

            [Fecha_Declarado],

            [No_Operacion],

            [Tipo_Periodo],

            [Estado],

            [Tipo_Presentacion],

            [Ejercicio_Fiscal],

            [Fuente_Informacion],

            [Municipio],

            [Oficina]
)

 SELECT a.RFC as RFC,
       '' as Numero_Serie,
       '' AS REC,
       b.Numero AS Numero_Establecimiento,
       c.Clave as Clave_Obligacion,
       Year(a.Fecha_Inicial) as Anio_Inicial,
       Month(a.Fecha_Inicial) as Mes_Inicial,
       a.Fecha_Inicial as Fecha_Inicial,
       Year(a.Fecha_Final) as Anio_Final,
       Month(a.Fecha_Final) as Mes_Final,
       a.Fecha_Final as Fecha_Final,
       a.Pago_Fecha as Fecha_Declarado,
       a.No_Operacion as No_Operacion,
       '17' as Tipo_Periodo,
       'T' as Estado,
       'Mn' as Tipo_Presentacion,
       Year(a.Pago_Fecha) as Ejercicio_Fiscal,
       NULL as Fuente_Informacion,
       a.Pago_Municipio as Municipio,
       a.Pago_Recaudadora as Oficina
       FROM dbo.dec_informativa_extraccion as a
       left join pad_establecimientos as b
       on a.RFC=b.RFC
       left join pad_obligacionesporestablecimiento as c
       on b.RFC=c.RFC and b.Numero=c.Numero_Establecimiento 
       WHERE c.Clave='010106' and c.Situacion='Activo' and b.Situacion='Activo' and a.[Status]<>'0' --and a.rfc='NADR630104GP3';
       

--materiales
SELECT a.RFC as RFC,
       '' as Numero_Serie,
       '' AS REC,
       b.Numero AS Numero_Establecimiento,
       c.Clave as Clave_Obligacion,
       Year(a.Fecha_Inicial) as Anio_Inicial,
       Month(a.Fecha_Inicial) as Mes_Inicial,
       a.Fecha_Inicial as Fecha_Inicial,
       Year(a.Fecha_Final) as Anio_Final,
       Month(a.Fecha_Final) as Mes_Final,
       a.Fecha_Final as Fecha_Final,
       a.Pago_Fecha as Fecha_Declarado,
       a.No_Operacion as No_Operacion,
       '17' as Tipo_Periodo,
       'T' as Estado,
       'Mn' as Tipo_Presentacion,
       Year(a.Pago_Fecha) as Ejercicio_Fiscal,
       NULL as Fuente_Informacion,
       a.Pago_Municipio as Municipio,
       a.Pago_Recaudadora as Oficina
       FROM dbo.dec_informativa_extraccion as a
       left join pad_establecimientos as b
       on a.RFC=b.RFC
       left join pad_obligacionesporestablecimiento as c
       on b.RFC=c.RFC and b.Numero=c.Numero_Establecimiento 
       WHERE c.Clave='010106' and c.Situacion='Activo' and b.Situacion='Activo' and a.[Status]<>'0' --and a.rfc='NADR630104GP3';
       
       select * from pad_obligacionesporestablecimiento 
       where rfc='NADR630104GP3' and Clave='010106'
       select * from pad_establecimientos  
       where rfc='NADR630104GP3' 
       
       --ilepal
       SELECT a.RFC as RFC,
       '' as Numero_Serie,
       '' AS REC,
       b.Numero AS Numero_Establecimiento,
       c.Clave as Clave_Obligacion,
       Year(a.Fecha_Inicial) as Anio_Inicial,
       Month(a.Fecha_Inicial) as Mes_Inicial,
       a.Fecha_Inicial as Fecha_Inicial,
       Year(a.Fecha_Final) as Anio_Final,
       Month(a.Fecha_Final) as Mes_Final,
       a.Fecha_Final as Fecha_Final,
       a.Pago_Fecha as Fecha_Declarado,
       a.No_Operacion as No_Operacion,
       '17' as Tipo_Periodo,
       'T' as Estado,
       'Mn' as Tipo_Presentacion,
       Year(a.Pago_Fecha) as Ejercicio_Fiscal,
       NULL as Fuente_Informacion,
       a.Pago_Municipio as Municipio,
       a.Pago_Recaudadora as Oficina
       FROM  dbo.dec_informativa_hospedaje_anual as a
       left join pad_establecimientos as b
       on a.RFC=b.RFC
       left join pad_obligacionesporestablecimiento as c
       on b.RFC=c.RFC and b.Numero=c.Numero_Establecimiento 
       WHERE c.Clave='010102' and c.Situacion='Activo' and b.Situacion='Activo' --and a.[Status]<>'0' --and a.rfc='NADR630104GP3';
       
       select top 100 * from dec_informativa_hospedaje_anual 


hospedaje
dec_informativa_hospedaje


#####

SELECT a.RFC as RFC,
       '' as Numero_Serie,
       '' AS REC,
       b.Numero AS Numero_Establecimiento,
       c.Clave as Clave_Obligacion,
       Year(a.Fecha_Inicial) as Anio_Inicial,
       Month(a.Fecha_Inicial) as Mes_Inicial,
       a.Fecha_Inicial as Fecha_Inicial,
       Year(a.Fecha_Final) as Anio_Final,
       Month(a.Fecha_Final) as Mes_Final,
       a.Fecha_Final as Fecha_Final,
       a.Pago_Fecha as Fecha_Declarado,
       a.No_Operacion as No_Operacion,
       '12' as Tipo_Periodo,
       'T' as Estado,
       'Mn' as Tipo_Presentacion,
       Year(a.Pago_Fecha) as Ejercicio_Fiscal,
       NULL as Fuente_Informacion,
       a.Pago_Municipio as Municipio,
       a.Pago_Recaudadora as Oficina
       FROM  dbo.dec_informativa_hospedaje as a
       left join pad_establecimientos as b
       on a.RFC=b.RFC
       left join pad_obligacionesporestablecimiento as c
       on b.RFC=c.RFC and b.Numero=c.Numero_Establecimiento 
       WHERE c.Clave='010104' and c.Situacion='Activo' and b.Situacion='Activo' 
	   and a.No_Operacion  not in (

//esta parte es para meter los pagos que no hemos cargado de las informativas
       select  *--No_Operacion  
       from obl_obligacion_vigilable_presentada 
       where Clave_Obligacion='010106' 
       and Tipo_Periodo='17'

)

-----------------------------------------
problema con los pipes genaro
Buenas tardes, 



Derivado de la revisión a los archivos enviados, para realizar la carga de las emisiones de la vigilancia de contribuyentes diferentes a Repecos e Intermedios del mes de Mayo de 2013, se observa que los siguientes archivos rcoef73 no contienen los | pipes que marca el Layout para realizar la carga de los requerimientos, debido a que esto ya se había reportado en el correo anterior y me enviaron de nuevo los archivos conteniendo el mismo problema, me ví obligada a rellenar los registros de los archivos con el número de pipes correctos de manera manual para poder realizar la carga de requerimientos, 

Saludos. 

-------------------------------------------------------------
Estadistica de contribuyentes no localizados por cada obligación y municipio. reyes santos, gerardo

select min(t.Clave) as Clave_Obligacion, MIN(obl.Descripcion ) as Nombre_Obligacion,
Municipio as Clave_Municipio, min(mun.Nombre ) as Municipio,
COUNT(rfc) Total_No_Localizados
from (
select  c.municipio,a.Clave,min(c.rfc) as rfc
from pad_obligacionesporestablecimiento  as a
--inner JOIN pad_establecimientos as b ON a.rfc=b.rfc AND a.Numero_Establecimiento=b.Numero
INNER JOIN pad_contribuyentes as c on a.RFC=c.rfc
where a.Situacion='Activo' --and b.Situacion='Activo' 
and c.Situacion='Activo' and c.Localizable_Estatal='N'
and a.Clave in ('010106')--and c.RFC='AIBJ6612273E5'-- indicar la obligacion para generar la informacion de cada obligacion
group by  a.Clave, c.municipio, c.rfc) as t
join cat_municipios mun on t.Municipio =mun.Clave 
join cat_obligaciones obl on t.Clave =obl.Clave 
group by t.municipio
order by Clave_Municipio 

-------------------------------------------------------------------

##########estadistica que genera el archivo requerimientos 2007-2013 es la suma total de requerimientos por año y por emision reyes samuel gerardo

SELECT t.Clave_Obligacion,min(t.Obligacion) as Nombre_Obligacion, t.Ejercicio_Fiscal,min(t.Municipio) as Clave_Municipio ,
min(t.Municipio_Nombre) as Nombre_Municipio ,
		min(t.Oficina) as Oficina , COUNT(*) as Numero_Emisiones,SUM(Total ) Total_Requerimientos,SUM(impreso) Impresos, 
		SUM(Notificados) Notificados,
		 SUM(vencidos) Vencidos FROM (SELECT --*
		min(d.Clave) as Municipio ,
		min(d.Nombre) as Municipio_Nombre ,
		min(b.Oficina) as Oficina ,
		a.Numero_Emision,
		b.Clave_Obligacion as Clave_Obligacion,
               min(c.Descripcion) as Obligacion,
               min(b.Dirigida) as Dirigida,
               b.Periodo_Inicial,
               b.Periodo_Final,
               b.anio_moroso,
               MIN(b.Ejercicio_Fiscal ) AS Ejercicio_Fiscal,
               min(b.Fecha_Emision) as Fecha_Emision,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Notificados,
               SUM(CASE WHEN (a.Status='V') THEN 1 ELSE 0 END) AS Vencidos
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               join cat_municipios as d on b.Municipio=d.Clave  
               where a.Movimiento='R1' and 
			  
			   b.Ejercicio_Fiscal  in ('2007','2008','2009','2010','2011','2012','2013') --and 
			   --and Clave_Obligacion in ('010103','010104','010102','010106')
			   and b.Clave_Obligacion in ('010103') --and b.Municipio='09'
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision,b.Anio_Moroso,
                b.Periodo_Inicial,b.Periodo_Final, Clave_Periodicidad  
               ) AS T
                group by t.Clave_Obligacion,t.Ejercicio_Fiscal,t.Municipio, t.Oficina
                ORDER BY t.Clave_Obligacion, t.Municipio, t.Oficina,t.Ejercicio_Fiscal
               
#################es es la suma total de multas por omision por año y por emision reyes samuel gerardo

SELECT t.Clave_Obligacion,min(t.Obligacion) as Nombre_Obligacion, t.Ejercicio_Fiscal,min(t.Municipio) as Clave_Municipio ,
min(t.Municipio_Nombre) as Nombre_Municipio ,
		min(t.Oficina) as Oficina , COUNT(*) as Numero_Emisiones,SUM(Total ) Total_Multas,SUM(impreso) Impresos, 
		SUM(Notificados) Notificados,
		 SUM(vencidos) Vencidos,
		 SUM(Multa) Multa,
		 SUM(Gastos_Ejecucion) Gastos_Ejecucion
		  FROM (SELECT --*
		min(d.Clave) as Municipio ,
		min(d.Nombre) as Municipio_Nombre ,
		min(b.Oficina) as Oficina ,
		a.Numero_Emision,
		b.Clave_Obligacion as Clave_Obligacion,
               min(c.Descripcion) as Obligacion,
               min(b.Dirigida) as Dirigida,
               b.Periodo_Inicial,
               b.Periodo_Final,
               b.anio_moroso,
               MIN(b.Ejercicio_Fiscal ) AS Ejercicio_Fiscal,
               min(b.Fecha_Emision) as Fecha_Emision,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Notificados,
               SUM(CASE WHEN (a.Status='V') THEN 1 ELSE 0 END) AS Vencidos,
               SUM (Multa_Efectiva) AS Multa,
               SUM (Gastos_Ejecucion  ) AS Gastos_Ejecucion               
               FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               join cat_municipios as d on b.Municipio=d.Clave  
               where a.Movimiento='I1' and 
			  
			   b.Ejercicio_Fiscal  in ('2007','2008','2009','2010','2011','2012','2013') --and 
			   --and Clave_Obligacion in ('010103','010104','010102','010106')
			   and b.Clave_Obligacion in ('010102') --and b.Municipio='08'
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision,b.Anio_Moroso,
                b.Periodo_Inicial,b.Periodo_Final, Clave_Periodicidad  
               ) AS T
                group by t.Clave_Obligacion,t.Ejercicio_Fiscal,t.Municipio, t.Oficina
                ORDER BY t.Clave_Obligacion, t.Municipio, t.Oficina,t.Ejercicio_Fiscal


--------------------------------------------------------------------------------------



LIC. MARIO LUIS DEL VALLE LÓPEZ 
DIRECTOR GENERAL DE TECNOLOGÍAS DE LA INFORMACIÓN Y 
COMUNICACIONES. 
En atención a la plática sostenida con usted vía telefónica y por instrucciones del Lic. Freddy Falcón Be, Director de Recaudación, por este medio me permito solicitar a usted su valioso apoyo con el fin de poder elaborar un impacto en recaudación de un programa de condonación de créditos fiscales que se encuentra en vías de aprobación y proyección en su caso, tengo a bien hacer la petición formal de la información relativa a los impuestos sobre nóminas, al hospedaje, sobre extracción de materiales y al libre ejercicio de profesiones, en base a lo siguiente: 
1. El total de pagos por impuestos realizados por todos los contribuyentes hasta el día de hoy, para las obligaciones causadas en los ejercicios fiscales 2007, 2008, 2009, 2010, 2011, 2012 y de enero a junio de 2013. 
2. El numero de requerimientos impresos por impuesto de las obligaciones fiscales causadas en los ejercicios fiscales 2007, 2008, 2009, 2010, 2011, 2012 y de enero a junio de 2013. 
3. El número de requerimientos notificados por impuesto, de las obligaciones causadas en los ejercicios fiscales 2007, 2008, 2009, 2010, 2011, 2012 y de enero a junio de 2013. 
4. El número de requerimientos no solventados (vencidos) por impuesto, de las obligaciones fiscales causadas en los ejercicios fiscales 2007, 2008, 2009, 2010, 2011, 2012 y de enero a junio de 2013. 
5. El número de multas por omisión a requerimiento de autoridad competente emitidas, mas los notificados y los no solventados, por padrón de impuesto, impuestas en el ejercicio fiscal 2007, 2008, 2009, 2010, 2011, 2012 y de enero a junio de 2013. 
6. El número de contribuyentes activos en el padrón de cada impuesto, en los ejercicios fiscales 2007, 2008, 2009, 2010, 2011, 2012 y de enero a junio de 2013. 
7. El número de contribuyentes morosos en cada padrón de impuestos, en los ejercicios fiscales 2007, 2008, 2009, 2010, 2011, 2012 y de enero a junio de 2013. 
Agradezco el favor de su atención y hago propicia la ocasión para enviarle cordiales saludos.
 
 
LIC. SAMUEL SANTOS FRIAS
ENC. DEPTO. DE CONTRIBUCIONES ESTALES.



ejecutar este procedimiento para los rfcs morosos de las obligaciones estatales puestos en la tabla de rfcs estatales y sacar 




USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales]

SELECT	'Return Value' = @return_value

GO


####con este saco la estadistica de cuantos contribuyentes deben cada mes del año el archivo de excel es estadistica de contribuyentes estatales 2007-2013.xlsx

       select MPO_CON, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, EJERCICIO,MES_INICIAL,TOTAL  from (SELECT MPO_CON, CLAVE, EJERCICIO,MES_INICIAL, COUNT(*) AS TOTAL 
               FROM (select distinct(RFC) as RFC ,MPO_CON, CLAVE, EJERCICIO,  PERIODICIDAD, MES_INICIAL 
               from RES_VIG_MOROSIDAD_LIC_BEBAL 
               where NO_OPERACION is null  and clave='010103' and PERIODICIDAD='02' --and MPO_CON='01' and EJERCICIO='2009' and MES_INICIAL='1'
               ) AS T
               group by MPO_CON, CLAVE, EJERCICIO, MES_INICIAL 
               ) as s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
               order by  MPO_CON, s.CLAVE, EJERCICIO, convert(int,MES_INICIAL)
               
####con estos 4 siguientes querys obtengo el listado de contribuyentes cuantos periodos adeudan por obligacion de 2007-2013 y los datos del ultimo pago    use
la tabla resultado del sp anterior el archivo enviado es contribuyentes estatales adeudo y ultimo pago.xlsx

7.-  El número de contribuyentes morosos en cada padrón de impuestos estatales, en los ejercicios fiscales 2007, 2008, 2009, 2010, 2011, 2012 y de enero a junio de 2013. 

Información a complementar:    

Cantidad de Declaraciones Omisas por contribuyente de los Impuestos Estatales (nómina, hospedaje, libre ejercicio de profesiones y extracción de materiales) en los ejercicios fiscales 2007, 2008, 2009, 2010, 2011, 2012.

 Importe del Historial del Último pago efectuado por contribuyente (Moroso) durante los ejercicios fiscales 2008, 2009, 2010, 2011, 2012 (en el año en que se localice el último pago)  y en caso de NO encontrar información en este período (de 2008 a 2012), verificar si existe información de 2007 hacia años anteriores.           
               
  NOMINA             
select s.MPO_CON as MUNICIPIO, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, s.RFC, S.periodos_adeuda AS PERIODOS_ADEUDA,
s.IMPORTE_ULTIMO_PAGO, s.FECHA_PAGO,s.REFERENCIA 
  from (
		    select a.MPO_CON , A.RFC,COUNT(MES_INICIAL) as periodos_adeuda,min(a.clave) as CLAVE,
		    (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		     AS IMPORTE_ULTIMO_PAGO, (select top 1  fecha_alta from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		      AS FECHA_PAGO,
		     (select top 1  Referencia  from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Referencia
            from RES_VIG_MOROSIDAD_LIC_BEBAL as a
            where NO_OPERACION is null  and clave='010103' and PERIODICIDAD='02' 
            group by a.MPO_CON ,rfc 
            ) AS s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
               order by  MPO_CON, rfc
            
 HOSPEDAJE           
select s.MPO_CON as MUNICIPIO, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, s.RFC, S.periodos_adeuda AS PERIODOS_ADEUDA,
s.IMPORTE_ULTIMO_PAGO, s.FECHA_PAGO,s.REFERENCIA 
  from (
		    select a.MPO_CON , A.RFC,COUNT(MES_INICIAL) as periodos_adeuda,min(a.clave) as CLAVE,
		    (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		     AS IMPORTE_ULTIMO_PAGO, (select top 1  fecha_alta from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		      AS FECHA_PAGO,
		     (select top 1  Referencia  from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Referencia
            from RES_VIG_MOROSIDAD_LIC_BEBAL as a
            where NO_OPERACION is null  and clave='010104' and PERIODICIDAD='02' 
            group by a.MPO_CON ,rfc 
            ) AS s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
               order by  MPO_CON, rfc
                        
ILEPAL

select s.MPO_CON as MUNICIPIO, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, s.RFC, S.periodos_adeuda AS PERIODOS_ADEUDA,
s.IMPORTE_ULTIMO_PAGO, s.FECHA_PAGO,s.REFERENCIA 
  from (
		    select a.MPO_CON , A.RFC,COUNT(MES_INICIAL) as periodos_adeuda,min(a.clave) as CLAVE,
		    (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		     AS IMPORTE_ULTIMO_PAGO, (select top 1  fecha_alta from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		      AS FECHA_PAGO,
		     (select top 1  Referencia  from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Referencia
            from RES_VIG_MOROSIDAD_LIC_BEBAL as a
            where NO_OPERACION is null  and clave='010102' and PERIODICIDAD='03' 
            group by a.MPO_CON ,rfc 
            ) AS s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
               order by  MPO_CON, rfc
               
               
  EXTRACCION             
select s.MPO_CON as MUNICIPIO, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, s.RFC, S.periodos_adeuda 
AS PERIODOS_ADEUDA,
s.IMPORTE_ULTIMO_PAGO, s.FECHA_PAGO,s.REFERENCIA 
  from (
		    select a.MPO_CON , A.RFC,COUNT(MES_INICIAL) as periodos_adeuda,min(a.clave) as CLAVE,
		    (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		     AS IMPORTE_ULTIMO_PAGO, (select top 1  fecha_alta from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by 
		     pago_fecha desc)
		      AS FECHA_PAGO,
		     (select top 1  Referencia  from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Referencia
            from RES_VIG_MOROSIDAD_LIC_BEBAL as a
            where NO_OPERACION is null  and clave='010106' and PERIODICIDAD='02' 
            group by a.MPO_CON ,rfc 
            ) AS s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
               order by  MPO_CON, rfc
                                        

##SI ADEMAS QUIEREN SABER LOS PAGOS EN CEROS QUE PAGO ANTERIOR TUVIERON CHECAR ESTOS QUERYS
            
 ##INICIO NOMINA              
 select * from ( 
select s.MPO_CON as MUNICIPIO, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, s.RFC, 
S.periodos_adeuda AS PERIODOS_ADEUDA,
s.IMPORTE_ULTIMO_PAGO, s.FECHA_PAGO,s.REFERENCIA, s.Fecha_Inicial as PERIODO_DECLARADO,-- s.Fecha_Final, 
IMPORTE_ULTIMO_PAGO_SI_FUE_CERO,FECHA_ALTA_ULTIMO_PAGO_SI_FUE_CERO, REFERENCIA_ULTIMO_PAGO_SI_FUE_CERO, 
Fecha_Inicial_ULTIMO_PAGO_SI_FUE_CERO--, Fecha_Final_ULTIMO_PAGO_SI_FUE_CERO
, EJERCICIO 

  from (
		    select a.MPO_CON , A.RFC,COUNT(MES_INICIAL) as periodos_adeuda,min(a.clave) as CLAVE,
		    
		    (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) as IMPORTE_ULTIMO_PAGO,
		    
		    
		    case when (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 and Concepto_L!=0 order by pago_fecha desc) 
		    else   (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS IMPORTE_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     
		     (select top 1  fecha_alta from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)  AS FECHA_PAGO,
		     
		     case when (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  fecha_alta from dec_nominas as b where  rfc=a.rfc  and b.status!=0 and  Concepto_L!=0 order by pago_fecha desc) 
		    else  (select top 1  fecha_alta from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS FECHA_ALTA_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     
		     (select top 1  Referencia  from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Referencia,
		     
		     
		     case when (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Referencia from dec_nominas as b where  rfc=a.rfc  and b.status!=0 and  Concepto_L!=0 order by pago_fecha desc) 
		    else  (select top 1  Referencia from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS REFERENCIA_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     (select top 1  Fecha_Inicial  from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Fecha_Inicial,
		     
		      case when (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Fecha_Inicial from dec_nominas as b where  rfc=a.rfc  and b.status!=0 and  Concepto_L!=0 order by pago_fecha desc) 
		    else  (select top 1  Fecha_Inicial from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS Fecha_Inicial_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     
		     (select top 1  Fecha_Final  from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Fecha_Final,
		     
		       case when (select top 1 Concepto_L from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Fecha_Final from dec_nominas as b where  rfc=a.rfc  and b.status!=0 and  Concepto_L!=0 order by pago_fecha desc) 
		    else  (select top 1  Fecha_Final from dec_nominas as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS Fecha_Final_ULTIMO_PAGO_SI_FUE_CERO,
		     EJERCICIO
		     
            from RES_VIG_MOROSIDAD_LIC_BEBAL as a
            where NO_OPERACION is null  and clave='010103' and PERIODICIDAD='02' and a.RFC in  (' AAL080613155',' AAC061208PH3')
            group by a.MPO_CON ,rfc, EJERCICIO 
            ) AS s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
--               order by  MPO_CON, rfc)
 )as y          PIVOT (
		sum(PERIODOS_ADEUDA) FOR Ejercicio in ([2007],[2008],[2009],[2010],[2011],[2012],[2013]))pvt
ORDER BY	MUNICIPIO, RFC


##FINAL NOMINA

##INICIO HOSPEDAJE
 select * from (                            
select s.MPO_CON as MUNICIPIO, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, s.RFC, S.periodos_adeuda AS PERIODOS_ADEUDA,
s.IMPORTE_ULTIMO_PAGO, s.FECHA_ULTIMO_PAGO,s.REFERENCIA, s.Fecha_Inicial,
IMPORTE_ULTIMO_PAGO_SI_FUE_CERO,FECHA_ALTA_ULTIMO_PAGO_SI_FUE_CERO, REFERENCIA_ULTIMO_PAGO_SI_FUE_CERO, 
PERIODO_ULTIMO_PAGO_SI_FUE_CERO,EJERCICIO 
 
 
  from (
		    select a.MPO_CON , A.RFC,COUNT(MES_INICIAL) as periodos_adeuda,min(a.clave) as CLAVE,
		    
		    (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		     AS IMPORTE_ULTIMO_PAGO, 
		     
		        case when (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 and Concepto_K!=0 order by pago_fecha desc) 
		    else   (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS IMPORTE_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     (select top 1  fecha_alta from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		      AS FECHA_ULTIMO_PAGO,
		      
		      case when (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  fecha_alta from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  fecha_alta from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS FECHA_ALTA_ULTIMO_PAGO_SI_FUE_CERO,  
		      
		      
		     (select top 1  Referencia  from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Referencia,
		     
		     case when (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Referencia from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  Referencia from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS REFERENCIA_ULTIMO_PAGO_SI_FUE_CERO,  
		     
		      (select top 1  Fecha_Inicial   from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Fecha_Inicial,
		     
		       case when (select top 1 Concepto_K from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Fecha_Inicial from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  Fecha_Inicial from dec_hospedaje as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS PERIODO_ULTIMO_PAGO_SI_FUE_CERO,EJERCICIO 
		     
            from RES_VIG_MOROSIDAD_LIC_BEBAL as a
            where NO_OPERACION is null  and clave='010104' and PERIODICIDAD='02'  --AND A.RFC IN (' ADR070312SH0',' CCS980511QAA')
            group by a.MPO_CON ,rfc,EJERCICIO  
            ) AS s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
               --order by  MPO_CON, rfc
               
               )as y
               PIVOT (
		sum(PERIODOS_ADEUDA) FOR Ejercicio in ([2007],[2008],[2009],[2010],[2011],[2012],[2013]))pvt
ORDER BY	MUNICIPIO, RFC

##FIN HOSPEDAJE
                    
##INICIO ILEPAL
select * from (  
 select s.MPO_CON as MUNICIPIO, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, s.RFC, S.periodos_adeuda AS PERIODOS_ADEUDA,

s.IMPORTE_ULTIMO_PAGO, s.FECHA_PAGO,s.REFERENCIA, s.Fecha_Inicial, s.Fecha_Final, 
IMPORTE_ULTIMO_PAGO_SI_FUE_CERO,FECHA_ALTA_ULTIMO_PAGO_SI_FUE_CERO, REFERENCIA_ULTIMO_PAGO_SI_FUE_CERO, 
Fecha_Inicial_ULTIMO_PAGO_SI_FUE_CERO, Fecha_Final_ULTIMO_PAGO_SI_FUE_CERO, EJERCICIO 
  from (
		    select a.MPO_CON , A.RFC,COUNT(MES_INICIAL) as periodos_adeuda,min(a.clave) as CLAVE,
		    (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		     AS IMPORTE_ULTIMO_PAGO, 
		     
		      case when (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 and Concepto_K!=0 order by pago_fecha desc) 
		    else   (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS IMPORTE_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     (select top 1  fecha_alta from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		      AS FECHA_PAGO,
		      
		       case when (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  fecha_alta from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  fecha_alta from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS FECHA_ALTA_ULTIMO_PAGO_SI_FUE_CERO,  
		      
		     (select top 1  Referencia  from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Referencia,
		     
		    		     
		     case when (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Referencia from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  Referencia from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS REFERENCIA_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     (select top 1  Fecha_Inicial  from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Fecha_Inicial,
		     
		      case when (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Fecha_Inicial from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  Fecha_Inicial from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS Fecha_Inicial_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     
		     (select top 1  Fecha_Final  from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Fecha_Final,
		     
		       case when (select top 1 Concepto_K from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Fecha_Final from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  Fecha_Final from dec_ilepal as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS Fecha_Final_ULTIMO_PAGO_SI_FUE_CERO, EJERCICIO 
		     
		     
            from RES_VIG_MOROSIDAD_LIC_BEBAL as a
            where NO_OPERACION is null  and clave='010102' and PERIODICIDAD='03' --and rfc in ('EAHA760917QW1','AILS560321EK4')
            group by a.MPO_CON ,rfc , EJERCICIO 
            ) AS s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
               --order by  MPO_CON, rfc  
               )as y
               PIVOT (
		sum(PERIODOS_ADEUDA) FOR Ejercicio in ([2007],[2008],[2009],[2010],[2011],[2012],[2013]))pvt
ORDER BY	MUNICIPIO, RFC
##FIN ILEPAL    

##INICIO MATERIALES

 
 select * from ( 
 select s.MPO_CON as MUNICIPIO, q.Nombre as NOMBRE_MUNICIPIO,s.CLAVE ,p.Descripcion AS NOMBRE_OBLIGACION, s.RFC, S.periodos_adeuda 
AS PERIODOS_ADEUDA,
s.IMPORTE_ULTIMO_PAGO, s.FECHA_PAGO,s.REFERENCIA ,
s.Fecha_Inicial, s.Fecha_Final, 
IMPORTE_ULTIMO_PAGO_SI_FUE_CERO,FECHA_ALTA_ULTIMO_PAGO_SI_FUE_CERO, REFERENCIA_ULTIMO_PAGO_SI_FUE_CERO, 
Fecha_Inicial_ULTIMO_PAGO_SI_FUE_CERO, Fecha_Final_ULTIMO_PAGO_SI_FUE_CERO, EJERCICIO 
  from (
		    select a.MPO_CON , A.RFC,COUNT(MES_INICIAL) as periodos_adeuda,min(a.clave) as CLAVE,
		    (
		    
		    select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)
		     AS IMPORTE_ULTIMO_PAGO, 
		     
		     
		     case when (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 and Concepto_K!=0 order by pago_fecha desc) 
		    else   (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS IMPORTE_ULTIMO_PAGO_SI_FUE_CERO,
		     
		     
		     (select top 1  fecha_alta from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by 
		     pago_fecha desc)
		      AS FECHA_PAGO,
		      
		       
		       case when (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  fecha_alta from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  fecha_alta from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS FECHA_ALTA_ULTIMO_PAGO_SI_FUE_CERO,   
		      
		      
		     (select top 1  Referencia  from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Referencia,
		     
		      case when (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Referencia from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  Referencia from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS REFERENCIA_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     (select top 1  Fecha_Inicial  from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Fecha_Inicial,
		     
		      case when (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Fecha_Inicial from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  Fecha_Inicial from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS Fecha_Inicial_ULTIMO_PAGO_SI_FUE_CERO, 
		     
		     
		     (select top 1  Fecha_Final  from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) AS Fecha_Final,
		     
		       case when (select top 1 Concepto_K from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc)=0 
		    then  (select top 1  Fecha_Final from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 and  Concepto_K!=0 order by pago_fecha desc) 
		    else  (select top 1  Fecha_Final from dec_extraccion as b where  rfc=a.rfc  and b.status!=0 order by pago_fecha desc) end
		     AS Fecha_Final_ULTIMO_PAGO_SI_FUE_CERO , EJERCICIO 
		     
            from RES_VIG_MOROSIDAD_LIC_BEBAL as a
            where NO_OPERACION is null  and clave='010106' and PERIODICIDAD='02'-- and a.rfc in (' ICA0605292I5',' PCP800903HS9')
            group by a.MPO_CON ,rfc , EJERCICIO 
            ) AS s
               join cat_obligaciones as p on s.CLAVE=p.Clave 
               join cat_municipios  as q on s.MPO_CON=q.Clave 
              -- order by  MPO_CON, rfc, EJERCICIO 
               
                )as y
               PIVOT (
		sum(PERIODOS_ADEUDA) FOR Ejercicio in ([2007],[2008],[2009],[2010],[2011],[2012],[2013]))pvt
ORDER BY	MUNICIPIO, RFC
##FIN MATERIALES                     
                        


------------------------------------------------------------------------------------------
#### datos para entrar a la cuenta de pensionissste
DATOS GENERALES 
Número de Cuenta 10235278135 
ctrs: Mchuletina00
Apellido Paterno LIZARDI 
Apellido Materno RODRIGUEZ 
Nombre(s) LILI 

fovissste 
curp lirl830804mvzzdl07
no. credito: 1414725
ctrs: liza0408

usuario 
https://oficinavirtual.issste.gob.mx/Mi-Expediente
usuario LILI LIZARDI RODRIGUEZ
CTRS:  Mchuletina00


Numero de IMSS numero de seguridad social
Tu NSS es: 82058315506
-------------------------------------------------
procedimiento almacenado que me devuelve el archivo de excel contribuyentes estatales por municipio.xlsx 
es el listado de todos los contribuyentes estatales que obligacion tienen activa y cuantos establecimientos activos, y donde se encuentra su matriz.
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Estadistica_Contribuyentes_Obligaciones_Estabecimientos]

SELECT	'Return Value' = @return_value

GO
------------------------------------------------

USUARIO CAPA:

CONTRATO:75441
CONTRASEÑA: LIZA0408
---------------------------------------------------

procedimiento almacenado que devuelve el padronde operadoras de servicio que estan al dia con la licencia de funcionamiento 2013 BRUNO REYES, PADRON
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Rep_Declaraciones_de_Operadoras_de_Personal_Morales]
		@Ejercicio = 2013,
		@Mes = 1,
		@Mes_Final = 7

SELECT	'Return Value' = @return_value

GO

-----------------------------------------------------------------------------------------
datos de red conectividad pc
ip lili 10.9.17.116.116
ip david 10.9.17.116.111

---------------------------------
emisiones eliminadas de tenencias
--delete from obl_control_emisiones where Numero_Emision in ('1343','1342','1341','1337','1336','1335','1334')
--and Oficina='01' and Municipio='02'

--delete from obl_detalle_documentos  where Numero_Emision in ('1343','1342','1341','1337','1336','1335','1334')
--and Oficina='01' and Municipio='02'

--delete from obl_detalle_vehiculo  where Numero_Emision in ('1343','1342','1341','1337','1336','1335','1334')
--and Oficina='01' and Municipio='02'

--delete from obl_datos_vehiculo  where Numero_Emision in ('1343','1342','1341','1337','1336','1335','1334')
--and Oficina='01' and Municipio='02'

puerta de enlace 10.9.17.221

-----------------------------------------------------------------------------------------------------------
##determina los morosos de obligaciones informativas mensuales  de hospedaje  de todos los municipios reyes


USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = dbo.[pa_Co_Determina_Listado_Morosos_Inf_Hospedaje_requeridos]
		@Ejercicio = N'2013',
		@Mes_Inicio =N'09',
		@Mes_Fin = N'09',
		@Tipo_Periodo_Hospedaje_Informativa = N'12',
		@Rubro_Hospedaje =N'010104'--,
		--@Municipio = N'01'

SELECT	'Return Value' = @return_value

GO

##determina los morosos de obligaciones informativas anuales  de todos los municipios
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Co_Determina_Listado_Morosos_Informativas_Anual]
		@Ejercicio = N'2012',
		--@Mes_Inicio = N'01',
		--@Mes_Fin = N'12',
		@Tipo_Periodo_Anual_Informativa = N'17',
		--@Municipio = N'01',
		@Rubros_Informativas_Anuales='010102'

SELECT	'Return Value' = @return_value

GO





--------------------------------

listado de contribuyentes y sus periodos morosos y declarados entre enero- julio 2013

estatales mensuales
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Co_Contribuyentes_Est_Declaraciones_Morosidad]
		@Ejercicio = N'2013',
		@Tipo_Periodo = N'02',
		@Mes_Inicial=1,
		@MEs_Final=7,
		@Municipio = N'01',
		@Clave_Obligacion = N'010103'

SELECT	'Return Value' = @return_value

GO





este funciona para ilepal
listado de contribuyentes y sus periodos morosos y declarados entre enero- julio 2013
[pa_Co_Contribuyentes_Est_Declaraciones_Morosidad_EN_PRUEBAS]

---------------------------------
iforex 
lizardi_w@hotmail.com	
wjrkMH08
---------------------------------
procedimientos para reportes en excel gabo, gerardo

todas las tablas que comienzan con rep_


---------------------------------------
correo samuel santos frias 
capfiscal@hotmail.com

------------------------------------------
--store jorge informe istuv secretario

USE

 [ingresos]
 GO
 DECLARE

 @return_value int
 EXEC

 @return_value = [dbo].[pa_Tableros_Emisiones_ISTUV]
 
@Ejercicio_Fiscal = N'2013'
 SELECT

 'Return Value' = @return_value
GO



--store jorge informe estatales secretario
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Tableros_Emisiones_Estatales]
		@Ejercicio = N'2013',
		@Mes_Inicial = 01,
		@Mes_Final = 08,
		@Tipo_Periodo = 02,
		@Clave_Obligacion_Est = N'010104'

SELECT	'Return Value' = @return_value

GO



--store sirref store jorge informe secretario
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Tableros_Emisiones_SIRREF]
		@Ejercicio = N'2013'


SELECT	'Return Value' = @return_value

GO

----------------------


checar que onda con la 1347 jorge sanchez 
---------------------
uneme dedicam

8351930 ext4831
------------------------------------------
monitorear las informativas


verificar los pagos espontaneos
EXEC [dbo].[marcar_pagos_espontaneos_estatales]
	@rfc='RFC',
	@clave_periodicidad='PEDIODI',
	@mes='MES',
	@anio_moroso='',
	@clave_obligacion='',
	@tipo_cancelacion='infotrib'


marcar el pago
 UPDATE obl_detalle_sucursales 
SET Pagado='S', Numero_Operacion='0000000'
where rfc='AAGF640420GV6' 
and Clave_Periodicidad='17' 
and Clave_Obligacion='010102'
and Anio_Moroso='2012' 
--and Mes='00' 
--and Numero_Establecimiento='01001' este cuando lo cambiemos a detalle de establecimiento


select * from obl_control_emisiones where Clave_Periodicidad in ('12','17')	

select * from obl_detalle_sucursales where Clave_Periodicidad in ('12','17') and Pagado='S'
	


---------------------------------------------
enviar listado de 13000 a carlos amaro

select* from dbo.dec_informativa_hospedaje where No_Operacion is null and Pagado='N' 

SELECT a.RFC as RFC,
       '' as Numero_Serie,
       '' AS REC,
       b.Numero AS Numero_Establecimiento,
       c.Clave as Clave_Obligacion,
       Year(a.Fecha_Inicial) as Anio_Inicial,
       Month(a.Fecha_Inicial) as Mes_Inicial,
       a.Fecha_Inicial as Fecha_Inicial,
       MIN(Year(a.Fecha_Final)) as Anio_Final,
       MIN(Month(a.Fecha_Final)) as Mes_Final,
       MIN(a.Fecha_Final) as Fecha_Final,
       MIN(a.Pago_Fecha) as Fecha_Declarado,
       MIN(a.No_Operacion) as No_Operacion,
       '12' as Tipo_Periodo,
       'T' as Estado,
       'Mn' as Tipo_Presentacion,
       MIN(Year(a.Pago_Fecha)) as Ejercicio_Fiscal,
       NULL as Fuente_Informacion,
       MIN(a.Pago_Municipio) as Municipio,
       MIN(a.Pago_Recaudadora) as Oficina
       
       FROM dbo.dec_informativa_hospedaje as a
       left join pad_establecimientos as b
       on a.RFC=b.RFC
       left join pad_obligacionesporestablecimiento as c
       on b.RFC=c.RFC and b.Numero=c.Numero_Establecimiento 
       WHERE c.Clave='010104' and c.Situacion='Activo' and b.Situacion='Activo' 
       and No_Operacion is null and Pago_Fecha is null and pagado='N' 
       and Month(a.fecha_inicial ) between '1' and '3' and Year(a.fecha_inicial )='2013'
       GROUP BY A.RFC, Numero, Clave, Year(a.Fecha_Inicial),  Month(a.Fecha_Inicial), a.Fecha_Inicial


--listado de pagos que tienen referencia pero que no imprimieron acuse agrupado por todas las referencias

--ilepal
select  
a.RFC
,min(a.Nombre),max(a.Domicilio) as Domicilio,max(a.Colonia),max(a.Codigo_Postal),max(a.Numero_Interior),
max(a.Numero_Exterior),max(a.Localidad),min(a.Municipio),min(a.Referencia),min(a.Fecha_Inicial),min(a.Fecha_Final),min(a.Alta_Fecha),min(a.	No_Operacion),min(a.	Pagado)
,min(a.	Tipo_Declaracion),min(b.Numero_Emision),min(b.Numero_Establecimiento),min(b.	Folio_Impresion), b.	Anio_Moroso,min(b.	Numero_Operacion)
,b.	Pagado,b.	Clave_Obligacion,d.Nombre as Estatus,c.	Clave_Notificador,b.Municipio,b.Oficina 

from (select * from dec_informativa_hospedaje_anual 
where (Referencia is not null and Alta_Fecha  is not null) 
and No_Operacion is null and month(Fecha_Inicial ) = '01'  and YEAR (Fecha_Inicial )='2012'
) as a
left join obl_detalle_sucursales as b on a.RFC=b.RFC and b.Clave_Obligacion='010102' and b.Clave_Periodicidad='17' and b.Anio_Moroso='2012'
left join obl_detalle_documentos as c on b.Folio_Impresion=c.Folio_Impresion and b.Numero_Emision=c.Numero_Emision and b.Municipio=c.Municipio and 
b.Oficina=c.Oficina and c.Movimiento='R1'
left join obl_nombres_estatus as d on c.Status=d.Clave 
where --a.RFC='PETM531115CK4' and 
a.rfc is not null and a.rfc not in ('')
group by a.rfc,  a.fecha_inicial, a.fecha_final,b.numero_emision,  b.folio_impresion, b.anio_moroso, 
 b.pagado, b.clave_obligacion, d.Nombre, c.clave_notificador, b.municipio, b.oficina
order by rfc


--hospedaje
select  
--a.RFC,a.Nombre,a.Domicilio,a.Colonia,a.Codigo_Postal,a.Numero_Interior,
--a.Numero_Exterior,a.Localidad,a.Municipio,a.Referencia,a.Fecha_Inicial,a.Fecha_Final,a.	Alta_Fecha,a.	No_Operacion,a.	Pagado
--,a.	Tipo_Declaracion,b.	Numero_Emision,b.	Numero_Establecimiento,b.	Folio_Impresion,b.	Anio_Moroso,b.	Numero_Operacion
--,b.	Pagado,b.	Clave_Obligacion,d.Nombre as Estatus,c.	Clave_Notificador,
--b.Municipio,b.Oficina 
a.RFC
,min(a.Nombre),max(a.Domicilio) as Domicilio,max(a.Colonia),max(a.Codigo_Postal),max(a.Numero_Interior),
max(a.Numero_Exterior),max(a.Localidad),min(a.Municipio),min(a.Referencia),min(a.Fecha_Inicial),min(a.Fecha_Final),min(a.Alta_Fecha),min(a.	No_Operacion),min(a.	Pagado)
,min(a.	Tipo_Declaracion),min(b.Numero_Emision),min(b.Numero_Establecimiento),min(b.	Folio_Impresion), b.	Anio_Moroso,min(b.	Numero_Operacion)
,b.	Pagado,b.	Clave_Obligacion,d.Nombre as Estatus,c.	Clave_Notificador,b.Municipio,b.Oficina 


from (select * from dec_informativa_hospedaje 
where (Referencia is not null and Alta_Fecha  is not null) 
and No_Operacion is null and month(Fecha_Inicial ) between '01' and '04'  and YEAR (Fecha_Inicial )='2013'
) as a
left join obl_detalle_sucursales as b on a.RFC=b.RFC and b.Clave_Obligacion='010104' and b.Clave_Periodicidad='12' and b.Anio_Moroso='2013'
and MONTH(a.Fecha_Inicial)=b.Mes 
left join obl_detalle_documentos as c on b.Folio_Impresion=c.Folio_Impresion and b.Numero_Emision=c.Numero_Emision and b.Municipio=c.Municipio and 
b.Oficina=c.Oficina and c.Movimiento='R1'
left join obl_nombres_estatus as d on c.Status=d.Clave 
where --a.RFC=' CMO931124K69' and 
a.rfc is not null and a.rfc not in ('')
group by a.rfc,  a.fecha_inicial, a.fecha_final,b.numero_emision,  b.folio_impresion, b.anio_moroso, 
 b.pagado, b.clave_obligacion, d.Nombre, c.clave_notificador, b.municipio, b.oficina
order by rfc



--materiales
select  
--a.RFC,a.Nombre,a.Domicilio,a.Colonia,a.Codigo_Postal,a.Numero_Interior,
--a.Numero_Exterior,a.Localidad,a.Municipio,a.Referencia,a.Fecha_Inicial,a.Fecha_Final,a.	Alta_Fecha,a.	No_Operacion,a.	Pagado
--,a.	Tipo_Declaracion,b.	Numero_Emision,b.	Numero_Establecimiento,b.	Folio_Impresion,b.	Anio_Moroso,b.	Numero_Operacion
--,b.	Pagado,b.	Clave_Obligacion,d.Nombre as Estatus,c.	Clave_Notificador,b.Municipio,b.Oficina 

a.RFC
,min(a.Nombre),max(a.Domicilio) as Domicilio,max(a.Colonia),max(a.Codigo_Postal),max(a.Numero_Interior),
max(a.Numero_Exterior),max(a.Localidad),min(a.Municipio),min(a.Referencia),min(a.Fecha_Inicial),min(a.Fecha_Final),min(a.Alta_Fecha),min(a.	No_Operacion),min(a.	Pagado)
,min(a.	Tipo_Declaracion),min(b.Numero_Emision),min(b.Numero_Establecimiento),min(b.	Folio_Impresion), b.	Anio_Moroso,min(b.	Numero_Operacion)
,b.	Pagado,b.	Clave_Obligacion,d.Nombre as Estatus,c.	Clave_Notificador,b.Municipio,b.Oficina 


from (select * from dec_informativa_extraccion 
where (Referencia is not null and Alta_Fecha  is not null) 
and No_Operacion is null and month(Fecha_Inicial ) = '01'  and YEAR (Fecha_Inicial )='2012'
) as a
left join obl_detalle_sucursales as b on a.RFC=b.RFC and b.Clave_Obligacion='010106' and b.Clave_Periodicidad='17' and b.Anio_Moroso='2012'
left join obl_detalle_documentos as c on b.Folio_Impresion=c.Folio_Impresion and b.Numero_Emision=c.Numero_Emision and b.Municipio=c.Municipio and 
b.Oficina=c.Oficina and c.Movimiento='R1'
left join obl_nombres_estatus as d on c.Status=d.Clave 
where --a.RFC=' CMO931124K69' and 
a.rfc is not null and a.rfc not in ('')
group by a.rfc,  a.fecha_inicial, a.fecha_final,b.numero_emision,  b.folio_impresion, b.anio_moroso, 
 b.pagado, b.clave_obligacion, d.Nombre, c.clave_notificador, b.municipio, b.oficina
order by rfc







--------------------------------

correjidas de las emisiones de sirref ninis ago 2013 genaro

308
104
116
408
420
432
444
---------------------------------

desinstalar el ie8 cuando no pueda ver bien el navegador e instalar el ie7
presionar f12 y cambiar el explorador al 7
--------------------------------------------------------------------------
--actualizo los requeridos de informativas hospedaje que no tenian no de operacion 
update obl_detalle_documentos 
set SubStatus=c.Status, status=case when c.fecha_impresion<a.Alta_Fecha then 'P' else 'T' end, Fecha_Ultimo_Movimiento=GETDATE(), usuario_cancelacion='INFO'
from (select * from dec_informativa_hospedaje 
where (Referencia is not null and Alta_Fecha  is not null) 
and No_Operacion is null and month(Fecha_Inicial ) between '01' and '04'  and YEAR (Fecha_Inicial )='2013'
) as a
left join obl_detalle_sucursales as b on a.RFC=b.RFC and b.Clave_Obligacion='010104' and b.Clave_Periodicidad='12' and b.Anio_Moroso='2013'
and MONTH(a.Fecha_Inicial)=b.Mes 
left join obl_detalle_documentos as c on b.Folio_Impresion=c.Folio_Impresion and b.Numero_Emision=c.Numero_Emision and b.Municipio=c.Municipio and 
b.Oficina=c.Oficina --and c.Movimiento='R1'
left join obl_nombres_estatus as d on c.Status=d.Clave 
where --a.RFC=' AFL8710051R9' and 
a.rfc is not null and a.rfc not in ('') and  b.Numero_Emision is not null and c.Status  not in ('T','P','U','F')
-----------------------------------------------------
inserto los que no tienen numero de operacion de materiales
INSERT INTO obl_obligacion_vigilable_presentada

(

            [RFC],

            [Numero_Serie],

            [REC],

            [Numero_Establecimiento],

            [Clave_Obligacion],

            [Anio_Inicial],

            [Mes_Inicial],

            [Fecha_Inicial],

            [Anio_Final],

            [Mes_Final],

            [Fecha_Final],

            [Fecha_Declarado],

            [No_Operacion],

            [Tipo_Periodo],

            [Estado],

            [Tipo_Presentacion],

            [Ejercicio_Fiscal],

            [Fuente_Informacion],

            [Municipio],

            [Oficina]
)
select  
--a.RFC,a.Nombre,a.Domicilio,a.Colonia,a.Codigo_Postal,a.Numero_Interior,
--a.Numero_Exterior,a.Localidad,a.Municipio,a.Referencia,a.Fecha_Inicial,a.Fecha_Final,a.	Alta_Fecha,a.	No_Operacion,a.	Pagado
--,a.	Tipo_Declaracion,b.	Numero_Emision,b.	Numero_Establecimiento,b.	Folio_Impresion,b.	Anio_Moroso,b.	Numero_Operacion
--,b.	Pagado,b.	Clave_Obligacion,d.Nombre as Estatus,c.	Clave_Notificador,b.Municipio,b.Oficina 

--a.RFC
--,min(a.Nombre),max(a.Domicilio) as Domicilio,max(a.Colonia),max(a.Codigo_Postal),max(a.Numero_Interior),
--max(a.Numero_Exterior),max(a.Localidad),min(a.Municipio),min(a.Referencia),min(a.Fecha_Inicial),min(a.Fecha_Final),min(a.Alta_Fecha),min(a.	No_Operacion),min(a.	Pagado)
--,min(a.	Tipo_Declaracion),min(b.Numero_Emision),min(b.Numero_Establecimiento),min(b.	Folio_Impresion), b.	Anio_Moroso,min(b.	Numero_Operacion)
--,b.	Pagado,b.	Clave_Obligacion,d.Nombre as Estatus,c.	Clave_Notificador,b.Municipio,b.Oficina 

a.RFC as RFC,
       '' as Numero_Serie,
       '' AS REC,
       '00000' AS Numero_Establecimiento,
       '010106' as Clave_Obligacion,
       Year(a.Fecha_Inicial) as Anio_Inicial,
       Month(a.Fecha_Inicial) as Mes_Inicial,
       a.Fecha_Inicial as Fecha_Inicial,
       Year(a.Fecha_Final) as Anio_Final,
       Month(a.Fecha_Final) as Mes_Final,
       a.Fecha_Final as Fecha_Final,
       min(a.Alta_Fecha ) as Fecha_Declarado,
       min(SUBSTRING ( a.Referencia ,4,14)) as No_Operacion,
       '17' as Tipo_Periodo,
       'T' as Estado,
       'An' as Tipo_Presentacion,
       min(Year(a.Alta_Fecha )) as Ejercicio_Fiscal,
       NULL as Fuente_Informacion,
       min(a.Pago_Municipio) as Municipio,
       min(a.Pago_Recaudadora) as Oficina
from (select * from dec_informativa_extraccion 
where (Referencia is not null and Alta_Fecha  is not null) 
and No_Operacion is null and month(Fecha_Inicial ) = '01'  and YEAR (Fecha_Inicial )='2012'
) as a
left join obl_detalle_sucursales as b on a.RFC=b.RFC and b.Clave_Obligacion='010106' and b.Clave_Periodicidad='17' and b.Anio_Moroso='2012'
left join obl_detalle_documentos as c on b.Folio_Impresion=c.Folio_Impresion and b.Numero_Emision=c.Numero_Emision and b.Municipio=c.Municipio and 
b.Oficina=c.Oficina and c.Movimiento='R1'
left join obl_nombres_estatus as d on c.Status=d.Clave 
where --a.RFC=' CMO931124K69' and 
a.rfc is not null and a.rfc not in ('')
group by a.rfc,  a.fecha_inicial, a.fecha_final,b.numero_emision,  b.folio_impresion, b.anio_moroso, 
 b.pagado, b.clave_obligacion, d.Nombre, c.clave_notificador, b.municipio, b.oficina
order by rfc


actualizo materiales requeridos
update obl_detalle_documentos 
set SubStatus=Status, Status='T', Fecha_Ultimo_Movimiento=GETDATE(), usuario_cancelacion='INFO'
where Numero_Emision='1352' and Folio_Impresion in ('8','1') 


---------------------



inserto ilepal informativas que no tenian numero de operacion
--ilepal
INSERT INTO obl_obligacion_vigilable_presentada

(

            [RFC],

            [Numero_Serie],

            [REC],

            [Numero_Establecimiento],

            [Clave_Obligacion],

            [Anio_Inicial],

            [Mes_Inicial],

            [Fecha_Inicial],

            [Anio_Final],

            [Mes_Final],

            [Fecha_Final],

            [Fecha_Declarado],

            [No_Operacion],

            [Tipo_Periodo],

            [Estado],

            [Tipo_Presentacion],

            [Ejercicio_Fiscal],

            [Fuente_Informacion],

            [Municipio],

            [Oficina]
)

select  

a.RFC as RFC,
       '' as Numero_Serie,
       '' AS REC,
       '00000' AS Numero_Establecimiento,
       '010102' as Clave_Obligacion,
       Year(a.Fecha_Inicial) as Anio_Inicial,
       Month(a.Fecha_Inicial) as Mes_Inicial,
       a.Fecha_Inicial as Fecha_Inicial,
       Year(a.Fecha_Final) as Anio_Final,
       Month(a.Fecha_Final) as Mes_Final,
       a.Fecha_Final as Fecha_Final,
       min(a.Alta_Fecha ) as Fecha_Declarado,
       min(SUBSTRING ( a.Referencia ,4,14)) as No_Operacion,
       '17' as Tipo_Periodo,
       'T' as Estado,
       'An' as Tipo_Presentacion,
       min(Year(a.Alta_Fecha )) as Ejercicio_Fiscal,
       NULL as Fuente_Informacion,
       min(a.Pago_Municipio) as Municipio,
       min(a.Pago_Recaudadora) as Oficina

from (select * from dec_informativa_hospedaje_anual 
where (Referencia is not null and Alta_Fecha  is not null) 
and No_Operacion is null and month(Fecha_Inicial ) = '01'  and YEAR (Fecha_Inicial )='2012'
) as a
left join obl_detalle_sucursales as b on a.RFC=b.RFC and b.Clave_Obligacion='010102' and b.Clave_Periodicidad='17' and b.Anio_Moroso='2012'
left join obl_detalle_documentos as c on b.Folio_Impresion=c.Folio_Impresion and b.Numero_Emision=c.Numero_Emision and b.Municipio=c.Municipio and 
b.Oficina=c.Oficina and c.Movimiento='R1'
left join obl_nombres_estatus as d on c.Status=d.Clave 
where --a.RFC='PETM531115CK4' and 
a.rfc is not null and a.rfc not in ('') --and  b.Numero_Emision is not null and  c.Status  not in ('T','P','H','U','F')
group by a.rfc,  a.fecha_inicial, a.fecha_final,b.numero_emision,  b.folio_impresion, b.anio_moroso, 
 b.pagado, b.clave_obligacion, d.Nombre, c.clave_notificador, b.municipio, b.oficina
order by b.Numero_Emision , b.Folio_Impresion ,a.rfc

actualizo detalle_documentos 
update obl_detalle_documentos 
set SubStatus=Status, Status='T', Fecha_Ultimo_Movimiento=GETDATE(), usuario_cancelacion='INFO'
where Numero_Emision='1351' and Folio_Impresion in ('25','41','45','54','117') 


---------------------------------------------------
PREGUNTAS PARA ARMAR EL ESQUEMA DE REQUERIR LICENCIAS DE FUNCIONAMIENTO
hay requerimiento?
se deriva alguna multa despues de esta multa?
cuantas veces se asignará
hay proceso normal de impreso asignado, cancelado etc?
como aplican los contribuyentes no localizables?
hay obligacion /establecimiento/ contribuyente?

------------------------------------------------------
ejecuta tablero de ceros y unos para saber todas las emisiones generadas 

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Tableros_Emisiones_Generadas]
		@Ejercicio = N'2013'
		

SELECT	'Return Value' = @return_value

GO


CHECAR LA FECHA DE INICIO Y FIN DE LAS ESTATALES Y FEDERALES

------------------------------------
CHECAR  GASOLINAS ESTA MAL FECHA INICIO FECHA FIN

--------------------------------------------------------------
total de emisiones generadas por municipio por mes


mensual
select 

	min(d.Clave)+'-'+min(d.Nombre) as Municipio ,
		min(e.Clave)+'-'+min(e.Nombre) as Oficina ,
MIN(clave_obligacion) as Clave_Obligacion,
min(c.Descripcion) as Obligacion,
 MIN(Anio_Moroso ) as Anio_Moroso, 
CASE WHEN clave_periodicidad='02' THEN 'MENSUAL' 
WHEN clave_periodicidad='12' THEN 'MENSUAL INFORMATIVA'  
WHEN clave_periodicidad='03' THEN 'BIMESTRAL'  
WHEN clave_periodicidad='07' THEN 'ANUAL'
WHEN clave_periodicidad='17' THEN 'ANUAL INFORMATIVA' END AS Clave_Periodicidad,
SUM (enero) as Enero, 
SUM (febrero) as Febrero,
SUM (Marzo) as Marzo,
SUM (Abril) as Abril,
SUM (Mayo) as Mayo,
SUM (Junio) as Junio,
SUM (Julio) as Julio,
SUM (Agosto) as Agosto,
SUM (Septiembre) as Septiembre,
SUM (Octubre) as Octubre,
SUM (Noviembre) as Noviembre,
SUM (Diciembre) as Diciembre
from (
select  municipio, oficina, Clave_Obligacion, Anio_Moroso ,Clave_Periodicidad,
		case when Periodo_Inicial='01' then 1 else 0 end as enero,
		case when Periodo_Inicial='02' then 1 else 0 end as Febrero,
		case when Periodo_Inicial='03' then 1 else 0 end as Marzo,
		case when Periodo_Inicial='04' then 1 else 0 end as Abril,
		case when Periodo_Inicial='05' then 1 else 0 end as Mayo,
		case when Periodo_Inicial='06' then 1 else 0 end as Junio,
		case when Periodo_Inicial='07' then 1 else 0 end as Julio,
		case when Periodo_Inicial='08' then 1 else 0 end as Agosto,
		case when Periodo_Inicial='09' then 1 else 0 end as Septiembre,
		case when Periodo_Inicial='10' then 1 else 0 end as Octubre,
		case when Periodo_Inicial='11' then 1 else 0 end as Noviembre,
		case when Periodo_Inicial='12' then 1 else 0 end as Diciembre
		
--select * 
from obl_control_emisiones 
where Anio_Moroso ='2013' --and Municipio='04' 
and Clave_Obligacion IN ('010103','010104','010611','010622') ) as t
join cat_obligaciones as c on t.Clave_Obligacion=c.Clave
               join cat_municipios as d on t.Municipio=d.Clave  
               join cat_oficinas as e on t.Oficina=e.Clave and t.Municipio=e.Clave_Municipio
group by t.Municipio, t.oficina, t.Clave_Obligacion, t.clave_periodicidad,t.Anio_Moroso 
ORDER BY t.Municipio, t.Clave_Obligacion, t.Clave_Periodicidad 


--bimestral 

select 
	min(d.Clave)+'-'+min(d.Nombre) as Municipio ,
		min(e.Clave)+'-'+min(e.Nombre) as Oficina ,
MIN(clave_obligacion) as Clave_Obligacion,
min(c.Descripcion) as Obligacion,
MIN(Anio_Moroso ) as Anio_Moroso, 
CASE WHEN clave_periodicidad='02' THEN 'MENSUAL' 
WHEN clave_periodicidad='12' THEN 'MENSUAL INFORMATIVA'  
WHEN clave_periodicidad='03' THEN 'BIMESTRAL'  
WHEN clave_periodicidad='07' THEN 'ANUAL'
WHEN clave_periodicidad='17' THEN 'ANUAL INFORMATIVA' END AS Clave_Periodicidad,
SUM (ENE_FEB) as ENE_FEB, 

SUM (MAR_ABR) as MAR_ABR,

SUM (MAY_JUN) as MAY_JUN,

SUM (JUL_AGO) as JUL_AGO,

SUM (SEP_OCT) as SEP_OCT,

SUM (NOV_DIC) as NOV_DIC

from (
select  municipio, oficina, Clave_Obligacion, Anio_Moroso ,Clave_Periodicidad,
		case when Periodo_Inicial='01' then 1 else 0 end as ENE_FEB,
		case when Periodo_Inicial='03' then 1 else 0 end as MAR_ABR,
		case when Periodo_Inicial='05' then 1 else 0 end as MAY_JUN,
		case when Periodo_Inicial='07' then 1 else 0 end as JUL_AGO,
		case when Periodo_Inicial='09' then 1 else 0 end as SEP_OCT,
		case when Periodo_Inicial='11' then 1 else 0 end as NOV_DIC
		
--select * 
from obl_control_emisiones 
where Anio_Moroso ='2013' --and Municipio='04' 
and Clave_Obligacion IN ('010102','010610') ) as t
join cat_obligaciones as c on t.Clave_Obligacion=c.Clave
               join cat_municipios as d on t.Municipio=d.Clave  
               join cat_oficinas as e on t.Oficina=e.Clave and t.Municipio=e.Clave_Municipio
group by t.Municipio, t.oficina, t.Clave_Obligacion, t.clave_periodicidad,t.Anio_Moroso 
ORDER BY t.Municipio, t.Clave_Obligacion, t.Clave_Periodicidad 



--anual istuv
select
	min(d.Clave)+'-'+min(d.Nombre) as Municipio ,
		min(e.Clave)+'-'+min(e.Nombre) as Oficina ,
MIN(clave_obligacion) as Clave_Obligacion,
min(c.Descripcion) as Obligacion,
MIN(Anio_Moroso ) as Anio_Moroso, 
CASE WHEN clave_periodicidad='02' THEN 'MENSUAL' 
WHEN clave_periodicidad='12' THEN 'MENSUAL INFORMATIVA'  
WHEN clave_periodicidad='03' THEN 'BIMESTRAL'  
WHEN clave_periodicidad='07' THEN 'ANUAL'
WHEN clave_periodicidad='17' THEN 'ANUAL INFORMATIVA' END AS Clave_Periodicidad,
SUM (ENE_DIC) as ENE_DIC

from (
select  municipio, oficina, Clave_Obligacion, Anio_Moroso ,Clave_Periodicidad,
		case when Periodo_Inicial='00' then 1 else 0 end as ENE_DIC
		
--select * 
from obl_control_emisiones 
where Ejercicio_Fiscal  ='2013' --and Municipio='04' 
and Clave_Obligacion IN ('010603') ) as t
join cat_obligaciones as c on t.Clave_Obligacion=c.Clave
               join cat_municipios as d on t.Municipio=d.Clave  
               join cat_oficinas as e on t.Oficina=e.Clave and t.Municipio=e.Clave_Municipio
group by t.Municipio, t.oficina, t.Clave_Obligacion, t.clave_periodicidad,t.Anio_Moroso 
ORDER BY t.Municipio, t.Clave_Obligacion, t.Clave_Periodicidad 






-----------------------------
ejecuta tablero para saber los contribuyentes activos de nomina cuanto nos pagaron en julio, agosto septiembre octubre
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Tableros_Declaraciones_Nomina_Informe]
		@Anio_Inicial = N'2013',
		@Anio_Final = N'2013',
		@Mes_Inicial = 7,
		@Mes_Final = 10,
		@Clave_Obligacion_Est = N'010103'

SELECT	'Return Value' = @return_value

GO
------------------------------------------------------
sacar listado de morosos de repecos

Municipio_Contribuyente	Municipio_Nombre	RFC	Nombre	Obligación	Periodos_Morosos	Emisiones	Actividad	Nombre Establecimiento	Municipio_Establecimiento	Domicilio_Calle	Domicilio_Número	Domicilio_Colonia	Domicilio_Ubicación	Domicilio_Codigo_Postal

09	TULUM	AABI790516GL1	ISIDRO HUMBERTO ALVAREZ BAEZA	ISR REPECOS	 JUL-AGO 2013, SEP-OCT 2013	 M:09 E: 1312 F: 353 Periodo: 03-04 2013	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
09	TULUM	AACJ770519PFA	JUAN MIGUEL ALDANA CAUICH	ISR REPECOS	 NOV-DIC 2010, ENE-FEB 2011, MAR-ABR 2011, MAY-JUN 2011, JUL-AGO 2011, SEP-OCT 2011, NOV-DIC 2011, ENE-FEB 2012, MAR-ABR 2012, MAY-JUN 2012, JUL-AGO 2012, SEP-OCT 2012, NOV-DIC 2012, ENE-FEB 2013, MAR-ABR 2013, MAY-JUN 2013, JUL-AGO 2013, SEP-OCT 2013	 M:09 E: 1302 F: 44 Periodo: 11-12 2012, M:08 E: 0824 F: 822 Periodo: 07-08 2008	REP. APAR. ELECT. Y AIRE ACOND.	MULTISERVICIOS DE LA RIVIERA	09	AV NEPTUNO OTE	S/N	TULUM	ENTRE BETA SUR Y ORION SUR	77780


limpio ingresos.dbo.RFCNOLOC_REPECOS

delete from ingresos.dbo.RFCNOLOC_REPECOS
delete from ingresos.dbo.RES_VIG_MOROSIDAD_REPECOS


inserto los rfcs que voy a vigilar en este caso son del municipio 09
insert into ingresos.dbo.RFCNOLOC_REPECOS
select distinct(rfc) 

from 
(select distinct(a.rfc)
from pad_obligacionesporestablecimiento  as a
INNER JOIN pad_contribuyentes as c on a.RFC=c.rfc
where a.Situacion='Activo' --and b.Situacion='Activo' 
and c.Situacion='Activo'
and a.Clave in ('010610') and  c.Municipio='09') as x


--ejecuto

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_SOLO_REPECOS]

SELECT	'Return Value' = @return_value

GO



--saco la estadistica
	select 
			 m.Municipio_Contribuyente,m.Municipio_Nombre, m.RFC,n.Nombres+' '+n.Apellido_Paterno+' '+n.Apellido_Materno as Nombre,
			 m.Obligacion, m.Periodos_Morosos, m.Emisiones, cat_giros.Descripcion as Actividad, o.Nombre as Nombre_Establecimiento, 
			 o.Municipio as Municipio_Establecimiento, o.Domicilio_Calle, o.Domicilio_Numero, o.Domicilio_Colonia,
			 o.Domicilio_Ubicacion, o.Domicilio_Codigo_Postal 
			 
			  from 
			(SELECT	min(G.MPO_CON) as Municipio_Contribuyente,min(mun.Nombre) as Municipio_Nombre,G.RFC,
				min(b.Descripcion) as Obligacion, 
				c.Descripcion_Tipo_Periodo,
				STUFF( (SELECT ', ' + c.Descripcion +' '+a.Ejercicio
						FROM RES_VIG_MOROSIDAD_REPECOS as a
						JOIN cat_obligaciones as b on a.Clave=b.Clave 
						JOIN cat_periodos as c ON a.Periodicidad=c.Tipo 
							AND a.Mes_Inicial =c.Mes_Inicial 
							AND a.Mes_Final=c.Mes_Final            
						WHERE a.rfc=G.rfc
							AND a.Numero_Establecimiento=G.Numero_Establecimiento 
							AND a.Clave=G.Clave 
							--AND a.Ejercicio=G.Ejercicio 
							AND a.Periodicidad=G.Periodicidad
							and a.NO_OPERACION  is null
						
						FOR XML PATH('') ), 1, 1, '' ) AS Periodos_Morosos,
			
			STUFF( (SELECT ', '+'M:'+W.Municipio+' E: '+cast(W.Numero_Emision as  VARCHAR)+' F: '+cast(W.Folio_Impresion as VARCHAR)+' Periodo: '+
			CAST(W.Mes_Inicial AS VARCHAR)+'-'+CAST(W.Mes_final AS VARCHAR)+' '+CAST(W.Anio_Moroso AS VARCHAR) 
					from INGRESOS.DBO.RES_VIG_MOROSIDAD_REPECOS  as S
					left join obl_datos_federales as W on S.RFC=W.RFC and S.Clave=W.Clave_Obligacion 
					and cast(S.mes_inicial as int)=cast(W.Mes_Inicial as int) and cast(S.mes_final  as int)=cast(W.Mes_Final as int)
					and cast(S.Ejercicio as int)=cast(W.Anio_Moroso as int) and cast(S.Periodicidad as int)=cast(W.Clave_Periodicidad  as int)
					where S.rfc=G.rfc and W.RFC  is not null 
					and S.clave=G.Clave 
					FOR XML PATH('')), 1, 1, '' ) AS Emisiones
		FROM RES_VIG_MOROSIDAD_REPECOS AS G
		JOIN cat_obligaciones as b on G.Clave=b.Clave 
		JOIN cat_periodos as c ON G.Periodicidad=c.Tipo 
		AND G.Mes_Inicial =c.Mes_Inicial AND G.Mes_Final=c.Mes_Final 
		JOIN cat_municipios mun on G.MPO_CON=mun.Clave 
		where  --RFC='CARD3409244L6'  and
		  STUFF( (SELECT ', ' + c.Descripcion 
						FROM RES_VIG_MOROSIDAD_REPECOS as a
						JOIN cat_obligaciones as b on a.Clave=b.Clave 
						JOIN cat_periodos as c ON a.Periodicidad=c.Tipo 
							AND a.Mes_Inicial =c.Mes_Inicial 
							AND a.Mes_Final=c.Mes_Final            
						WHERE a.rfc=G.rfc
							AND a.Numero_Establecimiento=G.Numero_Establecimiento 
							AND a.Clave=G.Clave 
							AND a.Ejercicio=G.Ejercicio 
							AND a.Periodicidad=G.Periodicidad
							and a.NO_OPERACION  is null
						ORDER BY c.Mes_Inicial
						FOR XML PATH('') ), 1, 1, '') is not NULL
						and G.Clave  in ('010610')
		GROUP BY G.RFC, G.Numero_Establecimiento, G.Clave, G.Periodicidad, c.Descripcion_Tipo_Periodo--,G.Ejercicio
		) as m JOIN pad_contribuyentes as n on m.rfc=n.RFC 
		left join pad_establecimientos o on m.rfc=o.RFC and o.Tipo_Establecimiento='Matriz' and o.Situacion='Activo'
		left join cat_giros  on o.Giro =cat_giros.Clave 
		






---------------------------------
sps para marcar y desmarcar los pagos en linea de istuv
('E','V','C','N','X','A','B','I','D') solo estos estatus se utilizan para saber si esta requerido

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[marcar_pagos_espontaneos_istuv]
		@numero_serie = N'LJCTABPB852000761',
		@anio_requerimiento = N'2006',
		@folio_pago = N'123456'

SELECT	'Return Value' = @return_value

GO


USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[cancelar_pagos_espontaneos_istuv]
		@numero_serie = N'LJCTABPB852000761',
		@anio_requerimiento = N'2006',
		@folio_pago = N'123456'

SELECT	'Return Value' = @return_value

GO


----------------------------------------------
cambiar el contenido de la fundamentacion de los requerimientos 2014

----------------------------------
--listar los requerimientos que no tienen numero de establecimiento de los ilepales 010102

select a.rfc, a.No_Operacion, a.Mes_Inicial, a.Mes_Final, a.Anio_Inicial, a.Anio_Final, a.Clave_Obligacion,c.Establecimiento 
from obl_obligacion_vigilable_presentada as a
join dec_ilepal_mensual  as b on a.No_Operacion =b.No_Operacion  and a.RFC =b.rfc
join dec_ilepal_mensual_det  as c on b.Referencia=c.referencia 
where a.Numero_Establecimiento='' and a.Ejercicio_Fiscal='2013' 
and Clave_Obligacion='010102' --and a.rfc='PIPP590622EQ8'


aqui actualizo el numero de estableicimiento en vigilable_presentada
update obl_obligacion_vigilable_presentada
set Numero_Establecimiento=c.Establecimiento 
from obl_obligacion_vigilable_presentada as a
join dec_ilepal_mensual  as b on a.No_Operacion =b.No_Operacion  and a.RFC =b.rfc
join dec_ilepal_mensual_det  as c on b.Referencia=c.referencia 
where a.Numero_Establecimiento='' and a.Ejercicio_Fiscal='2013' 
and Clave_Obligacion='010102' --and a.rfc='PIPP590622EQ8'
----------------------------------------------------
excel query para sacar las consultas en excel ramon
http://10.9.1.193/excel/excelquery.htm
-----------------------------------------------------
1:18:00

checar el caso de la declaracion 7-8 2013
select * from pad_contribuyentes where rfc='GOMA381226FX4'
--------------------------------------------------------
datos fofya
Los datos para revisar su solicitud son los siguientes  
NO. DE SOLICITUD :  19011 
FECHA DE SOLICITUD : 2014-01-06 
NOMBRE COMPLETO :  LILI LIZARDI RODRIGUEZ 
R.F.C.: LIRL830804S18 
DEPENDENCIA :  SECRETARÍA DE HACIENDA 

Los trámites o constancias solicitados son los siguientes 
 
FOFYA 
-----------------------------------------------------------

checar este procedimiento almacenado
me trae los contribuyentes qye generaron la licencias de funcionamiento en 2013 y los periodos morosos estatales y federales
[paCo_Determina_Morosidad_padron_CPY_Lic_Funcionamiento]
-------------------------------------------------------
aportaciones a cuatrimestral 3 2013

Generé el proceso de vigilancia de las obligaciones informativas para
Hospedaje  Mensual, ILEPAL anual y Extración de Materiales anual.

Generé la estadística de emisiones de morosos emitidas por las oficinas recaudadoras, 
para la creación de tableros informativos.

Generé el listado de contribuyentes que imprimieron su
licencia de funcionamiento 2013 y sus periodos morosos de 
las obligaciones estatales y federales.

Cambiar el contenido de la fundamentacion de los requerimientos 2014.


----____________________________-
documentos que se podrian cancelar de tenencias 2008 y anteriores

SELECT 
 emi.Municipio,a.nombre as Nombre_Municipio, emi.Oficina, b.Nombre  as Nombre_Oficina, emi.Numero_Emision,  docu.Folio_Impresion, 
 docu.Numero_Serie, 
 case when docu.Movimiento='R1' then 'Primer Requerimiento'  
 when  docu.Movimiento='I1' then 'Multa por Incumplimiento'
  end as Movimiento,
 docu.Status+' - '+d.Nombre as Estatus, 
 docu.SubStatus+' - '+e.Nombre as Subestatus, 
 ' S - Solventado por Insolvencia'  AS Estatus_para_cancelacion,
 docu.Fecha_Ultimo_Movimiento, vehi.Anio_Moroso, 
                      vehi.Numero_Operacion, --vehi.Pagado, vehi.Fecha_Pago,
                       vehi.Anio_Moroso
FROM         obl_control_emisiones AS emi INNER JOIN
                      obl_detalle_documentos AS docu ON emi.Municipio = docu.Municipio AND emi.Oficina = docu.Oficina AND emi.Numero_Emision = docu.Numero_Emision INNER JOIN
                      obl_detalle_vehiculo AS vehi ON emi.Municipio = vehi.Municipio AND docu.Municipio = vehi.Municipio AND docu.Oficina = vehi.Oficina AND 
                      docu.Numero_Emision = vehi.Numero_Emision AND docu.Folio_Impresion = vehi.Folio_Impresion
left join cat_municipios as a on emi.municipio=a.clave
left join cat_oficinas as b on emi.Oficina=b.clave  and a.clave=b.Clave_Municipio 
left join obl_nombres_estatus  as d on docu.Status=d.Clave 
left join obl_nombres_estatus  as e on docu.subStatus=e.Clave 
WHERE     (vehi.Anio_Moroso <=2008) and docu.Status in ('I','A','D','E','V','C','N','X')

--group by vehi.Numero_Serie 
order by Municipio, Oficina, Numero_Emision, Folio_Impresion, vehi.anio_moroso,Movimiento



------------------
-- lilyana con este sp cubrimos todo en 2013 de aplicar el descuento a las licencias de funcionamiento que eran repecos cumplidos
procedimiento  para generar el descuento para  licencias de bebal a los repecos cumplidos.
  
 USE [ingresos]
 GO
 DECLARE @return_value int
 EXEC @return_value = [dbo].[paCo_Generar_Cumplidos_Repecos_Bebal]
 SELECT 'Return Value' = @return_value
 GO

--con este lo aplicamos en 2014 directo revisando cada uno de los rfcs norberto patentes
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Patentes]
		@RFC = N'AAAT7901262N4'

SELECT	'Return Value' = @return_value

GO
  

HACER PRUEBAS CON ESTOS RFCS
--VELF780401AS2 MOROSO Y REQUERIDO

--AAAA5602226JA baja 

--AAAT7901262N4 MOROSO
 
--AUMJ611204EL7 cumplido
----------

--con este procedimiento reviso los adeudos de todos los rfcs  que se encuentran en el listado 

ALTER PROCEDURE [dbo].[paCo_Generar_Cumplidos_Repecos_Bebal_listado_otros_rfcs]




//este es el mas actual para sacar los morosos estatales 

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales]

SELECT	'Return Value' = @return_value

GO

//este sp me da el mismo resultado que el anterior solo que especifico por municipio obligacion y año
//lo intente subir a los reportes de excel pero no se puede
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Est_Rep_Excel]
		@Clave_Obligacion_Est=N'010104',
		@Anio_Inicial=N'2012',
		@Municipio=N'03'

SELECT	'Return Value' = @return_value

GO




-*------------------------------------------------------------
querys para mostrar en listado detallado de un cobro con el numero de referencia ramon

select  b.Municipio, b.Oficina, b.Numero_Emision, b. RFC, b.Folio_Impresion,
b.Nombre_Contribuyente, b.Apellido_Paterno, b.Apellido_Materno, b.Anio_Moroso, b.Mes_Inicial, b.Mes_Final,
b.Pagado, b.Clave_Obligacion, b.Clave_Periodicidad, b.Numero_Operacion, b.Nombre_Comercial
 from obl_obligacion_vigilable_presentada  as a
left join obl_datos_federales   as b on a.Mes_Inicial=b.Mes_Inicial  
and a.Anio_Inicial=b.Anio_Moroso 
and a.Clave_Obligacion=b.Clave_Obligacion 
and a.RFC=b.RFC 
and a.Tipo_Periodo=b.Clave_Periodicidad 
where no_operacion='01030110486903'


select 
 b.Municipio, b.Oficina, b.Numero_Emision, b. RFC, b.numero_establecimiento,
 b.Anio_Moroso, b.Mes,
b.Pagado, b.Clave_Obligacion, b.Clave_Periodicidad, b.Numero_Operacion
from obl_obligacion_vigilable_presentada  as a
left join obl_detalle_sucursales    as b on a.Mes_Inicial=b.Mes  
and a.Anio_Inicial=b.Anio_Moroso 
and a.Anio_Final =b.Anio_Moroso  
and a.Clave_Obligacion=b.Clave_Obligacion 
and a.RFC=b.RFC 
and a.Numero_Establecimiento=b.Numero_Establecimiento  
and a.Tipo_Periodo=b.Clave_Periodicidad 
where no_operacion='01010142951860'

------------------------------------------------
RPP QUERY QUE ME DICE QUE ONDA CON UNA REFERENCIA RAMON 

SELECT 
 a.Id,a.Referencia, 
 a.Pago_No_Operacion as No_Operacion, 
 a.Pago_Fecha,a.Fecha, 
 a.RFC,  
 a.Nombre, 
 b.id_dec_rpp_detalle as Id_Detalle,
 row_number() OVER (order BY b.id_dec_rpp_detalle) AS Renglon,
 
 b.Concepto, 
 (CASE WHEN Cantidad=0 THEN 1 ELSE Cantidad END)-Cantidad_Bloqueados-Cantidad_Usados as Cantidad, 
 round(b.tarifa * sm,0) as Precio_Unitario,
 ((CASE WHEN Cantidad=0 THEN 1 ELSE Cantidad END)-Cantidad_Bloqueados-Cantidad_Usados)* round(b.tarifa * sm,0) AS Importe,
 
 b.Tarifa,b.SM, 
 1 as Editar_Cantidad 
    
    FROM dec_rpp as a inner join 
    dec_rpp_detalle as b
    on a.Id=b.Id_dec_rpp 
    WHERE Referencia='70010000214585684' and [Status]<>'0'

----------------------------------------------------------
--valida que se escriba un numero en el campo de texto y que el numero se encuentre en un  intervalo y si es letra borra el campo rpp
  <script>
      
       
       function valida_captura(name)
        {                                           
          if (name.value.length==0)        
            {
            alert('Escriba una cantidad.')   ;
            name.focus();         
            return true;
           }
         else {
          
            return false;
         }
        }
      
      
      function validaNum(n,mini,maxi,name)
       {
       
         if (!isNaN(n)) //verifico si es un numero
         {
           n = parseInt(n); //lo convierto a entero
           if ( n<mini || n>maxi ) 
               {alert("Sobrepasará el máximo permitido");  //si no esta en el intervalo envio el mensaje
                name.value="";      
                //         document.formulario_guardar.[name].value = "";
                
               //document.formulario_guardar.guardar[this.value][Cantidad_Usados].defaultValue = ""; poner aqui borre la cantidad en el campo
               }
           else
               {
                  return false;
               }
         }
        else 
         {
           name.value="";  //si es una letra borro los datos
         }
       }
      </script>

------------------------------------------------------------------

--Universo de patentes por Municipio norberto bebal 
select municipio_establecimiento,MIN(b.Descripcion) as Municipio, COUNT(*) as Total
from pad_patentes as a
left join cat_municipios as b on b.Clave=a.Municipio_Establecimiento
where a.Activado='S'
group by Municipio_Establecimiento
order by Municipio_Establecimiento

--Total de Patentes pagadas 2014
select COUNT(*) 
from mov_efectuados
where Pagado='S' and Id_Tipo_Movimiento='2' and Anio_Fiscal='2014'

--Total de Patentes pagadas 2014 por municipio
select b.Municipio_Establecimiento,MIN(c.Descripcion) as Municipio,COUNT(*) 
from mov_efectuados as a
inner join pad_patentes as b on a.Numero_Licencia=b.Numero_Licencia
left join cat_municipios as c on c.Clave=a.Municipio_Establecimiento
where Pagado='S' and a.Id_Tipo_Movimiento='2' and a.Anio_Fiscal='2014'
group by b.Municipio_Establecimiento

--Total de patentes que adeudan 2013 por municipio
select b.Municipio_Establecimiento,COUNT(*),MIN(c.Descripcion) as Municipio 
from mov_efectuados as a
inner join pad_patentes as b on a.Numero_Licencia=b.Numero_Licencia
left join cat_municipios as c on c.Clave=a.Municipio_Establecimiento
where Pagado='N' and a.Id_Tipo_Movimiento='2' and a.Anio_Fiscal='2013'
group by b.Municipio_Establecimiento



---------------------
caso duda gerardo
01	01	1404	BECJ5610242W5	00	ME	57	E	B	2014-01-22 09:44:28.053	2014-01-22 13:55:08.220	NULL	NULL	2014-01-22 00:00:00.000	2014-03-28 00:00:00.000	2014-01-22 15:00:41.727	gcruzs	NULL	NULL	0.0000	0.0000	0.0000	0.0000	NULL	NULL	0	NULL	NULL	NULL	 
01	01	1404	BECJ5610242W5	00	R1	57	V	E	2014-01-22 09:44:28.047	2014-01-22 13:55:08.127	NULL	NULL	2014-01-22 00:00:00.000	2014-01-30 00:00:00.000	2014-01-31 11:22:17.723	gcruzs	NULL	NULL	0.0000	0.0000	0.0000	0.0000	NULL	NULL	0	NULL	NULL	NULL	 
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL

---------------------
respaldos norberto bebal
insert into ingresos.dbo.RES_VIG_MOROSIDAD_LIC_BEBAL_2
select  * 
from ingresos.dbo.RES_VIG_MOROSIDAD_LIC_BEBAL

select * 
--into bebal.dbo.cumplidos_actualizacion_diaria_2014_cpy_07022014
from bebal.dbo.cumplidos_actualizacion_diaria_2014

----delete
from bebal.dbo.cumplidos_actualizacion_diaria_2014
where aplicado='N'
--------------------------------
##determinar el universo de las licencias de funcionamiento norberto patentes bebal

select Numero_Licencia,Municipio_Establecimiento,Domicilio_Establecimiento
from pad_patentes
where Activado='S'

-------------------------------------



$variable=ereg_replace("\"", "&quot;",$variable);

echo $variable;

-----------------------------------------
procedimiento

1.- no esta en la bd
inserta en la bd
actualiza la coordenada
inserta en historial

2.- esta en bd
actualiza la coordenada
inserta en historial


*--------------------------
//no resizable no maximizar la ventana
      $atributos="'toolbar=no,location=no,scrollbars=no,width=500,height=200,resizable=no,left=80,top=20'";
             // * Abrimos la ventana
             echo "<script>window.open($url,'',$atributos);</script>";




--------------------------
##para generar los cumplidos del nuevo regimen que quedaron como suspendidos y con la obligacion nueva. norberto licencias


 USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Generar_Cumplidos_Repecos_RI]

SELECT	'Return Value' = @return_value

GO

con este listado se quien puede ser suspendido de la licencia de funcionamiento.

select * from 
ingresos.dbo.cumplidos_actualizacion_diaria_2014_RI
where debe='0' and aplicado='N' 
and requerimientos is NULL and multas is NULL

------------------------------------------------------------------
obtener los morosos de un listado de rfcs
ALTER PROCEDURE [dbo].[paCo_Generar_Cumplidos_Repecos_Bebal_listado_otros_rfcs]

alter PROCEDURE [dbo].[paCo_Determina_Morosidad_padron_CPY_listado_rfcs]
	-- Add the parameters for the stored procedure here

tabla resultados bruno usuaria maribel

RES_VIG_MOROSIDAD_27022014
------------------------------------------------
caso de reunion carlos amaro hospedaje

Referencia	88080017425208037


------------------------------------------------

informe contribuyentes no localizables del padron

[dbo].[pa_co_informe_contribuyentes_noloc]

-------------------------------------------------
pendientes bruno

formatos federales
formatos estatales
listado de informativas en reporte de emisiones general
listado de informativas en reporte de emisiones detallado
listado de contribuyentes no localizados 
actas de inspeccion repaso con c amaro y quedo de enviarnos formato de acta y formatos de multas

----------------------------------------------------------------------------------------------
documentos para notificadores asignados al notificador "notificador" para pruebas del celular cel
originalmente estaba en O


update obl_detalle_documentos 
set fecha_impresion=GETDATE(), Fecha_Asignacion=GETDATE(), Clave_Notificador='Notificador' 
where Numero_Emision like ('07%')
and Movimiento='R1' and Status='O' and numero_emision='0704' and folio_impresion='324'

update obl_detalle_documentos 
set fecha_impresion=GETDATE(), Fecha_Asignacion=GETDATE(), Clave_Notificador='Notificador' 
where Numero_Emision like ('07%')
and Movimiento='R1' and Status='O' and numero_emision='0704' and folio_impresion='772'

update obl_detalle_documentos 
set fecha_impresion=GETDATE(), Fecha_Asignacion=GETDATE(), Clave_Notificador='Notificador' 
where Numero_Emision like ('07%')
and Movimiento='R1' and Status='O' and numero_emision='0704' and folio_impresion='1117'


select * from obl_detalle_documentos 
where Numero_Emision like ('07%')
and Movimiento='R1' and Status='O' and numero_emision='0704' and folio_impresion='324'

select * from obl_detalle_documentos where Numero_Emision like ('07%')
and Movimiento='R1' and Status='O' and numero_emision='0704' and folio_impresion='772'

select * from obl_detalle_documentos where Numero_Emision like ('07%')
and Movimiento='R1' and Status='O' and numero_emision='0704' and folio_impresion='1117'


------------------------------------------------
##query manuel rodriguez para sacar los requerimientos generados en el año 2014 eladio teneencias gabo marcado de pagos de tenencias ELADIO

SELECT 
 docu.Municipio, docu.Oficina, docu.Numero_Emision, emi.Numero_Control_Final, 
		emi.dirigida, docu.Folio_Impresion, docu.RFC, datos.Numero_Serie, datos.Placa,
		datos.Nombre_Contribuyente+' '+datos.Apellido_Paterno+' '+datos.Apellido_Materno as Nombre, 
		detalle.Anio_Moroso, docu.Movimiento, emi.Ejercicio_Fiscal 
		
into ingresos.dbo.obl_marcar_pagos_istuv
FROM         obl_detalle_documentos AS docu 
INNER JOIN   obl_control_emisiones AS emi ON docu.Municipio = emi.Municipio 
AND docu.Oficina = emi.Oficina 
AND docu.Numero_Emision = emi.Numero_Emision 
INNER JOIN   obl_detalle_vehiculo AS detalle ON docu.Municipio = detalle.Municipio 
AND docu.Oficina = detalle.Oficina AND docu.Numero_Emision = detalle.Numero_Emision 
AND docu.RFC = detalle.RFC AND docu.Folio_Impresion = detalle.Folio_Impresion 
AND docu.Numero_Serie = detalle.Numero_Serie 
INNER JOIN obl_datos_vehiculo AS datos ON docu.Municipio = datos.Municipio 
AND detalle.Municipio = datos.Municipio 
AND detalle.Oficina = datos.Oficina 
AND detalle.Numero_Emision = datos.Numero_Emision 
AND detalle.RFC = datos.RFC 
AND detalle.Numero_Serie = datos.Numero_Serie 
AND detalle.Folio_Impresion = datos.Folio_Impresion
WHERE  Movimiento='R1' and emi.Ejercicio_Fiscal between '2010' and '2013' 
and docu.Fecha_Impresion is not null and Status IN ('I','A','D','E','V','C','N','X','T','P')
--and emi.Numero_Emision='1322'  and emi.Municipio='07' and emi.Oficina='01' 
ORDER BY emi.Municipio, emi.Oficina, emi.Numero_Emision, 
docu.folio_impresion, detalle.Anio_Moroso 	



campos reporte
municipio
oficina
num emision
total de la emision
total pagados
folio
serie
placa
nombre
estatus
año moroso
principal
actualizaciones
Recargos
multas
gastos
dirigida


###ejecutar estos querys en el 10.9.3.40

Select
docu.Municipio, docu.Oficina, docu.Numero_Emision, emi.Numero_Control_Final, emi.dirigida, docu.Folio_Impresion, docu.RFC, datos.Numero_Serie, datos.Placa,
datos.Nombre_Contribuyente+' '+datos.Apellido_Paterno+' '+datos.Apellido_Materno as Nombre, 
detalle.Anio_Moroso, docu.Movimiento, emi.Ejercicio_Fiscal,
pco.No_Operacion,
pco.Fecha_Pago,
pco.Clave_Concepto,
pco.Ejercicio_Fiscal,
pco.Principal,
pco.Actualizacion,
pco.Recargos,
pco.Multa
From [10.9.3.31].ingresos.dbo.obl_detalle_documentos AS docu 
INNER JOIN [10.9.3.31].ingresos.dbo.obl_control_emisiones AS emi ON docu.Municipio = emi.Municipio AND docu.Oficina = emi.Oficina AND docu.Numero_Emision = emi.Numero_Emision 
INNER JOIN [10.9.3.31].ingresos.dbo.obl_detalle_vehiculo AS detalle ON docu.Municipio = detalle.Municipio AND docu.Oficina = detalle.Oficina AND docu.Numero_Emision = detalle.Numero_Emision 
AND docu.RFC = detalle.RFC AND docu.Folio_Impresion = detalle.Folio_Impresion AND docu.Numero_Serie = detalle.Numero_Serie 
INNER JOIN [10.9.3.31].ingresos.dbo.obl_datos_vehiculo AS datos ON docu.Municipio = datos.Municipio AND detalle.Municipio = datos.Municipio 
Inner Join tenencias.dbo.pagos_ctrl_obl as pco on pco.Serie=datos.Numero_Serie collate SQL_Latin1_General_CP1_CI_AS and pco.Ejercicio_Fiscal=detalle.anio_moroso
AND detalle.Oficina = datos.Oficina 
AND detalle.Numero_Emision = datos.Numero_Emision 
AND detalle.RFC = datos.RFC 
AND detalle.Numero_Serie = datos.Numero_Serie 
AND detalle.Folio_Impresion = datos.Folio_Impresion
Where Movimiento='R1' and emi.Ejercicio_Fiscal='2013' 


/* 
Select 
Ctrl_Obl.Municipio, 
Ctrl_Obl.Oficina, 
Ctrl_Obl.Numero_Emision, 
Ctrl_Obl.Numero_Control_Final, 
Ctrl_Obl.dirigida, 
Ctrl_Obl.Folio_Impresion, 
Ctrl_Obl.RFC, 
Ctrl_Obl.Numero_Serie, 
Ctrl_Obl.Placa,
Ctrl_Obl.Nombre, 
Ctrl_Obl.Anio_Moroso, 
Ctrl_Obl.Movimiento, 
Ctrl_Obl.Ejercicio_Fiscal,
cc.No_Operacion,
cc.Fecha_Pago,
cd.Clave_Concepto,
cd.Ejercicio_Fiscal,
cd.Principal,
cd.Actualizacion,
cd.Recargos,
cd.Multa
from
(
Left join [10.9.3.31].ingresos.dbo.cob_cobros as cc on cc.Serie=Ctrl_Obl.Numero_Serie and substring(cc.referencia,1,2)='51'
inner join [10.9.3.31].ingresos.dbo.cob_desglose as cd on cd.no_operacion=cc.no_operacion and cd.Clave_Concepto in ('TEN','GEJ') and cd.Ejercicio_Fiscal=Ctrl_Obl.Anio_Moroso
Group by Ctrl_Obl.Municipio, 
Ctrl_Obl.Oficina, 
Ctrl_Obl.Numero_Emision, 
Ctrl_Obl.Numero_Control_Final, 
Ctrl_Obl.dirigida, 
Ctrl_Obl.Folio_Impresion, 
Ctrl_Obl.RFC, 
Ctrl_Obl.Numero_Serie, 
Ctrl_Obl.Placa,
Ctrl_Obl.Nombre, 
Ctrl_Obl.Anio_Moroso, 
Ctrl_Obl.Movimiento, 
Ctrl_Obl.Ejercicio_Fiscal,
cc.No_Operacion,
cc.Fecha_Pago,
cd.Clave_Concepto,
cd.Ejercicio_Fiscal,
cd.Principal,
cd.Actualizacion,
cd.Recargos,
cd.Multa
*/


/*
--COBRANZA ISTUV
Select * from openquery(ads_ing,'Select 
NSE_CVDB06 as Serie,
Fol_cvdb06 as No_Operacion,
Fec_cvdb06 as Fecha_Pago,
tra_cvdb06 as Clave_Concepto,
aco_cvdb06 as Ejercicio_Fiscal,
imp_cvdb06 as Principal,
iac_cvdb06 as Actualizacion,
ire_cvdb06 as Recargos,
mul_cvdb06 as Multa
From cvdb06 
WHERE year(fec_cvdb06)=2013 and tra_cvdb06 in (''TEN'',''GEJ'')') as Padron
--COBRANZA SARH
select 
cc.Serie,
cc.No_Operacion,
cc.Fecha_Pago,
cd.Clave_Concepto,
cd.Ejercicio_Fiscal,
cd.Principal,
cd.Actualizacion,
cd.Recargos,
cd.Multa
from [10.9.3.31].ingresos.dbo.cob_cobros as cc 
inner join [10.9.3.31].ingresos.dbo.cob_desglose as cd on cd.no_operacion=cc.no_operacion and cd.Clave_Concepto in ('TEN','GEJ') 
where substring(cc.referencia,1,2)='51'
*/


-------------------------------------------------
sp de app celular que no pude copiar a 10.9.3.36 norberto


[paPadron_App_Situacion_Contribuyente]
paPadron_App_CE_Datos
paPadron_App_Registra_Entrega
paPadron_App_Registra_Entrega_16012013
paPadron_App_Registra_Entrega_Actas_Inspeccion
paPadron_App_Registra_Entrega_cpy
paPadron_App_Situacion_Contribuyente
paPadron_App_Situacion_Contribuyente_V2


------------------------------------------------------------

sp para marcar todos los pagos de istuv

[paarcar_pagos_istuv]

pendientes
terminas actas insp
telefono



USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCO_marcar_pagos_istuv]
		@No_Operacion = N'02010125848908',
		@Tipo_Cancelacion = N'WEB'

SELECT	'Return Value' = @return_value

GO
-----------------------------------------
sp wondry para saber los ultimos tres pagos en ceros reporte
revisar [pa_ultimos_3_pagos_cero_]

[paCO_marcar_pagos_istuv_advantage]

---------------------------------------------
problema con la carga de sirref genaro coincide corresponde

Tradicionalmente recibimos los numeros de control con el caracter de la 
posición 6 con la correspondencia al año moroso y en el archivo "QROO_02042014.txt" 
no sucede así, encontrando en el caracter 6 la letra A.

En el archivo "Cat Fund Legales Feb 2014.txt" de la fundamentacion no identificamos al inicio de los renglones antes del primer 
pipe el número de emision correspondiente.


-*---------------------------------------------------
##MARCADO DE EMISIONES GENARO DEPENDIENDO DEL MUNICIPIO PERTENECE CORRESPONDE

select * from sirref_co_documentos  as a join
sirref_co_datos as b  on a.numero_control=b.numero_control
where a.numero_emision='14002' and b.municipio_estatal='01' --and fecha_impresion>'27/08/2012'

update sirref_co_documentos
set status='A', Fecha_Impresion='06/05/2014'
from sirref_co_documentos  as a 
join sirref_co_datos as b  on a.numero_control=b.numero_control
where a.numero_emision='14002' and b.municipio_estatal='01'



con este query podemos saber que numeros de control no se cargaron bien cuando vienen incompletos los pipes. pipe

select * from sirref_co_documentos  as a left join
sirref_co_datos as b  on a.numero_control=b.numero_control and a.Numero_Emision=b.Numero_Emision 
left join sirref_co_emisiones as d on a.Numero_Emision=d.Numero_Emision and b.Municipio_Estatal=d.Municipio_Estatal 
and b.Municipio_Federal=d.Municipio_Federal 
where a.Numero_Emision 
in (select distinct(Numero_Emision ) from sirref_co_emisiones where  year(Fecha_Carga)='2014' and MONTH(Fecha_Carga)='06') and Status='B'
and a.Movimiento='R1' and b.Numero_Control is null

**dice que municipios tienen documentos de aqui puedo saber si hay o no de bacalar

select Municipio_Estatal, COUNT(*)-- a.Numero_Control, Municipio_Federal, Municipio_Estatal    
from sirref_co_documentos  as a join
sirref_co_datos as b  on a.numero_control=b.numero_control
where a.numero_emision='16147'
--and Municipio_Estatal=''
group by  Municipio_Estatal


con este lo actualizo
update sirref_co_datos 
set Municipio_Federal='4', Municipio_Estatal='01'
where Numero_Control   
in ('101404163191099C77042',
'101404163192872C77042',
'101404163199037C77042',
'101404163186539C77042',
'101404163201175C77042')


16147 bacalar
102902162955244C77042
102902162915465C77042

----------------------------------------------------
pendientes actas inspecion
 agregar
                                                                          definicion de multa
                                                                          ciudad
                                                                          firma
                                                                          refencia y vencimiento
imprimir test
----------------------------------------------------
query para eliminar los contribuyentes que no han tenido ninguna entrega entre 2012-2014 bruno gabo
delete from PAD_CONTRIBUYENTES_INACTIVOS
where rfc in (
SELECT distinct(a.rfc)
FROM PAD_CONTRIBUYENTES_INACTIVOS AS a
JOIN obl_detalle_documentos as b on
a.rfc=b.RFC --and b.Numero_Emision>='1201' 
and Fecha_Entrega is not null and YEAR(Fecha_Entrega)>=2012)



-----------------------------------------------
dias de vencimiento para los documentos de requerimientos vence bruno estatales federales

Para Obligaciones Estatales el Requerimiento vence a los 6 días
Para Requerimientos de Repecos, Intermedios, IEPS Federales el Requerimiento vence a los 16 dias
Para ISTUV el Requerimiento vence a los 15 dias
Multas por Incumplimiento a los 47 dias de la fecha de entrega
Multas por Extemporaneidad a los 47 dias de la fecha de entrega



	define('DPV_NOMINA', 6 );
	define('DPV_ISTUV', 15 );
	define('DPV_HOSPEDAJE', 6 );
	define('DPV_MATERIALES', 6 );
	define('DPV_LICENCIA', 6 );
	define('DPV_PROFESIONES', 6 );
	define('DPV_REPECOS_R1', 16 );
	define('DPV_REPECOS_R2', 7 );
	define('DPV_REPECOS_R3', 7 );
	define('DPV_INTERMEDIOS', 16 );
	define('DPV_IEPS', 16 );
	define('DPV_MULTA_EXTEMPORANEA', 47 );
	define('DPV_MULTA_INCUMPLIMIENTO', 47 );
	define('DPV_MULTA_ACTAS_INSPECCION', 6 );
------------------------

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[marcar_pagos_espontaneos_actas_inspeccion]
		@Id = 222,
		@referencia=N'72010365365302563'
		

SELECT	'Return Value' = @return_value

GO
select * from obl_detalle_documentos_actas_inspeccion where numero_emision='1301' and folio_impresion='1' 

select * from obl_actas_inspeccion_datos_generales  where numero_emision='1301' and folio_impresion='1' 
select * from obl_actas_inspeccion_detalle_sucursales   where numero_emision='1301' and folio_impresion='1' 


-----------------------------------------
QUERY  SABER EL ID PARA GENERAR LA REFERENCIA PARA PAGAR UNA MULTA
select  a.RFC, a.Municipio, a.Oficina,a.Numero_Emision, a.Folio_Impresion,Fecha_Impresion,
	                     Multa_Programada, Multa_Efectiva,
	                     --Num_Salarios_Multa, a.Honorarios_Notificacion, 
                        --Num_Salarios_Gastos_Ejecucion, 
                        --Descuento_Multa, Descuento_Multa_SMG, 
	                    -- Descuento_Gastos_Ejecucion,Descuento_Gastos_Ejecucion_SMG,Subtotal, Total, Referencia, 
                        --Observaciones_Cancelacion,
                        status, a.Movimiento,b.Domicilio_Matriz_Calle+' '+
                        Domicilio_Matriz_Colonia+' '+Domicilio_Matriz_Numero+' '+Domicilio_Matriz_Ubicacion+' '+
                        Domicilio_Matriz_Codigo_Postal+' '+Domicilio_Matriz_Colonia as Domicilio, c.Nombre as Localidad, 
                       d.Descripcion  as Giro, e.Nombre as Municipio_Nombre, 
                       --f.Nombre as Nombre_Multa, 
                       b.Nombre_Contribuyente
                      from obl_detalle_documentos as a 
                      join obl_datos_generales as b on a.Municipio=b.Municipio 
                      and a.Oficina=b.Oficina  and a.Folio_Impresion=b.Folio_Impresion and a.Numero_Emision=b.Numero_Emision
                      join cat_localidades as c on b.Localidad=c.Clave and b.Municipio=c.Clave_Municipio 
                      join cat_giros as d on b.Giro=d.Clave
                      join cat_municipios as e on a.Municipio=e.Clave 
                      join obl_id_multas as f on a.Numero_Emision=f.numero_emision 
                      and a.Folio_Impresion=f.folio_impresion and a.Municipio=f.municipio
                      and a.Oficina=f.oficina and a.Movimiento=f.movimiento
                      where  f.Id ='1'



---------------------------------
query marcar entrega sp telefono norberto celular

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_App_Registra_Entrega]
		@Usuario = N'notificador',
		@RFC = N' AAO560706E63',
		@Movimiento = N'R1',
		@Numero_Emision = N'0601',
		@Folio_Impresion = N'1',
		@Estatus = N'E',
		@Fecha_Movimiento = N'29/05/2014',
		@Persona_Recibe_Nombre = N'LOQUESEA',
		@Persona_Recibe_Identificacion = N'LOQUESEA',
		@Observaciones = N'LOQUESEA'

SELECT	'Return Value' = @return_value

GO

----------------------------------------------------


Municipio	Oficina	Numero_Emision	RFC	Numero_Serie	Movimiento	Folio_Impresion	Status	SubStatus	Fecha_Impresion	Fecha_Asignacion	Fecha_Citatorio	Fecha_No_Localizado	Fecha_Entrega	Fecha_Vencimiento	Fecha_Ultimo_Movimiento	Clave_Notificador	Gastos_Ejecucion	Multa_Efectiva	Multa_Programada	Actualizacion	Recargos	Honorarios_Notificacion	usuario_cancelacion	Categoria_No_Loc	Numero_No_Loc	Num_Salarios_Gastos_Ejecucion	No_Operacion	Referencia	No_Loc_Impreso	Descuento_Multa	Descuento_Gastos_Ejecucion	Subtotal	Total	Observaciones_Cancelacion	Fecha_Vencimiento_Referencia
1	1	601	 AAO560706E63	0	ME	1	A	A	00:00.0	NULL	NULL	NULL	NULL	NULL	07:55.3		95	96	120	0	0	0		NULL	0	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
1	1	601	 AAO560706E63	0	R1	1	N	A	00:00.0	NULL	NULL	47:47.9	NULL	NULL	47:47.9	notificador	NULL	NULL	0	0	0	0	ssolis	N	1	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL



SP PARA GENERAR LAS REFERENCIAS PARA PAGAR LAS MULTAS DE CONTROL DE OBLIGACIONES
[pa_Determina_Referencia_Multas]


USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Determina_Referencia_Multas]
		@Id = N'1',
		@No_Municipio = N'01',
		@Oficina = N'01',
		@No_Emision = N'0609',
		@Fol_Impresion = 7,
		@Movimiento = N'I1',
		@Clave_Obligacion=N'010610'

SELECT	'Return Value' = @return_value

GO

--010103 numero_emision='0601' and folio_impresion='1' ME
--010610 numero_emision='0609' and folio_impresion='1' M1
--010603 numero_emision='0601' and folio_impresion='7' I1 oficina='02'
-------------------------------------------------------------------------------------

guardar bien los montos a pagar para generar bien la multa programada de todas las multas

--checar el descuento marcado como si
--y el nombre del tipo de multa que se pagara
el monto total si no seleccionas descuento



-*------------------------------------------------------------------------------
checar este sp y complementarlo
SELECT distinct( pad_oblxest.rfc)
--@Municipio as Municipio, @ClaveOficina as Oficina, @Numero_Emision as Numero_Emision, 
--		pad_oblxest.RFC, pad_oblxest.Numero_Establecimiento, '' as Folio_Impresion, 
--		@Anio as Ejercicio_Fiscal, 	@Mes as Mes, @EjercicioFiscal as Anio_Moroso, '' AS Numero_Operacion,
--		'N' as Pagado, @Clave_Obligacion as Clave_Obligacion, @ClavePeriodicidad as Clave_Periodicidad, 
--		'' as numero_Control, 'T' as Tipo_Moroso
--		--AS RFC_OBL_MOR, pad_oblxest.Clave, pad_est.Localidad, pad_est.Zona,  
FROM pad_obligacionesporestablecimiento pad_oblxest 
LEFT JOIN pad_establecimientos pad_est ON pad_oblxest.RFC = pad_est.RFC 
	AND pad_oblxest.Numero_Establecimiento = pad_est.Numero 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
	AND pad_oblxest.Clave = oco.Clave_Obligacion 
	AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave in ( '010103','010104','010102','010106' )
AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2014'+'-'+'01'+'-'+'01',20)--checar fecha inicio
									OR pad_oblxest.Fecha_Inicio = ''
									OR pad_oblxest.Fecha_Inicio IS NULL )
--AND pad_oblxest.RFC in 
--	( SELECT distinct(RFC) FROM pad_establecimientos pad_est 
--	  WHERE pad_est.Municipio = '01' 
--		AND pad_est.Situacion = 'Activo' 
--		--AND pad_est.Tipo_Establecimiento = 'Matriz' 
--		AND pad_est.Localidad = '0001' --CHECAR SI ES OPCIONAL O NO comentar aqui
--		AND pad_est.Zona = '001'   --CHECAR SI ES OPCIONAL O NO comentar aqui
--		) AND pad_oblxest.Situacion = 'Activo' 
	AND oco.RFC IS NULL 
	AND pad_est.Situacion = 'Activo' 
	AND pad_oblxest.rfc=' AFA930503360'
	and pad_est.Municipio = '01' 
		AND pad_est.Situacion = 'Activo' 
		AND pad_est.Localidad = '0001' --CHECAR SI ES OPCIONAL O NO comentar aqui
		AND pad_est.Zona = '001'   --CHECAR SI ES OPCIONAL O NO comentar aqui
	
	
	--1267
	--2853
	--1051

------------------------------------------
sp para sacar las emisiones dirigidas de actas de insp

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Emisiones_Actas_Inspeccion_Dirigidas]
		@Limite = 1,
		@Municipio = N'01',
		@EjercicioFiscal = N'2014',
		@ClaveLocalidad = N'0001',
		@ClaveZona = N'004',
		@ClaveOficina = N'01',
		--@Anio = N'2014',
		@Numero_Emision = N'1401',
		@Situacion = N'Activo'

SELECT	'Return Value' = @return_value

GO

------------------
Tor Browser
-------------------------------------

ejecutar repecos
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Requerir_Morosos_Repecos_copia_01_julio_2014]
@Limite ='500',
 @Clave_Obligacion ='010610,010618,010623', 
 @Municipio ='01', 
 @ClavePeriodicidad ='03', 
 @EjercicioFiscal ='2011', 
 @Mes ='01', 
 @MesFinal = '02', 
 @ClaveLocalidad = '0001', 
 @ClaveZona = '0', 
 @ClaveOficina = '01', 
 @Anio ='2014', 
 @Numero_Emision = '1434', 
 @Separador = N','

SELECT	'Return Value' = @return_value

GO




USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Emisiones_Actas_Inspeccion_Dirigidas]
		@Limite = 1,
		@Municipio = N'01',
		@EjercicioFiscal = N'2014',
		@ClaveLocalidad = N'0001',
		@ClaveZona = N'001',
		@ClaveOficina = N'01',
		@Numero_Emision = N'1401',
		@Situacion = N'Activo',
		@Localizable=N'N',
		@Genera=N'S'
		


SELECT	'Return Value' = @return_value

GO




select * from obl_control_emisiones where Numero_Emision='1433' and Municipio='01' and Oficina='01'
select * from obl_detalle_documentos  
where Numero_Emision='1433' and Municipio='01' and Oficina='01'
order by Folio_Impresion 
select distinct(Folio_Impresion)  from obl_datos_federales   
where Numero_Emision='1433' and Municipio='01' and Oficina='01'
order by Folio_Impresion 

--delete from obl_control_emisiones where Numero_Emision='1434' and Municipio='01' and Oficina='01'
--delete from obl_detalle_documentos  
--where Numero_Emision='1434' and Municipio='01' and Oficina='01'

--delete  from obl_datos_federales   
--where Numero_Emision='1434' and Municipio='01' and Oficina='01'


select * from seg_usuarios where Usuario='gnavarro'

update obl_control_emisiones 
set numero_control_final='59'
where Numero_Emision='1415' and Municipio='09' and Oficina='01'



select * from obl_detalle_documentos  
where Numero_Emision='1427' and Municipio='03' and Oficina='01'
order by Folio_Impresion 
select distinct(Folio_Impresion)  from obl_datos_federales   
where Numero_Emision='1427' and Municipio='03' and Oficina='01'
order by Folio_Impresion 



select top 30 * from obl_control_emisiones where Cuenta_Registro='gnavarro'  order by Fecha_Emision desc

select * from obl_control_emisiones where Numero_Emision='1415' and Municipio='09' and Oficina='01'
select * from obl_detalle_documentos  
where Numero_Emision='1415' and Municipio='09' and Oficina='01'
order by Folio_Impresion 
select distinct(Folio_Impresion)  from obl_datos_federales   
where Numero_Emision='1415' and Municipio='09' and Oficina='01'
order by Folio_Impresion 


delete from obl_control_emisiones where Numero_Emision='1434' and Municipio='01' and Oficina='01'


select distinct(s.RFC) from ( SELECT pad_oblxest.RFC, min(pad_oblxest.clave) as clave_obligacion 
FROM pad_obligacionesporestablecimiento pad_oblxest JOIN pad_contribuyentes cont ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre ON pad_oblxest.RFC = obl_oblvigpre.RFC 
AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion AND obl_oblvigpre.Tipo_Periodo = '03' 
AND obl_oblvigpre.Anio_Inicial = '2011' AND obl_oblvigpre.Mes_Inicial = '01' 
AND obl_oblvigpre.Mes_Final = '02' AND obl_oblvigpre.Estado = 'T' 
LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
AND pad_oblxest.Clave in ('010610','010618','010623') AND fed.Anio_Moroso = '2011' 
AND fed.Mes_Inicial = '01' AND fed.Mes_Final = '02' AND fed.Clave_Periodicidad = '03' 
LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
WHERE pad_oblxest.Clave in ('010610','010618','010623') AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2011-02-01',20) 
OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) AND cont.Municipio = '01' 
AND pad_oblxest.Situacion = 'Activo' AND cont.Situacion = 'Activo' AND fed.RFC IS NULL 
AND obl_oblvigpre.RFC IS NULL AND oco.RFC IS NULL AND cont.Localidad = '0001' 
AND pad_oblxest.RFC not in (SELECT a.RFC FROM obl_detalle_documentos a 
JOIN obl_control_emisiones b ON a.Municipio = b.Municipio AND a.Oficina = b.Oficina 
AND a.Numero_Emision = b.Numero_Emision WHERE a.Municipio = '01' AND a.Oficina = '01' 
AND a.Status in ('X') AND a.Movimiento in ('R1','R2','R3') 
AND b.Clave_Obligacion in ('010610','010618','010623') GROUP BY a.RFC) 
AND pad_oblxest.RFC not in ( select b.RFC from obl_control_emisiones as a 
join obl_detalle_documentos as b on a.Municipio=b.Municipio and a.Oficina=b.Oficina 
and a.numero_emision=b.numero_emision where a.municipio='01' and a.ejercicio_fiscal in ('2011') 
and a.oficina='01' and a.clave_obligacion in ('010610','010618','010623') 
and b.Movimiento in ('R1','R2','R3') group by b.RFC ) GROUP BY pad_oblxest.RFC ) as s 
inner join obl_obligacion_vigilable_presentada as v on s.rfc=v.rfc and s.clave_obligacion=v.clave_obligacion 
where v.anio_inicial>'2007' and v.tipo_periodo='03' and v.clave_obligacion in ('010610','010618','010623') and v.estado='T'



select * from pad_contribuyentes where rfc=' GEL741008GY9'
select * from obl_contribuyentes_omitidos where rfc=' GEL741008GY9'


SELECT  distinct(Clave_Obligacion )
						FROM	obl_obligacion_vigilable_presentada as obl_oblvigpre
						INNER JOIN  pad_contribuyentes as cont 
						ON obl_oblvigpre.RFC=cont.RFC 
						INNER JOIN pad_obligacionesporestablecimiento	as pad_oblxest 
						ON obl_oblvigpre.RFC= pad_oblxest.RFC 
						--comentado pues salian establecimientos morosos que no son morosos
						--AND obl_oblvigpre.Numero_Establecimiento= pad_oblxest.Numero_Establecimiento 
						WHERE obl_oblvigpre.Tipo_Periodo = '03'
						AND obl_oblvigpre.Anio_Inicial = '2011'
						AND obl_oblvigpre.Clave_Obligacion in ('010610','010618','010623')
						AND obl_oblvigpre.Mes_Inicial = '01'
						AND obl_oblvigpre.Estado = 'T'
						--AND cont.Municipio ='01'
						AND cont.RFC=' GEL741008GY9';
						
select * from obl_detalle_documentos where Folio_Impresion='11' and Numero_Emision='1401' and Municipio='01'
--select * from obl_datos_generales where Folio_Impresion='11' and Numero_Emision='1401' and Municipio='01'
select * from obl_detalle_sucursales  where Folio_Impresion='11' and Numero_Emision='1401' and Municipio='01'
select * from obl_obligacion_vigilable_presentada where rfc=' SMO000426MW7' 
and Mes_Inicial='11' and Anio_Inicial='2013' and Tipo_Periodo='02'


update obl_detalle_documentos 
set Status=SubStatus
where Folio_Impresion='11' and Numero_Emision='1401' and Municipio='01'

--select * from obl_datos_generales where Folio_Impresion='11' and Numero_Emision='1401' and Municipio='01'

update obl_detalle_sucursales  
set Pagado='N'
where Folio_Impresion='11' and Numero_Emision='1401' and Municipio='01'

update obl_obligacion_vigilable_presentada 
set Estado='N'
where rfc=' SMO000426MW7' 
and Mes_Inicial='11' and Anio_Inicial='2013' and Tipo_Periodo='02'



select * from pad_contribuyentes where rfc like ('cais4607%')

update cob_cobros 
set RFC='CAIS460708NS7'
where Referencia='72030151765392675'

SELECT MAX( Numero_Emision ) AS ultimaEmision 
FROM obl_control_emisiones_actas_inspeccion 
WHERE Municipio = '01' AND Oficina = '01' AND LEFT( Numero_Emision, 2 ) = '14' 



DELETE FROM obl_actas_inspeccion_datos_generales WHERE Numero_Emision='1401' AND Municipio='01'
DELETE FROM obl_detalle_documentos_actas_inspeccion  WHERE Numero_Emision='1401' AND Municipio='01'
DELETE FROM obl_actas_inspeccion_detalle_sucursales   WHERE Numero_Emision='1401' AND M
-----------------------------------------------------------------
[Pa_Co_Reporte_Documentos]


--ESTE SP GENERA LOS DATOS DE LOS CONTRIBUYENTES CON ALGUNA NOTIFICACION 
--O REQUERIMIENTO EN EL ESTATUS QUE SEA SELECCIONADO DE LA CABECERA
--------------------------------------

procedimiento que me dice los inscritos a carta responsiva para el calculo de cuota fija entre 2008 2013 y su morosidad
genaro reporte

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Pa_Co_Reporte_Repecos_Adeudos]
		@Municipioobl = N'01',
		@Anio_Carta_Responsiva = N'2008'
		

SELECT	'Return Value' = @return_value

GO
------------------------------------------
reporte de documntos vencidos no localizados genaro

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Pa_Co_Reporte_Documentos]
		@Clave_Obligacion_Fed = N'010610',
		@Municipioobl = N'01',
		@Estatusobl = N'V'
		

SELECT	'Return Value' = @return_value

GO
-----------------------------------
select * from obl_detalle_documentos where Numero_Emision='1320' and Folio_Impresion='3743' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1323' and Folio_Impresion='4713' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1335' and Folio_Impresion='6305' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1337' and Folio_Impresion='6675' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1341' and Folio_Impresion='7700' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1347' and Folio_Impresion='8726' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1409' and Folio_Impresion='2300' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1415' and Folio_Impresion='3287' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1418' and Folio_Impresion='4184' and Municipio='01' and Movimiento='R1'
select * from obl_detalle_documentos where Numero_Emision='1418' and Folio_Impresion='4203' and Municipio='01' and Movimiento='R1'


------------------------------------

en las multas por incumplimiento estatales me envían rangos y esta fija la cantidad actualmente
recibi sirref nuevamente incompleto



------------------------------------------------------------------------
ejecuta emisiones dirigidas de actas de inspeccion carlos amaro

EXEC [dbo].[Emisiones_Actas_Inspeccion_Dirigidas] 
@Limite ='200', 
@Municipio ='01', 
@EjercicioFiscal ='2014', 
@ClaveLocalidad = '0002', 
@ClaveZona = '001', 
@ClaveOficina = '01', 
@Numero_Emision = '1402', 
@Situacion = 'Activo', 
@Localizable = 'N', 
@Genera = 'S' 

----------------------------------------------------------------------------
Este reporte me dice los campos del reporte que se genera en lista de obligaciones federales cuando genero el reporte de todos los pagados de istuv este lo pidio cancun
te dice el importe, la multa y los gastos de ejecucion
version Gabo esta version se va directamente sobre los numeros de  folio
SELECT * 
FROM 
(
select * from obl_detalle_vehiculo a left outer join
(SELECT distinct Serie,Ejercicio_Fiscal ,a.No_Operacion ,Clave_Concepto ,B.Principal ,Multa   FROM 
cob_cobros A inner join
cob_desglose b on a.No_Operacion = b.No_Operacion 
where a.Estatus in ('A','T','W')
and Clave_Concepto in ('TEN','GEJ')
)b on a.Numero_Serie = b.Serie and a.Anio_Moroso = b.Ejercicio_Fiscal 
where folio_impresion in ('5172',
'5172',
'5220',
'5220',
'5242',
'5242',
'5354',
'5354',
'5370',
'5370',
'5380',
'5380',
'5405',
'5405',
'5410',
'5410',
'5452',
'5452'
) and 
Oficina='02'
and Numero_Emision='1304'
 ) A
PIVOT
(
MAX(Principal)
FOR Clave_Concepto IN ([TEN],[GEJ])
) AS PivotTable
order by Folio_Impresion;


--version mia adaptada a lo que se ve en el reporte de tenencias de control de obligaciones gabo

select * from (
SELECT datos.RFC, datos.Numero_Serie, datos.Placa, datos.Folio_Anterior, documento.Status, 
(CONVERT(VARCHAR(100),datos.Modelo) + ' - ' + datos.Marca + ' - ' + datos.Sub_Marca + ' - ' + Numero_Motor) 
AS Datos_Vehiculo, (datos.Nombre_Contribuyente + ' ' + datos.Apellido_Paterno + ' ' + datos.Apellido_Materno) 
AS Nombre_Contribuyente, (datos.Domicilio_Calle + ' ' + datos.Domicilio_Numero + ' ' + datos.Domicilio_Colonia) 
AS Domicilio, datos.Folio_Impresion, CONVERT( VARCHAR(10),documento.Fecha_Impresion,20) as Fecha_Impresion, 
CONVERT( VARCHAR(10),documento.Fecha_No_Localizado,20) as Fecha_No_Localizado, 
CONVERT( VARCHAR(10),documento.Fecha_Entrega,20) as Fecha_Entrega, 
CONVERT( VARCHAR(10),documento.Fecha_Vencimiento,20) as Fecha_Vencimiento, det.Anio_Moroso, b.* 
FROM obl_datos_vehiculo datos 
JOIN obl_detalle_documentos documento ON datos.Municipio = documento.Municipio 
AND datos.Oficina = documento.Oficina 
AND datos.Numero_Emision = documento.Numero_Emision 
AND datos.Numero_Serie = documento.Numero_Serie 
JOIN obl_detalle_vehiculo det ON datos.Municipio = det.Municipio 
AND datos.Oficina = det.Oficina 
AND datos.Numero_Emision = det.Numero_Emision 
AND datos.Numero_Serie = det.Numero_Serie 
 left outer join (
SELECT distinct Serie,Ejercicio_Fiscal ,a.No_Operacion ,Clave_Concepto ,B.Principal ,Multa   FROM 
cob_cobros A inner join
cob_desglose b on a.No_Operacion = b.No_Operacion 
where a.Estatus in ('A','T','W')
and Clave_Concepto in ('TEN','GEJ')
)b on det.Numero_Serie = b.Serie and det.Anio_Moroso = b.Ejercicio_Fiscal 
WHERE datos.Numero_Emision = '1303' AND datos.Municipio = '02' 
AND documento.Status='P'
AND datos.Oficina = '02' AND documento.Movimiento = 'R1'  --and datos.Folio_Impresion='5172'
 ) A
PIVOT
(
MAX(Principal)
FOR Clave_Concepto IN ([TEN],[GEJ])
) AS PivotTable
order by Folio_Impresion;

----------------------------
MARCAR EL PAGO DE LAS MULTAS POR ACTAS DE INSPECCION Y LOS CODIGOS PARA EL RESTO DE OBLIGACIONES

489--Multa por Actas Inspeccion
PROCEDURE [marcar_pagos_espontaneos_actas_inspeccion]
@Id bigint, 
@Referencia varchar(20), 
@Tipo_Pago varchar(16)

480--Multa ILEPAL
481--Multa Nomina
482--Multa Hospedaje
483--Multa Materiales

---------------------------------------------------
--me dice todas las emisiones que emitio genaro entre 2013-2014 bruno

select a.Municipio, c.Nombre as Nombre_Municipio,
b.Descripcion as Obligacion, a.Numero_Emision, 
a.Numero_Control_Final, a.Clave_Periodicidad, a.Ejercicio_Fiscal, 
a.Periodo_Inicial as Mes_Inicial, a.Periodo_Final as Mes_Final,
a.Fecha_Emision,a.Dirigida  
from obl_control_emisiones as a
join cat_obligaciones as b on a.Clave_Obligacion=b.Clave 
join cat_municipios as c on a.Municipio=c.Clave 
where Ejercicio_Fiscal between ('2013') and ('2014')
and clave_obligacion in ('010610','010611','010622')
order by a.Municipio, Oficina, clave_obligacion,a.Numero_Emision, a.Periodo_Inicial

---------------------------------------------
reporte de todas las multas de control de obligaciones y sus importes por municipio 
 bruno en el caso de las extemporaneas no se marca la impresion y la asignacion
hago un truco para que aparezca el estatus correcto


select 
--*
--DISTINCT(Multa_Programada ), Honorarios_Notificacion 
--DISTINCT(Clave_Periodicidad )
--COUNT(*)
--top 1000 
a.Municipio, a.Oficina,b.Clave_Obligacion,d.Descripcion as Nombre_Obligacion, 
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '01' else b.Periodo_Inicial end as Mes_Inicial,
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '12' else b.Periodo_Final   end as Mes_Final,
 b. Anio_Moroso as Año_Moroso,
 case when b.Clave_Periodicidad ='02' then 'Mensual' 
 when b.Clave_Periodicidad ='03' then 'Bimestral'
 when b.Clave_Periodicidad ='07' then 'Anual'
 when b.Clave_Periodicidad ='12' then 'Mensual Informativa'
 when b.Clave_Periodicidad ='17' then 'Anual Informativa'
 end as Periodicidad, 
 
b.Fecha_Emision,
a.Numero_Emision, a.Folio_Impresion,a.RFC, c.nombre as Tipo_Documento, 
 case when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is not null) then 'Asignado' 
when (a.Status='I' and a.Fecha_Asignacion is not null) then 'Asignado'
when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is null) then 'Impreso'
else e.Nombre
end as Estatus,
a.fecha_impresion as Fecha_Impresion, a.fecha_asignacion as Fecha_Asignacion, a.fecha_no_localizado as Fecha_No_Localizado, 
a.Fecha_Entrega, case when  a.Fecha_Entrega is null and a.Fecha_Vencimiento is not null then NULL else a.Fecha_Vencimiento end as Fecha_Vencimiento, 
Clave_Notificador, a.Multa_Programada, a.Multa_Efectiva, a.Gastos_Ejecucion, a.Honorarios_Notificacion
from obl_detalle_documentos as a
join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision  
and a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
--where  a.Numero_Emision between '0901' and '1501'
join obl_nombres_documentos as c on a.Movimiento=c.Clave 
join cat_obligaciones as d on b.Clave_Obligacion=d.Clave 
join obl_nombres_estatus as e on a.Status=e.clave
where  a.numero_emision between ('0901')  and  ('1501')
and Movimiento in ('ME','I1','M1','M2','M3','I1') 
--and Movimiento in ('ME') 
and Status not in ('T','P','H','L','M','J','S','Y','Z','O','U','W','R','G','F') 
--and Status in ('X','E') 
--and Fecha_Impresion  is not NULL
and Clave_Obligacion in ('010103','010104','010102','010106','010610','010611','010622')
--and Clave_Obligacion in ('010622')
--and Folio_Impresion='21'
--and a.Numero_Emision='1301'
and a.Municipio='09'
--and  Multa_Programada>1
order by a.Municipio, a.Oficina, b.Clave_Obligacion, a.Numero_Emision, a.Folio_Impresion,  c.Nombre 

##CORREJIDO
select t.* from (select 
--*
--DISTINCT(Multa_Programada ), Honorarios_Notificacion 
--DISTINCT(Clave_Periodicidad )
--COUNT(*)
--top 100
a.Municipio,
f.Nombre as Municipio_Nombre,
a.Oficina,
b.Clave_Obligacion,d.Descripcion as Nombre_Obligacion, 
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '01' else b.Periodo_Inicial end as Mes_Inicial,
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '12' else b.Periodo_Final   end as Mes_Final,
 b. Anio_Moroso as Año_Moroso,
 case when b.Clave_Periodicidad ='02' then 'Mensual' 
 when b.Clave_Periodicidad ='03' then 'Bimestral'
 when b.Clave_Periodicidad ='07' then 'Anual'
 when b.Clave_Periodicidad ='12' then 'Mensual Informativa'
 when b.Clave_Periodicidad ='17' then 'Anual Informativa'
 end as Periodicidad, 
 
b.Fecha_Emision,
a.Numero_Emision, a.Folio_Impresion,a.RFC, c.nombre as Tipo_Documento, 
 case when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is not null) then 'Asignado' 
when (a.Status='I' and a.Fecha_Asignacion is not null) then 'Asignado'
when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is null) then 'Impreso'
else e.Nombre
end as Estatus,
a.fecha_impresion as Fecha_Impresion, a.fecha_asignacion as Fecha_Asignacion, a.fecha_no_localizado as Fecha_No_Localizado, 
a.Fecha_Entrega, case when  a.Fecha_Entrega is null and a.Fecha_Vencimiento is not null then NULL else a.Fecha_Vencimiento end as Fecha_Vencimiento, 
Clave_Notificador, a.Multa_Programada, a.Multa_Efectiva, a.Gastos_Ejecucion, a.Honorarios_Notificacion
from obl_detalle_documentos as a
join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision  
and a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
--where  a.Numero_Emision between '0901' and '1501'
join obl_nombres_documentos as c on a.Movimiento=c.Clave 
join cat_obligaciones as d on b.Clave_Obligacion=d.Clave 
join obl_nombres_estatus as e on a.Status=e.clave
join cat_municipios as f on a.Municipio=f.Clave 
where  a.numero_emision >='1001'  and  a.numero_emision<='1501'
and Movimiento in ('ME','I1','M1','M2','M3','I1') 
--and Movimiento in ('ME') 
and Status not in ('T','P','H','L','M','J','S','Y','Z','O','U','W','R','G','F') 
--and Status in ('B') 
--and Fecha_Impresion  is not NULL
and Clave_Obligacion in ('010103','010104','010102','010106','010610','010611','010622')
--and Clave_Obligacion in ('010622')
--and a.numero_emision='1104' and Folio_Impresion='1'
and a.Municipio='02'
--and  Multa_Programada>1
) as t 
left join obl_detalle_documentos as w on
t.Numero_Emision=w.Numero_Emision and t.Folio_Impresion=w.Folio_Impresion and t.Municipio=w.Municipio and t.Oficina=w.Oficina
and w.Status not in ('T','P') and w.Movimiento='R1'
where w.RFC is not null
order by t.Municipio,  t.Clave_Obligacion, t.Numero_Emision, t.Folio_Impresion,  t.Estatus 


---el corregido con requerimientos 
select t.* from (select 
--*
--DISTINCT(Multa_Programada ), Honorarios_Notificacion 
--DISTINCT(Clave_Periodicidad )
--COUNT(*)
--top 100
a.Municipio,
f.Nombre as Municipio_Nombre,
a.Oficina,
b.Clave_Obligacion,d.Descripcion as Nombre_Obligacion, 
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '01' else b.Periodo_Inicial end as Mes_Inicial,
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '12' else b.Periodo_Final   end as Mes_Final,
 b. Anio_Moroso as Año_Moroso,
 case when b.Clave_Periodicidad ='02' then 'Mensual' 
 when b.Clave_Periodicidad ='03' then 'Bimestral'
 when b.Clave_Periodicidad ='07' then 'Anual'
 when b.Clave_Periodicidad ='12' then 'Mensual Informativa'
 when b.Clave_Periodicidad ='17' then 'Anual Informativa'
 end as Periodicidad, 
b.Fecha_Emision,
a.Numero_Emision, a.Folio_Impresion,a.RFC, c.nombre as Tipo_Documento, 
 case when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is not null) then 'Asignado' 
when (a.Status='I' and a.Fecha_Asignacion is not null) then 'Asignado'
when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is null) then 'Impreso'
else e.Nombre
end as Estatus,
a.fecha_impresion as Fecha_Impresion, a.fecha_asignacion as Fecha_Asignacion, a.fecha_no_localizado as Fecha_No_Localizado, 
a.Fecha_Entrega, case when  a.Fecha_Entrega is null and a.Fecha_Vencimiento is not null then NULL else a.Fecha_Vencimiento end as Fecha_Vencimiento, 
Clave_Notificador--, a.Multa_Programada, a.Multa_Efectiva, a.Gastos_Ejecucion, a.Honorarios_Notificacion
from obl_detalle_documentos as a
join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision  
and a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
--where  a.Numero_Emision between '0901' and '1501'
join obl_nombres_documentos as c on a.Movimiento=c.Clave 
join cat_obligaciones as d on b.Clave_Obligacion=d.Clave 
join obl_nombres_estatus as e on a.Status=e.clave
join cat_municipios as f on a.Municipio=f.Clave 
where  a.numero_emision >='1101'  and  a.numero_emision<='1701'
and Movimiento in ('R1','ME','I1','M1','M2','M3','I1') 
--and Movimiento in ('ME') 
and Status not in ('T','P','H','L','M','J','S','Y','Z','O','U','W','R','G','F') 
--and Status in ('B') 
--and Fecha_Impresion  is not NULL
and Clave_Obligacion in ('010103','010104','010102','010106','010610','010611','010622')
--and Clave_Obligacion in ('010622')
--and a.numero_emision='1104' and Folio_Impresion='1'
and a.Municipio='09'
--and  Multa_Programada>1
) as t 
left join obl_detalle_documentos as w on
t.Numero_Emision=w.Numero_Emision and t.Folio_Impresion=w.Folio_Impresion and t.Municipio=w.Municipio and t.Oficina=w.Oficina
and w.Status not in ('T','P') and w.Movimiento='R1'
where w.RFC is not null
order by t.Municipio,  t.Clave_Obligacion, t.Numero_Emision, t.Folio_Impresion,  t.Estatus




--40963
--375818 -todo
--287503 ME
--63208 I1
--9210 M1
--6375 M2
--9522 M3
--63208 I1

aqui marque todas las multas que no se habian marcado de los importes del año 2014
----BEGIN TRAN
----update obl_detalle_documentos
----set Multa_Programada=255,Multa_Efectiva=255, Gastos_Ejecucion=446, Subtotal=Gastos_Ejecucion +Multa_Efectiva, Total=Gastos_Ejecucion +Multa_Efectiva,
----Honorarios_Notificacion=0
----from obl_detalle_documentos as a
----join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision  and a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
------where  a.Numero_Emision between '0901' and '1501'
----where  a.Numero_Emision >='1401'  --and a.Numero_Emision <'1401'
------and Movimiento in ('ME','I1','M1','M2','M3','I1','12','13') 
----and Movimiento in ('ME') 
------and Status not in ('T','P','H','L','M','J','S','Y','Z','O','U','W','R','G','F') 
------and Fecha_Impresion  is not NULL
------and Folio_Impresion='21'
------and a.Numero_Emision='1301'
------and a.Municipio='01'
----and Clave_Obligacion in ('010103','010104','010102','010106')

----COMMIT


------------------------------------
ejecuta pruebas en riesgo estatales
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Requerir_Morosos_Estatales_enriesgo_07_ago_2014]
		@Limite = 1,
		@Clave_Obligacion = N'010104',
		@Municipio = N'02',
		@ClavePeriodicidad = N'02',
		@EjercicioFiscal = N'2014',
		@Mes = N'07',
		@MesFinal = N'07',
		@ClaveLocalidad = N'0001',
		@ClaveZona = N'01',
		@ClaveOficina = N'01',
		@Anio = N'2014',
		@Numero_Emision = N'1499',
		@Cont_No_Localizados = 0,
		@Total_En_Riesgo=2

SELECT	'Return Value' = @return_value

GO
------------------------------------------

actualiza los pagos espontaneos de los que requeri sin que fueran morosos genaro

--update  obl_detalle_documentos
--set SubStatus=Status, Status='T', usuario_cancelacion='INFO', Fecha_Ultimo_Movimiento=GETDATE()
----select *
--from obl_detalle_documentos as	a
--inner join obl_control_emisiones as b
--on a.numero_emision=b.numero_emision 
--and a.municipio=b.municipio 
--and a.oficina=b.oficina
--left join obl_obligacion_vigilable_presentada as c
--on a.RFC=c.RFC 
--and b.periodo_inicial=c.mes_inicial 
--and b.Anio_Moroso=c.Anio_Inicial 
--and b.Clave_Periodicidad=c.Tipo_Periodo
--and b.Clave_Obligacion=c.Clave_Obligacion   
--where --a.municipio='01' 
----and a.oficina='01' and 
--a.Movimiento in ('R1','R2','R3')
--and b.Clave_Obligacion in ('010610','010618','010623')
--and b.Ejercicio_Fiscal ='2014'
----and a.numero_emision='1433' 
----and a.folio_impresion='1616'
--and a.Status not in ('P','T','H','L','M','J','S','Y','Z','O','U','W','R','G','F')
--and c.RFC is not null
----and a.RFC='SURM670909RG2'
-----------------------------------------------------
revisar los requerimientos como estaban hasta el 2011  de tenencias gabo bruno informe reporte

--EMITIDOS	NOTIFICADOS	PAGADOS	IMPROCEDENTES	MONTO RECAUDADO

--aqui lleno una tabla con todos los requerimientos de 2011

--emitidos
SELECT --count(*)
docu.*, 
emi.Numero_Control_Inicial ,
emi.Numero_Control_Final,
emi.Clave_Obligacion,
emi.Clave_Periodicidad,
emi.Ejercicio_Fiscal,
emi.Periodo_Inicial,
emi.Periodo_Final,
emi.Anio_Moroso,
emi.Fecha_Emision,
emi.Tipo_Moroso,
emi.Cuenta_Registro,
emi.Dirigida,
detalle.Anio_Moroso as Anio_moroso_detalle,
detalle.Numero_Operacion,
detalle.Pagado,
detalle.Fecha_Pago
into ingresos.dbo.obl_requerimientos_tenencias_2011 
FROM         obl_detalle_documentos AS docu 
INNER JOIN   obl_control_emisiones AS emi ON docu.Municipio = emi.Municipio 
AND docu.Oficina = emi.Oficina 
AND docu.Numero_Emision = emi.Numero_Emision 
INNER JOIN   obl_detalle_vehiculo AS detalle ON docu.Municipio = detalle.Municipio 
AND docu.Oficina = detalle.Oficina AND docu.Numero_Emision = detalle.Numero_Emision 
AND docu.RFC = detalle.RFC AND docu.Folio_Impresion = detalle.Folio_Impresion 
AND docu.Numero_Serie = detalle.Numero_Serie 
INNER JOIN obl_datos_vehiculo AS datos ON docu.Municipio = datos.Municipio 
AND detalle.Municipio = datos.Municipio 
AND detalle.Oficina = datos.Oficina 
AND detalle.Numero_Emision = datos.Numero_Emision 
AND detalle.RFC = datos.RFC 
AND detalle.Numero_Serie = datos.Numero_Serie 
AND detalle.Folio_Impresion = datos.Folio_Impresion
WHERE  Movimiento='R1' and emi.Ejercicio_Fiscal = '2011' 
and docu.status is not null 
--and emi.Municipio='01' and emi.Oficina='02'
--and emi.Numero_Emision='1322'  and emi.Municipio='07' and emi.Oficina='01' 
ORDER BY emi.Municipio, emi.Oficina, emi.Numero_Emision, 
docu.folio_impresion, detalle.Anio_Moroso 	


####aqui saco la estadistica por municipio de los requerimientos de tenencias no de los años morosos

select Municipio, Oficina, SUM(CASE WHEN estatus is not null THEN 1 ELSE 0 END) AS	Total
  ,SUM(CASE WHEN (year(Fecha_Entrega)<=2011) THEN 1 ELSE 0 END) AS Entregados
  ,SUM(CASE WHEN (year(fecha_pago)<=2011) THEN 1 ELSE 0 END) AS Pagados
  ,SUM(CASE WHEN (estatus in ('T','H','L','M','J','S','Y','Z','O','U','W','R','G','F')) THEN 1 ELSE 0 END) AS Improcedentes
from(
select municipio, oficina, numero_emision, folio_impresion,MIN(numero_serie)  as numero_serie, 
min(status) as estatus, MIN(fecha_entrega) as fecha_entrega, MIN(fecha_pago) as fecha_pago
from ingresos.dbo.obl_requerimientos_tenencias_2011  
--where  municipio='01' and oficina='02'
--where numero_serie='5KMMSG1V955122113'
group by Municipio, Oficina,numero_emision, folio_impresion
) as a
group by Municipio, Oficina
order by Municipio, oficina

##------------------------aqui me dice los importes de los pagos que ya ingrese a ingresos.dbo.obl_requerimientos_tenencias_2011_pagos
select municipio, oficina,SUM(importe), SUM(multa)
from ingresos.dbo.obl_requerimientos_tenencias_2011_pagos
--where municipio='01' and oficina='02'
group by municipio, oficina
order by municipio, oficina


select *  
from ingresos.dbo.obl_requerimientos_tenencias_2011  
where municipio='09' and status='T'
-----------------------------------------
aqui obtengo los requerimientos historicos desde 2009 a 2013 de repecos intermedios e gasolinas

select t.Municipio, t.Oficina, t.Clave_Obligacion, t.Obligacion, Numero_Emision, t.Dirigida, 
		t.Periodo_Inicial, t.Periodo_Final, t.Anio_Moroso,
		t.Total as Emitidos, t.Entregados , 
		t.Pagados, t.Improcedentes from 
(
SELECT --*
		b. Municipio,
		b.Oficina,
		b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               a.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN (YEAR(a.Fecha_Entrega)<='2013') THEN 1 ELSE 0 END) AS Entregados,
               SUM(CASE WHEN (YEAR(e.Fecha_Declarado)<='2013') THEN 1 ELSE 0 END) AS Pagados,
               SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('N','X','T','H','L','M','J','S','Y','Z','O','U','W','R','G','F')) THEN 1 ELSE 0 END) AS IMPROCEDENTES
               
              FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               inner join obl_datos_federales as d on a.Numero_Emision=d.Numero_Emision and a.Folio_Impresion=d.Folio_Impresion 
               and a.Municipio=d.Municipio and a.Oficina=d.Oficina  and b.Clave_Obligacion=d.Clave_Obligacion 
               LEFT join obl_obligacion_vigilable_presentada as e on d.RFC=e.RFC and d.Mes_Inicial=e.Mes_Inicial --and d.Mes_Final=e.mes_final 
               and d.Anio_Moroso=e.Anio_Inicial and d.Clave_Periodicidad=e.Tipo_Periodo 
               and d.Clave_Obligacion=e.Clave_Obligacion
              WHERE a.Movimiento='R1' and 
			   b.Clave_Obligacion='010622' and 
			   b.Ejercicio_Fiscal='2013'
			   --and a.Municipio='03' and a.Oficina='01'
			   --and a.RFC in ('AACF630511744','AACG5511095IA','AAAM451011H70')
			  -- and a.RFC in ('AAAM451011H70')
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision ,c.Descripcion 
) as t
order by  t.Municipio, t.Oficina,t.Clave_Obligacion,t.Numero_Emision 


ingresos.dbo.obl_requerimientos_repecos_2009_pagos
ingresos.dbo.obl_requerimientos_intermedios_pagos
ingresos.dbo.obl_requerimientos_ieps_pagos

saco los importes de repecos
select  Municipio, Oficina,Clave_Obligacion,Numero_Emision,SUM(importe)
from ingresos.dbo.obl_requerimientos_repecos_2009_pagos
where ejercicio_fiscal='2013'
group by Municipio, Oficina,Clave_Obligacion,Numero_Emision 
order by  Municipio, Oficina,Clave_Obligacion,Numero_Emision 


saco los importes de ieps
select  Municipio, Oficina,Clave_Obligacion,Numero_Emision,SUM(importe)
from ingresos.dbo.obl_requerimientos_ieps_pagos
where ejercicio_fiscal='2013'
group by Municipio, Oficina,Clave_Obligacion,Numero_Emision 
order by  Municipio, Oficina,Clave_Obligacion,Numero_Emision 


saco los importes de intermedios
select  Municipio, Oficina,Clave_Obligacion,Numero_Emision,SUM(importe)
from ingresos.dbo.obl_requerimientos_intermedios_pagos
where ejercicio_fiscal='2013'
group by Municipio, Oficina,Clave_Obligacion,Numero_Emision 
order by  Municipio, Oficina,Clave_Obligacion,Numero_Emision 


-----------------------------------------
determina los morosos de todas las obligaciones

[paCo_Determina_Morosidad_padron_CPY_Todas_las_obligaciones]
[paCo_Generar_Cumplidos_General_Todas_las_obligaciones]

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Generar_Cumplidos_General_Todas_las_obligaciones]

SELECT	'Return Value' = @return_value

GO
--determina los morosos estatales

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales]

SELECT	'Return Value' = @return_value

GO


----------------------------------
obtener el dia en numero de la semana fecha 
declare @dia integer
 
set @dia = DATEPART(dw,@Fecha)
------------------------------------------
##sp para cargar los periodos vencidos en cat_periodos_ejercicio para la vigilancia de obligaciones en general 
se corre diarimente y checa si ya puede cargar el siguiente registro azueta gabo

[dbo].[paCo_cargar_periodos_ejercicio] esta lo jala azueta para ejecutar diariamente
[dbo].[paCo_cargar_periodos_ejercicio_modificado] este me sirve para modificarlo




USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_cargar_periodos_ejercicio_modificado]

SELECT	'Return Value' = @return_value

GO

----------------------------------------------
total de registros en cat_periodos_ejercicio al 22 ago 2014
select COUNT(*) from cat_periodos_ejercicio 
143


-
-----------------------------------------------------------------
contribuyente prueba con sirref y demas obl

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Control_Creditos]
		@RFC = N'AAAA660313FV9'

SELECT	'Return Value' = @return_value

GO

---------------------------------------

fecha
movimiento en el listado de obligaciones en la captura

campos a cambiar para sirref

numero_control 14- 21
clave_obligacion 6-3
regimen 1-3 = clasificacion agrupacion
equivalencia tambien crecerla 3-6 y cambiar la posicion de lectura


llevar rfcs

poner el numero de credito para que cuando se inserte sea con no de credito
-----------------------------------------------------------

query para 
select  b.Nombre as Municipio, a.Oficina, Numero_Emision, Numero_Control_Final as Total, 
'Repecos'  as Obligacion, Ejercicio_Fiscal, Anio_Moroso, Fecha_Emision, c.Nombre+' '+ c.Apellido as Usuario_Carga, c.Municipio,
c.Usuario 

from obl_emisiones_cartas_invitacion as a
join cat_municipios as b on a.Municipio=b.Clave 
join seg_usuarios as c on a.Cuenta_Registro=c.Usuario 
order by a.Fecha_Emision desc

-----------------------------------------------------------

para incluir las referencias de estatales modificar 

----reportes\imprime_requerimientos2.php
----templates\requerimiento_tpl.php

para incluir las referencias de federales modificar 
----reportes\notifica_credito_imprimir.php
----reportes\templates\notifica_credito_intermedios_imprimir_tpl.php
----reportes\templates\notifica_credito_ieps_imprimir_tpl.php
----reportes/templates/notifica_credito_federal_imprimir_tpl.php
----reportes/templates/notifica_credito_imprimir_tpl.php --esta checar para el salto de linea antes de acta de inspeccion

el modulo para imprimir todas las I1 de una vez se modifica en

----reportes/imposicion_multa_incumplimiento_general_imprimir.php

ME                           
imposicion multa federal imprimir
----imposicion multas federales tpl

reportes\notifica_credito_istuv_imprimir.php
reportes\templates\notifica_credito_istuv_imprimir_tpl.php


---------------------------------------------------
sps para marcar las multas cobradas con referencia  con gabo

'480';'481';'482';'483';para estos conceptos ejecutar 
EXEC	@return_value = [dbo].[marcar_pagos_referencias_multas]
		@Numero_Emision = N'0601',
		@Folio_Impresion = 1,
		@Municipio = N'01',
		@Oficina = N'01',
		@Movimiento = N'ME',
		@Tipo_Pago= N'Caja'

489--para este concepto ejecutar
PROCEDURE [marcar_pagos_espontaneos_actas_inspeccion]
@Id bigint, 
@Referencia varchar(20), 
@Tipo_Pago varchar(16)
--------------------------------

checar el sp de generar multas para las actas de inspeccion no esta generando la referencia
con el id 242

------------------------------------------
genaro sirref saber que registros vienen con inconsistencias en el regimen o clasificacion y la clave		
		SELECT cat.*, CONVERT(VARCHAR(10),cat.Fecha_Vencimiento_PF,20) as Vencimiento_Documento, det.RFC, det.Numero_Control,
			det.Concepto_Ley, det.Agrupacion 
		FROM sirref_co_detalle det
		left JOIN sirref_cat_fundamentos cat
			ON det.Numero_Emision = cat.Numero_Emision
			AND det.Concepto_Ley = cat.Concepto_Ley
			AND det.Ejercicio_Fiscal = cat.Ejercicio_Fiscal
			AND det.Numero_Pago = cat.Periodo
			AND det.Agrupacion = cat.Clasificacion
		WHERE det.Numero_Emision='14007' 
		--and det.Numero_Control='100309140069035C77042'
		and cat.Concepto_Ley is null


----------------------------------------------------
generar multa por incumplimeitno intermedios  
--delete from obl_detalle_documentos 
--  where   Oficina='01' and Municipio='01' and Movimiento like ('I1')
--  and Numero_Emision='0814' and Folio_Impresion='2' 
    
    
    
    
--delete from obl_detalle_federales  
--  where   Oficina='01' and Municipio='01' --and Status='I' 
--  and Numero_Emision='0814' and Folio_Impresion='2' 



------------------------------------------------------------
trabajar esto los morosos de nomina y hospedaje   opb carrillo morelos

[paCo_Determina_Morosidad_padron_CPY_Estatales]
-------------------------------------------------------------

exec determina referencia multas
EXEC [dbo].[pa_Determina_Referencia_Multas] @Id =N'1', 
@No_Municipio =N'01', 
@Oficina = N'01', 
@No_Emision = N'1314', 
@Fol_Impresion = '549', 
@Movimiento = N'M1', 
@Clave_Obligacion=N'010610' 
------------------------------------------------------
##cancelar los numeros de operacion del pago

select * from obl_datos_federales  as a
join  obl_obligacion_vigilable_presentada  as b on a.RFC=b.RFC and a.Mes_Inicial=b.Mes_Inicial and a.Mes_Final=b.Mes_Final and 
a.Anio_Moroso =b.Anio_Inicial and a.Clave_Periodicidad=b.Tipo_Periodo and a.Clave_Obligacion=b.Clave_Obligacion 
where numero_EMISION='1428' and Folio_Impresion in ('207',
'208',
'219',
'242',
'254')
and a.Municipio='09'


----------------------------------------
#######################3volver a marcar estos pagos
##ya los marque como pagados
update obl_obligacion_vigilable_presentada
set Estado='T'
from obl_datos_federales  as a
join  obl_obligacion_vigilable_presentada  as b on a.RFC=b.RFC and a.Mes_Inicial=b.Mes_Inicial and a.Mes_Final=b.Mes_Final and 
a.Anio_Moroso =b.Anio_Inicial and a.Clave_Periodicidad=b.Tipo_Periodo and a.Clave_Obligacion=b.Clave_Obligacion 
where numero_EMISION='1428' and Folio_Impresion in ('223','207',
'208',
'219',
'242',
'254')
and a.Municipio='09'
-----------------------------------------------------------
####  solicitud Genaro

 los morosos activos de la localidad central en el municipio por ejemplo en opb solo los de chetumal
-- que sean localizables hay un campo en el padron federal que indica si un contribuyente es localizable o no
 omite los que ya han sido requeridos y se marcaron como doble no localizado
 que tengan al menos un pago del 2008 en adelante
-- al final los ordeno dando prioridad a los que no han sido requeridos en años anteriores y despues por monto
los ordeno por monto de acuerdo a lo reportado en inscritos de cuota fija

este es el sp[Listado_morosos_federales_filtros]

[28/10/2014 02:48:11 p.m.] Lili Lizardi: estos son los filtros para los repecos
[28/10/2014 02:48:48 p.m.] Lili Lizardi: los que tienen --se quitaron de los filtros en la ultima modificacion

2010-2013
ene-feb 2013



          SELECT pad_oblxest.RFC, cont.localidad,
         (     SELECT top 1 rfc
		FROM obl_detalle_documentos s
		JOIN obl_control_emisiones f
		ON s.Municipio = f.Municipio
		AND s.Oficina = f.Oficina
		AND s.Numero_Emision = f.Numero_Emision
		WHERE s.Municipio = cont.Municipio
		AND s.Oficina = '01' 
		AND s.Status in ('X')
		AND s.Movimiento in ('R1','R2','R3')
		AND f.Clave_Obligacion in ('010610','010618','010623')
		AND s.RFC= pad_oblxest.RFC
		) as doble_no_loc,
		
		(select top 1 (y.rfc)
		from obl_obligacion_vigilable_presentada  as y
		where y.anio_inicial>'2007' 
		and y.tipo_periodo='03'
		and y.clave_obligacion in ('010610','010623','010618' )
		and y.RFC=pad_oblxest.RFC
		and y.estado='T') as pago_2008_adelante
          
          FROM pad_obligacionesporestablecimiento pad_oblxest JOIN pad_contribuyentes cont 
          ON pad_oblxest.RFC = cont.RFC LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre 
          ON pad_oblxest.RFC = obl_oblvigpre.RFC AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion 
          AND obl_oblvigpre.Tipo_Periodo = '03' AND obl_oblvigpre.Anio_Inicial = '2013' 
          AND obl_oblvigpre.Mes_Inicial = '01' AND obl_oblvigpre.Mes_Final = '02' 
          LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC 
          AND pad_oblxest.Clave = fed.Clave_Obligacion AND fed.Anio_Moroso = '2013' 
          AND fed.Mes_Inicial = '01' AND fed.Mes_Final = '02' AND fed.Clave_Periodicidad = '03' 
          LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC 
          AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' 
          WHERE pad_oblxest.Clave in ('010610','010618','010623') 
          AND (pad_oblxest.Fecha_Inicio <= '2013-01-01' OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) 
          AND cont.Municipio = '01' AND pad_oblxest.Situacion = 'Activo' AND cont.Situacion = 'Activo' 
          AND fed.RFC IS NULL AND obl_oblvigpre.RFC IS NULL 
         -- GROUP BY pad_oblxest.RFC


--------------------------------
SERVIDOR PARA DESARROLLO DE QUERYS 
10.9.3.108 ENTRAR CON LLIZARDI

Y BD HACIENDA\LLIZARDI

----------------------------
checar este folio
select * from obl_detalle_documentos  where Folio_Impresion='753' and numero_emision='1450'
select * from obl_detalle_sucursales  where Folio_Impresion='753' and numero_emision='1450'
select * from obl_obligacion_vigilable_presentada where No_Operacion='10039065208010'
------------------------------------

query para saber los requerimientos y multas que se generaron en 2013-2014 de todas las obligaciones de todos los municipios



select b.nombre as Municipio, c.nombre as Oficina,  d.descripcion as Clave_Obligacion, a.Clave_Obligacion, Numero_Emision, 
numero_control_final as Total_Requeridos, 
(select  count(movimiento) from obl_detalle_documentos 
where Municipio=a.Municipio  and Oficina=a.Oficina  
and Movimiento in ('ME','M1')
and Numero_Emision=a.Numero_Emision) as Multas_Extemporaneidad,
(select count(movimiento) from obl_detalle_documentos 
where Municipio=a.Municipio  and Oficina=a.Oficina  
and Movimiento='I1'  
and Numero_Emision=a.Numero_Emision) as Multas_Incumplimiento,
case Clave_Periodicidad 
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
when '12' then 'INFORMATIVA MENSUAL'
when '17' then 'INFORMATIVA ANUAL'
end as Tipo_Periodo,
case Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
case Periodo_Final 
when NULL then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Final,
anio_moroso as Año_Moroso,
Fecha_Emision
from obl_control_emisiones as a
join cat_municipios as b on a.municipio=b.clave
join cat_oficinas as c on a.municipio=c.clave_municipio and a.oficina=c.clave
join cat_obligaciones as d on a.clave_obligacion=d.clave
where ejercicio_fiscal in ('2013','2014')
--and municipio='01' 
--and oficina='02'
--and a.clave_obligacion not in ('010611')
--and a.Numero_Emision='1325'
order by a.municipio,tipo_periodo desc, a.clave_obligacion, a.numero_emision

-----------------------------------------
actualiza los caracteres raros en la carga de fundamento chr caracter
UPDATE sirref_cat_fundamentos SET descripcion_obligacion =  (SELECT top 1 REPLACE(
    SUBSTRING(descripcion_obligacion, 1, DATALENGTH(descripcion_obligacion)),
    'Ã³', 'ó') FROM sirref_cat_fundamentos
    where Numero_Emision='14021' and Concepto_Ley='44') where Numero_Emision='14021' and Concepto_Ley='44'

guardar el archivo de fundamentos en pspad con formato ansi txt


    
    --------------
sp para la carga
1. recibes el correo descomprimes.
2. revisar que te envien uno que corresponda a fundamentos legales
y uno de omisos.
3. ingresar al sistema con el usuario gnavarro
4. revisar el archivo de fundamentos en  Analiza archivo de fundamentos
que contenga la estructura
5. revisar el archivo de morosos en Analiza archivo de morosos
que contenga la estructura.
(si los archivos no contienen la estructura hay dos opciones corregirlos si son pocos o devolverlos Genaro para que pida la correccion al SAT)
6.-Acompletar el archivo de fundamentos en el campo numero de emision de la posicion antes del primer pipe
a 5 digitos iniciando con los dos primeros digitos con el año y el resto en ceros.
7.-abrir la tabla sirref_cat_equivalencias y crear un nuevo registro 
con los campos numero de emision, ejericicio fiscal(no es el año actual es el año moroso),
equivalencia(tomar del tercer dato de un reglon del archivo de morosos que es el numero de control
y separar de la tercera posicion a la ocho estos seis digitos es la equivalencia ej.101211140245861C73065 equivalencia 121114),
Numero de emision es el numero de emision original que viene en el catalogo de fundamentos.
8.-Enviarle a Genaro el archivo de fundamentos modificado, para que cargue los fundamentos.
9.-Si se modifico el archivo de morosos enviarselo a Genaro, si no, decirle que cargue la emision.
---------------------------
RECURSOS HUMANOS DE HACIENDA
USER 
LIRL830804MVZZDL07
CTRS: 16887
http://rh.qroo.gob.mx/empleados/


 
http://rh.qroo.gob.mx/empleados/Inicio.php
curp lirl830804mvzzdl07
ctrs:168871

pORTAL: http://quintanaroo.pcfdi.mx nomina
NOMBRE: LIZARDI RODRIGUEZ LILI
USUARIO: LIRL830804S18
PASSWORD: 168871

recibos de nomina
https://www.timbradoquintanaroo.mx/SEFIPLANEmpleados/Login.aspx?ReturnUrl=%2fSEFIPLANEmpleados
USUARIO: LIRL830804SI8
PASSWORD: LIZA0408



https://tramitesrh.qroo.gob.mx/empleados/Principal.php
usuario: lirl830804mvzzdl07
contraseña: 168871

-----------------------
checar caso de gerardo
select * from obl_detalle_documentos 
where Numero_Emision like '1347' and Folio_Impresion='8489' 
and Municipio='01' and Oficina='01'

select * from obl_detalle_sucursales  
where Numero_Emision like '1347' and Folio_Impresion='8489' 
and Municipio='01' and Oficina='01'

update obl_detalle_documentos 
set Status='C'
where Numero_Emision like '1347' and Folio_Impresion='8489' 
and Municipio='01' and Oficina='01' 

update obl_detalle_sucursales  
set Pagado=''
where Numero_Emision like '1347' and Folio_Impresion='8489' 
and Municipio='01' and Oficina='01'

update obl_obligacion_vigilable_presentada 
set Estado='S'
where No_Operacion='02010121940150'

-----------------------------------------------------------
reportes de referencias
pa_Co_Referencias_Vencidas

con descuento
pa_Co_Referencias_Con_Descuento

pagadas
pa_Co_Referencias_Pagadas 
-----------------------------------------------
isan-010604

-------------------------------------
renumerar estas emisiones para soli
checar desde el desglose

un select where numero emision not in poner los rangos para hacer la excepcion
si ya existe la emision sumar uno a esa y asi sucesivamente

select * from obl_control_emisiones where --Numero_Emision>'1596' and 
Municipio='08' and Oficina='01' and Ejercicio_Fiscal='2015'
select * from obl_detalle_documentos  where Numero_Emision>'1596' and 
Municipio='08' and Oficina='01'
select * from obl_datos_vehiculo   where Numero_Emision>'1596' and 
Municipio='08' and Oficina='01'
select * from obl_detalle_vehiculo   where Numero_Emision>'1596' and 
Municipio='08' and Oficina='01'
1514-1523
1524-1552
1560-1587


select * from obl_control_emisiones where --Numero_Emision>'1596' and 
Municipio='08' and Oficina='01' and Ejercicio_Fiscal='2015'

SELECT MAX( Numero_Emision ) AS ultimaEmision
							FROM obl_control_emisiones
							WHERE Municipio = '08' 
								AND Oficina = '01'                                                                                                                                                                                                                                                                                                  
								AND LEFT( Numero_Emision, 2 ) = '15'
								AND (Numero_Emision not between 1501 and 1513 ) 
								and (Numero_Emision not between 1556 and 1559 ) 
								and (Numero_Emision not between 1588 and 1597 ) 
								
								
SELECT MAX( Numero_Emision ) AS ultimaEmision
							FROM obl_control_emisiones
							WHERE Municipio = '08' 
								AND Oficina = '01'                                                                                                                                                                                                                                                                                                  
								AND LEFT( Numero_Emision, 2 ) = '15'
							and (Numero_Emision not between 1556 and 1559 ) 
							and (Numero_Emision not between 1588 and 1597 ) 
								
1501 between 1513
libre 1515 a 1523
libre 1525 a 1552
1556 between 1559
libre 1561 a 1587                                                                 
								
					


-----------------------
continuar checando que se genere la referencia
y que se íntegren las demas obligaciones
------------------------------

con uno que declare pasa
-----------------------------
LISTADO DE MULTAS DE ESTATALES AMARO 

select t.* from (select 
--*
--DISTINCT(Multa_Programada ), Honorarios_Notificacion 
--DISTINCT(Clave_Periodicidad )
--COUNT(*)
--top 100
a.Municipio,
f.Nombre as Municipio_Nombre,
a.Oficina,
b.Clave_Obligacion,d.Descripcion as Nombre_Obligacion, 
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '01' else b.Periodo_Inicial end as Mes_Inicial,
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '12' else b.Periodo_Final   end as Mes_Final,
 b. Anio_Moroso as Año_Moroso,
 case when b.Clave_Periodicidad ='02' then 'Mensual' 
 when b.Clave_Periodicidad ='03' then 'Bimestral'
 when b.Clave_Periodicidad ='07' then 'Anual'
 when b.Clave_Periodicidad ='12' then 'Mensual Informativa'
 when b.Clave_Periodicidad ='17' then 'Anual Informativa'
 end as Periodicidad, 
 
b.Fecha_Emision,
a.Numero_Emision, a.Folio_Impresion,a.RFC, c.nombre as Tipo_Documento, 
 case when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is not null) then 'Asignado' 
when (a.Status='I' and a.Fecha_Asignacion is not null) then 'Asignado'
when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is null) then 'Impreso'
else e.Nombre
end as Estatus,
a.fecha_impresion as Fecha_Impresion, a.fecha_asignacion as Fecha_Asignacion, a.fecha_no_localizado as Fecha_No_Localizado, 
a.Fecha_Entrega, case when  a.Fecha_Entrega is null and a.Fecha_Vencimiento is not null then NULL else a.Fecha_Vencimiento end as Fecha_Vencimiento, 
Clave_Notificador, a.Multa_Programada, a.Multa_Efectiva, a.Gastos_Ejecucion, a.Honorarios_Notificacion
from obl_detalle_documentos as a
join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision  
and a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
--where  a.Numero_Emision between '0901' and '1501'
join obl_nombres_documentos as c on a.Movimiento=c.Clave 
join cat_obligaciones as d on b.Clave_Obligacion=d.Clave 
join obl_nombres_estatus as e on a.Status=e.clave
join cat_municipios as f on a.Municipio=f.Clave 
where  a.numero_emision >='1001'  and  a.numero_emision<='1501'
and Movimiento in ('ME','I1','M1','M2','M3','I1') 
--and Movimiento in ('ME') 
and Status not in ('T','P','H','L','M','J','S','Y','Z','O','U','W','R','G','F') 
--and Status in ('B') 
--and Fecha_Impresion  is not NULL
and Clave_Obligacion in ('010103','010104','010102','010106','010610','010611','010622')
--and Clave_Obligacion in ('010622')
--and a.numero_emision='1104' and Folio_Impresion='1'
and a.Municipio='09'
--and  Multa_Programada>1
) as t 
left join obl_detalle_documentos as w on
t.Numero_Emision=w.Numero_Emision and t.Folio_Impresion=w.Folio_Impresion and t.Municipio=w.Municipio and t.Oficina=w.Oficina
and w.Status not in ('T') and w.Movimiento='R1'
where w.RFC is not null
order by t.Municipio,  t.Clave_Obligacion, t.Numero_Emision, t.Folio_Impresion,  t.Estatus 


---------------------------------

obl_ decirle que onda a charlie
-------------------------------------
RFC GENERICO
XAXX010101000
-----------------
dejar bien cuando no se escribe un numero de emsiion

------------------------------
hacer el update del documento

--------------------------

NO. DE SOLICITUD:
26503
FECHA DE SOLICITUD:
2015-07-08
NOMBRE COMPLETO :
LILI LIZARDI RODRIGUEZ
R.F.C.:
LIRL830804SI8
DEPENDENCIA :
SECRETARÍA DE FINANZAS Y PLANEACION

-------------
[paCo_Determina_Morosidad_padron_CPY_SOLO_REPECOS]
[paCo_Determina_Morosidad_padron_CPY_SOLO_REPECOS_CON ADEUDO] correo confirmado
---------------------

cargar la fundamentacion y catalogo de equivalencias de sirref


determinar el numero de emision 15080
verificar que no exista un numero de emision
insertar el nuevo registro con los campos:
*numero_emision: primer campo fundamentos
*ejercicio_fiscal: año de morosidad
equivalencia: 101211140245861C73065 121114
tipo de obligacion: tipo de vigilancia.
actualizar el catalogo de fundamentos a 15080 no 80|


agregarle a la revision de fundamentos el mensaje de quitar el encabezado
agregarle a la revision de omisos el mensaje de quitar el encabezado
agregarle la revision a la carga de fundamentos y a la carga  de emisiones 
antes de hacer la carga
-----------------------------------
tabla base creada por norberto
select * from temp_estatales_2015_correo

con este saco el detalle de los morosos con correos confirmados estatales
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_CON_CORREO]

SELECT	'Return Value' = @return_value

GO



con  este saco el general de estatales con correo confirmado

select I.RFC, L.nombres+' '+L.apellido_paterno+' '+ L.Apellido_Materno as Nombre,case when I.municipio ='B' then 'BENITO JUAREZ'
when I.municipio ='O'then'01-OTHON P. BLANCO'  
when I.municipio ='S'then'08-SOLIDARIDAD'  
when I.municipio ='F'then'05-FELIPE CARRILLO PUERTO'  
when I.municipio ='C'then'03-COZUMEL'  
when I.municipio ='L'then'07-LAZARO CARDENAS'  
when I.municipio ='T'then'09-TULUM'  
when I.municipio ='I'then'04-ISLA MUJERES'  
when I.municipio ='J'then'06-JOSE MARIA MORELOS'  
when I.municipio ='B'then'02-BENITO JUAREZ' END AS Municipio,
case when moroso='m' then '' else moroso end as Moroso
from ingresos.dbo.temp_estatales_2015_correo2  AS I JOIN pad_contribuyentes AS L ON I.RFC=L.RFC
order by Municipio, rfc


-*---------------
sp para generar listado de morosos con correo federales
[paCo_Determina_Morosidad_Correo_Federales]

sp estales
[paCo_Determina_Morosidad_Correo_Estatales]
------------------
	
	SELECT * FROM obl_datos_federales 
	WHERE Folio_Impresion = '17' AND Municipio = '01' AND Oficina = '01' AND Numero_Emision = '0713'
terminar de checar cancelar reyes

-----------------------------
insertar estos de entrada son los que no tienen carta responsiva en ningun año
select * 
from ingresos.dbo.rfc_ins_correo as a
left join repecos_cf_inscritos_2010  as b
on a.rfc=b.rfc
left join repecos_cf_inscritos_2011  as c
on a.rfc=c.rfc
left join repecos_cf_inscritos_2012  as d
on a.rfc=d.rfc
left join repecos_cf_inscritos_2013  as e
on a.rfc=e.rfc
where b.RFC is NULL and c.RFC is null and d.RFC is null
and e.RFC is null
 

----------------------
10.9.3.40 servidor para consultar istuv tenencias
logearme con hacienda\llizardi  ctrs rodriguez...ra



		select * FROM openquery (ADS_ING,' SELECT distinct(nse_cvdb75)
		FROM CVDB75 
		WHERE MPO_CVDB75 = 02  and ANM_CVDB75=2011')



----------

select *
from sirref_co_documentos  as a 
join sirref_co_datos as b  on a.numero_control=b.numero_control
join sirref_co_documentos2 as c on a.numero_control=c.numero_control 
and a.numero_emision=c.numero_emision
where a.numero_emision='15099' and b.municipio_estatal='09'

select * from sirref_co_emisiones where  numero_emision='15099' and municipio_estatal='04'

02
    01* no tocar
    02 no tocar
    03* no tocar
    08
    06
    --
    01 no tocar
    02 no tocar
    03 no tocar
    04 regresarle el estatus anterior- ya lo regrese
    05 revisar cinco pendiente esta???
    06 no tocar
    07 noo tocar
    08 no tocar
    09 no tocar


---------------
select  * from obl_obligacion_vigilable_presentada where rfc=' ASO871208IU9'  
and YEAR(Fecha_Declarado )>='2015' and month(Fecha_Declarado )>='10'



USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_Determina_Morosidad_Promo_Octubre]
--EXEC	@return_value = [dbo].[paCO_Determina_Morosidad_cpy]
		@RFC = N' ASO871208IU9' --SME0109138I3
SELECT	'Return Value' = @return_value

GO

--------------------------
SACAR LOS PAGOS QUE HA HECHO UN CONTRIBUYENTE DE ALGUNA OBLIGACION

SELECT @No_Pagos=COUNT(*)
FROM         cob_cobros AS c INNER JOIN
cob_desglose AS d ON c.No_Operacion = d.No_Operacion INNER JOIN
cat_municipios AS m ON c.Municipio = m.Clave
WHERE     c.Estatus IN ('A','B') and Year(c.Fecha_Pago)=2015 and MONTH(c.Fecha_Pago)=10
AND d.Rubro=@Clave_Obligacion
 and rfc=@RFC 
 and YEAR(Periodo_Inicial)<'2015'
 and tipo_declaracion='N'

SP PRUEBA
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_Determina_Morosidad_Promo_Octubre2]
		@RFC = N' EFP090311IU9',
		@Clave_Obligacion = N'010250'

SELECT	'Return Value' = @return_value

GO


USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_Listado_Pagos_Octubre2]
		@RFC = N'EFP090311IU9',
		@Clave_Obligacion = N'010250'

SELECT	'Return Value' = @return_value

GO



EFP090311IU9 



USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_Determina_Morosidad_Promo_Octubre2]
		--@RFC = N'CAHN880917EU3',
		@RFC = N'AACE5209079M1',
		@Clave_Obligacion = N'010103'

SELECT	'Return Value' = @return_value

GO
---------------------------
multas nov 2014- 2015
select mes_emision, ejercicio_fiscal, SUM(total_requerimientos) 
from (
select MONTH(a.Fecha_Emision) as Mes_Emision, a.Ejercicio_Fiscal , COUNT(*) Total_Requerimientos
from obl_control_emisiones as a
join obl_detalle_documentos   as b on 
a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio and a.Oficina=b.Oficina  
where ((MONTH(Fecha_Emision)>='11' and YEAR(Fecha_Emision)>='2014') 
--and a.Numero_Emision in ('1456') 
and  Movimiento not in ('R1'))
or ((YEAR(Fecha_Emision)='2015') 
--and a.Numero_Emision in ('1456') 
and  Movimiento not in ('R1','ME')) 
group by MONTH(Fecha_Emision), Ejercicio_Fiscal
union
select MONTH(fecha_impresion) as Mes_Emision, year(fecha_impresion) , COUNT(*) Total_Multas
from sirref_co_documentos 
where ((MONTH(fecha_impresion )>='11' and YEAR(Fecha_Impresion  )>='2014') 
 and Movimiento not in ('R1') 
 --and numero_emision='15041'
 )
or ((YEAR(fecha_impresion)='2015') and  Movimiento not in ('R1')  
--and numero_emision='15041'
)
group by MONTH(fecha_impresion), year(fecha_impresion) 
) as t
group by Mes_Emision, Ejercicio_Fiscal
order by Mes_Emision , Ejercicio_Fiscal desc



requerimientos nov 2014-2015
select mes_emision, ejercicio_fiscal, SUM(total_requerimientos) 
from (
select MONTH(Fecha_Emision) as Mes_Emision, Ejercicio_Fiscal , sum(Numero_Control_Final ) Total_Requerimientos
from obl_control_emisiones 
where ((MONTH(Fecha_Emision)>='11' and YEAR(Fecha_Emision)>='2014') 
)
or ((YEAR(Fecha_Emision)='2015') 
)  
group by MONTH(Fecha_Emision), Ejercicio_Fiscal 
union
select MONTH(Fecha_Carga ) as Mes_Emision, Ejercicio_Fiscal , sum(Numero_Control_Final ) Total_Requerimientos
from sirref_co_emisiones  
where ((MONTH(Fecha_Carga )>='11' and YEAR(Fecha_Carga )>='2014') 
)
or ((YEAR(Fecha_Carga )='2015') 
)  
group by MONTH(Fecha_Carga ), Ejercicio_Fiscal 
) as t
group by Mes_Emision, Ejercicio_Fiscal+



------------------------------------------------
sp para SABER LAS MULTAS QUE ADEUDA UN CONTRIBUENTE norberto

EXEC	[dbo].[pa_obl_multas_pendientes]
		@rfc = N' ACJ010416A25'


programa diseño imagenes
http://pizap.com/

----------------
quitar en genera_emision_paquetes y genera_emision_paquetes_previo la parte de generar las emisiones con el numero 25 algo 
para el cambio de año

genera_emision_paquetes.php
genera_emision_paquetes_previo.php


tipos de emisiones

 
        if  ($tipo_obl=='R')
				{echo "<td> <input type='text' name='Multa' size='4' value='620' readonly> </td>";}       //repecos
        elseif  ($tipo_obl=='I')
        {echo "<td> <input type='text' name='Multa' size='4' value='1240' readonly> </td>";}  //intermedios
        elseif  ($tipo_obl=='D')
        {echo "<td> <input type='text' name='Multa' size='4' value='2250' readonly> </td>";}  //dif intermedio y repecos
        elseif  ($tipo_obl=='G')
        {echo "<td> <input type='text' name='Multa' size='4' value='12500' readonly> </td>";}  //gasolinas
        elseif  ($tipo_obl=='P')
        {echo "<td> <input type='text' name='Multa' size='4' value='2250' readonly> </td>";} //plus
         elseif  ($tipo_obl=='F')
        {echo "<td> <input type='text' name='Multa' size='4' value='620' readonly> </td>";}  //interes 
         elseif  ($tipo_obl=='X')
        {echo "<td> <input type='text' name='Multa' size='4' value='620' readonly> </td>";}  //rif
        else
        {echo "<td> <input type='text' name='Multa' size='4' value='620' readonly> </td>";}

W0601052626
mayra sierra

-----------------------------
vigilancia correo  invitaciones gabo carlos
tabla [obl_vigilancia_correo_estatales]
sp [paCo_Determina_Morosidad_Correo_Estatales]
este es el ultimo modificado
paCo_Determina_Morosidad_Correo_Estatales_CPY_22102015

exec este sp de gabo
paObl_Vigilancia_Correos_Estatales_Resume

volver a enviar eliminar de esta tabla   donde folio_invitacion es el número de invitaciones enviadas   se alimenta cuando ya se enviaron las invitaciones

delete 
from obl_Invitaciones_correos_Estatales 
where rfc=' AAE050309FM0' and 
folio_invitacion='74'

 # tabla que se genera cuando ya se enviaron las invitaciones
  select top 10 * 
from obl_Invitaciones_correos_Estatales 
where rfc=' AAE050309FM0' and folio_invitacion='74'

#tabla que me dice los datos previos cuando inspecciono los morosos
select * from obl_vigilancia_correo_estatales where rfc=' AAE050309FM0' and orden_carga='74'


obl_invitaciones_pagadas tabla para generar el reporte de invitaciones enviadas por correo


correo de envío de invitaciones
vigilancias@satq.qroo.gob.mx

----------------------
SP PARA GENERAR LA MULTA DE EXTEMPORANEIDAD A PARTIR DE UN PAGO
paCO_generar_multas_extemporaneas

SP PARA GENERAR LA MULTA DE INCUMPLIMIENTO A PARTIR DE LOS REQUERIMIENTOS VENCIDOS
paCO_generar_multas_incumplimiento

----------------------------
sp para multas referenciadas norberto
[paPadron_obl_multas_pendientes]



USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_obl_multas_pendientes]
		@rfc = N'TERC570815M14'

SELECT	'Return Value' = @return_value

GO


*--------------------------
morales longitud moral 13 caracteres 12 caracteres
	--Validando si el RFC proporcionado es de 12 caracteres, le agregamos un espacio en blanco
			IF(LEN(@RFC)=12)
		   BEGIN
		   set @RFC=' '+@RFC
		   END
--------------------------------

tabla de descuentos a usuarios por las referencias carlos amaro

------------------------------------------
pagos  de tenencias historico tenencia eladio

select * from cob_cobros where Serie='93CTC69B56B107690'

select * from tenencias.dbo.ten_Historico_Pagos  where Serie='93CTC69B56B107690'

-----------------------------------------
#######################################################################################################################
sp 2016 descuentos licencias de funcionamiento norberto patentes
[paCo_Generar_Cumplidos_Repecos_Bebal]

WHERE     (Municipio = '01') AND (Oficina = '01') AND (Numero_Emision = '1001') AND (Folio_Impresion = '115')

HACER TODO PARA 2017
[paCo_Generar_Cumplidos_Repecos_Bebal]


--------------------------------
alergologo
manuel baeza bacab

usuarios grupos
mpech	prueba_multa

query saber multas para insertar

SELECT     a.RFC, a.Status,a.Movimiento, x.Movimiento ,
 a.usuario_cancelacion, a.Fecha_Impresion, b.Fecha_Emision, c.Fecha_Declarado, c.No_Operacion, a.Numero_Emision, a.Folio_Impresion, 
                      a.Municipio, a.Oficina
FROM         obl_detalle_documentos AS a INNER JOIN
                      obl_control_emisiones AS b ON a.Numero_Emision = b.Numero_Emision 
                      AND a.Municipio = b.Municipio AND a.Oficina = b.Oficina 
                      INNER JOIN
                      obl_detalle_sucursales AS f ON a.Municipio = f.Municipio AND a.Oficina = f.Oficina 
                      AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
                      LEFT OUTER JOIN
                      obl_obligacion_vigilable_presentada AS c 
                      ON f.Numero_Establecimiento = c.Numero_Establecimiento AND a.RFC = c.RFC 
                      AND b.Periodo_Inicial = c.Mes_Inicial AND 
                      b.Anio_Moroso = c.Anio_Inicial AND b.Clave_Periodicidad = c.Tipo_Periodo 
                      AND b.Clave_Obligacion = c.Clave_Obligacion
                      left join obl_detalle_documentos as x on a.Municipio=x.Municipio and a.Oficina=x.Oficina
                      and a.Numero_Emision=x.Numero_Emision and a.Folio_Impresion=x.Folio_Impresion 
                      and x.Movimiento='ME'
WHERE     (b.Fecha_Emision >= '22/02/2016') AND (c.RFC IS NOT NULL) 
AND (a.Movimiento = 'R1') AND (a.Fecha_Entrega IS NOT NULL)
and x.Movimiento is not  null
ORDER BY a.Folio_Impresion



--------------------------------
###obtener un campo consulta
 $conexionBD->EjecutaConsulta( $sql_fecha_pago );
    $conexionBD->NumeroFilas();
    
    if ($conexionBD->NumRegistros >0 )
      {
      $conexionBD->DevuelveRegistros();
        echo $fecha_declarado=$conexionBD->Registro['fecha_declarado'];
      }
---------------------------------------

##################
inserto en una tabla los que tienen multas generadas que son pagos espontaneos 

insert into obl_marcar_pagos
--delete from obl_marcar_pagos
SELECT     a.RFC, a.Status,a.Movimiento,-- x.Movimiento ,
 a.usuario_cancelacion, a.Fecha_Impresion, b.Fecha_Emision, 
 a.fecha_entrega,MIN(c.Fecha_Declarado) fecha_declarado, MIN(c.No_Operacion) as no_operacion, 
 a.Numero_Emision, a.Folio_Impresion, 
                      a.Municipio, a.Oficina
                      
FROM         obl_detalle_documentos AS a INNER JOIN
                      obl_control_emisiones AS b ON a.Numero_Emision = b.Numero_Emision 
                      AND a.Municipio = b.Municipio AND a.Oficina = b.Oficina 
                      INNER JOIN
                      obl_detalle_sucursales AS f ON a.Municipio = f.Municipio AND a.Oficina = f.Oficina 
                      AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
                      LEFT OUTER JOIN
                      obl_obligacion_vigilable_presentada AS c 
                      ON f.Numero_Establecimiento = c.Numero_Establecimiento AND a.RFC = c.RFC 
                      AND b.Periodo_Inicial = c.Mes_Inicial AND 
                      b.Anio_Moroso = c.Anio_Inicial AND b.Clave_Periodicidad = c.Tipo_Periodo 
                      AND b.Clave_Obligacion = c.Clave_Obligacion
                      and c.Tipo_Presentacion='Mn'
                      and (CONVERT(CHAR(8), a.Fecha_Entrega, 103))=(CONVERT(CHAR(8), c.Fecha_Declarado, 103))
                      left join obl_detalle_documentos as x on a.Municipio=x.Municipio
                       and a.Oficina=x.Oficina
                      and a.Numero_Emision=x.Numero_Emision and a.Folio_Impresion=x.Folio_Impresion 
                      and x.Movimiento='ME'
WHERE     (b.Fecha_Emision >= '22/02/2016') AND (c.RFC IS NOT NULL) 
AND (a.Movimiento = 'R1') AND (a.Fecha_Entrega IS NOT NULL)
--and x.Movimiento is  null
and a.Status  in ('E','V')
--and c.No_Operacion='02080131611724'
group by a.RFC, a.Status,a.Movimiento, x.Movimiento ,
 a.usuario_cancelacion, a.Fecha_Impresion, b.Fecha_Emision, a.Fecha_Entrega,  a.Numero_Emision, a.Folio_Impresion, 
                      a.Municipio, a.Oficina
ORDER BY a.Folio_Impresion

####la ultima vez use este es el buenoooooo los que devuelve son los que necesitan que se les inserte una multa ext

SELECT  min(a.RFC), min(a.Status),min(a.Movimiento), min(x.Movimiento) ,
 min(a.usuario_cancelacion), min(a.Fecha_Impresion), min(b.Fecha_Emision),
  min(c.Fecha_Declarado) as Fecha_Declarado, min(a.fecha_entrega) as fecha_entrega,
  min(c.No_Operacion), 
  a.Numero_Emision, a.Folio_Impresion, 
  min(a.Municipio), min(a.Oficina),MIN(Mes), MIN(f.Anio_Moroso ), MIN (f.Clave_Obligacion )
FROM         obl_detalle_documentos AS a 
INNER JOIN   obl_control_emisiones AS b ON 
a.Numero_Emision = b.Numero_Emision 
AND a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina 
INNER JOIN obl_detalle_sucursales AS f ON a.Municipio = f.Municipio 
AND a.Oficina = f.Oficina 
AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
LEFT  JOIN   obl_obligacion_vigilable_presentada AS c 
ON f.RFC = c.RFC AND f.Mes=c.Mes_Inicial AND 
f.Anio_Moroso = c.Anio_Inicial 
AND f.Clave_Periodicidad = c.Tipo_Periodo 
AND b.Clave_Obligacion = c.Clave_Obligacion
left join obl_detalle_documentos as x on a.Municipio=x.Municipio 
and a.Oficina=x.Oficina   and a.Numero_Emision=x.Numero_Emision 
and a.Folio_Impresion=x.Folio_Impresion and x.Movimiento='ME'
WHERE --    (b.Fecha_Emision >= '22/02/2016') 
 (c.RFC IS NOT NULL) and 
 f.Anio_Moroso>='2016'
and f.Mes>='01'
and f.Clave_Obligacion in ('010104','010103')
and Tipo_Periodo='02'
AND (a.Movimiento = 'R1') 
AND (a.Fecha_Entrega IS NOT NULL)
--and a.Numero_Emision='1621'
--and a.RFC='RURE501201TS8'
and x.Movimiento is  null
and c.Fecha_Declarado>a.Fecha_entrega
group by a.Numero_Emision, a.Folio_Impresion                   
ORDER BY a.Folio_Impresion

####este es el insert bueno 11/04/2016



insert into obl_detalle_documentos
(municipio, oficina,numero_emision,rfc,Numero_Serie, Movimiento, folio_impresion, 
fecha_ultimo_movimiento)
SELECT 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
'ME' as Movimiento,
MIN(a.folio_impresion) as folio_impresion,
GETDATE() as fecha_ultimo_movimiento

 --min(a.RFC), min(a.Status),min(a.Movimiento), min(x.Movimiento) ,
 --min(a.usuario_cancelacion), min(a.Fecha_Impresion), min(b.Fecha_Emision),
 -- min(c.Fecha_Declarado) as Fecha_Declarado, min(a.fecha_entrega) as fecha_entrega,
 -- min(c.No_Operacion), 
 -- a.Numero_Emision, a.Folio_Impresion, 
 -- min(a.Municipio), min(a.Oficina),MIN(Mes), MIN(f.Anio_Moroso ), MIN (f.Clave_Obligacion )
FROM         obl_detalle_documentos AS a 
INNER JOIN   obl_control_emisiones AS b ON 
a.Numero_Emision = b.Numero_Emision 
AND a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina 
INNER JOIN obl_detalle_sucursales AS f ON a.Municipio = f.Municipio 
AND a.Oficina = f.Oficina 
AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
LEFT  JOIN   obl_obligacion_vigilable_presentada AS c 
ON f.RFC = c.RFC AND f.Mes=c.Mes_Inicial AND 
f.Anio_Moroso = c.Anio_Inicial 
AND f.Clave_Periodicidad = c.Tipo_Periodo 
AND b.Clave_Obligacion = c.Clave_Obligacion
left join obl_detalle_documentos as x on a.Municipio=x.Municipio 
and a.Oficina=x.Oficina   and a.Numero_Emision=x.Numero_Emision 
and a.Folio_Impresion=x.Folio_Impresion and x.Movimiento='ME'
WHERE --    (b.Fecha_Emision >= '22/02/2016') 
 (c.RFC IS NOT NULL) and 
 f.Anio_Moroso>='2016'
and f.Mes>='01'
and f.Clave_Obligacion in ('010104','010103')
and Tipo_Periodo='02'
AND (a.Movimiento = 'R1') 
AND (a.Fecha_Entrega IS NOT NULL)
--and a.Numero_Emision='1621'
--and a.RFC='VECA660107R33'
and x.Movimiento is  null
and c.Fecha_Declarado>a.Fecha_entrega
group by a.Numero_Emision, a.Folio_Impresion                   
ORDER BY a.Folio_Impresion





######################

marco los pagos espontaneos
--update obl_detalle_documentos
--set obl_detalle_documentos.Status='T', obl_detalle_documentos.SubStatus=b.Status,
--Fecha_Ultimo_Movimiento=GETDATE(), usuario_cancelacion='INFO'
--from obl_marcar_pagos as a
--join obl_detalle_documentos as b
--on a.numero_emision=b.Numero_Emision and a.folio_impresion=b.Folio_Impresion and 
--a.oficina=b.Oficina and a.municipio=b.Municipio 



##3#### marcar pagos espontaneos de una emision contribuyentes que se les haya requerido aunque ya habian pagado
update  obl_detalle_documentos
set SubStatus=Status, Status='T', usuario_cancelacion='INFO', Fecha_Ultimo_Movimiento=GETDATE()
--select fecha_declarado, fecha_impresion
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and b.periodo_inicial=c.mes_inicial 
and b.Anio_Moroso=c.Anio_Inicial 
and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion   
where --a.municipio='01' 
--and a.oficina='01' and 
a.Movimiento in ('R1')
and b.Clave_Obligacion in ('010102')
and b.Anio_Moroso  ='2020'
--and a.numero_emision='1433' 
--and a.folio_impresion='1616'
and a.fecha_impresion>c.fecha_declarado
and a.Status not in ('P','T','H','L','M','J','S','Y','Z','O','U','W','R','G','F')
and c.RFC is not null
--and a.RFC='SURM670909RG2'





#################333
todos los requerimientos que ya estan pagados
SELECT     a.RFC, a.Status,a.Movimiento,-- x.Movimiento ,
 a.usuario_cancelacion, a.Fecha_Impresion, b.Fecha_Emision, 
 a.fecha_entrega,MIN(c.Fecha_Declarado) fecha_declarado, MIN(c.No_Operacion) as no_operacion, 
 a.Numero_Emision, a.Folio_Impresion, 
                      a.Municipio, a.Oficina--,
                     --min(CONVERT(int, a.Fecha_Entrega)),
                     --min(CONVERT(int, c.Fecha_Declarado))
                     
FROM         obl_detalle_documentos AS a INNER JOIN
                      obl_control_emisiones AS b ON a.Numero_Emision = b.Numero_Emision 
                      AND a.Municipio = b.Municipio AND a.Oficina = b.Oficina  and
                      a.Movimiento='R1'
                      INNER JOIN
                      obl_detalle_sucursales AS f ON a.Municipio = f.Municipio AND a.Oficina = f.Oficina 
                      AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
                      LEFT OUTER JOIN
                      obl_obligacion_vigilable_presentada AS c 
                      ON f.Numero_Establecimiento = c.Numero_Establecimiento AND a.RFC = c.RFC 
                      AND b.Periodo_Inicial = c.Mes_Inicial AND 
                      b.Anio_Moroso = c.Anio_Inicial AND b.Clave_Periodicidad = c.Tipo_Periodo 
                      AND b.Clave_Obligacion = c.Clave_Obligacion
                      and c.Tipo_Presentacion='Mn'
                      --and (CONVERT(CHAR(8), a.Fecha_Entrega, 103))<(CONVERT(CHAR(8), c.Fecha_Declarado, 103))
                      --and (CONVERT(int, c.Fecha_Declarado))<(CONVERT(int, a.Fecha_Entrega))
                      --and (CONVERT(int, b.Fecha_Emision))>(CONVERT(int, c.Fecha_Declarado ))
                       --CONVERT(int, ListPrice) 
                      left join obl_detalle_documentos as x on a.Municipio=x.Municipio
                       and a.Oficina=x.Oficina
                      and a.Numero_Emision=x.Numero_Emision and a.Folio_Impresion=x.Folio_Impresion 
                      and x.Movimiento='ME'
WHERE     (b.Fecha_Emision >= '22/02/2016') AND (c.RFC IS NOT NULL) 
AND (a.Movimiento = 'R1') AND (a.Fecha_Entrega IS NOT NULL)
and x.Movimiento is  null
and a.Status  in ('E','V')
--and c.No_Operacion='02080131611724'
--and a.usuario_cancelacion='INFO'
group by a.RFC, a.Status,a.Movimiento, x.Movimiento ,
 a.usuario_cancelacion, a.Fecha_Impresion, b.Fecha_Emision, a.Fecha_Entrega,  a.Numero_Emision, a.Folio_Impresion, 
                      a.Municipio, a.Oficina
ORDER BY a.Folio_Impresion
--------------
sp que se ejecutara todos los dias a la 1
[dbo].[sarh_proceso_programado]

hacer segunda m1 repecos


-----------------
if de emisiones antes del cambio
if( ($Anio_Moroso<'2016' and ($clave=='010103' or $clave=='010104') ) or ($Periodo_Inicial=='01' 
and $Anio_Moroso=='2016' and ($clave=='010103' or $clave=='010104')))



revision rapida de las multas
insert into obl_detalle_documentos
(municipio, oficina,numero_emision,rfc,Numero_Serie, Movimiento, folio_impresion, 
fecha_ultimo_movimiento)
SELECT 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
'ME' as Movimiento,
MIN(a.folio_impresion) as folio_impresion,
GETDATE() as fecha_ultimo_movimiento

 --min(a.RFC), min(a.Status),min(a.Movimiento), min(x.Movimiento) ,
 --min(a.usuario_cancelacion), min(a.Fecha_Impresion), min(b.Fecha_Emision),
 -- min(c.Fecha_Declarado) as Fecha_Declarado, min(a.fecha_entrega) as fecha_entrega,
 -- min(c.No_Operacion), 
 -- a.Numero_Emision, a.Folio_Impresion, 
 -- min(a.Municipio), min(a.Oficina),MIN(Mes), MIN(f.Anio_Moroso ), MIN (f.Clave_Obligacion )
FROM         obl_detalle_documentos AS a 
INNER JOIN   obl_control_emisiones AS b ON 
a.Numero_Emision = b.Numero_Emision 
AND a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina 
INNER JOIN obl_detalle_sucursales AS f ON a.Municipio = f.Municipio 
AND a.Oficina = f.Oficina 
AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
LEFT  JOIN   obl_obligacion_vigilable_presentada AS c 
ON f.RFC = c.RFC AND f.Mes=c.Mes_Inicial AND 
f.Anio_Moroso = c.Anio_Inicial 
AND f.Clave_Periodicidad = c.Tipo_Periodo 
AND b.Clave_Obligacion = c.Clave_Obligacion
left join obl_detalle_documentos as x on a.Municipio=x.Municipio 
and a.Oficina=x.Oficina   and a.Numero_Emision=x.Numero_Emision 
and a.Folio_Impresion=x.Folio_Impresion and x.Movimiento='ME'
WHERE --    (b.Fecha_Emision >= '22/02/2016') 
 (c.RFC IS NOT NULL) and 
 f.Anio_Moroso>='2016'
and f.Mes>='01'
and f.Clave_Obligacion in ('010104','010103')
and Tipo_Periodo='02'
AND (a.Movimiento = 'R1') 
AND (a.Fecha_Entrega IS NOT NULL)
--and a.Numero_Emision='1621'
--and a.RFC='VECA660107R33'
and x.Movimiento is  null
and Cast(c.Fecha_Declarado As Date)>Cast(a.Fecha_entrega As Date)
group by a.Numero_Emision, a.Folio_Impresion                   
ORDER BY a.Folio_Impresion

--insercion de las multas anuales


insert into obl_detalle_documentos
(municipio, oficina,numero_emision,rfc,Numero_Serie, Movimiento, folio_impresion, 
fecha_ultimo_movimiento)
SELECT 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
'ME' as Movimiento,
MIN(a.folio_impresion) as folio_impresion,
GETDATE() as fecha_ultimo_movimiento--,
--min(c.Fecha_Declarado),
--MIN(a.Fecha_Entrega),
--MIN(a.status)

 --min(a.RFC), min(a.Status),min(a.Movimiento), min(x.Movimiento) ,
 --min(a.usuario_cancelacion), min(a.Fecha_Impresion), min(b.Fecha_Emision),
 -- min(c.Fecha_Declarado) as Fecha_Declarado, min(a.fecha_entrega) as fecha_entrega,
 -- min(c.No_Operacion), 
 -- a.Numero_Emision, a.Folio_Impresion, 
 -- min(a.Municipio), min(a.Oficina),MIN(Mes), MIN(f.Anio_Moroso ), MIN (f.Clave_Obligacion )

FROM         obl_detalle_documentos AS a 
INNER JOIN   obl_control_emisiones AS b ON 
a.Numero_Emision = b.Numero_Emision 
AND a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina 
INNER JOIN obl_detalle_sucursales AS f ON a.Municipio = f.Municipio 
AND a.Oficina = f.Oficina 
AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
LEFT  JOIN   obl_obligacion_vigilable_presentada AS c 
ON f.RFC = c.RFC AND f.Anio_Moroso = c.Anio_Inicial 
AND f.Clave_Periodicidad = c.Tipo_Periodo 
AND b.Clave_Obligacion = c.Clave_Obligacion
left join obl_detalle_documentos as x on a.Municipio=x.Municipio 
and a.Oficina=x.Oficina   and a.Numero_Emision=x.Numero_Emision 
and a.Folio_Impresion=x.Folio_Impresion and x.Movimiento='ME'
WHERE --    (b.Fecha_Emision >= '22/02/2016') 
 (c.RFC IS NOT NULL) and 
 f.Anio_Moroso='2015'
and f.Mes='00'
and ((f.Clave_Obligacion in ('010104','010103')and Tipo_Periodo='07') 
or ( f.Clave_Obligacion in ('010102')and Tipo_Periodo='17'))
AND (a.Movimiento = 'R1') 
AND (a.Fecha_Entrega IS NOT NULL)
--and a.Numero_Emision='1637'
--and a.RFC='VECA660107R33'
--Numero_Emision='1637'
--and a.Folio_Impresion='233'
and x.Movimiento is  null
and Cast(c.Fecha_Declarado As Date)>Cast(a.Fecha_entrega As Date)
group by a.Numero_Emision, a.Folio_Impresion                   
ORDER BY a.Folio_Impresion

----------------------
reperar detalle documentos cuando no insertaba las multas por incumplimiento
insert into obl_detalle_documentos
(municipio, oficina,numero_emision,rfc,Numero_Serie, Movimiento, folio_impresion, 
fecha_ultimo_movimiento)
select 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
'ME' as Movimiento,
MIN(a.folio_impresion) as folio_impresion,
GETDATE() as fecha_ultimo_movimiento

 from obl_detalle_documentos AS a
where Numero_Emision='1534' 
--and Folio_Impresion='1017'
and Municipio='08'
and Movimiento='R2'
group by a.Numero_Emision, a.Folio_Impresion  


---------------------------
detalle de morosos de contribuyentes que tienen nomina y decir si tiene correo confirmado

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_19042016_NOMINA]

SELECT	'Return Value' = @return_value

GO


general

select --rfc 
	*
	FROM Temp_lili_nomina
	where municipio in ('07')
	order by rfc

hospedaje

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_19042016_HOSPEDAJE]

SELECT	'Return Value' = @return_value

GO


general

select --rfc 
	*
	FROM Temp_lili_HOSPEDAJE
	where municipio in ('07')
	order by rfc


ILEPAL

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_19042016]

SELECT	'Return Value' = @return_value

GO


general

select --rfc 
	*
	FROM Temp_lili_PROFESIONES
	where municipio in ('07')
	order by rfc


---------------------------------------------

IF NOT EXISTS(select * from ingresos.dbo.cat_salarios_minimos_prueba where Id=21)

1633 anual hosp
--------------------------------------


select Numero_Emision, COUNT(*) from
(

SELECT --
a.Municipio, a.Oficina,a.Movimiento, a.Clave_Obligacion, a.Clave_Periodicidad, a.Periodo_Inicial, a.Periodo_Final, 
         a.Numero_Emision, a.Folio_Impresion, a.RFC, a.Ejercicio_Fiscal, a.Anio_Moroso,
         min(a.No_Operacion) as No_Operacion, min(convert(varchar,a.Fecha_Declarado ,103)) as Fecha_Declarado
         FROM (SELECT documento.Municipio, documento.Oficina, documento.Movimiento, emision.Clave_Obligacion, 
         emision.Clave_Periodicidad, emision.Periodo_Inicial, emision.Periodo_Final, documento.Numero_Emision, 
         documento.Folio_Impresion, documento.RFC, emision.Ejercicio_Fiscal, emision.Anio_Moroso,
         vig.No_Operacion , vig.Fecha_Declarado  
         FROM obl_detalle_documentos AS documento JOIN obl_control_emisiones AS emision 
         ON documento.Municipio = emision.Municipio AND documento.Oficina = emision.Oficina 
         AND documento.Numero_Emision = emision.Numero_Emision JOIN obl_datos_generales dat 
         ON documento.Municipio=dat.Municipio AND documento.Oficina=dat.Oficina 
         AND documento.Numero_Emision=dat.Numero_Emision AND documento.Folio_Impresion=dat.Folio_Impresion
         join obl_obligacion_vigilable_presentada as vig on emision.Periodo_Inicial=vig.Mes_Inicial and 
         emision.Anio_Moroso=vig.Anio_Inicial and emision.Clave_Obligacion=vig.Clave_Obligacion and
         emision.Clave_Periodicidad=vig.Tipo_Periodo and emision.Periodo_Inicial=vig.Mes_Final 
         and documento.RFC=vig.RFC and vig.Tipo_Presentacion not in ('Co') 
         WHERE  
         documento.Movimiento = 'ME' AND documento.Status = 'B' 
         AND documento.Municipio = '01'
        			AND documento.Oficina = '01'
        			AND emision.Clave_Obligacion = '010103' ) as a 
         LEFT JOIN obl_detalle_documentos AS b ON a.Municipio = b.Municipio AND a.Oficina = b.Oficina 
         AND a.Numero_Emision = b.Numero_Emision AND a.Folio_Impresion=b.FOLIO_IMPRESION 
         AND b.movimiento='R1' 
         AND (b.Fecha_Entrega is not null and
          b.Fecha_Vencimiento  is not null )
           where b.Movimiento is not null 
           group by a.Municipio, a.Oficina,a.Movimiento, 
          a.Clave_Obligacion, a.Clave_Periodicidad,
           a.Periodo_Inicial, a.Periodo_Final, a.Numero_Emision, 
           a.Folio_Impresion, a.RFC, a.Ejercicio_Fiscal, a.Anio_Moroso

         )
         as v 
         group by Numero_Emision
         
         

------------------
requerir estatales
EXEC [dbo].[Requerir_Morosos_Estatales] @Limite ='8152', @Clave_Obligacion ='010103', 
@Municipio ='02', @ClavePeriodicidad ='02', @EjercicioFiscal ='2016', @Mes ='04', @MesFinal = '04', 
@ClaveLocalidad = '0', @ClaveZona = '0', @ClaveOficina = '01', @Anio ='2016', @Numero_Emision = '1635', 
@Cont_No_Localizados = '4065', @Total_En_Riesgo = '2067'



-----------------------------
estadistica de morosos estatales de las informativas
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_Informativas]

SELECT	'Return Value' = @return_value

GO



-----------------------------------
todos los requerimientos multas desde 2011 a la fecha
select t.* from (select 
--*
--DISTINCT(Multa_Programada ), Honorarios_Notificacion 
--DISTINCT(Clave_Periodicidad )
--COUNT(*)
--top 100
a.Municipio,
f.Nombre as Municipio_Nombre,
a.Oficina,
b.Clave_Obligacion,d.Descripcion as Nombre_Obligacion, 
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '01' else b.Periodo_Inicial end as Mes_Inicial,
case when b.Clave_Periodicidad='17' OR b.Clave_Periodicidad='07' then '12' else b.Periodo_Final   end as Mes_Final,
 b. Anio_Moroso as Año_Moroso,
 case when b.Clave_Periodicidad ='02' then 'Mensual' 
 when b.Clave_Periodicidad ='03' then 'Bimestral'
 when b.Clave_Periodicidad ='07' then 'Anual'
 when b.Clave_Periodicidad ='12' then 'Mensual Informativa'
 when b.Clave_Periodicidad ='17' then 'Anual Informativa'
 end as Periodicidad, 
b.Fecha_Emision,
a.Numero_Emision, a.Folio_Impresion,a.RFC, c.nombre as Tipo_Documento, 
 case when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is not null) then 'Asignado' 
when (a.Status='I' and a.Fecha_Asignacion is not null) then 'Asignado'
when (a.Status='B' and a.Fecha_Impresion is not null and a.Fecha_Asignacion is null) then 'Impreso'
else e.Nombre
end as Estatus,
a.fecha_impresion as Fecha_Impresion, a.fecha_asignacion as Fecha_Asignacion, a.fecha_no_localizado as Fecha_No_Localizado, 
a.Fecha_Entrega, case when  a.Fecha_Entrega is null and a.Fecha_Vencimiento is not null then NULL else a.Fecha_Vencimiento end as Fecha_Vencimiento, 
Clave_Notificador--, a.Multa_Programada, a.Multa_Efectiva, a.Gastos_Ejecucion, a.Honorarios_Notificacion
from obl_detalle_documentos as a
join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision  
and a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
--where  a.Numero_Emision between '0901' and '1501'
join obl_nombres_documentos as c on a.Movimiento=c.Clave 
join cat_obligaciones as d on b.Clave_Obligacion=d.Clave 
join obl_nombres_estatus as e on a.Status=e.clave
join cat_municipios as f on a.Municipio=f.Clave 
where  a.numero_emision >='1101'  and  a.numero_emision<='1701'
and Movimiento in ('R1','ME','I1','M1','M2','M3','I1') 
--and Movimiento in ('ME') 
and Status not in ('T','P','H','L','M','J','S','Y','Z','O','U','W','R','G','F') 
--and Status in ('B') 
--and Fecha_Impresion  is not NULL
and Clave_Obligacion in ('010103','010104','010102','010106','010610','010611','010622')
--and Clave_Obligacion in ('010622')
--and a.numero_emision='1104' and Folio_Impresion='1'
and a.Municipio='09'
--and  Multa_Programada>1
) as t 
left join obl_detalle_documentos as w on
t.Numero_Emision=w.Numero_Emision and t.Folio_Impresion=w.Folio_Impresion and t.Municipio=w.Municipio and t.Oficina=w.Oficina
and w.Status not in ('T','P') and w.Movimiento='R1'
where w.RFC is not null
order by t.Municipio,  t.Clave_Obligacion, t.Numero_Emision, t.Folio_Impresion,  t.Estatus




---------------
EXEC [dbo].[Requerir_Morosos_Estatales_Anuales_CPY_28062016] 
@Limite ='8144', @Clave_Obligacion ='010103', @Municipio ='02', 
@ClavePeriodicidad ='07', @EjercicioFiscal ='2016', @Mes ='00', 
@MesFinal = '', @ClaveLocalidad = '0', @ClaveZona = '0', 
@ClaveOficina = '01', @Anio ='2016', @Numero_Emision = '1641', 
@Cont_No_Localizados = '0', @Total_En_Riesgo = '0'

----------------------------
insertar las multas de las anuales que no se han generado

insert into obl_detalle_documentos
(municipio, oficina,numero_emision,rfc,Numero_Serie, Movimiento, folio_impresion, 
fecha_ultimo_movimiento)
SELECT 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
'ME' as Movimiento,
MIN(a.folio_impresion) as folio_impresion,
GETDATE() as fecha_ultimo_movimiento--,
--min(c.Fecha_Declarado),
--MIN(a.Fecha_Entrega),
--MIN(a.status)

 --min(a.RFC), min(a.Status),min(a.Movimiento), min(x.Movimiento) ,
 --min(a.usuario_cancelacion), min(a.Fecha_Impresion), min(b.Fecha_Emision),
 -- min(c.Fecha_Declarado) as Fecha_Declarado, min(a.fecha_entrega) as fecha_entrega,
 -- min(c.No_Operacion), 
 -- a.Numero_Emision, a.Folio_Impresion, 
 -- min(a.Municipio), min(a.Oficina),MIN(Mes), MIN(f.Anio_Moroso ), MIN (f.Clave_Obligacion )

FROM         obl_detalle_documentos AS a 
INNER JOIN   obl_control_emisiones AS b ON 
a.Numero_Emision = b.Numero_Emision 
AND a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina 
INNER JOIN obl_detalle_sucursales AS f ON a.Municipio = f.Municipio 
AND a.Oficina = f.Oficina 
AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
LEFT  JOIN   obl_obligacion_vigilable_presentada AS c 
ON f.RFC = c.RFC AND f.Anio_Moroso = c.Anio_Inicial 
AND f.Clave_Periodicidad = c.Tipo_Periodo 
AND b.Clave_Obligacion = c.Clave_Obligacion
left join obl_detalle_documentos as x on a.Municipio=x.Municipio 
and a.Oficina=x.Oficina   and a.Numero_Emision=x.Numero_Emision 
and a.Folio_Impresion=x.Folio_Impresion and x.Movimiento='ME'
WHERE --    (b.Fecha_Emision >= '22/02/2016') 
 (c.RFC IS NOT NULL) and 
 f.Anio_Moroso='2015'
and f.Mes='00'
and f.Clave_Obligacion in ('010104','010103','010102')
and Tipo_Periodo='07'
AND (a.Movimiento = 'R1') 
AND (a.Fecha_Entrega IS NOT NULL)
--and a.Numero_Emision='1637'
--and a.RFC='VECA660107R33'
--Numero_Emision='1637'
--and a.Folio_Impresion='233'
and x.Movimiento is  null
and Convert(Varchar(10),c.Fecha_Declarado,103)>Convert(Varchar(10),a.Fecha_entrega,103)
group by a.Numero_Emision, a.Folio_Impresion                   
ORDER BY a.Folio_Impresion



-----------------------
##correos estatales
sp lili
ALTER PROCEDURE [dbo].[paCo_Determina_Morosidad_Correo_Estatales_CPY_22102015]
*---------------------------


select 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
'ME' as Movimiento,
MIN(a.folio_impresion) as folio_impresion,
GETDATE() as fecha_ultimo_movimiento
from obl_detalle_documentos as a 
inner join obl_control_emisiones as c on 
a.Municipio =c.Municipio and a.Oficina=c.Oficina and a.Numero_Emision=c.Numero_Emision 
left join obl_detalle_documentos as b on 
a.Municipio=b.Municipio and a.Oficina=b.Oficina 
and a.Folio_Impresion=b.Folio_Impresion and a.Numero_Emision=b.Numero_Emision 
and b.Movimiento='R2'
where 
 --a.Numero_Emision='1637'
 --and 
 c.Clave_Obligacion in ('010104','010103')
 and c.Clave_Periodicidad='07'
 and c.Anio_Moroso='2015'
--and a.Folio_Impresion='33'
and a.Fecha_Impresion is not null
and a.Movimiento='I1'
and b.Movimiento is null
group by a.Numero_Emision, a.Folio_Impresion                   
ORDER BY a.Folio_Impresion

1
3
4
5
6
7
9

http://www.desarrolloweb.com/manuales/css3.html


magic_quotes_sybase=OFF php.ini reparar las comillas para reportes de excel



http://www.desarrolloweb.com/articulos/vistas-codeigniter.html

opciones deshabilitadas del menu por el cambio de gobierno
01_04_03_10 Captura Declaración Ceros
01_04_03_12 Listado Parcialidades
01_04_03_13 Detalle Parcialidades
01_04_03_14 Listado 3 Pagos Ceros
01_04_04_21 Reporte Inscritos Parcialidades
01_04_04_22 Modifica Situación Declaraciones
01_04_04_28 Imposicion de multa nuevo
01_04_04_31 Imprimir Requerimientos Nuevo
01_04_04_32 multas trabajando
01_04_04_33 Segunda Notificación de Crédito cpy

01_04_08 Actas Inspeccion este es el arbol completo
01_04_09_02 control de creditos este es el concentrado de multas
01_04_09_03 Control de Créditos Captura este es la captura
01_04_04_23 Reporte subsidios

3000 CARRO
1200 SERVICIO
300 AGUA
350 CEL
500 BNX
1000 JEFA 
500 GASOLINA
200 lucy
6900

-----------------------

select 
--COUNT(*)
--distinct(b.Clave_Obligacion )
a.Municipio,
a.RFC,
c.Nombre as Status,
case when a.Movimiento='I1' then 'Multas por Incumplimiento' 
when a.Movimiento='M1' then 'Multas por extemporaneidad ISR' 
when a.Movimiento='M2' then 'Multas por extemporaneidad IVA' 
when a.Movimiento='M3' then 'Multas por extemporaneidad IETU' 
when a.Movimiento='R1' then 'Requerimiento' 
when a.Movimiento='ME' then 'Multa por extemporaneidad' end as Movimiento,
a.Movimiento,
a.numero_emision,
a.folio_impresion,
a.Referencia,
a.Fecha_Vencimiento_Referencia,
b.clave_obligacion
--distinct(Movimiento )
from obl_detalle_documentos as a 
join obl_control_emisiones as b 
on a.Numero_Emision=b.Numero_Emision 
and a.Municipio=b.Municipio 
and a.Oficina=b.Oficina
join obl_nombres_estatus  as c
on a.Status=c.clave
where a.Municipio='01' and a.Oficina='01' 
and Referencia is not null
--order by a.Numero_Emision,a.Folio_Impresion, a.Movimiento 



select 
--COUNT(*)
--distinct(b.Clave_Obligacion )
a.Municipio,
a.RFC,
a.Status,
c.Nombre as Status,
case when a.Movimiento='I1' then 'Multas por Incumplimiento' 
when a.Movimiento='M1' then 'Multas por extemporaneidad ISR' 
when a.Movimiento='M2' then 'Multas por extemporaneidad IVA' 
when a.Movimiento='M3' then 'Multas por extemporaneidad IETU' 
when a.Movimiento='R1' then 'Requerimiento' 
when a.Movimiento='ME' then 'Multa por extemporaneidad' end as Movimiento,
a.Movimiento,
a.numero_emision,
a.folio_impresion,
a.Referencia,
a.Fecha_Vencimiento_Referencia,
b.clave_obligacion
--distinct(Movimiento )
from obl_detalle_documentos as a 
join obl_control_emisiones as b 
on a.Numero_Emision=b.Numero_Emision 
and a.Municipio=b.Municipio 
and a.Oficina=b.Oficina
join obl_nombres_estatus  as c
on a.Status=c.clave
where a.Municipio='01' and a.Oficina='01'  
and a.Status not in ('P','T','H','U','J','Y')
and Referencia is not null
order by a.Numero_Emision,a.Folio_Impresion, a.Movimiento 


select * from obl_control_emisiones where Clave_Obligacion='010103' order by Fecha_Emision desc
select * from obl_detalle_documentos  
where Numero_Emision='1653' and Municipio='02'

select * from seg_usuarios where Usuario='rarroniz'




//CHECAR QUE CUADREN AQUI
EXEC [dbo].[Requerir_Morosos_Repecos_cpy]
 @Limite ='500', 
@Clave_Obligacion ='010610,010618,010623', @Municipio ='08', 
@ClavePeriodicidad ='03', @EjercicioFiscal ='2011', @Mes ='11', 
@MesFinal = '12', @ClaveLocalidad = '0001', @ClaveZona = '0', 
@ClaveOficina = '01', @Anio ='2016', @Numero_Emision = '1649', 
@Separador = N','

select distinct(s.RFC) from ( SELECT pad_oblxest.RFC, min(pad_oblxest.clave) as clave_obligacion 
FROM pad_obligacionesporestablecimiento pad_oblxest 
JOIN pad_contribuyentes cont ON pad_oblxest.RFC = cont.RFC 
LEFT JOIN obl_obligacion_vigilable_presentada obl_oblvigpre ON pad_oblxest.RFC = obl_oblvigpre.RFC AND pad_oblxest.Clave = obl_oblvigpre.Clave_Obligacion AND obl_oblvigpre.Tipo_Periodo = '03' AND obl_oblvigpre.Anio_Inicial = '2011' AND obl_oblvigpre.Mes_Inicial = '11' AND obl_oblvigpre.Mes_Final = '12' AND obl_oblvigpre.Estado = 'T' LEFT JOIN obl_datos_federales fed ON pad_oblxest.RFC = fed.RFC AND pad_oblxest.Clave in ('010610','010618','010623') AND fed.Anio_Moroso = '2011' AND fed.Mes_Inicial = '11' AND fed.Mes_Final = '12' AND fed.Clave_Periodicidad = '03' LEFT JOIN obl_contribuyentes_omitidos oco ON pad_oblxest.RFC = oco.RFC AND pad_oblxest.Clave = oco.Clave_Obligacion AND oco.Activado = 'S' WHERE pad_oblxest.Clave in ('010610','010618','010623') AND (pad_oblxest.Fecha_Inicio <= CONVERT(datetime,'2011-12-01',20) OR pad_oblxest.Fecha_Inicio = '' OR pad_oblxest.Fecha_Inicio IS NULL ) AND cont.Municipio = '08' AND pad_oblxest.Situacion = 'Activo' AND cont.Situacion = 'Activo' AND cont.localizable='S' AND fed.RFC IS NULL AND obl_oblvigpre.RFC IS NULL AND oco.RFC IS NULL AND pad_oblxest.RFC not in (SELECT a.RFC FROM obl_detalle_documentos a JOIN obl_control_emisiones b ON a.Municipio = b.Municipio AND a.Oficina = b.Oficina AND a.Numero_Emision = b.Numero_Emision WHERE a.Municipio = '08' AND a.Oficina = '01' AND a.Status in ('X') AND a.Movimiento in ('R1','R2','R3') AND b.Clave_Obligacion in ('010610','010618','010623') GROUP BY a.RFC) AND cont.Localidad = '0001' GROUP BY pad_oblxest.RFC ) as s inner join obl_obligacion_vigilable_presentada as v on s.rfc=v.rfc and s.clave_obligacion=v.clave_obligacion where v.anio_inicial>'2007' and v.tipo_periodo='03' and v.clave_obligacion in ('010610','010618','010623') and v.estado='T'

-------------------------------------
SILLA
pasta de dientes

actualizacion de r2 y r3
		 SELECT * FROM obl_control_emisiones as a
				 JOIN obl_detalle_documentos as b on a.Municipio=b.Municipio and a.Oficina=b.Oficina 
				 and a.Numero_Emision=b.Numero_Emision 
				 WHERE Movimiento IN ('R2','R3') and Clave_Obligacion in ('010610','010623','010618')
				 and Fecha_Entrega is not null
				 and Ejercicio_Fiscal='2016'
				 and usuario_cancelacion is null
				 and MONTH(Fecha_Vencimiento)=10 
				 and YEAR(Fecha_Vencimiento)=2016 
				 --and DAY(Fecha_Entrega )=05
				 order by Fecha_Vencimiento 
				 
				update  obl_detalle_documentos
				set Fecha_Vencimiento='27/10/2016'				
			    from obl_control_emisiones as a
				 JOIN obl_detalle_documentos as b on a.Municipio=b.Municipio and a.Oficina=b.Oficina 
				 and a.Numero_Emision=b.Numero_Emision 
				 WHERE Movimiento IN ('R2','R3') and Clave_Obligacion in ('010610','010623','010618')
				 and Fecha_Entrega is not null
				 and Ejercicio_Fiscal='2016'
				 and usuario_cancelacion is null
				 and MONTH(Fecha_Vencimiento)=10 
				 and YEAR(Fecha_Vencimiento)=2016 
				 and DAY(Fecha_Entrega )=05
				 --order by Fecha_Vencimiento 
				 				 

--buscar lso segundos y tercer requerimientos que sus vencimientos erasn de 5 dias

				 SELECT * FROM obl_control_emisiones as a
				 JOIN obl_detalle_documentos as b on a.Municipio=b.Municipio and a.Oficina=b.Oficina 
				 and a.Numero_Emision=b.Numero_Emision 
				 WHERE Movimiento IN ('R2','R3') and Clave_Obligacion in ('010610','010623','010618')
				 and Fecha_Entrega is not null
				 and Ejercicio_Fiscal='2016'
				 and usuario_cancelacion is null
				 and MONTH(Fecha_Vencimiento)=10 
				 and YEAR(Fecha_Vencimiento)=2016 
				 --and DAY(Fecha_Entrega )=05
				 order by Fecha_Vencimiento 
				 
				update  obl_detalle_documentos
				set Fecha_Vencimiento='27/10/2016',
				Status='E'				
			    from obl_control_emisiones as a
				 JOIN obl_detalle_documentos as b on a.Municipio=b.Municipio and a.Oficina=b.Oficina 
				 and a.Numero_Emision=b.Numero_Emision 
				 WHERE Movimiento IN ('R2','R3') and Clave_Obligacion in ('010610','010623','010618')
				 and Fecha_Entrega is not null
				 and Ejercicio_Fiscal='2016'
				 and usuario_cancelacion is null
				 and MONTH(Fecha_Vencimiento)=10 
				 and YEAR(Fecha_Vencimiento)=2016 
				 and DAY(Fecha_Entrega )=05
				 --order by Fecha_Vencimiento 

				 05-27
				 06-28
				 07-31
				 10-1



				 
este query me servira de base para el reporte del lunes
DETALLE
				 SELECT 
				 min(c.Nombre) as MUNICIPIO ,  
				 MIN(a.Anio_Moroso) as AÑO_MOROSO,
				 				case min(Periodo_Inicial )
					when '01' then 'ENERO' 
					when '02' then 'FEBRERO'
					when '03' then 'MARZO'
					when '04' then 'ABRIL' 
					when '05' then 'MAYO'
					when '06' then 'JUNIO'
					when '07' then 'JULIO' 
					when '08' then 'AGOSTO'
					when '09' then 'SEPTIEMBRE'
					when '10' then 'OCTUBRE' 
					when '11' then 'NOVIEMBRE'
					when '12' then 'DICIEMBRE'
					end as MES_MOROSO,
				MIN(A.Ejercicio_Fiscal) AS AÑO_EMISION,
				 a.Numero_Emision AS NUMERO_EMISION, 
				 b.FOLIO_IMPRESION, min(rfc) as RFC, 
				 min (UPPER(d.Nombre) ) as ESTATUS--,
				 --MIN (a.Numero_Control_Final ) as TOTAL,

				 FROM obl_control_emisiones as a
				 JOIN obl_detalle_documentos as b on a.Municipio=b.Municipio and a.Oficina=b.Oficina 
				 and a.Numero_Emision=b.Numero_Emision 
				 JOIN cat_municipios as c on a.Municipio=c.Clave 
				 JOIN obl_nombres_estatus as d on b.Status=d.Clave 
				 WHERE Movimiento IN ('R1') 
				 and Clave_Obligacion in ('010103')
				 and a.Clave_Periodicidad='02'
				 and Anio_Moroso >'2011'
				 and a.Municipio='09'
			     and Fecha_Entrega is not null
			     and LEN(rtrim(ltrim(rfc)))=12 
			     --and a.Numero_Emision='1207'
			     --AND a.Periodo_Inicial='01'
			     --AND A.Anio_Moroso='2012'
				 group by a.Municipio  , a.Oficina, a.Numero_Emision , Folio_Impresion  
				 order by a.Municipio , a.Oficina, a.Numero_Emision , Folio_Impresion  			
CONCENTRADO

 SELECT 
				 min(c.Nombre) as MUNICIPIO ,  
				  MIN(a.Anio_Moroso) as AÑO_MOROSO,
				 				case min(Periodo_Inicial )
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as MES_MOROSO,
MIN(A.Ejercicio_Fiscal) AS AÑO_EMISION,
				 --a.Numero_Emision AS NUMERO_EMISION, 
				 COUNT(*) as TOTAL_REQUERIDOS
				 FROM obl_control_emisiones as a
				 JOIN obl_detalle_documentos as b on a.Municipio=b.Municipio and a.Oficina=b.Oficina 
				 and a.Numero_Emision=b.Numero_Emision 
				 JOIN cat_municipios as c on a.Municipio=c.Clave 
				 JOIN obl_nombres_estatus as d on b.Status=d.Clave 
				 WHERE Movimiento IN ('R1') 
				 and Clave_Obligacion in ('010103')
				 and a.Clave_Periodicidad='02'
				 and Anio_Moroso >'2011'
				 and a.Municipio='01'
			     and Fecha_Entrega is not null
			     AND 	LEN(rtrim(ltrim(rfc)))=12 
			     --and a.Numero_Emision='1504'
				 group by a.Municipio  , a.Oficina, a.Anio_Moroso,a.Periodo_Inicial, a.Ejercicio_Fiscal     
				 order by a.Municipio , a.Oficina, a.Anio_Moroso,a.Periodo_Inicial , a.Ejercicio_Fiscal
				 


150 mau
500 tarjeta


43

---------------------
trabajar la lista de requerimientos desde 2012-2016
SELECT     
--a.Clave_Obligacion AS Expr1, a.Clave_Periodicidad AS Expr2,  
--a.*,b.*, a.Ejercicio_Fiscal AS Expr3,
c.Nombre , d.Nombre , a.Numero_Emision,e.Descripcion , a.Clave_Periodicidad,
 a.Ejercicio_Fiscal, 
 a.anio_moroso as Año_Moroso,
CASE WHEN a.clave_periodicidad='02' THEN 'MENSUAL' 
WHEN a.clave_periodicidad='12' THEN 'MENSUAL INFORMATIVA'  
WHEN a.clave_periodicidad='03' THEN 'BIMESTRAL'  
WHEN a.clave_periodicidad='07' THEN 'ANUAL'
WHEN a.clave_periodicidad='17' THEN 'ANUAL INFORMATIVA' END AS Clave_Periodicidad,
case when a.Periodo_Inicial='00' then 'ANUAL' 
when a.Periodo_Inicial='01' then 'ENERO' 
when a.Periodo_Inicial='02' then 'FEBRERO'
when a.Periodo_Inicial='03' then 'MARZO'
when a.Periodo_Inicial='04' then 'ABRIL' 
when a.Periodo_Inicial='05' then 'MAYO'
when a.Periodo_Inicial='06' then 'JUNIO'
when a.Periodo_Inicial='07' then 'JULIO' 
when a.Periodo_Inicial='08' then 'AGOSTO'
when a.Periodo_Inicial='09' then 'SEPTIEMBRE'
when a.Periodo_Inicial='10' then 'OCTUBRE' 
when a.Periodo_Inicial='11' then 'NOVIEMBRE'
when a.Periodo_Inicial='12' then 'DICIEMBRE'
end as Periodo_Inicial_Moroso,
case when a.Periodo_Final ='00' then 'ANUAL' 
when a.Periodo_Final='01' then 'ENERO' 
when a.Periodo_Final='02' then 'FEBRERO'
when a.Periodo_Final='03' then 'MARZO'
when a.Periodo_Final='04' then 'ABRIL' 
when a.Periodo_Final='05' then 'MAYO'
when a.Periodo_Final='06' then 'JUNIO'
when a.Periodo_Final='07' then 'JULIO' 
when a.Periodo_Final='08' then 'AGOSTO'
when a.Periodo_Final='09' then 'SEPTIEMBRE'
when a.Periodo_Final='10' then 'OCTUBRE' 
when a.Periodo_Final='11' then 'NOVIEMBRE'
when a.Periodo_Final='12' then 'DICIEMBRE'
end as Periodo_Final_Moroso,
a.Fecha_Emision,
b.RFC, b.Folio_Impresion, f.Nombre , b.Fecha_Impresion, b.Fecha_Asignacion, b.Fecha_Entrega, b.Clave_Notificador
FROM         obl_control_emisiones AS a 
INNER JOIN   obl_detalle_documentos AS b ON a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina AND a.Numero_Emision = b.Numero_Emision
INNER JOIN cat_municipios AS c on a.municipio=c.Clave
INNER JOIN cat_oficinas as d on a.municipio=d.Clave_Municipio  and a.oficina=d.Clave 
inner join cat_obligaciones as e on a.clave_obligacion=e.clave
inner join obl_nombres_estatus as f on b.Status=f.Clave 
WHERE     (a.Ejercicio_Fiscal = '2016')
and Movimiento='R1'  
and a.Numero_Emision='1601'
and a.Municipio='01'
and a.Oficina='01'
and Clave_Obligacion not in ('010618','010623')

01
02
03
04
05
06
07
08
09



SELECT     
--a.Clave_Obligacion AS Expr1, a.Clave_Periodicidad AS Expr2,  
--a.*,b.*, a.Ejercicio_Fiscal AS Expr3,
c.Nombre as Municipio, d.Nombre as Oficina, a.Numero_Emision,e.Descripcion ,
 a.Ejercicio_Fiscal, 

CASE WHEN a.clave_periodicidad='02' THEN 'MENSUAL' 
WHEN a.clave_periodicidad='12' THEN 'MENSUAL INFORMATIVA'  
WHEN a.clave_periodicidad='03' THEN 'BIMESTRAL'  
WHEN a.clave_periodicidad='07' THEN 'ANUAL'
WHEN a.clave_periodicidad='17' THEN 'ANUAL INFORMATIVA' END AS Clave_Periodicidad,
 a.anio_moroso as Año_Moroso,
case when a.Periodo_Inicial='00' then 'ANUAL' 
when a.Periodo_Inicial='01' then 'ENERO' 
when a.Periodo_Inicial='02' then 'FEBRERO'
when a.Periodo_Inicial='03' then 'MARZO'
when a.Periodo_Inicial='04' then 'ABRIL' 
when a.Periodo_Inicial='05' then 'MAYO'
when a.Periodo_Inicial='06' then 'JUNIO'
when a.Periodo_Inicial='07' then 'JULIO' 
when a.Periodo_Inicial='08' then 'AGOSTO'
when a.Periodo_Inicial='09' then 'SEPTIEMBRE'
when a.Periodo_Inicial='10' then 'OCTUBRE' 
when a.Periodo_Inicial='11' then 'NOVIEMBRE'
when a.Periodo_Inicial='12' then 'DICIEMBRE'
end as Periodo_Inicial_Moroso,

case when a.Periodo_Final ='00' then 'ANUAL' 
when a.Periodo_Final='01' then 'ENERO' 
when a.Periodo_Final='02' then 'FEBRERO'
when a.Periodo_Final='03' then 'MARZO'
when a.Periodo_Final='04' then 'ABRIL' 
when a.Periodo_Final='05' then 'MAYO'
when a.Periodo_Final='06' then 'JUNIO'
when a.Periodo_Final='07' then 'JULIO' 
when a.Periodo_Final='08' then 'AGOSTO'
when a.Periodo_Final='09' then 'SEPTIEMBRE'
when a.Periodo_Final='10' then 'OCTUBRE' 
when a.Periodo_Final='11' then 'NOVIEMBRE'
when a.Periodo_Final='12' then 'DICIEMBRE'
end as Periodo_Final_Moroso,
a.Fecha_Emision,
b.RFC, b.Folio_Impresion, f.Nombre AS Estatus , b.Fecha_Impresion, 
b.Fecha_Asignacion, b.Fecha_Entrega, 
b.Fecha_No_Localizado,
b.Clave_Notificador,
g.Nombre + ' ' +g.Apellido as Nombre_Notificador
FROM         obl_control_emisiones AS a 
INNER JOIN   obl_detalle_documentos AS b ON a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina AND a.Numero_Emision = b.Numero_Emision
INNER JOIN cat_municipios AS c on a.municipio=c.Clave
INNER JOIN cat_oficinas as d on a.municipio=d.Clave_Municipio  and a.oficina=d.Clave 
inner join cat_obligaciones as e on a.clave_obligacion=e.clave
inner join obl_nombres_estatus as f on b.Status=f.Clave 
LEFT JOIN seg_usuarios g ON b.Clave_Notificador=g.Usuario 
WHERE
(a.Ejercicio_Fiscal > '2011') AND 
Movimiento='R1'  
--and a.Numero_Emision='1601'
and a.Municipio='09'
and a.Oficina='01'
and Clave_Obligacion not in ('010618','010623')
order by a.Municipio, a.Oficina, a.Clave_Obligacion ,a.Ejercicio_Fiscal  ,a.Numero_Emision, b.Folio_Impresion 



 SELECT 
				 min(c.Nombre) as MUNICIPIO ,  
				  MIN(a.Anio_Moroso) as AÑO_MOROSO,
				 				case min(Periodo_Inicial )
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as MES_MOROSO,
MIN(A.Ejercicio_Fiscal) AS AÑO_EMISION,
				 --a.Numero_Emision AS NUMERO_EMISION, 
				 COUNT(*) as TOTAL_REQUERIDOS
				 FROM obl_control_emisiones as a
				 JOIN obl_detalle_documentos as b on a.Municipio=b.Municipio and a.Oficina=b.Oficina 
				 and a.Numero_Emision=b.Numero_Emision 
				 JOIN cat_municipios as c on a.Municipio=c.Clave 
				 JOIN obl_nombres_estatus as d on b.Status=d.Clave 
				 WHERE Movimiento IN ('R1') 
				 and Clave_Obligacion in ('010103')
				 and a.Clave_Periodicidad='02'
				 and Anio_Moroso >'2011'
				 --and a.Municipio='01'
			     and Fecha_Entrega is not null
			     AND 	LEN(rtrim(ltrim(rfc)))=13 
			     --and a.Numero_Emision='1504'
				 group by a.Municipio  , a.Oficina, a.Anio_Moroso,a.Periodo_Inicial, a.Ejercicio_Fiscal     
				 order by a.Municipio , a.Oficina, a.Anio_Moroso,a.Periodo_Inicial , a.Ejercicio_Fiscal
				 

----------------------------------


SELECT     TOP (200) Municipio, Oficina, Numero_Emision, RFC, Numero_Serie, Movimiento, Folio_Impresion, Status, SubStatus, Fecha_Impresion, Fecha_Asignacion, 
                      Fecha_Citatorio, Fecha_No_Localizado, Fecha_Entrega, Fecha_Vencimiento, Fecha_Ultimo_Movimiento, Clave_Notificador, Gastos_Ejecucion, Multa_Efectiva, 
                      Multa_Programada, Actualizacion, Recargos, Honorarios_Notificacion, usuario_cancelacion, Categoria_No_Loc, Numero_No_Loc, Num_Salarios_Gastos_Ejecucion, 
                      No_Operacion, Referencia, No_Loc_Impreso, Descuento_Multa, Descuento_Gastos_Ejecucion, Subtotal, Total, Observaciones_Cancelacion, 
                      Fecha_Vencimiento_Referencia, Descuento, EnRiesgo_Impreso, Impuesto
FROM         obl_detalle_documentos
WHERE     (Numero_Emision = '1618') AND (Folio_Impresion = 10877)

 
 1634-32858
 1653-66326
 ---------
MB00241980
envio centauros




1000 polarizado

8740


acta nac 
ife
curp
comp domicilio establec
predial
dulces granel
 
 -----------------------------


--cuando queda como estatus pendiente el cobro
select * from cob_cobros 
where Fecha_Pago='20161222'  and Estatus='P'

--metodo de pago efectivo solo poner estatus='A'
--metodo de pago cheque solo poner metodo_pago='02' estatus='A'
--metodo de pago transferencia solo poner metodo_pago='03' estatus='A'

-------------
04
06
07
09

[paCo_Generar_Cumplidos_Repecos_Bebal]


:________________
sp que genera morosos de repecos con recargos y actualizacion
	01	9334
	02	24425
	03	2888
	04	975
	05	1550
	06	955
	07	372
	08	7208
	09	946
[paCo_Determina_Morosidad_padron_CPY_SOLO_REPECOS_CON_ACT_RECARGOS]




		DECLARE @xmlTokens XML;
			DECLARE @resultado varchar(max);

			SET @xmlTokens = (select Grupo  from seg_usuarios_grupos where Usuario='agranados' for xml auto, elements, root('root'));

			SET @resultado = dbo.unSplitString(@xmlTokens, ',');
			select @resultado;
	
	
				DECLARE @xmlTokens varchar(max);
		--	DECLARE @resultado varchar(max);		
SET @xmlTokens = (select top 1 periodos_morosos from 
 ingresos.dbo.obl_vigilancia_repecos_act_recargos );
 select @xmlTokens;
		--SET @resultado = dbo.SplitString(@xmlTokens, ',');
		--SELECT * FROM dbo.SplitString('<root><MAR-ABR 2012, MAY-JUN 2012, JUL-AGO 2012, SEP-OCT 2012, NOV-DIC 2012, ENE-FEB 2013, MAR-ABR 2013, MAY-JUN 2013, JUL-AGO 2013, SEP-OCT 2013, NOV-DIC 2013</periodos_morosos></ingresos.dbo.obl_vigilancia_repecos_act_recargos></root>', ',')
		select * from dbo.SplitString(@xmlTokens, ',')
		--(@xmlTokens,',')
		

-----------------------
oso 115
corazon rojo con rosa 115
corazon te amo rojo 115
corazon te amo multicolor 115
corazon multi con centro rosa 115
corazon ojitos rojo  135
paletas 100 135
paletas 30 piezas 185




select c.Nombre as Municipio, d.Nombre as Oficna,  e.Clave +' - '+e.Descripcion as Obligacion, 
case a.Clave_Periodicidad  
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
when '12' then 'INFORMATIVA MENSUAL'
when '17' then 'INFORMATIVA ANUAL'
end as Tipo_Periodo,
Anio_Moroso ,
case a.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
case a.Periodo_Final 
when NULL then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Final,
 a.Numero_Emision, RFC,  Folio_Impresion,
f.Nombre as Estatus, Fecha_Impresion 
from obl_control_emisiones  as a
join obl_detalle_documentos as b on a.Numero_Emision=b.Numero_Emision  and
a.Municipio=b.Municipio and a.Oficina =b.Oficina 
join cat_municipios as c on a.Municipio=c.Clave 
join cat_oficinas as d on a.Oficina=d.Clave and a.Municipio=d.Clave_Municipio 
join cat_obligaciones as e on a.Clave_Obligacion=e.Clave 
join obl_nombres_estatus as f on b.Status=f.Clave 
where year(b.Fecha_Impresion)  between '2016' and '2017'
and b.Movimiento='R1'
and Clave_Obligacion not in ('010618','010623')



case Clave_Periodicidad 
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
end as Tipo_Periodo,


select * 
from obl_control_emisiones  as a
join obl_detalle_documentos as b on a.Numero_Emision=b.Numero_Emision  and
a.Municipio=b.Municipio and a.Oficina =b.Oficina 
where year(b.Fecha_Ultimo_Movimiento)  between '2016' and '2017'
and b.Movimiento='R1' and usuario_cancelacion is not null
and Status in ('T',
'H','L','M','J','S','Y','Z','O','U','W','R','G','F','K')


-------------------------------------------------
requerimientos impresos entre 2016-2017

select c.Nombre as Municipio, d.Nombre as Oficna,  e.Clave +' - '+e.Descripcion as Obligacion, 
case a.Clave_Periodicidad  
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
when '12' then 'INFORMATIVA MENSUAL'
when '17' then 'INFORMATIVA ANUAL'
end as Tipo_Periodo,
Anio_Moroso ,
case a.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial_Moroso,
case a.Periodo_Final 
when NULL then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Final_Moroso,
 a.Numero_Emision, RFC,  Folio_Impresion,
f.Nombre as Estatus, Fecha_Impresion 
from obl_control_emisiones  as a
join obl_detalle_documentos as b on a.Numero_Emision=b.Numero_Emision  and
a.Municipio=b.Municipio and a.Oficina =b.Oficina 
join cat_municipios as c on a.Municipio=c.Clave 
join cat_oficinas as d on a.Oficina=d.Clave and a.Municipio=d.Clave_Municipio 
join cat_obligaciones as e on a.Clave_Obligacion=e.Clave 
join obl_nombres_estatus as f on b.Status=f.Clave 
where year(b.Fecha_Impresion)  between '2016' and '2017'
and b.Movimiento='R1'
and Clave_Obligacion not in ('010618','010623')
order by a.Municipio, a.Oficina, a.Clave_Obligacion , Folio_Impresion 


--requerimientos cancelados
select c.Nombre as Municipio, d.Nombre as Oficna,  e.Clave +' - '+e.Descripcion as Obligacion, 
case a.Clave_Periodicidad  
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
when '12' then 'INFORMATIVA MENSUAL'
when '17' then 'INFORMATIVA ANUAL'
end as Tipo_Periodo,
Anio_Moroso ,
case a.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial_Moroso,
case a.Periodo_Final 
when NULL then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Final_Moroso,
 a.Numero_Emision, RFC,  Folio_Impresion,
f.Nombre as Estatus, 
b.usuario_cancelacion,
b.Fecha_Ultimo_Movimiento as Fecha_Cancelación
from obl_control_emisiones  as a
join obl_detalle_documentos as b on a.Numero_Emision=b.Numero_Emision  and
a.Municipio=b.Municipio and a.Oficina =b.Oficina 
join cat_municipios as c on a.Municipio=c.Clave 
join cat_oficinas as d on a.Oficina=d.Clave and a.Municipio=d.Clave_Municipio 
join cat_obligaciones as e on a.Clave_Obligacion=e.Clave 
join obl_nombres_estatus as f on b.Status=f.Clave 
where year(b.Fecha_Ultimo_Movimiento)  between '2016' and '2017'
and b.Movimiento='R1' and usuario_cancelacion is not null
and Status in ('T',
'H','L','M','J','S','Y','Z','O','U','W','R','G','F','K')
and Clave_Obligacion not in ('010618','010623')
order by a.Municipio, a.Oficina, a.Clave_Obligacion , Folio_Impresion 


reporte de requerimientos y multas 2012-2013
select 
c.Nombre as Municipio, d.Nombre as Oficna,  e.Clave +' - '+e.Descripcion as Obligacion, 
case a.Clave_Periodicidad  
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
when '12' then 'INFORMATIVA MENSUAL'
when '17' then 'INFORMATIVA ANUAL'
end as Tipo_Periodo,
Anio_Moroso ,
case a.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial_Moroso,
case a.Periodo_Final 
when NULL then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Final_Moroso,
 a.Numero_Emision, b.RFC,  Folio_Impresion,
 case when  b.movimiento='I1' then 'Multa por Incumplimiento' 
when b.movimiento='R1'  then 'Primer Requerimiento'
when b.movimiento=''  then ' '
when b.movimiento='M1'  then 'Multa Extemporanea ISR'
when b.movimiento='M2'  then 'Multa Extemporanea IVA'
when b.movimiento='ME'  then 'Multa Extemporanea'
when b.movimiento='I2'  then 'Multa por Incumplimiento ISR'
when b.movimiento='R3'  then 'Tercer Requerimiento'
when b.movimiento='R2'  then 'Segundo Requerimiento'
when b.movimiento='M3'  then 'Multa Extemporanea IETU'
end as Movimiento,
CASE WHEN ( b.Fecha_Impresion is not null and b.Status in ('B')and Fecha_Asignacion is  null and  Fecha_Citatorio  is null and  Fecha_Entrega is null and  Fecha_No_Localizado  is  null) then 'Impreso'
WHEN ( b.Status in ('B') and Fecha_Asignacion is not null and  Fecha_Citatorio  is null and  Fecha_Entrega is null and  Fecha_No_Localizado  is  null) then 'Asignado'
 else f.Nombre end as Estatus, 

Fecha_Emision,Fecha_Impresion, 
Fecha_Asignacion, 
Fecha_Citatorio, Fecha_Entrega, 
Fecha_No_Localizado,
Referencia, 
Fecha_Vencimiento_Referencia,
g.Nombre+' '+g.Apellido as Clave_Notificador
from obl_control_emisiones  as a
join obl_detalle_documentos as b on a.Numero_Emision=b.Numero_Emision  and
a.Municipio=b.Municipio and a.Oficina =b.Oficina 
join cat_municipios as c on a.Municipio=c.Clave 
join cat_oficinas as d on a.Oficina=d.Clave and a.Municipio=d.Clave_Municipio 
join cat_obligaciones as e on a.Clave_Obligacion=e.Clave 
join obl_nombres_estatus as f on b.Status=f.Clave 
join seg_usuarios as g on b.Clave_Notificador=g.Usuario 
where Ejercicio_Fiscal   between '2012' and '2016'
--and b.Movimiento='R1'
and Clave_Obligacion not in ('010618','010623')
and a.Municipio =('09')
order by a.Municipio, a.Oficina,  Ejercicio_Fiscal, a.Periodo_Inicial,  a.Clave_Obligacion ,a.Numero_Emision, Folio_Impresion 


requerimientos de istuv 
select a.Municipio, a.Oficina,  Ejercicio_Fiscal, a.Anio_Moroso --, count(*), 
, a.Numero_Control_Final, a.Numero_Emision, MONTH(a.Fecha_Emision) as Mes_Emision, Fecha_Emision 
from obl_control_emisiones  as a
join obl_detalle_documentos as b on a.Numero_Emision=b.Numero_Emision  and
a.Municipio=b.Municipio and a.Oficina =b.Oficina 
join cat_municipios as c on a.Municipio=c.Clave 
join cat_oficinas as d on a.Oficina=d.Clave and a.Municipio=d.Clave_Municipio 
join cat_obligaciones as e on a.Clave_Obligacion=e.Clave 
join obl_nombres_estatus as f on b.Status=f.Clave 
join seg_usuarios as g on b.Clave_Notificador=g.Usuario 
where Ejercicio_Fiscal  between '2015' and '2017' and 
 b.Movimiento='R1'
and Clave_Obligacion  in ('010603')
--and a.Numero_Emision='1501'
--and a.Municipio =('01')
group by a.Municipio, a.Oficina,  Ejercicio_Fiscal, a.Anio_Moroso ,
a.Numero_Control_Final, a.Numero_Emision, MONTH(a.Fecha_Emision), Fecha_Emision 
order by a.Municipio, a.Oficina,  Ejercicio_Fiscal, a.Numero_Emision  



revision playa
select * from obl_detalle_documentos where  Numero_Emision='1635' and Folio_Impresion in 
('15','25','29','31','41','46','64','67','71','72','76','79','81','84','86','96','113','114',
'117','128','133','158','164','170','171','174','180','187','188','189','192','196','212','218',
'220','221')
--('187')
 and
 municipio='08'
and Movimiento='R1'

------------------------------

1706

10500000



SELECT     TOP (200) Municipio, Oficina, Numero_Emision, RFC, Numero_Serie, Movimiento, Folio_Impresion, Status, SubStatus, Fecha_Impresion, Fecha_Asignacion, 
                      Fecha_Citatorio, Fecha_No_Localizado, Fecha_Entrega, Fecha_Vencimiento, Fecha_Ultimo_Movimiento, Clave_Notificador, Gastos_Ejecucion, Multa_Efectiva, 
                      Multa_Programada, Actualizacion, Recargos, Honorarios_Notificacion, usuario_cancelacion, Categoria_No_Loc, Numero_No_Loc, Num_Salarios_Gastos_Ejecucion, 
                      No_Operacion, Referencia, No_Loc_Impreso, Descuento_Multa, Descuento_Gastos_Ejecucion, Subtotal, Total, Observaciones_Cancelacion, 
                      Fecha_Vencimiento_Referencia, Descuento, EnRiesgo_Impreso, Impuesto
FROM         obl_detalle_documentos
WHERE     (Numero_Emision = '1706') AND (Municipio = '01')


select * 
from pad_contribuyentes 
where rfc in 

-------------------------------------
checar el municipio que le corresponde a los rfcs pertenece
DELETE FROM  RFCTODO 

select * 
from sirref_co_datos
where numero_control='RIFEF2201600001082282' 

select a.rfc, b.municipio_estatal,c.nombre as Municipio_Estatal
--, b.municipio_federal
from  rfctodo as a
left join sirref_co_datos as b on a.rfc=b.rfc
and b.numero_emision='16213'
left join cat_municipios as c on 
b.municipio_estatal=c.clave
order by rfc

select a.rfc, b.municipio_estatal,c.nombre as Municipio_Estatal--, b.municipio_federal
from  rfctodo as a
left join sirref_co_datos as b on a.rfc=b.rfc
and b.numero_emision='16218'
left join cat_municipios as c on 
b.municipio_estatal=c.clave
order by rfc

//ASI SE OBTIENE POR EL NUMERO DE CONTROL CUANDO NO TIENES EL NUMERO DE EMISION
select b.rfc,b.numero_control, b.municipio_estatal,c.nombre as Municipio_Estatal
from  sirref_co_datos as b 
left join cat_municipios as c on 
b.municipio_estatal=c.clave
where b.numero_control 
in ('100203187857819C77042',
'100404188089994C77042',
'100203187862505C73316',
'100404188095303C73316',
'100203187859127C73065',
'100404188091472C73065',
'100203187857932C77042',
'100404188089917C73065')
order by rfc

select * from sirref_co_documentos
where numero_control='101011164851992C73065'

select * from sirref_co_emisiones where numero_emision='16181'

poner el numero de control pertenece sara

DELETE FROM  RFCTODO2 

select * 
from sirref_co_datos
where numero_control='RIFEF2201600001082282' 

select a.rfc, b.municipio_estatal,c.nombre as Municipio_Estatal
--, b.municipio_federal
from  rfctodo2 as a
left join sirref_co_datos as b on a.rfc=b.Numero_Control 
and b.numero_emision='17267'
left join cat_municipios as c on 
b.municipio_estatal=c.clave
order by rfc



SELECT COUNT(*) FROM rfctodo
DELETE FROM rfctodo


[paCo_Generar_Cumplidos_Repecos_Bebal]



ctrseña face book		
lili830804

datos cuenta correo
nombre 
lili
apellidos
lizardi rodriguez	
nombre usuario 
candymaniadb
contraseña
candy2017
pais mexico
nacimiento 4 agosto 1983
no. telefonico 9837328128
dir. alternativa 9837328128

---------------------------
sfp-sarh\administrador
ctrs: Sarh2016

http://10.9.3.59/formatos/imp_recibo.php?referencia=72014880246416890



-----------------
sql para sacar los datos de las invitaciones impresas para el sat
select 
a.ADR,
a.RFC,
a.NUM_CONTROL ,
a.NOMBRE_COMPLETO,
a.CALLE,
a.NumExt,
a.NumInt,
a.Colonia,
a.Localidad,
a.entrecalle_y_calle,
a.OBLIGACION1,
CASE when PERIODO>=1 then '2016' else NULL end AS EJERCICIO,
a.REGIMEN,
(select Bimestre 
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion1
and Periodo=a.periodo
) as Periodo,

(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion1
and Periodo=a.periodo
) as Descripcion_obligacion,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.OBLIGACION1 
and Periodo=a.PERIODO
) as Fecha_vencimiento,

a.OBLIGACION2,
CASE when PERIODO2>=1 then '2016' else NULL end AS EJERCICIO2,
a.REGIMEN2,
(select Bimestre   
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion2
and Periodo=a.periodo2
) as Periodo2,

(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion2
and Periodo=a.periodo2
) as Descripcion_Obligacion2,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion2
and Periodo=a.PERIODO2
) as Fecha_vencimiento2,
a.OBLIGACION3,
CASE when PERIODO3>=1 then '2016' else NULL end AS EJERCICIO3,
a.REGIMEN3,
(select Bimestre   
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion3
and Periodo=a.periodo3
) as Periodo3 ,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion3
and Periodo=a.periodo3
) as Descripcion_Obligacion3,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion3
and Periodo=a.periodo3
) as Fecha_vencimiento3,
a.OBLIGACION4,
CASE when PERIODO4>=1 then '2016' else NULL end AS EJERCICIO4,
a.REGIMEN4,
(select Bimestre  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion4
and Periodo=a.periodo4
) as Periodo4,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion4
and Periodo=a.periodo4
) as Descripcion_Obligacion4,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion4
and Periodo=a.periodo4
) as Fecha_vencimiento4,
a.OBLIGACION5,
CASE when PERIODO5>=1 then '2016' else NULL end AS EJERCICIO5,
a.REGIMEN5,
(select Bimestre  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion5
and Periodo=a.periodo5
) as Periodo5,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion5
and Periodo=a.periodo5
) as Descripcion_Obligacion5,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion5
and Periodo=a.periodo5
) as Fecha_vencimiento5,
a.OBLIGACION6,
CASE when PERIODO6>=1 then '2016' else NULL end AS EJERCICIO6,
a.REGIMEN6,
(select Bimestre  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion6
and Periodo=a.periodo6
) as Periodo6,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion6
and Periodo=a.periodo6
) as Descripcion_Obligacion6,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion6
and Periodo=a.periodo6
) as Fecha_vencimiento6,
a.OBLIGACION7,
CASE when PERIODO7>=1 then '2016' else NULL end AS EJERCICIO7,
a.REGIMEN7,
(select Bimestre   
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion7
and Periodo=a.periodo7
) as Periodo7,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion7
and Periodo=a.periodo7
) as Descripcion_Obligacion7,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion7
and Periodo=a.periodo7
) as Fecha_vencimiento7,
a.OBLIGACION8,
CASE when PERIODO8>=1 then '2016' else NULL end AS EJERCICIO8,
a.REGIMEN8,
(select Bimestre   
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion8
and Periodo=a.periodo8
) as Periodo8,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion8
and Periodo=a.periodo8
) as Descripcion_Obligacion8,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion8
and Periodo=a.periodo8
) as Fecha_vencimiento8,
a.MEDIO_ENVIO_EF,
a.FECHA_CARGA,
a.CP ,
a.MUNICIPIO, 
case 
when a.MUNICIPIO ='1' then 'COZUMEL' 
when a.MUNICIPIO ='2' then 'F. CARRILLO PUERTO' 
when a.MUNICIPIO ='3' then 'ISLA MUJERES' 
when a.MUNICIPIO ='4' then 'OTHÓN P. BLANCO' 
when a.MUNICIPIO ='5' then 'BENITO JUÁREZ' 
when a.MUNICIPIO ='6' then 'J. M. MORELOS' 
when a.MUNICIPIO ='7' then 'LÁZARO CARDENAS' 
when a.MUNICIPIO ='8' then 'SOLIDARIDAD' 
when a.MUNICIPIO ='9' then 'TULUM' 
when a.MUNICIPIO ='10' then 'OTHÓN P. BLANCO' 
ELSE b.Nombre end as Nombre_Municipio

 from sirref_invitaciones_morosos as a
left join cat_municipios as b on a.MUNICIPIO=b.Clave 
order by MUNICIPIO, rfc
------------------


75 hector
50 extras
250 agua
300 addy
200 mauricio
	200 caja
	150 caja
700 emplacamiento
430 telcel
600 tarjeta
	400 caja
500 regalo nene
400 gasolina
 250 pantalon mauricio
75 queso bruno
75 queso mio
35 lucy
100 crema 
30 pluma
175 rosalia
800 jefa
300 despensa
400 d lucy
7700 seguro
---------------
6460
13195

2000
2000
9000
----------------------


datos banorte 
14081983

-------
evelasquez
universe

---------------------------
este es el bueno genaro invitaciones federales

select 
NUM_CONTROL AS NUMERO_CONTROL,
NOMBRE_COMPLETO,
RFC,
OBLIGACION1 ,
CASE WHEN DOMICILIO_FISCAL IS NULL THEN '' ELSE DOMICILIO_FISCAL END AS DOMICILIO_FISCAL,
CASE WHEN NOMBRE_MUNICIPIO IS NULL THEN '' ELSE NOMBRE_MUNICIPIO END AS NOMBRE_MUNICIPIO,
CASE WHEN CP IS NULL THEN '' ELSE CP END AS CP,
CASE WHEN EJERCICIO IS NULL THEN '' ELSE EJERCICIO END AS EJERCICIO,
--CASE WHEN PERIODO1 IS NULL THEN '' ELSE PERIODO1 END AS PERIODO1,
--CASE WHEN DESCRIPCION_OBLIGACION1 IS NULL THEN '' ELSE DESCRIPCION_OBLIGACION1 END AS DESCRIPCION_OBLIGACION1,
--FECHA_VENCIMIENTO1,
--CASE WHEN PERIODO2 IS NULL THEN '' ELSE PERIODO2 END AS PERIODO2,
--CASE WHEN DESCRIPCION_OBLIGACION2 IS NULL THEN '' ELSE DESCRIPCION_OBLIGACION2 END AS DESCRIPCION_OBLIGACION2,
--FECHA_VENCIMIENTO2,
--CASE WHEN PERIODO3 IS NULL THEN '' ELSE PERIODO3 END AS PERIODO3,
--CASE WHEN DESCRIPCION_OBLIGACION3 IS NULL THEN '' ELSE DESCRIPCION_OBLIGACION3 END AS DESCRIPCION_OBLIGACION3,
--FECHA_VENCIMIENTO3,	
--CASE WHEN PERIODO4 IS NULL THEN '' ELSE PERIODO4 END AS PERIODO4,
--CASE WHEN DESCRIPCION_OBLIGACION4 IS NULL THEN '' ELSE DESCRIPCION_OBLIGACION4 END AS DESCRIPCION_OBLIGACION4,
--FECHA_VENCIMIENTO4,
--PERIODO5,
--DESCRIPCION_OBLIGACION5,
--FECHA_VENCIMIENTO5,
--PERIODO6,
--DESCRIPCION_OBLIGACION6,
--FECHA_VENCIMIENTO6,
--PERIODO7,	
--DESCRIPCION_OBLIGACION7,
--FECHA_VENCIMIENTO7,
--PERIODO8,
--DESCRIPCION_OBLIGACION8,
--FECHA_VENCIMIENTO8,
--Julio_Agosto1+Julio_Agosto2 as julio_agosto1,
'Julio_Agosto' as PERIODO1,
Julio_Agosto1+' '+Julio_Agosto2+' '+Julio_Agosto3+' '+Julio_Agosto4+' '+Julio_Agosto5+' '+Julio_Agosto6+' '+Julio_Agosto7+' '+Julio_Agosto8 as DESCRIPCION_OBLIGACIONES1,
'03/10/2016' as VENCIMIENTO1,
'Septiembre_Octubre' as PERIODO2,
Septiembre_Octubre1+' '+Septiembre_Octubre2+' '+Septiembre_Octubre3+' '+Septiembre_Octubre4+' '+Septiembre_Octubre5+' '+Septiembre_Octubre6+' '+Septiembre_Octubre7+' '+Septiembre_Octubre8 as DESCRIPCION_OBLIGACIONES2,
'30/11/2016' as VENCIMIENTO2,
'Noviembre_Diciembre' as PERIODO3,
Noviembre_Diciembre1+' '+Noviembre_Diciembre2+' '+Noviembre_Diciembre3+' '+Noviembre_Diciembre4+' '+Noviembre_Diciembre5+' '+Noviembre_Diciembre6+' '+Noviembre_Diciembre7+' '+Noviembre_Diciembre8 as DESCRIPCION_OBLIGACIONES3,
'31/01/2017' as VENCIMIENTO3
from (
select 
* ,
case when Periodo1='Julio-Agosto' then Descripcion_obligacion1 else ' ' End as Julio_Agosto1,
case when Periodo2='Julio-Agosto' then Descripcion_obligacion2 else ' ' End as Julio_Agosto2,
case when Periodo3='Julio-Agosto' then Descripcion_obligacion3 else ' ' End as Julio_Agosto3,
case when Periodo4='Julio-Agosto' then Descripcion_obligacion4 else ' ' End as Julio_Agosto4,
case when Periodo5='Julio-Agosto' then Descripcion_obligacion5 else ' ' End as Julio_Agosto5,
case when Periodo6='Julio-Agosto' then Descripcion_obligacion6 else ' ' End as Julio_Agosto6,
case when Periodo7='Julio-Agosto' then Descripcion_obligacion7 else ' ' End as Julio_Agosto7,
case when Periodo8='Julio-Agosto' then Descripcion_obligacion8 else ' ' End as Julio_Agosto8,
case when Periodo1='Septiembre-Octubre' then Descripcion_obligacion1 else ' ' End as Septiembre_Octubre1,
case when Periodo2='Septiembre-Octubre' then Descripcion_obligacion2 else ' ' End as Septiembre_Octubre2,
case when Periodo3='Septiembre-Octubre' then Descripcion_obligacion3 else ' ' End as Septiembre_Octubre3,
case when Periodo4='Septiembre-Octubre' then Descripcion_obligacion4 else ' ' End as Septiembre_Octubre4,
case when Periodo5='Septiembre-Octubre' then Descripcion_obligacion5 else ' ' End as Septiembre_Octubre5,
case when Periodo6='Septiembre-Octubre' then Descripcion_obligacion6 else ' ' End as Septiembre_Octubre6,
case when Periodo7='Septiembre-Octubre' then Descripcion_obligacion7 else ' ' End as Septiembre_Octubre7,
case when Periodo8='Septiembre-Octubre' then Descripcion_obligacion8 else ' ' End as Septiembre_Octubre8,
case when Periodo1='Noviembre-Diciembre' then Descripcion_obligacion1 else ' ' End as Noviembre_Diciembre1,
case when Periodo2='Noviembre-Diciembre' then Descripcion_obligacion2 else ' ' End as Noviembre_Diciembre2,
case when Periodo3='Noviembre-Diciembre' then Descripcion_obligacion3 else ' ' End as Noviembre_Diciembre3,
case when Periodo4='Noviembre-Diciembre' then Descripcion_obligacion4 else ' ' End as Noviembre_Diciembre4,
case when Periodo5='Noviembre-Diciembre' then Descripcion_obligacion5 else ' ' End as Noviembre_Diciembre5,
case when Periodo6='Noviembre-Diciembre' then Descripcion_obligacion6 else ' ' End as Noviembre_Diciembre6,
case when Periodo7='Noviembre-Diciembre' then Descripcion_obligacion7 else ' ' End as Noviembre_Diciembre7,
case when Periodo8='Noviembre-Diciembre' then Descripcion_obligacion8 else ' ' End as Noviembre_Diciembre8
from 
(select --top 10
*

--NUM_CONTROL AS NUMERO_CONTROL,
--NOMBRE_COMPLETO,
--RFC,
--a.OBLIGACION1 ,
--CASE WHEN DOMICILIO_FISCAL IS NULL THEN '' ELSE DOMICILIO_FISCAL END AS DOMICILIO_FISCAL,
--CASE WHEN NOMBRE_MUNICIPIO IS NULL THEN '' ELSE NOMBRE_MUNICIPIO END AS NOMBRE_MUNICIPIO,
--CASE WHEN CP IS NULL THEN '' ELSE CP END AS CP,
--CASE WHEN EJERCICIO IS NULL THEN '' ELSE EJERCICIO END AS EJERCICIO,
--CASE WHEN PERIODO1 IS NULL THEN '' ELSE PERIODO1 END AS PERIODO1,
--CASE WHEN DESCRIPCION_OBLIGACION1 IS NULL THEN '' ELSE DESCRIPCION_OBLIGACION1 END AS DESCRIPCION_OBLIGACION1,
--FECHA_VENCIMIENTO1,
--CASE WHEN PERIODO2 IS NULL THEN '' ELSE PERIODO2 END AS PERIODO2,
--CASE WHEN DESCRIPCION_OBLIGACION2 IS NULL THEN '' ELSE DESCRIPCION_OBLIGACION2 END AS DESCRIPCION_OBLIGACION2,
--FECHA_VENCIMIENTO2,
--CASE WHEN PERIODO3 IS NULL THEN '' ELSE PERIODO3 END AS PERIODO3,
--CASE WHEN DESCRIPCION_OBLIGACION3 IS NULL THEN '' ELSE DESCRIPCION_OBLIGACION3 END AS DESCRIPCION_OBLIGACION3,
--FECHA_VENCIMIENTO3,	
--CASE WHEN PERIODO4 IS NULL THEN '' ELSE PERIODO4 END AS PERIODO4,
--CASE WHEN DESCRIPCION_OBLIGACION4 IS NULL THEN '' ELSE DESCRIPCION_OBLIGACION4 END AS DESCRIPCION_OBLIGACION4,
--FECHA_VENCIMIENTO4,
--PERIODO5,
--DESCRIPCION_OBLIGACION5,
--FECHA_VENCIMIENTO5,
--PERIODO6,
--DESCRIPCION_OBLIGACION6,
--FECHA_VENCIMIENTO6,
--PERIODO7,	
--DESCRIPCION_OBLIGACION7,
--FECHA_VENCIMIENTO7,
--PERIODO8,
--DESCRIPCION_OBLIGACION8,
--FECHA_VENCIMIENTO8
from 
(
select 
a.ADR,
a.RFC,
a.NUM_CONTROL ,
a.NOMBRE_COMPLETO,
a.CALLE+' ENTRE '+a.entrecalle_y_calle+' '+a.NumExt+' '+a.NumInt+' '+a.Colonia+' '+a.Localidad as DOMICILIO_FISCAL,
a.OBLIGACION1,
CASE when PERIODO>=1 then '2016' else NULL end AS EJERCICIO,
a.REGIMEN,
(select Bimestre 
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion1
and Periodo=a.periodo
) as Periodo1,

(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion1
and Periodo=a.periodo
) as Descripcion_obligacion1,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.OBLIGACION1 
and Periodo=a.PERIODO
) as Fecha_vencimiento1,

a.OBLIGACION2,
CASE when PERIODO2>=1 then '2016' else NULL end AS EJERCICIO2,
a.REGIMEN2,
(select Bimestre   
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion2
and Periodo=a.periodo2
) as Periodo2,

(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion2
and Periodo=a.periodo2
) as Descripcion_Obligacion2,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion2
and Periodo=a.PERIODO2
) as Fecha_vencimiento2,
a.OBLIGACION3,
CASE when PERIODO3>=1 then '2016' else NULL end AS EJERCICIO3,
a.REGIMEN3,
(select Bimestre   
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion3
and Periodo=a.periodo3
) as Periodo3 ,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion3
and Periodo=a.periodo3
) as Descripcion_Obligacion3,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion3
and Periodo=a.periodo3
) as Fecha_vencimiento3,
a.OBLIGACION4,
CASE when PERIODO4>=1 then '2016' else NULL end AS EJERCICIO4,
a.REGIMEN4,
(select Bimestre  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion4
and Periodo=a.periodo4
) as Periodo4,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion4
and Periodo=a.periodo4
) as Descripcion_Obligacion4,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion4
and Periodo=a.periodo4
) as Fecha_vencimiento4,
a.OBLIGACION5,
CASE when PERIODO5>=1 then '2016' else NULL end AS EJERCICIO5,
a.REGIMEN5,
(select Bimestre  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion5
and Periodo=a.periodo5
) as Periodo5,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion5
and Periodo=a.periodo5
) as Descripcion_Obligacion5,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion5
and Periodo=a.periodo5
) as Fecha_vencimiento5,
a.OBLIGACION6,
CASE when PERIODO6>=1 then '2016' else NULL end AS EJERCICIO6,
a.REGIMEN6,
(select Bimestre  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion6
and Periodo=a.periodo6
) as Periodo6,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion6
and Periodo=a.periodo6
) as Descripcion_Obligacion6,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion6
and Periodo=a.periodo6
) as Fecha_vencimiento6,
a.OBLIGACION7,
CASE when PERIODO7>=1 then '2016' else NULL end AS EJERCICIO7,
a.REGIMEN7,
(select Bimestre   
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion7
and Periodo=a.periodo7
) as Periodo7,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion7
and Periodo=a.periodo7
) as Descripcion_Obligacion7,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion7
and Periodo=a.periodo7
) as Fecha_vencimiento7,
a.OBLIGACION8,
CASE when PERIODO8>=1 then '2016' else NULL end AS EJERCICIO8,
a.REGIMEN8,
(select Bimestre   
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion8
and Periodo=a.periodo8
) as Periodo8,
(select [Descripcion_de_la_obligacion]  
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion8
and Periodo=a.periodo8
) as Descripcion_Obligacion8,
(select Fecha_de_Vencimiento
from sirref_invitaciones_fundamentos 
where ObligacionIDC=a.obligacion8
and Periodo=a.periodo8
) as Fecha_vencimiento8,
a.MEDIO_ENVIO_EF,
a.FECHA_CARGA,
a.CP ,
a.MUNICIPIO, 
case 
when a.MUNICIPIO ='1' then 'COZUMEL' 
when a.MUNICIPIO ='2' then 'F. CARRILLO PUERTO' 
when a.MUNICIPIO ='3' then 'ISLA MUJERES' 
when a.MUNICIPIO ='4' then 'OTHÓN P. BLANCO' 
when a.MUNICIPIO ='5' then 'BENITO JUÁREZ' 
when a.MUNICIPIO ='6' then 'J. M. MORELOS' 
when a.MUNICIPIO ='7' then 'LÁZARO CARDENAS' 
when a.MUNICIPIO ='8' then 'SOLIDARIDAD' 
when a.MUNICIPIO ='9' then 'TULUM' 
when a.MUNICIPIO ='10' then 'OTHÓN P. BLANCO' 
ELSE b.Nombre end as Nombre_Municipio
from sirref_invitaciones_morosos as a
left join cat_municipios as b on a.MUNICIPIO=b.Clave 
) as a
--where RFC='MASA910206D1A'
) as x

) as s


--ju 111
--se 111
--nov 11



--update  sirref_invitaciones_morosos_nov_2017_1
--set entrecalle_y_calle=''
--where entrecalle_y_calle is null



*------------------

9-6 informes @centuaros.com.mx
55523122 ext 113 o 114
cantidad


----------------------------------------------
estatales
Localizable_Estatal, EnRiesgo, Localidad, Zona, PAGO_PROMEDIO desc

federales
doble no localizados,
que  tengan un pago de 2007 en adelante
se ordenan por numero de veces que se les ha requerido en el año
verifica el monto en el que se inscribio

-----------------
Usuario: La CURP
Password: 168870

El link es http://rhom.qroo.gob.mx/sideol  y estará abierto el sistema hasta el día 20 de enero del presente

---------------------------------
200 agua
210 celular
400 jefa celular
1000 jefa
1000 liverpool
1000 candymania
500 despensa
500 lavadora
3810


200 agua
	210 celular
	400 jefa celular
	1000 mau
	1400 liverpool
500 candymania
300 despensa
500 lavadora
	500 gasolina
	300 silla
3810



chocoretas verdes 5
suspiros 5
pasitas 5
churritos ajonjoli 2
kranky 3
chicle chico 10
estrella multicolor 2
estrella azul 2
tamaringo 6
habas 4
enchilados 4
ajo 4
gota chica 3
gota grande 3
papas sal 2
papas adobadas 2
lunetas azul fuerte 2k



SELECT                EMI.Clave_Obligacion+' - '+OBL.Descripcion AS Obligacion ,
                      DOCU.Folio_Impresion,
                      DOCU.Numero_Emision,
                      EMI.Clave_Periodicidad,
                      nom.Nombre,
                      EMI.Anio_Moroso AS Año_Moroso                      
FROM         obl_detalle_documentos AS DOCU 
INNER JOIN
obl_control_emisiones AS EMI 
ON DOCU.Municipio = EMI.Municipio 
AND DOCU.Oficina = EMI.Oficina 
AND DOCU.Numero_Emision = EMI.Numero_Emision and DOCU.Movimiento='R1'
INNER JOIN  cat_obligaciones  AS OBL  ON EMI.Clave_Obligacion=OBL.Clave  
INNER JOIN obl_nombres_estatus AS NOM ON DOCU.Status=nom.Clave 
WHERE     (DOCU.Municipio = '01') AND (DOCU.Oficina = '01') AND (EMI.Clave_Obligacion = '010103') 
AND DOCU.Municipio='01'  AND DOCU.Oficina='01' AND EMI.Ejercicio_Fiscal='2017'

instagram
candymaniachetumal
liza0408
correo 
llizardiro@gmail.com
mchuletina



lizardilili
liza0408

al C. Ángel Ricardo Nar Zúñiga, 


select Municipio, count(*) as no_impresos
from  obl_detalle_documentos_actas_inspeccion 
where Numero_Emision>='1700'
and Fecha_Impresion is not null
group by Municipio, Oficina

select  *
from  obl_detalle_documentos_actas_inspeccion 
where Numero_Emision>='1700'
and Fecha_Impresion is not null
group by Municipio, Oficina


WHERE     (Folio_Impresion = '22') AND (Numero_Emision = '1618')


WHERE     (Municipio = '05') AND (Numero_Emision = '1618') AND (Folio_Impresion = 22)



115 hilda


--cambio veintitantos

<!-- SUCURSALES MOROSAS -->
  <table width="746" border="0" cellpadding="0"  cellspacing="0">
		
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">1.  INSCRIPCIÓN AL REGISTRO ESTATAL DE CONTRIBUYENTES; </div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">2.  AVISO DE APERTURA;</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr STYLE="background-color:#D8D8D8;">
		  <!--<td width="87%"><div style="font-size:11px">3.  LICENCIA PARA LA VENTA DE BEBIDAS ALCOH&Oacute;LICAS <?=//date("Y");?> O PERMISO PROVISIONAL, VIGENTE</div></td>-->
      <td width="87%"><div style="font-size:11px">3.  AVISO DE CAMBIO DE DOMICILIO FISCAL;</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <!--<tr >
		  <td width="87%"><div style="font-size:10px">&nbsp;&nbsp;&nbsp;&nbsp;N&Uacute;MERO__________________A NOMBRE DE ____________________________________________________________</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"></td><td width="50%"></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:10px">&nbsp;&nbsp;&nbsp;&nbsp;DOMICILIO _______________________________________GIRO AUTORIZADO _______________________________</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"></td><td width="50%"></td></tr></table></td>
      </tr> -->
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">4.  AVISO DE CAMBIO DE ACTIVIDAD PREPONDERANTE;<?=//date("Y");?></div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">5.  AVISO DE AUMENTO O DISMINUCIÓN DE OBLIGACIONES;</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">6.  AVISO DE CANCELACIÓN EN EL REGISTRO ESTATAL DE CONTRIBUYENTES;</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <!--<tr >
		  <td width="87%"><div style="font-size:10px">&nbsp;&nbsp;&nbsp;&nbsp;MES _____/_______ N&Uacute;MERO DE TRABAJADORES DECLARADOS______________           OBSERVADOS________________</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"></td><td width="50%"></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:10px">&nbsp;&nbsp;&nbsp;&nbsp;M2 construidos _____________M2 de la obra ___________         Imp.   contrato $________________</div></td>
       <td width="13%" align="right"><table ><tr><td width="50%"></td><td width="50%"></td></tr></table></td>
      </tr>  -->
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">7. AVISO DE CONTRATO CON INTERMEDIARIO LABORAL;;<?php //$anio_anterior=date("Y"); echo --$anio_anterior;?></div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">8. LICENCIA DE FUNCIONAMIENTO VIGENTE;</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">9. LICENCIA PARA LA VENTA DE BEBIDAS ALCOHÓLICAS O PERMISO PROVISIONAL, VIGENTES;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></td>
       <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:10px">&nbsp;&nbsp;&nbsp;&nbsp;N&Uacute;MERO__________________A NOMBRE DE ____________________________________________________________</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"></td><td width="50%"></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:10px">&nbsp;&nbsp;&nbsp;&nbsp;DOMICILIO _______________________________________GIRO AUTORIZADO _______________________________</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"></td><td width="50%"></td></tr></table></td>
      </tr> 
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">10. CONTRATO DE COMODATO VIGENTE; </div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">11. AUTORIZACIÓN PARA OPERAR COMO CASA DE EMPEÑO VIGENTE; Y</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
       <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">12. REGISTRO PARA OPERAR COMO EMPRESA DE SEGURIDAD PRIVADA VIGENTE.<?=//$anio_anterior?></div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">13. DECLARACIÓN Y PAGO PROVISIONAL DEL IMPUESTO SOBRE NÓMINAS POR PRESTACIÓN DE SERVICIOS EN SU CARÁCTER DE RETENEDOR</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">14. DECLARACIÓN Y PAGO PROVISIONAL O DEFINITIVA DEL IMPUESTO SOBRE NÓMINA;.<?=//$anio_anterior?></div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
            <tr >
		  <td width="87%"><div style="font-size:11px">15. DECLARACIÓN Y PAGO ANUAL DEL IMPUESTO SOBRE NÓMINA DEL EJERCICIO FISCAL INMEDIATO ANTERIOR.</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">16. DECLARACIÓN Y PAGO PROVISIONAL O DEFINITIVA DEL IMPUESTO AL HOSPEDAJE.<?=//$anio_anterior?></div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">17. DECLARACIÓN Y PAGO ANUAL DEL IMPUESTO AL HOSPEDAJE DEL EJERCICIO FISCAL INMEDIATO ANTERIOR.</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">18. DECLARACIÓN INFORMATIVA DEL IMPUESTO AL HOSPEDAJE.<?=//$anio_anterior?></div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">19. DECLARACIÓN Y PAGO BIMESTRAL DEL IMPUESTO AL LIBRE EJERCICIO DE PROFESIONES Y ACTIVIDADES LUCRATIVAS, A LA FECHA DEL PRESENTE.</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">20. DECLARACIÓN INFORMATIVA ANUAL DEL IMPUESTO AL LIBRE EJERCICIO DE PROFESIONES Y ACTIVIDADES LUCRATIVAS DEL EJERCICIO FISCAL.<?=//$anio_anterior?></div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">21. DECLARACIÓN Y PAGO DEL IMPUESTO A LAS EROGACIONES EN JUEGOS Y CONCURSOS.</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">22. DECLARACIONES Y PAGOS BIMESTRALES DEL RÉGIMEN DE PEQUEÑOS CONTRIBUYENTES.<?=//$anio_anterior?></div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr >
		  <td width="87%"><div style="font-size:11px">23. DECLARACIÓN (ES) Y PAGOS MENSUALES  (ES) DEL RÉGIMEN INTERMEDIO.</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      <tr STYLE="background-color:#D8D8D8;">
		  <td width="87%"><div style="font-size:11px">24. DECLARACIÓN Y PAGO A LA VENTA DE GASOLINA Y DIESEL; Y</div></td>
        <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
       <tr >
		  <td width="87%"><div style="font-size:11px">25. DECLARACIÓN Y PAGO BIMESTRAL DE CONTRIBUCIONES DEL RÉGIMEN DE INCORPORACIÓN FISCAL (IMPUESTO SOBRE LA RENTA, IMPUESTO AL VALOR AGREGADO Y/O IMPUESTO ESPECIAL SOBRE PRODUCCIÓN Y SERVICIOS.</div></td>
      <td width="13%" align="right"><table ><tr><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td width="50%"><div  style="font-size:8px;border-right:  1px solid; border-top:  1px solid; border-left:  1px solid; border-bottom:  1px solid;">&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr></table></td>
      </tr>
      

       
       
 </table>


fundamento actas de inspeccion

EN LA CIUDAD DE <?=$moroso['Localidad']?>, QUINTANA ROO, SIENDO LAS ____:____ 
HORAS DEL DIA _____ DEL MES DE __________ DEL AÑO <?=date("Y");?>, CONSTITUÍDO(S),  
EL (LOS)  NOTIFICADOR (ES)  EJECUTOR (ES) EN SU CARÁCTER DE AUTORIDAD FISCAL ESTATAL Y FEDERAL, 
CON FUNDAMENTO EN EL ARTÍCULO 27 FRACCIÓN XIII DEL CÓDIGO FISCAL VIGENTE PARA EL ESTADO DE 
QUINTANA ROO Y 2 FRACCIÓN <?=$Articulo18?> DEL REGLAMENTO DEL CÓDIGO FISCAL 
DEL ESTADO,  EN EL DOMICILIO UBICADO EN ____________________________________
 DEL MUNICIPIO DE <?=$moroso['Nombre_Municipio']?>, LUGAR SEÑALADO COMO: DOMICILIO FISCAL (  ) 
 MATRIZ(  )  O SUCURSAL(   ),  DEL CONTRIBUYENTE  _________________________________________
(NOMBRE, RAZÓN O DENOMINACIÓN SOCIAL), CON GIRO O ACTIVIDAD PREPONDERANTE SEÑALADA EN EL 
ENCABEZADO DE ESTA ACTA, ADEMÁS DE COINCIDIR CON EL DOMICILIO SEÑALADO EN LA ORDEN DE VISITA 
DE INSPECCIÓN, CONTENIDA EN EL OFICIO NÚMERO <?=$moroso['Folio_Impresion']?> DE FECHA _________, 
SEGÚN EL DICHO DE LA PERSONA CON LA QUE SE ENTIENDE LA DILIGENCIA QUIEN RESPONDE AL NOMBRE 
DE ________________________________ Y MANIFIESTA SER ___________________ 
DEL CONTRIBUYENTE, QUIEN SEÑALA QUE EL DOMICILIO ES EL CORRECTO,  
A QUIEN LE REQUERI(MOS) LA PRESENCIA DEL CONTRIBUYENTE O SU REPRESENTANTE LEGAL, MISMA QUE 
MANIFESTÓ QUE ____________________________________________________, 
RAZÓN POR LA CUAL SE ENTIENDE LA PRESENTE DILIGENCIA CON _______________________ 
EN LA CALIDAD DE _______________________ DEL VISITADO; MISMO QUE SE 
IDENTIFICA CON SU ______________________ EN TÉRMINOS DE LO PREVISTO 
EN EL ARTÍCULO 42-B FRACCIÓN II DEL CÓDIGO FISCAL DEL ESTADO DE QUINTANA ROO; 
ANTE QUIEN ME (NOS) IDENTIFIC(O)(AMOS) COMO AUTORIDAD(ES) FISCAL(ES) Y LE EXHIB(O)(IMOS) 
LA(S) CREDENCIA(LES) QUE (ME)(NOS) ACREDITA(N) COMO NOTIFICADOR(ES)-EJECUTOR(ES), 
CON VIGENCIA DEL______________________AL ___________________, EXPEDIDA(S) POR EL/LA C. SUBSECRETARIO(A) DE INGRESOS DE LA SECRETARIA DE FINANZAS Y 
PLANEACIÓN DEL ESTADO DE QUINTANA ROO, CON FUNDAMENTO EN LOS ARTÍCULOS 4 PUNTO 1.1, 10 
FRACCIÓN IX, 11 FRACCIÓN XXV DEL REGLAMENTO INTERIOR DE LA SECRETARÍA DE FINANZAS Y 
PLANEACIÓN DEL ESTADO DE QUINTANA ROO VIGENTE, PROCEDIENDO A NOTIFICARLE MEDIANTE LA 
PRESENTE ACTA, LA ÓRDEN DE INSPECCIÓN NÚMERO <?=$moroso['Folio_Impresion']?>, EMITIDA POR EL RECAUDADOR 
DE RENTAS EN EL MUNICIPIO DE <?=$moroso['Nombre_Municipio']?> EN FECHA _____________, 
MISMA QUE SE LE HACE ENTREGA EN ESTE MOMENTO AL COMPARECIENTE, PROCEDIENDO EN CONSECUENCIA 
CON FUNDAMENTO EN LOS ARTÍCULOS 16 PÁRRAFOS PRIMERO, DECIMOPRIMERO Y DECIMOSEXTO DE LA 
CONSTITUCIÓN POLÍTICA DE LOS ESTADOS UNIDOS MEXICANOS; 24 PÁRRAFOS PRIMERO, OCTAVO Y NOVENO 
DE LA CONSTITUCIÓN POLÍTICA DEL ESTADO LIBRE Y SOBERANO DE QUINTANA ROO; 3, 19 FRACCIÓN III, 
33 FRACCIONES XVI, XVII Y XVIII DE LA LEY ORGÁNICA DE LA ADMINISTRACIÓN PÚBLICA DEL ESTADO DE 
QUINTANA ROO; 42 FRACCIÓN II DEL CÓDIGO FISCAL DE LA FEDERACIÓN; ASÍ COMO 24, 25, 26 Y 27 
FRACCIONES IX, XII Y  XIII, 40 FRACCIÓN IV, 41, 42-B, 43, 59, 60, 61, 69 FRACCIONES I, IV Y 
V EN RELACIÓN CON EL ARTÍCULO 70, 85 FRACCIÓN XV Y 86 FRACCIÓN VII DEL CÓDIGO FISCAL DEL 
ESTADO DE QUINTANA ROO VIGENTE; 3, 14, 15, 16, 17, 23 Y 24 DEL REGLAMENTO DEL CÓDIGO FISCAL 
DEL ESTADO DE QUINTANA ROO VIGENTE; 4 PUNTO 1.1, 1.1.1, <?=$Puntos?>, 15 
FRACCIÓN <?=$Articulo18?>, 16, 17 Y 18 FRACCIONES I, VI, VII, XII, XV, XXII, XXIII, 
XXIV, XXVI, XXVII y XXVIII DEL REGLAMENTO INTERIOR DE LA SECRETARÍA DE FINANZAS Y 
PLANEACIÓN DEL ESTADO VIGENTE; 39, 40, 43, 43-B, 44, 45, 46, 47, 143, 144, 147, 148, 
168-A, 168-C, 168-E, 168-I, 168-J, 168-M, 168-BIS, 168-BIS-A, 168-BIS-C, 168-BIS-E, 
172, 173-A, 175 6Y 207-T  DE LA LEY DE HACIENDA DEL ESTADO DE QUINTANA ROO EN VIGOR; 
TERCERO TRANSITORIO DEL DECRETO 370 PUBLICADO EN EL PERIÓDICO OFICIAL DEL ESTADO DE 
QUINTANA ROO EL 15 DE DICIEMBRE DE 2015 POR EL QUE SE EFECTÚAN DIVERSAS MODIFICACIONES A 
LA LEY DE HACIENDA DEL ESTADO DE QUINTANA ROO; 2, 4, 7, 8, 9, 12, 13, 14, 15 Y 16 BIS 
FRACCIONES I Y II, 16 TER Y 16 QUATER FRACCIÓN II DE LA LEY DEL IMPUESTO SOBRE NÓMINAS 
DEL ESTADO DE QUINTANA ROO;1, 2, 3 Y 5 DE LA LEY DEL IMPUESTO A LAS EROGACIONES EN 
JUEGOS Y CONCURSOS DEL ESTADO DE QUINTANA ROO; 30, 31, 51, 52, 53 Y 54 DE LA LEY SOBRE 
VENTA Y CONSUMO DE BEBIDAS ALCOHÓLICAS EN EL ESTADO DE QUINTANA ROO; 2, 3, 4, 5, 26, 27 
y 28 DE LA  LEY QUE ESTABLECE LAS BASES DE APERTURA Y CIERRE DE LAS CASAS DE EMPEÑO O 
PRÉSTAMO DEL ESTADO DE QUINTANA ROO; ASÍ COMO LAS CLÁUSULAS PRIMERA, SEGUNDA FRACCIONES I, 
II, IV Y V, CUARTA, OCTAVA FRACCIÓN I INCISOS A), B), C) Y D) DEL CONVENIO DE COLABORACIÓN 
ADMINISTRATIVA EN MATERIA FISCAL FEDERAL CELEBRADO ENTRE EL GOBIERNO DEL ESTADO DE QUINTANA 
ROO Y LA SECRETARÍA DE HACIENDA Y CRÉDITO PÚBLICO EN FECHA 17 DE DICIEMBRE DE 2008, 
PUBLICADO EN EL DIARIO OFICIAL DE LA FEDERACIÓN EL DÍA 6 DE FEBRERO DE 2009 Y EN EL PERIÓDICO 
OFICIAL DEL ESTADO DE QUINTANA ROO EL DÍA 27 DE FEBRERO DE 2009; CLÁUSULAS PRIMERA, SEGUNDA 
FRACCIONES I, II Y III, TERCERA,  CUARTA, OCTAVA FRACCIÓN I INCISOS A), B) Y D),  TERCERA 
TRANSITORIA Y CUARTA TRANSITORIA DEL CONVENIO DE COLABORACIÓN ADMINISTRATIVA EN MATERIA FISCAL 
FEDERAL CELEBRADO ENTRE EL GOBIERNO FEDERAL, POR CONDUCTO DE LA SECRETARÍA DE HACIENDA Y CRÉDITO 
PÚBLICO Y EL GOBIERNO DEL ESTADO DE QUINTANA ROO, PUBLICADO EL  17 DE AGOSTO DE 2015 EN EL DIARIO 
OFICIAL DE LA FEDERACIÓN Y EL 10 DE AGOSTO DE 2015 EN EL PERIÓDICO OFICIAL DEL ESTADO DE QUINTANA 
ROO; LAS CLAUSULAS PRIMERA FRACCIONES I, II Y III, SEGUNDA FRACCIONES II Y III DEL ANEXO 19 AL 
CONVENIO DE COLABORACIÓN ADMINISTRATIVA EN MATERIA FISCAL FEDERAL, CELEBRADO ENTRE LA SECRETARÍA 
DE HACIENDA Y CRÉDITO PÚBLICO Y EL GOBIERNO DEL ESTADO DE QUINTANA ROO, PUBLICADO EL 15 DE ABRIL 
DE 2014 EN EL DIARIO OFICIAL DE LA FEDERACIÓN  Y EL 30 DE ABRIL DE 2014 EN EL PERIÓDICO OFICIAL 
DEL ESTADO DE QUINTANA ROO, A REQUERIRLE A LA PERSONA CON LA QUE SE ENTIENDE LA PRESENTE 
DILIGENCIA, PARA QUE EN ESTE ACTO DESIGNE DOS TESTIGOS DE ASISTENCIA, A LO QUE EN USO DE 
LA VOZ MANIFESTÓ QUE SI (       ) SEÑALA TESTIGO(S), RAZON POR LA CUAL SE DESIGNA(N) Y SE 
TIENE(N) COMO TESTIGO(S) A LOS CC. ___________________________________________________ 
Y____________________________________________________, QUIEN (ES) 
SE IDENTIFICA(N) CON ____________________________________________, RESPECTIVAMENTE.
(  ) NO SEÑALA TESTIGOS (DESCRIBIR LAS CIRCUNSTANCIAS)  ___________________________________________________________________________________________
POR LO QUE CONFORME A LO DISPUESTO EN EL ARTÍCULO 16 DE LA CONSTITUCIÓN POLÍTICA DE LOS 
ESTADOS UNIDOS MEXICANOS, ESTA AUTORIDAD FISCAL PROCEDE A LA DESIGNACIÓN DE TESTIGO(S), CUYO(S) NOMBRE(S) SE SEÑALA(N) A CONTINUACIÓN, CC. ____________________________________ Y ___________________________________ 
QUIEN(ES) SE IDENTIFICA(N) CON____________________, EXPEDIDA POR ____________________ 
RESPECTIVAMENTE. Y ANTE LA PRESENCIA DE LOS TESTIGOS ANTES SEÑALADOS PROCED(O) (EMOS) A REQUERIRLE AL 
COMPARECIENTE, QUE EXHIBA LA DOCUMENTACIÓN QUE A CONTINUACIÓN SE DESCRIBE:


27  1618 nom anual
-------------
220 1609 mens
329 1611 mens 
450 1613 mens
554 1615 mens
681 1633 mens
811 1637 mens
929 1642 mens
1046 1651 mens
1168 1653 mens
1288 1657 mens


26102018
---marcado de la diligencia que trabajo genaro resultado de la vigilancia

delete from obl_retro_vig_plus

select * 
from dbo.obl_retro_vig_plus as a 
JOIN sirref_co_documentos  as b 
on a.no_control=b.Numero_Control 
where No_Control ='100707176347835C73065'

select * 
from dbo.obl_retro_vig_plus as a 
JOIN sirref_co_documentos  as b 
on a.no_control=b.Numero_Control 
where No_Control ='100707176347835C73065'and 
a.identificador='1' and Numero_Emision='18287'

--agregar el vencimiento
update obl_retro_vig_plus
set F5=Fecha_diligencia+15
where identificador='1'

--guardar  los entregados

update sirref_co_documentos
set Status='E', Fecha_Entrega=a.fecha_diligencia,  
fecha_citatorio=case when a.Fecha_citatorio IS  not NULL  
then a.fecha_citatorio 
else NULL end,
Fecha_Vencimiento=a.F5 
from dbo.obl_retro_vig_plus as a 
JOIN sirref_co_documentos  as b 
on a.no_control =b.Numero_Control 
where a.identificador='1' and Numero_Emision='18303'

--guardar los no localizados
update sirref_co_documentos
set Status='N', Fecha_No_Localizado =a.fecha_diligencia, 
fecha_citatorio=case when a.Fecha_citatorio IS  not NULL  
then a.fecha_citatorio 
else NULL end,
Fecha_Vencimiento=NULL
from dbo.obl_retro_vig_plus as a 
JOIN sirref_co_documentos  as b 
on a.no_control=b.Numero_Control 
where --No_Control ='100707176347835C73065'and 
a.identificador='0' and Numero_Emision='18303'

actualizar los nulos
update sirref_co_documentos  
set Fecha_Citatorio=NULL
where Numero_Emision='18303'
and Fecha_Citatorio='01/01/1900'



-------------------------
nueva forma 2019
delete from obl_retro_vig_plus

select * 
from dbo.obl_retro_vig_plus as a 
JOIN sirref_co_documentos  as b 
on a.no_control=b.Numero_Control 
where No_Control ='100309192531636C73316'

select * 
from dbo.obl_retro_vig_plus as a 
JOIN sirref_co_documentos  as b 
on a.no_control=b.Numero_Control and a.Numero_Emision  =b.Numero_Emision  
where No_Control ='100309192531636C73316'and 
a.identificador='1' --and Numero_Emision='18287'

--agregar el vencimiento
update obl_retro_vig_plus
set F5=Fecha_diligencia+15
where identificador='1'

--guardar  los entregados

update sirref_co_documentos
set Status='E', Fecha_Entrega=a.fecha_diligencia,  
fecha_citatorio=case when a.Fecha_citatorio IS  not NULL  
then a.fecha_citatorio 
else NULL end,
Fecha_Vencimiento=a.F5
from dbo.obl_retro_vig_plus as a 
JOIN sirref_co_documentos  as b 
on a.no_control =b.Numero_Control and a.Numero_Emision  =b.Numero_Emision 
where a.identificador='1'-- and Numero_Emision='18303'




## querys vigilancia plus para reimprimir los documentos que tienen 4 fundamentos y sobresalen a 2 hojas

select * from sirref_co_documentos
where Numero_Control in (
select Numero_Control  from (
select c.Numero_Control, COUNT(c.Numero_Control ) as total
from sirref_co_documentos  as a 
inner join sirref_co_datos as b  on a.numero_control=b.numero_control
join sirref_co_detalle as c on a.Numero_Control=c.Numero_Control 
where a.numero_emision='17267' and b.Municipio_Estatal ='02' 
and a.Numero_Control in ('100708176506423C73065',
'100708176559021C73065',
'100708176589821C73065',
'100708176530879C73065',
'100708176520763C73065',
'100708176506807C73065',
'100708176543308C73065',
'100708176542530C73065',
'100708176575214C73065',
'100708176499113C73065',
'100708176500509C73065',
'100708176533734C73065',
'100708176547920C73065',
'100708176515397C73065',
'100708176579702C73065',
'100708176503243C73065',
'100708176520876C73065',
'100708176575550C73065',
'100708176545219C73065',
'100708176526345C73065',
'100708176506343C73065',
'100708176566313C73065',
'100708176583956C73065',
'100708176584458C73065',
'100708176500596C73065',
'100708176588832C73065',
'100708176503611C73065',
'100708176534111C73065',
'100708176537925C73065',
'100708176530572C73065')
group by c.Numero_Control ) as v
where total>='4')
order by Fecha_Impresion 

update sirref_co_documentos
set Status='B'
where Numero_Control in (
select Numero_Control  from (
select c.Numero_Control, COUNT(c.Numero_Control ) as total
from sirref_co_documentos  as a 
inner join sirref_co_datos as b  on a.numero_control=b.numero_control
join sirref_co_detalle as c on a.Numero_Control=c.Numero_Control 
where a.numero_emision='17267' and b.Municipio_Estatal ='02' 
and a.Numero_Control in ('100708176506423C73065',
'100708176559021C73065',
'100708176589821C73065',
'100708176530879C73065',
'100708176520763C73065',
'100708176506807C73065',
'100708176543308C73065',
'100708176542530C73065',
'100708176575214C73065',
'100708176499113C73065',
'100708176500509C73065',
'100708176533734C73065',
'100708176547920C73065',
'100708176515397C73065',
'100708176579702C73065',
'100708176503243C73065',
'100708176520876C73065',
'100708176575550C73065',
'100708176545219C73065',
'100708176526345C73065',
'100708176506343C73065',
'100708176566313C73065',
'100708176583956C73065',
'100708176584458C73065',
'100708176500596C73065',
'100708176588832C73065',
'100708176503611C73065',
'100708176534111C73065',
'100708176537925C73065',
'100708176530572C73065')
group by c.Numero_Control ) as v
where total>='4')


correo sra elsy
candymaniae@outlook.com
candy2017
contraseña inadem
Candy2017

este es tu número de registro en la Red de Apoyo al Emprendedor
#RAE: LILI7938437
contraseña inadem
Candy2017




select * from sirref_co_documentos 
where Numero_Control='100206176114062C77042'
and Numero_Emision='17261' and Movimiento='R1'

select * from sirref_co_documentos 
where Numero_Control='100504175713040C77042'
and Numero_Emision='17249'  and Movimiento='R1'

select * from sirref_co_documentos 
where Numero_Control='100405175907662C77042'
and Numero_Emision='17257'  and Movimiento='R1'

select * from sirref_co_documentos 
where Numero_Control='100803175538721C77042'
and Numero_Emision='17243'  and Movimiento='I1'

update sirref_co_documentos 
set Status='A', Fecha_No_Localizado=NULL
where Numero_Control='100206176114062C77042'
and Numero_Emision='17261' and Movimiento='R1'

update sirref_co_documentos 
set Status='A', Fecha_No_Localizado=NULL
where Numero_Control='100504175713040C77042'
and Numero_Emision='17249'  and Movimiento='R1'

update sirref_co_documentos 
set Status='A', Fecha_No_Localizado=NULL
where Numero_Control='100405175907662C77042'
and Numero_Emision='17257'  and Movimiento='R1'

update sirref_co_documentos 
set Status='A', Fecha_No_Localizado=NULL
where Numero_Control='100803175538721C77042'
and Numero_Emision='17243'  and Movimiento='I1'


100708176566827C73065


el t roman - ps
ella hsd  -  12cpx


carga sirref formato ansi del archivo de fundamentos


a que municipio pertenecen lic sara genaro sirref
select a.RFC, a.Numero_Control,b.Nombre_Contribuyente, Codigo_Postal, 
Municipio_Estatal, Municipio_Federal, b.Calle,b.Num_Exterior, b.Num_Interior, b.Colonia,
b.Referencia 
from sirref_co_documentos  as a 
join sirref_co_datos as b  
on a.numero_control=b.numero_control
where a.numero_emision='17272'-- and b.municipio_estatal='01' 
order by rfc


-----------------
procedimiento  emisiones sirref genaro sara
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_co_informe_emisiones_sirref]
		@Ejercicio = N'2017',
		@Municipio01 = N'01'		

SELECT	'Return Value' = @return_value

GO



fumigacion
tarjeta de salud
agua potable
alimentos libres de contaminacion




		320 celular
		200 jefa celular
		1000 mau
		500 liverpool
		300 despensa
	1000 monte
		500 jefa
		600 gasolina
		300 silla

1 KILO DE ALITAS
1/4 TAZA HARINA
1/2 TAZAHARINA DE MAIZ
1/4 TAZA HARINA
1 CUCH PIMENTON
1 CUCH AJO EN POLVO
C CDITA PIMIENTA CAYENA
POLVO HORNEAR 2 CUCH
1 CUDITA PIMIENTA
S CUDITAS SAL
2/3 AGUA



SELECT  mu.Nombre as Municipio, obl.Descripcion as Obligacion, 
case MORO.MES_INICIAL  
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '1' then 'ENERO' 
when '02' then 'FEBRERO'
when '2' then 'FEBRERO'
when '03' then 'MARZO'
when '3' then 'MARZO'
when '04' then 'ABRIL' 
when '4' then 'ABRIL' 
when '05' then 'MAYO'
when '5' then 'MAYO'
when '06' then 'JUNIO'
when '6' then 'JUNIO'
when '07' then 'JULIO' 
when '7' then 'JULIO' 
when '08' then 'AGOSTO'
when '8' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '9' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
case MORO.MES_FINAL  
when NULL then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '1' then 'ENERO' 
when '02' then 'FEBRERO'
when 'iJUNIO'
when '6' then 'JUNIO'
when '07' then 'JULIO' 
when '7' then 'JULIO' 
when '08' then 'AGOSTO'
when '8' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '9' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Final,
case moro.PERIODICIDAD  
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
end as Tipo_Periodo,
moro.EJERCICIO, suc.Numero_Emision,emi.Fecha_Emision 
, suc.Folio_Impresion, 
moro.rfc,st.Nombre as Estatus, 
docu.Fecha_Impresion, docu.Fecha_Asignacion, docu.Fecha_Entrega, docu.Fecha_No_Localizado,
docu.Clave_Notificador, min(usu.Nombre)+' '+min(usu.Apellido)  as notificador--,
--usuario_cancelacion as registro_pago,
--docu.No_Operacion 
--, moro.NUMERO_ESTABLECIMIENTO 
FROM         RES_VIG_MOROSIDAD_REPECOS AS moro 
left JOIN   obl_detalle_sucursales AS suc ON 
moro.EJERCICIO = suc.Anio_Moroso 
AND CAST(moro.Mes_Inicial AS INT)= CAST(suc.Mes AS INT )
AND moro.RFC = suc.RFC 
AND moro.PERIODICIDAD = suc.Clave_Periodicidad 
AND moro.CLAVE = suc.Clave_Obligacion
and moro.NUMERO_ESTABLECIMIENTO=suc.Numero_Establecimiento 
left JOIN   obl_detalle_documentos AS docu ON suc.RFC = docu.RFC 
AND moro.MPO_CON = docu.Municipio and docu.Oficina in('01','09')
AND suc.Numero_Emision=docu.Numero_Emision and suc.Folio_Impresion=docu.Folio_Impresion
and docu.Movimiento='R1'
left JOIN cat_obligaciones AS OBL ON moro.CLAVE=obl.Clave 
left JOIN cat_municipios  as mu on moro.MPO_CON=mu.Clave 
left JOIN obl_nombres_estatus AS st on docu.Status=st.Clave 
left join obl_control_emisiones as emi on docu.Municipio=emi.Municipio and docu.Oficina=emi.Oficina 
and docu.Numero_Emision =emi.Numero_Emision 
left join seg_usuarios usu on docu.Clave_Notificador=usu.Usuario 
WHERE     (moro.MPO_CON = '01')
AND EJERCICIO>='2014'
--AND docu.Status='P'
AND moro.CLAVE in ('010102','010103','010104','010106')
--AND MORO.RFC=' CTU160418AG7'
group by mu.Nombre,obl.Descripcion,MORO.MES_INICIAL, MORO.MES_FINAL,moro.PERIODICIDAD  ,
moro.EJERCICIO,suc.Numero_Emision,emi.Fecha_Emision 
, suc.Folio_Impresion, 
moro.rfc,st.Nombre,docu.Fecha_Impresion, docu.Fecha_Asignacion, docu.Fecha_Entrega, docu.Fecha_No_Localizado,
docu.Clave_Notificador,usuario_cancelacion,
docu.No_Operacion 
, moro.NUMERO_ESTABLECIMIENTO 
ORDER BY  obl.Descripcion,moro.EJERCICIO, moro.mes_Inicial, moro.MES_FINAL,
suc.Numero_Emision, suc.Folio_Impresion


datos de un vehiculo
 select Serie,Placa,Descripcion_Vehiculo,An_Construccion  
 from tenencias.dbo.ten_Padron_Vehicular 
where Apellido_Paterno 
like  '%burciaga%' 
and		Apellido_Materno like '%ortega%'



select Serie,Placa,Descripcion_Vehiculo,An_Construccion  
from tenencias.dbo.ten_Padron_Vehicular 
where Apellido_Paterno like  '%lizardi%' 
and		Apellido_Materno like '%rodriguez%'




reporte bruno morosos 2014-2017 estatales

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_24102017]

SELECT	'Return Value' = @return_value

GO

SELECT  mu.Nombre as Municipio, obl.Descripcion as Obligacion, 

case MORO.MES_INICIAL  
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '1' then 'ENERO' 
when '02' then 'FEBRERO'
when '2' then 'FEBRERO'
when '03' then 'MARZO'
when '3' then 'MARZO'
when '04' then 'ABRIL' 
when '4' then 'ABRIL' 
when '05' then 'MAYO'
when '5' then 'MAYO'
when '06' then 'JUNIO'
when '6' then 'JUNIO'
when '07' then 'JULIO' 
when '7' then 'JULIO' 
when '08' then 'AGOSTO'
when '8' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '9' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
case MORO.MES_FINAL  
when NULL then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '1' then 'ENERO' 
when '02' then 'FEBRERO'
when '2' then 'FEBRERO'
when '03' then 'MARZO'
when '3' then 'MARZO'
when '04' then 'ABRIL' 
when '4' then 'ABRIL' 
when '05' then 'MAYO'
when '5' then 'MAYO'
when '06' then 'JUNIO'
when '6' then 'JUNIO'
when '07' then 'JULIO' 
when '7' then 'JULIO' 
when '08' then 'AGOSTO'
when '8' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '9' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Final,
case moro.PERIODICIDAD  
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
end as Tipo_Periodo,
moro.EJERCICIO, suc.Numero_Emision,emi.Fecha_Emision 
, suc.Folio_Impresion, 
moro.RFC,
min(cont.Nombres)+' '+min(cont.Apellido_Paterno)+' '+min(cont.Apellido_Materno) as Nombre,
min(cont.Domicilio_Fiscal_Calle)+' '+min(cont.Domicilio_Fiscal_Numero)+' '+min(cont.Domicilio_Fiscal_Domicilio) 
+' '+min(cont.Domicilio_Fiscal_Ubicacion) as Domicilio,
st.Nombre as Estatus, 
docu.Fecha_Impresion, docu.Fecha_Asignacion, docu.Fecha_Entrega, docu.Fecha_No_Localizado,
docu.Clave_Notificador, min(usu.Nombre)+' '+min(usu.Apellido)  as notificador--,
--usuario_cancelacion as registro_pago,
--docu.No_Operacion 
--, moro.NUMERO_ESTABLECIMIENTO 
FROM         RES_VIG_MOROSIDAD_REPECOS AS moro 
left JOIN   obl_detalle_sucursales AS suc ON 
moro.EJERCICIO = suc.Anio_Moroso 
AND CAST(moro.Mes_Inicial AS INT)= CAST(suc.Mes AS INT )
AND moro.RFC = suc.RFC 
AND moro.PERIODICIDAD = suc.Clave_Periodicidad 
AND moro.CLAVE = suc.Clave_Obligacion
and moro.NUMERO_ESTABLECIMIENTO=suc.Numero_Establecimiento 
left JOIN   obl_detalle_documentos AS docu ON suc.RFC = docu.RFC 
AND moro.MPO_CON = docu.Municipio and docu.Oficina in('01','09')
AND suc.Numero_Emision=docu.Numero_Emision and suc.Folio_Impresion=docu.Folio_Impresion
and docu.Movimiento='R1'
left JOIN cat_obligaciones AS OBL ON moro.CLAVE=obl.Clave 
left JOIN cat_municipios  as mu on moro.MPO_CON=mu.Clave 
left JOIN obl_nombres_estatus AS st on docu.Status=st.Clave 
left join obl_control_emisiones as emi on docu.Municipio=emi.Municipio and docu.Oficina=emi.Oficina 
and docu.Numero_Emision =emi.Numero_Emision 
left join seg_usuarios usu on docu.Clave_Notificador=usu.Usuario 
left join pad_contribuyentes AS CONT ON moro.RFC=cont.RFC 
WHERE     (moro.MPO_CON = '07')
AND EJERCICIO>='2014'
--AND docu.Status='P'
AND moro.CLAVE in ('010102','010103','010104','010106')
--AND MORO.RFC=' CTU160418AG7'
group by mu.Nombre,obl.Descripcion,MORO.MES_INICIAL, MORO.MES_FINAL,moro.PERIODICIDAD  ,
moro.EJERCICIO,suc.Numero_Emision,emi.Fecha_Emision 
, suc.Folio_Impresion, 
moro.rfc,st.Nombre,docu.Fecha_Impresion, docu.Fecha_Asignacion, docu.Fecha_Entrega, docu.Fecha_No_Localizado,
docu.Clave_Notificador,usuario_cancelacion,
docu.No_Operacion 
, moro.NUMERO_ESTABLECIMIENTO 
ORDER BY  obl.Descripcion,moro.EJERCICIO, moro.mes_Inicial, moro.MES_FINAL,
suc.Numero_Emision, suc.Folio_Impresion 
--658



paPadron_App_Desglosa_Pendientes.- Devuelve los documentos que tiene asignados un notificador.
EXEC	[dbo].[paPadron_App_Desglosa_Pendientes]
		@Usuario = N'jcanul'
paPadron_App_Detalle_Documento.-Devuelve los datos generales de un documento asignado, puede ser un requerimiento o una multa.
EXEC	 [dbo].[paPadron_App_Detalle_Documento]
		@Usuario = N'jcanul',
		@RFC = N'CACM7311279C8',
		@Movimiento = N'R1',
		@Numero_Emision = N'1028',
		@Folio_Impresion = N'2910'

paPadron_App_Lista_Notificadores.- Muestra el listado de los notificadores adscritos a un municipio.
EXEC	 [dbo].[paPadron_App_Lista_Notificadores]
		@municipio = N'05'
		
paPadron_App_Registra_Entrega.-Registra el resultado de la vigilancia.
EXEC	 [dbo].[paPadron_App_Registra_Entrega]
		@Usuario = N'co_municipio',
		@RFC = N' AAO560706E63',
		@Movimiento = N'R1',
		@Numero_Emision = N'0601',
		@Folio_Impresion = N'1',
		@Estatus = N'E',
		@Fecha_Movimiento = N'09/01/2015',
		@Persona_Recibe_Nombre = N'LILI',
		@Persona_Recibe_Identificacion = N'LIZARDI',
		@Observaciones = N'sdsd',
		@Categoria_No_Loc = N'1'

paPadron_App_Situacion_Contribuyente.- Devuelve los adeudos de un contribuyente.

EXEC	 [dbo].[paPadron_App_Situacion_Contribuyente]
		@RFC = N'SOSI821114CJ3'





---------
bitso
passww

Client ID: 1024796
Password: liza0408
Transaction PIN: 3565
Nip:040801

binance
lizardi_w@hotmail.com
Liza0408

select * from cat_localidades where Clave_Municipio ='02' and Nombre like ('Puerto%')
select * from cat_localidades where Clave_Municipio ='02' and Nombre like ('%vallarta%')
select * from cat_localidades where Clave_Municipio ='02' and Nombre like ('%vicario%')




---------------
cambio opb a bacalar

select a.rfc as rfc_cambio,a.numero as numero_cambio, a.numero_establecimiento_nuevo, b.*
into ingresos.dbo.obl_obligacion_vigilable_cambio_opb
from establecimientos_bacalar2017 as a
join obl_obligacion_vigilable_presentada as b on 
a.rfc=b.RFC and a.numero=b.Numero_Establecimiento 
where b.Estado='T' 
order by No_Operacion 



update obl_obligacion_vigilable_presentada
set Numero_Establecimiento_Anterior=b.numero_establecimiento,
Numero_Establecimiento=a.numero_establecimiento_nuevo
from establecimientos_bacalar2017 as a
join obl_obligacion_vigilable_presentada as b on 
a.rfc=b.RFC 
and a.numero=b.Numero_Establecimiento 
where b.Estado='T' 
--and a.RFC='LALN670727ATA'


cambio cancun pto morelos


select a.rfc as rfc_cambio,a.numero as numero_cambio, a.numero_establecimiento_nuevo, b.*
into ingresos.dbo.obl_obligacion_vigilable_cambio_ptomorelos
from establecimientos_puertomorelos2017 as a
join obl_obligacion_vigilable_presentada as b on 
a.rfc=b.RFC and a.numero=b.Numero_Establecimiento 
where b.Estado='T' 
order by No_Operacion 


update obl_obligacion_vigilable_presentada
set Numero_Establecimiento_Anterior=b.numero_establecimiento,
Numero_Establecimiento=a.numero_establecimiento_nuevo
from establecimientos_puertomorelos2017 as a
join obl_obligacion_vigilable_presentada as b on 
a.rfc=b.RFC 
and a.numero=b.Numero_Establecimiento 
where b.Estado='T' 
--and a.RFC='LALN670727ATA'


poner las obligaciones en periodos para la vigilancia
cambiar las localidades de los requerimientos al nuevo catalogo
antes de que impriman eso es importante








USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_CPY_nomina_emisiones_nuevas]
@Limite ='10', 
@Clave_Obligacion ='010103', 
@Municipio ='03', 
@ClavePeriodicidad ='02', 
@EjercicioFiscal ='2017', 
@Mes ='01', 
@MesFinal = '12', 
@ClaveLocalidad = '0', 
@ClaveZona = '0', 
@ClaveOficina = '01', 
@Anio ='2017', 
@Numero_Emision = '1801', 
@Cont_No_Localizados = '0', 
@Total_En_Riesgo = '0'

SELECT	'Return Value' = @return_value

GO



http://rh.qroo.gob.mx/portal/iniciarencuesta.php


select mun.Nombre as Municipio, A.Numero_Emision, Folio_Impresion,  co.Descripcion as Obligacion, 
 Ejercicio_Fiscal,
case a.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
Anio_Moroso, Fecha_Impresion, 'Impreso' as Status, RFC
from obl_control_emisiones as a
join obl_detalle_documentos as b on 
a.numero_emision=b.numero_emision
and  a.municipio=b.municipio
and a.oficina=a.oficina
INNER JOIN  cat_municipios AS mun ON a.Municipio  = mun.Clave
INNER JOIN		  cat_obligaciones AS co ON a.Clave_Obligacion  = co.Clave

where a.Anio_Moroso ='2017'
and b.Status ='I' and Fecha_Entrega is null
and a.Municipio='08'
order by a.Numero_Emision, B.Folio_Impresion 



select mun.Nombre as Municipio, A.Numero_Emision, Folio_Impresion,  co.Descripcion as Obligacion, 
 Ejercicio_Fiscal,
case a.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
Anio_Moroso, Fecha_Impresion, 'Impreso' as Status, RFC
from obl_control_emisiones as a
join obl_detalle_documentos as b on 
a.numero_emision=b.numero_emision
and  a.municipio=b.municipio
and a.oficina=a.oficina
INNER JOIN  cat_municipios AS mun ON a.Municipio  = mun.Clave
INNER JOIN		  cat_obligaciones AS co ON a.Clave_Obligacion  = co.Clave

where a.Anio_Moroso ='2017'
and b.Status ='I' and Fecha_Entrega is null
and a.Municipio='08'
order by a.Numero_Emision, B.Folio_Impresion 



evaluacion cuatrimestral evalua bruno curp
Usuario: La CURP
Password: 168870

El link es http://rhom.qroo.gob.mx/sideol  y estará abierto el sistema hasta el día 20 de enero del presente

XRP gabo
18.532246


mostrar los errrores ramon
  error_reporting(E_ALL);
  ini_set('display_errors', 1);
     set_time_limit( 0 );//CHECAR LOCALIDAD   JHDFGHKJDFGKSDJ
                $sql_estatales_anuales_multi="              EXEC [dbo].[paCo_Determina_CPY_nend]
                          @Clave_Obligacion ='{$clave_obligacion}',
                          @Municipio ='{$_POST['municipio']}',
                          @ClavePeriodicidad ='02',
                          @EjercicioFiscal ='{$anio}',
                          @Mes  ='{$_POST['mes_inicial']}',
                          @MesFinal = '{$_POST['mes_final']}',
                          @ClaveLocalidad = '0',
                          @ClaveZona = '0',
                          @ClaveOficina = '{$_POST['oficina']}',
                          @Anio ='{$EjercicioFiscal}'";
                //echo $sql_estatales_anuales_multi;   
                    
                 $conexionBD->Seleccion($sql_estatales_anuales_multi);
                 $cantidad_anual=$conexionBD->ObtenNumeroFilas();
                

antes de la ejecucion



tabla de notificadores
select a.Usuario, RFC, CURP, a.Nombre,Apellido, Puesto,
c.Nombre as Municipio, c.Nombre as Oficina
from seg_usuarios as a
join  dbo.seg_usuarios_celular as b on a.Usuario=b.usuario 
join cat_municipios as c on a.Municipio=c.Clave 
join cat_oficinas as d on a.Municipio=d.Clave_Municipio and a.Oficina=d.Clave 
where puesto like '%notifi%' and Activado='S'




eliminar los documentos para reimprimir las multas por incumplimiento R2
select *
from obl_detalle_documentos 
where Movimiento='R2' 
and Numero_Emision='1719'
and Status='I'
and Municipio='02' 
and Oficina='01' 
and folio_impresion 
 in (select Folio_Impresion  
from obl_detalle_documentos 
where Movimiento='I1' 
and Numero_Emision='1719'
and Status='B' 
and Municipio='02' 
and Oficina='01') 



delete obl_detalle_documentos 
where Movimiento='R2' 
and Numero_Emision='1721'
and Status='I'
and Municipio='02' 
and Oficina='01' 
and folio_impresion 
 in (select Folio_Impresion  
from obl_detalle_documentos 
where Movimiento='I1' 
and Numero_Emision='1721'
and Status='B' 
and Municipio='02' 
and Oficina='01') 




informe de pendientes doctos carlos amaro
select a.Municipio, a.Oficina, a.Numero_Emision, a.rfc, Movimiento, a.Folio_Impresion, Status,
Referencia, Fecha_Vencimiento_Referencia 
from obl_detalle_documentos as a
join obl_datos_generales as b on a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
and a.Numero_Emision=b.Numero_Emision and a.Folio_Impresion=b.Folio_Impresion 
join obl_nombres_estatus as c on 
where a.Municipio='02' AND Localidad IN (SELECT Clave_nueva   FROM  Temp_Locali_puerto_morelos )
and Status not in ('P','T','X','N','H',
'M',
'J',
'S',
'Y',
'O',
'U',
'R',
'G',
'K')
and Movimiento in ('ME','I1','R1')
and Fecha_Vencimiento_Referencia<01192018
and Referencia is not null
and YEAR(Fecha_Impresion)>'2016'
--and a.rfc=' OMD130705DS8'))


16951



select * 
from obl_detalle_documentos as a
join obl_datos_generales as b on a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
and a.Numero_Emision=b.Numero_Emision and a.Folio_Impresion=b.Folio_Impresion 
where a.Municipio='02' AND Localidad IN (SELECT Clave_nueva   FROM  Temp_Locali_puerto_morelos )
--and Status in ('E','V')
and Status in ('E','V')
--and Movimiento in ('ME','I1')
and a.Numero_Emision>='1300'
and a.rfc=' OMD130705DS8'




select * 
from obl_detalle_documentos as a
join obl_datos_generales as b on a.Municipio=b.Municipio  and a.Oficina=b.Oficina 
and a.Numero_Emision=b.Numero_Emision and a.Folio_Impresion=b.Folio_Impresion 
where a.Municipio='01' AND Localidad IN (SELECT Clave_nueva   FROM  TEMP_Locali_Bacalar )
and Status in ('E','V')
and a.Numero_Emision>='1300'
and a.rfc=' OMD130705DS8'





1759 1220 I1 nomm mens pago antes de la entrega 01050128133101
1752 35 I2 materiales mens
1748 31 I2 mat mens
1728 12 I2 inf mens hosp
1735 5 I3 bim ilepal pagado
1723 3 I3 bim ilep ok
1707 2 I3 bim ilep ok
1620 6 I3 anual ilepal ok
1623 7 I3 bim ilepal ok
1624 8 I3 bim ilepal ok
1640 11 I3 bim ilepal ok
1647 12 I3 bim ilpal ok
1661 15 I3 bim ilepal ok
1622 1 ME anual materiales
1725 2 ME anual 2016 materiales
1735 5 I3 bim ilepal pagado
1757 9 I2 bim ilepal pagado 
1767 10 I1 bim ilepal pagado





select '100701187535461C73065' as numero_control
into ingresos.dbo.numero_control




select a.numero_control, b.municipio_estatal,c.nombre as Municipio_Estatal
--, b.municipio_federal
from  numero_control as a
left join sirref_co_datos as b on a.numero_control=b.Numero_Control 
and b.numero_emision='18285'
left join cat_municipios as c on 
b.municipio_estatal=c.clave
order by Numero_Control 




select Numero_Emision  
from sirref_co_datos
where numero_control in (select Numero_Control from ingresos.dbo.numero_control)



ALR	RFC	Numero_Control	Numero_Emision	Movimiento	Status	SubStatus	Fecha_Impresion	Fecha_Asignacion	Fecha_Citatorio	Fecha_No_Localizado	Fecha_Entrega	Fecha_Vencimiento	Fecha_Ultimo_Movimiento	Gastos_Ejecucion	Multa_Efectiva	Multa_Programada	Usuario_Cancelacion	Usuario_Impresion	ALR	RFC	Numero_Control	Numero_Emision	Nombre_Contribuyente	Calle	Num_Exterior	Num_Interior	Colonia	Localidad	Referencia	Medio_Envio	Fecha_Generacion	Codigo_Postal	Municipio_Federal	Municipio_Estatal	Numero_Factura
77	HESP820218TP7	102112177437150C77042	18284	R1	E	C	2018-01-09 10:41:07.870	NULL	2018-01-16 00:00:00.000	NULL	2018-01-17 00:00:00.000	2018-02-08 00:00:00.000	2018-01-19 15:12:49.413	NULL	NULL	NULL	NULL	gpina	77	HESP820218TP7	102112177437150C77042	18284	PAUL MOISES HERNANDEZ SANCHEZ	SAN SALVADOR	474	SIN NUMERO	FRACCIONAMIENTO FLAMBOYANES	CHETUMAL	ENTRE CALLE SICILIA Y CALLE PALERMO, A CUATRO PREDIOS DE LA CALLE PALERMO	06	NULL	77034	4  	01	NULL
																																			
																																			
																																			
																																			
77	AACC770608TC0	100412177344405C77042	17283	R1	N	B	05/12/2017 13:09	NULL	NULL	00:00.0	NULL	NULL	09:02.7	NULL	NULL	NULL	NULL	co_municipio																	




acompletar el ihospedaje pto morelos





fundamento nomina mensual

  <!--
  EN VIRTUD DE LA PRESENTACIÓN EXTEMPORÁNEA DE LA DECLARACIÓN MENSUAL DEL IMPUESTO SOBRE NÓMINAS 
  CORRESPONDIENTE AL PERIODO <b><?=strtoupper(FncNombreMes( $moroso['Periodo_Inicial'] ))?>,
   REALIZADA EN FECHA <b><?=strtoupper($fecha_declarado)?></b>,  ORIGINADO DEL REQUERIMIENTO CON NÚMERO DE 
  FOLIO <b> <?=$moroso['Folio_Impresion']?></b>  QUE LE FUE DEBIDAMENTE NOTIFICADO EL 
  DÍA <b><?=strtoupper($moroso['Fecha_Entrega'])?></b>, CON 
  FUNDAMENTO EN LOS ARTÍCULOS 16 PÁRRAFO PRIMERO Y 22 DE LA CONSTITUCIÓN POLÍTICA DE LOS ESTADOS 
  UNIDOS MEXICANOS; 24 PÁRRAFO PRIMERO Y 29 DE LA CONSTITUCIÓN POLÍTICA DEL ESTADO LIBRE Y 
  SOBERANO DE QUINTANA ROO; 27 FRACCIONES IX Y XIII, 38 FRACCIÓN II, 59 PRIMER PÁRRAFO, 60, 
  61 Y 65  FRACCION(ES)<?=$Fraccion?>  Y 68 DEL CÓDIGO FISCAL DEL ESTADO DE QUINTANA ROO; 2 
  FRACCIÓN <?=$Fraccion?> DEL REGLAMENTO DEL CÓDIGO FISCAL DEL ESTADO DE QUINTANA ROO; 
  ARTÍCULOS 1, 3, 19 FRACCIÓN III, 21 Y  33 FRACCIONES XVI Y XVII  DE LA LEY ORGÁNICA DE LA 
  ADMINISTRACIÓN PÚBLICA DEL ESTADO DE QUINTANA ROO; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 
  14 Y 16-BIS DE LA LEY DEL IMPUESTO SOBRE NÓMINAS DEL ESTADO DE QUINTANA ROO; ARTÍCULOS 4 PUNTOS 
  1.1, 1.1.1, 1.1.1, <?=$Punto?>, 15 FRACCIÓN <?=$Articulo18?>, 16, 17 Y CON 
  LAS FACULTADES QUE ME CONFIERE EL ARTICULO 18 FRACCIONES I, IV, VI, VII, XII, XIII, XXII Y XXVI 
  DEL REGLAMENTO INTERIOR DE LA SECRETARÍA DE FINANZAS Y PLANEACIÓN DEL ESTADO, TODAS LEGISLACIONES 
  VIGENTES EN ESTA ENTIDAD FEDERATIVA; SE DETERMINA QUE ES PROCEDENTE IMPONERLE UNA MULTA POR LA 
  CANTIDAD DE <b>$<?=number_format($multa,2).' '.$multaTexto?></b> EQUIVALENTE A CUATRO VECES EL VALOR 
  DIARIO DE LA UNIDAD DE MEDIDA Y ACTUALIZACIÓN VIGENTE PREVISTA EN EL ARTÍCULO 86 FRACCIÓN VIII DEL 
  CÓDIGO FISCAL DEL ESTADO DE QUINTANA ROO EN VIGOR, POR INFRINGIR LO DISPUESTO EN EL ARTÍCULO 85 
  FRACCIÓN VII DEL CÓDIGO CITADO. 

DE LO ANTERIOR, SE HACE DE SU CONOCIMIENTO QUE DE CONFORMIDAD CON LO DISPUESTO EN LOS ARTÍCULOS 60 
SEGUNDO PÁRRAFO DEL CÓDIGO FISCAL DEL ESTADO DE QUINTANA ROO, SE LE OTORGA UN PLAZO DE TREINTA  DÍAS 
HÁBILES, CONTADOS A PARTIR DEL DIA SIGUIENTE EN QUE SURTA EFECTOS LA PRESENTE NOTIFICACIÓN PARA ACUDIR 
A LIQUIDAR DICHO ADEUDO EN LA OFICINA RECAUDADORA DE RENTAS SITA EN <?if ($Oficina_Localidad=="PLAYA DEL CARMEN")
    {
        echo $Oficina_Domicilio=  "CALLE 1A. SUR ENTRE 10 Y 15 SUR";
        
    }
    else
    {
    echo $Oficina_Domicilio;
    }?>,
    <!--
DE LA CIUDAD DE <?php echo $moroso['Nombre_Localidad'];?>; APERCIBIÉNDOLO QUE DE NO PAGARSE EN EL PLAZO CONCEDIDO 
LA MISMA SE ACTUALIZARÁ Y ADEMÁS DEBERÁ PAGAR RECARGOS POR FALTA DE PAGO OPORTUNO, SEGÚN LO ESTABLECEN 
LOS ARTICULOS 20, 22 Y 60 DEL CÓDIGO REFERIDO Y SE PROCEDERÁ AL INICIO DEL PROCEDIMIENTO ADMINISTRATIVO 
DE EJECUCIÓN CON FUNDAMENTO EN LOS ARTÍCULOS 136, 138 Y 144 DEL CÓDIGO FISCAL DEL ESTADO DE QUINTANA ROO, 
INCLUYENDO EL EMBARGO O CLAUSURA DE ESTABLECIMIENTO.

EL PAGO DE LA MULTA  NO LO LIBERA DEL CUMPLIMIENTO  DE LA(S) OBLIGACION(ES) QUE DIO O DIERON ORIGEN  
A ESTA SANCIÓN POR LO QUE DEBERA CUMPLIRLA DE FORMA INMEDIATA Y CON SUJECIÓN AL ARTÍCULO 129 ÚLTIMO 
PÁRRAFO DEL MULTICITADO CÓDIGO FISCAL DEL ESTADO DEBERÁ PAGAR LA CANTIDAD 
DE  <b>$<?=number_format($GE,2).' '.$GastosEjecucionTexto?></b> EQUIVALENTE A 
SIETE VECES EL VALOR DIARIO DE LA UNIDAD DE MEDIDA Y ACTUALIZACIÓN VIGENTE, POR CONCEPTO DE HONORARIOS 
DE LA PRESENTE NOTIFICACIÓN. 

CON FUNDAMENTO EN LOS ARTÍCULOS 112 FRACCIÓN III, 113 Y 114 DEL CÓDIGO FISCAL DEL ESTADO DE QUINTANA ROO, 
CONTRA LA PRESENTE MULTA, PROCEDERÁ EL RECURSO DE REVOCACIÓN DENTRO DEL TÉRMINO DE 30 DÍAS SIGUIENTES A 
AQUEL EN QUE HAYA SURTIDO EFECTOS SU NOTIFICACIÓN. ASIMISMO, CON FUNDAMENTO EN LOS ARTÍCULOS 100, 118 Y 
187 DEL CÓDIGO DE JUSTICIA ADMINISTRATIVA DEL ESTADO DE QUINTANA ROO, PODRÁ ACUDIR ANTE EL TRIBUNAL DE 
JUSTICIA ADMINISTRATIVA DEL ESTADO DE QUINTANA ROO A DEMANDAR LA NULIDAD DE LA MULTA A TRAVÉS DEL JUICIO 
CONTENCIOSO ADMINISTRATIVO, DENTRO DE LOS 15 DÍAS SIGUIENTES AL QUE SURTA EFECTOS SU NOTIFICACIÓN.

    ->                               

colores de colorantes
amarillo huevo 
amarillo limon
azul celeste
azul rey
azul rey
cafe
carne
fucsia
naranja
negro
purpura
morado delicado
super rojo
verde agua
verde hoja
verde limon
rosa delicado



USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_Hospedaje]

SELECT	'Return Value' = @return_value

GO



esta es la buena emisiones multianual
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_CPY_nomina_emisiones_nuevas]
@Limite ='10', 
@Clave_Obligacion ='010103', 
@Municipio ='03', 
@ClavePeriodicidad ='02', 
@EjercicioFiscal ='2014', 
@Mes ='01', 
@MesFinal = '12', 
@ClaveLocalidad = '0', 
@ClaveZona = '0', 
@ClaveOficina = '01', 
@Anio ='2014', 
@AnioFinal ='2017', 
@Numero_Emision = '1801', 
@Cont_No_Localizados = '0', 
@Total_En_Riesgo = '0'

SELECT	'Return Value' = @return_value

GO

notepad++




R 192
G 160
B 98
Espero Que Sea Lo Que Pides
Salud


eliminar los r2 de la reimpresion
select *
from obl_detalle_documentos 
where Folio_Impresion in (
select Folio_Impresion  from obl_detalle_documentos 
where Numero_Emision ='1816' and Municipio='02' and Oficina='01' 
and Movimiento='I1' and Status='B')
and Municipio='02' and Oficina='01' 
and Movimiento='R2'   and Status='I'



delete from obl_detalle_documentos 
where Folio_Impresion in (
select Folio_Impresion  from obl_detalle_documentos 
where Numero_Emision ='1816' and Municipio='02' and Oficina='01' 
and Movimiento='I1' and Status='B')
and Municipio='02' and Oficina='01' 
and Movimiento='R2'   and Status='I'







De: oficinacfarmacias <oficinacfarmacias@cfarmacias.com.mx>
Enviado: lunes, 25 de junio de 2018 05:38 p. m.
Para: lizardi_w@hotmail.com
Asunto: Datos bancarios para devolución
 


Buena tarde:

Por este medio le solicito los siguientes datos para poder realizarle la devolución pendiente:

Razón Social(a nombre de quien esta la cuenta): LILI LIZARDI RODRIGUEZ
RFC: LIRL830804SI8
Banco: BANORTE
Sucursal: 0742 CHETUMAL QROO
Cuenta Clabe: 072690002838004096 
Correo: LIZARDI_W@HOTMAIL.COM
Contacto :9837328128
Telefono:9837328128

Atentamente:
Sindi Cervantes Ventura.

Cfarmacias
Tel.(999)9240964


072690002838004096 clabe interbancaria
clave de acceso telefonico banorte

4 2 0




query sacar multas a extemporaneas a generar de los formatos multiples

insert into obl_detalle_documentos
(municipio, oficina,numero_emision,rfc,Numero_Serie, Movimiento, folio_impresion, 
fecha_ultimo_movimiento)
--checar si el establecimiento debe  varios periodos y si se estan generando varias multas
select 
 v.municipio,
v.oficina,
v.numero_emision,
v.rfc,
v.Numero_Serie,
v.Movimiento,
v.Folio_Impresion,
GETDATE()
 from (
SELECT 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
--min(a.Movimiento) Movimiento,
a.Folio_Impresion,
GETDATE() as fecha_ultimo_movimiento,
min(a.Status) as Estatus,-- min(x.Movimiento) as Mov2 ,
min(a.usuario_cancelacion) as Usuario_Cancelacion, min(a.Fecha_Impresion) as Fecha_Impresion, 
min(b.Fecha_Emision) as Fecha_Emision,
min(c.Fecha_Declarado) as Fecha_Declarado, min(a.fecha_entrega) as fecha_entrega,
min(c.No_Operacion) as No_Operacion,  
 MIN(f.Mes) as Mes, MIN(f.Anio_Moroso ) as Anio_Moroso, 
MIN (f.Clave_Obligacion ) as Clave_Obligacion
,(select Clave_Movimiento    
from dbo.obl_movimientos_multiples_ME
where Mes_Moroso=Cast(f.mes As Int) and Anio =Cast(f.Anio_Moroso As Int)) as Movimiento
FROM         obl_detalle_documentos AS a 
INNER JOIN   obl_control_emisiones AS b ON 
a.Numero_Emision = b.Numero_Emision 
AND a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina 
INNER JOIN obl_detalle_sucursales AS f ON a.Municipio = f.Municipio 
AND a.Oficina = f.Oficina 
AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
LEFT  JOIN   obl_obligacion_vigilable_presentada AS c 
ON f.RFC = c.RFC AND f.Mes=c.Mes_Inicial AND 
f.Anio_Moroso = c.Anio_Inicial 
AND f.Clave_Periodicidad = c.Tipo_Periodo 
AND b.Clave_Obligacion = c.Clave_Obligacion
WHERE     (c.RFC IS NOT NULL) and 
 b.Clave_Obligacion in ('010103')
and b.Clave_Periodicidad ='27'
AND (a.Movimiento = 'R1') 
AND (a.Fecha_Entrega IS NOT NULL)
--and a.RFC=' BSM970519DU8'
and a.Municipio='01'
and Cast(c.Fecha_Declarado As Date)>Cast(a.Fecha_entrega As Date)
group by a.Numero_Emision, a.Folio_Impresion, f.Mes,f.Anio_Moroso                
) as v 
left join obl_detalle_documentos l
on  v.Numero_Emision=l.Numero_Emision 
and v.RFC=l.rfc
and v.municipio =l.Municipio 
and v.oficina=l.Oficina 
and v.Folio_Impresion =l.Folio_Impresion 
and v.Movimiento=l.Movimiento 
where l.Folio_Impresion is null


CON ESTAS ELIMINE LOS DOCUMENTOS DE SOLI EQUIVOCADOS
   DELETE obl_detalle_documentos 
   WHERE RFC IN (
   SELECT RFC
    from obl_control_emisiones AS A
    join obl_detalle_documentos AS B ON A.Municipio=B.Municipio AND A.Oficina =B.Oficina 
    AND A.Numero_Emision=B.Numero_Emision 
    where  a.Clave_Periodicidad ='27' and A.Municipio not in ('01') 
    AND A.Oficina='01'
    AND B.Movimiento='I1'
    AND Status NOT IN ('I')
    )
    AND 
    Numero_Emision='1825' AND Municipio='08'
    AND Movimiento='I1'





Insertar multas de incumplimiento 
insert obl_detalle_documentos
   (municipio,Oficina,Numero_Emision,RFC,Numero_Serie, Movimiento,Folio_Impresion, Status, Fecha_Ultimo_Movimiento  )
 select 
 v.municipio,
v.oficina,
v.numero_emision,
v.rfc,
v.Numero_Serie,
v.Movimiento,
v.Folio_Impresion,
'B' as status,
GETDATE()
 from (
SELECT 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
--min(a.Movimiento) Movimiento,
a.Folio_Impresion,
GETDATE() as fecha_ultimo_movimiento,
min(a.Status) as Estatus,-- min(x.Movimiento) as Mov2 ,
min(a.usuario_cancelacion) as Usuario_Cancelacion, min(a.Fecha_Impresion) as Fecha_Impresion, 
min(b.Fecha_Emision) as Fecha_Emision,
 MIN(f.Mes) as Mes, MIN(f.Anio_Moroso ) as Anio_Moroso, 
MIN (f.Clave_Obligacion ) as Clave_Obligacion
,(select Clave_Movimiento    
from dbo.obl_movimientos_multiples
where Mes_Moroso=Cast(f.mes As Int) and Anio =Cast(f.Anio_Moroso As Int)) as Movimiento
FROM         obl_detalle_documentos AS a 
INNER JOIN   obl_control_emisiones AS b ON 
a.Numero_Emision = b.Numero_Emision 
AND a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina 
INNER JOIN obl_detalle_sucursales AS f ON a.Municipio = f.Municipio 
AND a.Oficina = f.Oficina 
AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
WHERE    -- (c.RFC IS NOT NULL) and 
 b.Clave_Obligacion in ('010103')
and b.Clave_Periodicidad ='27'
AND (a.Movimiento = 'R1') 
AND (a.Fecha_Entrega IS NOT NULL)
and a.RFC=' CEC960902VC0'
and a.Municipio='01'
and a.Fecha_Vencimiento<GETDATE()
group by a.Numero_Emision, a.Folio_Impresion, f.Mes,f.Anio_Moroso                
) as v 
left join obl_detalle_documentos l
on  v.Numero_Emision=l.Numero_Emision 
and v.RFC=l.rfc
and v.municipio =l.Municipio 
and v.oficina=l.Oficina 
and v.Folio_Impresion =l.Folio_Impresion 
and v.Movimiento=l.Movimiento 
where l.Folio_Impresion is null
 

//cambiar el usuario al recaudador de pto morelos
select * 
from seg_permisos  
where opcion='01_04_13_01'
select * 
from seg_usuarios_grupos as a join seg_usuarios as b
on a.Usuario =b.Usuario 
where a.Grupo='obl_generar_ref'
and b.Municipio='11'


este es el bueno para insertar multas por incumplimiento  de los multiples

Insertar multas de incumplimiento 
insert obl_detalle_documentos
 (municipio,Oficina,Numero_Emision,RFC,Numero_Serie, Movimiento,Folio_Impresion, Status, Fecha_Ultimo_Movimiento  )
select 
 p.municipio,
p.oficina,
p.numero_emision,
p.rfc,
p.Numero_Serie,
p.Movimiento,
p.Folio_Impresion,
p.status,
p.fecha_ultimo_movimiento
 from ( select 
 v.municipio,
v.oficina,
v.numero_emision,
v.rfc,
v.Numero_Serie,
v.Movimiento,
v.Folio_Impresion,
'B' as status,
GETDATE() as fecha_ultimo_movimiento
 from (
SELECT 
min(a.municipio) as municipio,
min(a.Oficina) as oficina,
min (a.numero_emision) as numero_emision,
MIN(a.rfc) as rfc,
'00' as Numero_Serie,
--min(a.Movimiento) Movimiento,
a.Folio_Impresion,
GETDATE() as fecha_ultimo_movimiento,
min(a.Status) as Estatus,-- min(x.Movimiento) as Mov2 ,
min(a.usuario_cancelacion) as Usuario_Cancelacion, min(a.Fecha_Impresion) as Fecha_Impresion, 
min(b.Fecha_Emision) as Fecha_Emision,
 MIN(f.Mes) as Mes, MIN(f.Anio_Moroso ) as Anio_Moroso, 
MIN (f.Clave_Obligacion ) as Clave_Obligacion
,(select Clave_Movimiento    
from dbo.obl_movimientos_multiples
where Mes_Moroso=Cast(f.mes As Int) and Anio =Cast(f.Anio_Moroso As Int)) as Movimiento
FROM         obl_detalle_documentos AS a 
INNER JOIN   obl_control_emisiones AS b ON 
a.Numero_Emision = b.Numero_Emision 
AND a.Municipio = b.Municipio 
AND a.Oficina = b.Oficina 
INNER JOIN obl_detalle_sucursales AS f ON a.Municipio = f.Municipio 
AND a.Oficina = f.Oficina 
AND a.Numero_Emision = f.Numero_Emision AND a.RFC = f.RFC 
WHERE    -- (c.RFC IS NOT NULL) and 
 b.Clave_Obligacion in ('010103')
and b.Clave_Periodicidad ='27'
AND (a.Movimiento = 'R1') 
AND (a.Fecha_Entrega IS NOT NULL)
--and a.RFC  not in (' SPR0811104I4')--,' SPR0811104I4')--,'DAMB501123QL3')
and a.Municipio='01'
and a.Status  in ('V','E')
and a.Fecha_Vencimiento<GETDATE()
group by a.Numero_Emision, a.Folio_Impresion, f.Mes,f.Anio_Moroso                
) as v 
left join obl_detalle_documentos l
on  v.Numero_Emision=l.Numero_Emision 
and v.RFC=l.rfc
and v.municipio =l.Municipio 
and v.oficina=l.Oficina 
and v.Folio_Impresion =l.Folio_Impresion 
and v.Movimiento=l.Movimiento 
where l.Movimiento  is null ) as p 
left join
obl_detalle_documentos as o on p.numero_emision=o.Numero_Emision 
and p.rfc=o.RFC 
and p.municipio =o.Municipio 
and p.oficina =o.Oficina 
and p.Folio_Impresion =o.Folio_Impresion 
and o.Movimiento='I1'
where o.Movimiento is null --and p.rfc=' STR081211FS5' and p.Movimiento='1G'
group by p.municipio, p.oficina, p.numero_emision, p.rfc, p.Numero_Serie,
p.Movimiento, p.Folio_Impresion, p.status, p.fecha_ultimo_movimiento 


SP PARA SABER CUAL ES EL MUNICIPIO DEL NUMERO DE CONTROL
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCO_Municipio_Sirref]
		@NOSCONTROL=N'100404188122751C77042,100404188119276C77042'

SELECT	'Return Value' = @return_value

GO





emisiones multiples hospedaje
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_CPY_nomina_emisiones_nuevas]
@Limite ='10000', 
@Clave_Obligacion ='010104', 
@Municipio ='01', 
@ClavePeriodicidad ='02', 
@EjercicioFiscal ='2014', 
@Mes ='01', 
@MesFinal = '12', 
@ClaveLocalidad = '0', 
@ClaveZona = '0', 
@ClaveOficina = '01', 
@Anio ='2014', 
@AnioFinal ='2017', 
@Numero_Emision = '1801', 
@Cont_No_Localizados = '0', 
@Total_En_Riesgo = '0'

SELECT	'Return Value' = @return_value

GO



--------------------------

sp eladio


--Parametros para la detección
Declare @Municipio varchar(2) = '07'
Declare @Oficina   int        = ''

Declare @An_Construccion int  = '2014'
Declare @Tipo_Persona int     = 0--1 fisico  2 moral
Declare @Clase int            = 0--select * from tenencias.dbo.ten_cat_clases
Declare @Tipo_Servicio int    = 0--select * from tenencias.dbo.ten_cat_servicios
Declare @Uso int              = 0--select * from tenencias.dbo.ten_cat_usos
Declare @Localidad int        = 0--select * from tenencias.dbo.ten_cat_localidades
Declare @Placa varchar(7)     = ''-- 'UVA1034'
Declare @Rfc varchar(13)      = ''

Declare @Filtro varchar(max)  = ''
Declare @Emisiones Table (Serie varchar(max),An_Construccion int, Fecha_Factura datetime) --Aquí incluir los campos necesarios

If @An_Construccion != 0  Begin Set @Filtro = @Filtro+ ' An_Construccion = '+Convert(varchar(4),@An_Construccion)+' And ' End
If @Tipo_Persona    != 0  Begin Set @Filtro = @Filtro+ ' Tipo_Persona    = '+Convert(varchar(1),@Tipo_Persona)+' And '    End
If @Clase           != 0  Begin Set @Filtro = @Filtro+ ' Clase           = '+Convert(varchar(2),@Clase)+' And '           End
If @Tipo_Servicio   != 0  Begin Set @Filtro = @Filtro+ ' Tipo_Servicio   = '+Convert(varchar(2),@Tipo_Servicio)+' And '   End
If @Uso             != 0  Begin Set @Filtro = @Filtro+ ' Uso             = '+Convert(varchar(2),@Uso)+' And '             End
If @Localidad       != 0  Begin Set @Filtro = @Filtro+ ' Localidad       = '''+@Localidad+''' And '                       End
If @Placa           != '' Begin Set @Filtro = @Filtro+ ' Placa           = '''+@Placa+''' And '                           End
If @Rfc             != '' Begin Set @Filtro = @Filtro+ ' Rfc             = '''+@Rfc+''' And '                             End

--5 electrico  y menor a 2009 se pueden requerir dspues del 2009 los electricos ya no pagan tenencia
--situacion critica padron lo indica
--remolque no paga
--13 años para atras desde el año actual
--
If Len(RTrim(LTrim(@Filtro))) != 0
Begin  
   Set @Filtro = SubString( @Filtro,1,Len( @Filtro )-4 )+ ' And (Situacion_Crit IN(0,7) Or Situacion_Crit Is Null) And (Exento_Tenencia = 0 Or Exento_Tenencia Is Null) And Clase Not In (3) And Municipio = '''+@Municipio+''' And (Estatus <> 9 Or Estatus Is Null) '
   Set @Filtro = @Filtro+' And ( Case When Fecha_Factura Is Null Then 0 Else Year(Fecha_Factura) End >= Year(GetDate())-13 Or Case When An_construccion Is Null Then 0 Else An_Construccion End >= Year(GetDate())-13 ) '
   Set  @Filtro = @Filtro+'And ((Tipo_Combustible = 5 And An_Construccion < 2009) or Tipo_Combustible <> 5 ) '
   Set @Filtro = 'Select Serie,An_Construccion,Fecha_Factura From tenencias.dbo.ten_Padron_Vehicular where '+@Filtro
   --print @Filtro   
   Insert into @Emisiones Exec(@Filtro)
   
End

--Select * From @Emisiones

Declare @Serie             varchar(20) = ''
Declare @Fecha_Factura     datetime
Declare @Ejercicio_Inicial int  = Year(GetDate())-4 --Están Solicitando 2014-2018, aunque el sistema calcula Ejercicio Actual y 5 anños Anteriores
Declare @Ejercicio_Final   int  = Year(GetDate())

Declare @Emision_Final Table (Serie varchar(max),Ejercicio int)

DECLARE vend_cursor CURSOR FOR Select * From @Emisiones

OPEN vend_cursor

FETCH NEXT FROM vend_cursor INTO @Serie,@An_Construccion,@Fecha_Factura

WHILE @@FETCH_STATUS = 0  
BEGIN  
   Declare @Ejercicio         int  = @Ejercicio_Inicial
   WHILE @Ejercicio <= @Ejercicio_Final
   BEGIN             
      Declare @PASA_SN int = 0
      If @An_Construccion + 9 >= @Ejercicio_Inicial
      Begin
           If @Ejercicio >= @An_Construccion And @Ejercicio <= @An_Construccion +9
           Begin
              Set @PASA_SN = 1
           End
      End      
      If @Ejercicio < Year(@Fecha_Factura)
      Begin
         Set @PASA_SN = 0
      End
      If @PASA_SN = 1
 
           
      Begin       
         If (Select Count(*) From (
         Select Numero_Serie as Serie from ingresos.dbo.obl_detalle_vehiculo where Numero_Serie=@Serie AND Anio_moroso=@Ejercicio --Requerimientos
         Union
         Select tp.Serie as Serie FROM tenencias.dbo.ten_prescripciones as tp Where tp.Estatus in ('A') and tp.Serie= @Serie and tp.Ejercicio=@Ejercicio and tp.Transaccion in ('TEN') --Prescripciones
         Union      
         Select hp.Serie as Serie From tenencias.dbo.ten_Historico_Pagos as hp where (hp.Estatus in ('0','1') or hp.Estatus is null) and hp.Serie= @Serie and hp.Ejercicio_Fiscal=@Ejercicio and hp.Transaccion in ('TEN','UTV') --Historico de Cobranza
         Union
         Select cc.Serie From ingresos.dbo.cob_cobros as cc 
         Inner join ingresos.dbo.cob_desglose as cd on cd.No_Operacion=cc.No_Operacion and cd.Ejercicio_Fiscal=@Ejercicio and cd.Clave_Concepto IN ('TEN','UTV') 
         Where cc.Estatus in ('A','T','W') and cc.Serie= @Serie --Cobranza
         )t )= 0 
         Begin
            Insert into @Emision_Final Select @Serie,@Ejercicio
         End
      End
  Set @Ejercicio = @Ejercicio+1
   END
   
   FETCH NEXT FROM vend_cursor INTO @Serie,@An_Construccion,@Fecha_Factura
      
END   
CLOSE vend_cursor;  
DEALLOCATE vend_cursor;  

Select * From @Emision_Final Order by Serie,Ejercicio



--poner esto antes de imprimir el listado para que solo me imprima los que tienen algun valor en el numero de establecimiento
este es el caso de los morosos multiples que me imprimian espacios vacios
 if ($sucursal[$i]['Numero_Establecimiento'])
{
imprimir en el formato
}

multa ext ME

SELECT a.Municipio, a.Oficina,a.Movimiento, a.Clave_Obligacion, a.Clave_Periodicidad, 
a.Periodo_Inicial, a.Periodo_Final, a.Numero_Emision, a.Folio_Impresion, a.RFC, 
a.Ejercicio_Fiscal, a.Anio_Moroso, min(a.No_Operacion) as No_Operacion, 
max(convert(varchar,a.Fecha_Declarado ,103)) as Fecha_Declarado 
FROM (
SELECT documento.Municipio, documento.Oficina, 
documento.Movimiento, emision.Clave_Obligacion, 
emision.Clave_Periodicidad, emision.Periodo_Inicial, 
emision.Periodo_Final, documento.Numero_Emision, 
documento.Folio_Impresion, documento.RFC, emision.Ejercicio_Fiscal, 
emision.Anio_Moroso, vig.No_Operacion , vig.Fecha_Declarado, ME.Mes_Moroso,ME.Anio  
FROM obl_detalle_documentos AS documento 
JOIN obl_control_emisiones AS emision ON documento.Municipio = emision.Municipio 
AND documento.Oficina = emision.Oficina AND documento.Numero_Emision = emision.Numero_Emision 
JOIN obl_datos_generales dat ON documento.Municipio=dat.Municipio AND documento.Oficina=dat.Oficina 
AND documento.Numero_Emision=dat.Numero_Emision AND documento.Folio_Impresion=dat.Folio_Impresion 
JOIN obl_movimientos_multiples_ME AS ME on documento.Movimiento=ME.Clave_Movimiento 
join obl_obligacion_vigilable_presentada as vig on 
ME.Mes_Moroso =vig.Mes_Inicial 
and ME.Anio =vig.Anio_Inicial 
and emision.Clave_Obligacion=vig.Clave_Obligacion 
and documento.RFC=vig.RFC 

WHERE documento.Numero_Emision='1825' 
and documento.Folio_Impresion='15057'
and vig.Tipo_Periodo ='02' and emision.Clave_Periodicidad='27' and documento.Movimiento 
in (select clave_movimiento from obl_movimientos_multiples_ME) 
AND documento.Status = 'B' 
AND documento.Municipio = '08' 
AND documento.Oficina = '01' 
AND emision.Clave_Obligacion = '010103' ) 
as a 
LEFT JOIN obl_detalle_documentos AS b ON a.Municipio = b.Municipio AND a.Oficina = b.Oficina 
AND a.Numero_Emision = b.Numero_Emision AND a.Folio_Impresion=b.FOLIO_IMPRESION 
AND b.movimiento='R1' AND (b.Fecha_Entrega is not null and b.Fecha_Vencimiento 
is not null ) where b.Movimiento is not null 
group by a.Municipio, a.Oficina,a.Movimiento, a.Clave_Obligacion, 
a.Clave_Periodicidad, a.Periodo_Inicial, a.Periodo_Final, a.Numero_Emision, 
a.Folio_Impresion, a.RFC, a.Ejercicio_Fiscal, a.Anio_Moroso 
order by Folio_Impresion

sep 15
3500
	1000 jfa
	150 cdy
	200 agua
	216 maquillaje
	200 celular
	400 celular
200 mau
300 banco
	200 gasolina
	100 hernan




elect top 10 Referencia  
from dec_juegos 
select top 10 * from obl_obligacion_vigilable_presentada where Clave_Obligacion='010112'

--select top 10 * from cob_cobros as a
--where SUBSTRING ( a.Referencia,1,2) ='30'

select a.rfc, '' as numero_serie, 
'' as REC, b.Establecimiento as Numero_Establecimiento,  
'010112' as clave_obligacion,
year(a.periodo_inicial) as Anio_Inicial, 
month(a.periodo_inicial) as Mes_Inicial, 
a.periodo_inicial, year(a.periodo_final) as Anio_Final, month(a.periodo_final) as Mes_Final,
a.Periodo_Final as Periodo_Final,
fecha_pago as Fecha_declarado, 
a.No_Operacion as Numero_Operacion, a.Periodicidad, 'T' as Estado, 
case when (a.Tipo_Declaracion='N') then 'Mn' 
when (a.Tipo_Declaracion='C') then 'Co' 
end as Tipo_Declaracion, 
year(a.Fecha_Pago  )as Ejercicio_Fiscal, 
'' as Fuente_Informacion, '' as Oficina, '' as Numero_Establecimiento_Anterior 
from cob_cobros as a
join cob_detalle as b 
on a.No_Operacion=b.No_Operacion 
where SUBSTRING ( a.Referencia,1,2) ='30'
and a.Estatus ='A'

select *--YEAR(Periodo_Inicial ) 
from cob_cobros 





USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCO_desglose_morosos_tenencias]
		@Municipio=N'07'
SELECT	'Return Value' = @return_value

GO


-- cnocer la marca de un vehiculo
Select tenencias.dbo.ften_Marca('9BWCC05WX6T053741') as Marca





USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCO_carga_morosos_tenencias]
		@Municipio = N'07'

SELECT	'Return Value' = @return_value

GO

-- sp [paCO_carga_morosos_tenencias]


USE [ingresos]
GO
/****** Object:  StoredProcedure [dbo].[paCO_desglose_morosos_tenencias]    Script Date: 09/24/2018 11:14:24 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Lilí Lizardi
-- Create date: 03/07/2013
-- Carga la emisión de los contribuyentes morosos estatales
-- =============================================
ALTER PROCEDURE [dbo].[paCO_desglose_morosos_tenencias]
	-- Add the parameters for the stored procedure here
		--@Limite int,
		--@Clave_Obligacion varchar(20),
		@Municipio varchar(2)
		/*@ClavePeriodicidad varchar(2), 
		@EjercicioFiscal varchar(4),
		@Mes varchar(2),
		@MesFinal varchar (2),
		@ClaveLocalidad varchar(10),
		@ClaveZona varchar(10),
		@ClaveOficina varchar(10),
		@Anio varchar(4),
		@Numero_Emision varchar(10),
		@Cont_No_Localizados int,
		@Total_En_Riesgo int*/
		
		--@Porcentaje_No_Loc int
		
		
		
		
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
  
	SET NOCOUNT ON;
	SET CONCAT_NULL_YIELDS_NULL ON
	SET ANSI_PADDING ON
	SET ANSI_WARNINGS ON

    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
    BEGIN TRY
	--Declaramos e inicializamos
        BEGIN TRANSACTION
        
        
        

		
--Parametros para la detección
--Declare @Municipio varchar(2) = '07'
--SET @Municipio = '07';
DECLARE @Folio_Impresion BIGINT;
Declare @Oficina   int        = ''

Declare @An_Construccion int  = '2014'
Declare @Tipo_Persona int     = 0--1 fisico  2 moral
Declare @Clase int            = 0--select * from tenencias.dbo.ten_cat_clases
Declare @Tipo_Servicio int    = 0--select * from tenencias.dbo.ten_cat_servicios
Declare @Uso int              = 0--select * from tenencias.dbo.ten_cat_usos
Declare @Localidad int        = 0--select * from tenencias.dbo.ten_cat_localidades
Declare @Placa varchar(7)     = ''-- 'UVA1034'
Declare @Rfc varchar(13)      = ''


Declare @Filtro varchar(max)  = ''
Declare @Emisiones Table (Serie varchar(max),An_Construccion int, Fecha_Factura datetime) --Aquí incluir los campos necesarios
SET @Folio_Impresion=0;



CREATE TABLE #obl_datos_vehiculo(
	Municipio VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	Numero_Emision VARCHAR (4) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
	NUMERO_SERIE VARCHAR(30) COLLATE SQL_Latin1_General_CP1_CI_AS,
	Folio_Impresion BIGINT,
	NOMBRE_CONTRIBUYENTE VARCHAR(200) COLLATE SQL_Latin1_General_CP1_CI_AS,
	APELLIDO_PATERNO VARCHAR(200) COLLATE SQL_Latin1_General_CP1_CI_AS,
	APELLIDO_MATERNO VARCHAR(200) COLLATE SQL_Latin1_General_CP1_CI_AS,
	LOCALIDAD VARCHAR(200) COLLATE SQL_Latin1_General_CP1_CI_AS,
	DOMICILIO_CALLE VARCHAR(500) COLLATE SQL_Latin1_General_CP1_CI_AS,
	DOMICILIO_NUMERO VARCHAR(500) COLLATE SQL_Latin1_General_CP1_CI_AS,
	DOMICILIO_COLONIA VARCHAR(500) COLLATE SQL_Latin1_General_CP1_CI_AS,
	DOMICILIO_UBICACION VARCHAR(500) COLLATE SQL_Latin1_General_CP1_CI_AS,
	DOMICILIO_CODIGO_POSTAL VARCHAR(500) COLLATE SQL_Latin1_General_CP1_CI_AS,
	DOMICILIO_EJERCICIO_FISCAL VARCHAR(500) COLLATE SQL_Latin1_General_CP1_CI_AS,
	PAGADO VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
	CLAVE_OBLIGACION VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
	CLAVE_PERIODICIDAD VARCHAR(6) COLLATE SQL_Latin1_General_CP1_CI_AS,
	PLACA VARCHAR(20) COLLATE SQL_Latin1_General_CP1_CI_AS,
	MODELO SMALLINT,
	MARCA VARCHAR(200) COLLATE SQL_Latin1_General_CP1_CI_AS,
	SUBMARCA VARCHAR(200) COLLATE SQL_Latin1_General_CP1_CI_AS,
	NUMERO_MOTOR VARCHAR(200) COLLATE SQL_Latin1_General_CP1_CI_AS,
	FOLIO_ANTERIOR VARCHAR(200) COLLATE SQL_Latin1_General_CP1_CI_AS
	);
	
CREATE TABLE #TMP_detalle_documentos (
				Municipio VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Numero_Emision VARCHAR (4) COLLATE SQL_Latin1_General_CP1_CI_AS, 
		 		RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
		 		Numero_Serie VARCHAR(50) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Movimiento VARCHAR(2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
				Folio_Impresion BIGINT,
				Status VARCHAR(1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				No_Loc_Impreso VARCHAR (1) COLLATE SQL_Latin1_General_CP1_CI_AS,
				Multa_Efectiva Money,
				Multa_Programada Money,
				Gastos_Ejecucion Money,
				EnRiesgo_Impreso VARCHAR (1) COLLATE SQL_Latin1_General_CP1_CI_AS
		);
CREATE TABLE #TMP_detalle_vehiculo (		
	Municipio VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	Oficina VARCHAR (2) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	Numero_Emision VARCHAR (4) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	RFC VARCHAR(13) COLLATE SQL_Latin1_General_CP1_CI_AS,
	Numero_Serie VARCHAR(30) COLLATE SQL_Latin1_General_CP1_CI_AS,
	Folio_Impresion BIGINT,
	Anio_Moroso VARCHAR (4) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	Numero_Operacion VARCHAR (14) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	Pagado VARCHAR (1) COLLATE SQL_Latin1_General_CP1_CI_AS, 
	Fecha_Pago datetime)
	
	

SELECT @Folio_Impresion=Max(datos.Folio_Impresion) 
			FROM obl_datos_generales datos
			LEFT JOIN obl_control_emisiones emision
				ON datos.Municipio = emision.Municipio
				AND datos.Oficina = emision.Oficina
				AND datos.Numero_Emision = emision.Numero_Emision
			WHERE datos.Municipio = @Municipio
				AND datos.Oficina = @Oficina 
				AND emision.Clave_Obligacion = '010604' 
				AND emision.Clave_Periodicidad = '07' 
				AND emision.Ejercicio_Fiscal = YEAR(GETDATE())

SET @Folio_Impresion= ISNULL(@Folio_Impresion,0);
--select @Folio_Impresion;


If @An_Construccion != 0  Begin Set @Filtro = @Filtro+ ' An_Construccion = '+Convert(varchar(4),@An_Construccion)+' And ' End
If @Tipo_Persona    != 0  Begin Set @Filtro = @Filtro+ ' Tipo_Persona    = '+Convert(varchar(1),@Tipo_Persona)+' And '    End
If @Clase           != 0  Begin Set @Filtro = @Filtro+ ' Clase           = '+Convert(varchar(2),@Clase)+' And '           End
If @Tipo_Servicio   != 0  Begin Set @Filtro = @Filtro+ ' Tipo_Servicio   = '+Convert(varchar(2),@Tipo_Servicio)+' And '   End
If @Uso             != 0  Begin Set @Filtro = @Filtro+ ' Uso             = '+Convert(varchar(2),@Uso)+' And '             End
If @Localidad       != 0  Begin Set @Filtro = @Filtro+ ' Localidad       = '''+@Localidad+''' And '                       End
If @Placa           != '' Begin Set @Filtro = @Filtro+ ' Placa           = '''+@Placa+''' And '                           End
If @Rfc             != '' Begin Set @Filtro = @Filtro+ ' Rfc             = '''+@Rfc+''' And '                             End


--5 electrico  y menor a 2009 se pueden requerir dspues del 2009 los electricos ya no pagan tenencia
--situacion critica padron lo indica
--remolque no paga
--13 años para atras desde el año actual
--
If Len(RTrim(LTrim(@Filtro))) != 0
Begin  
   Set @Filtro = SubString( @Filtro,1,Len( @Filtro )-4 )+ ' And (Situacion_Crit IN(0,7) Or Situacion_Crit Is Null) And (Exento_Tenencia = 0 Or Exento_Tenencia Is Null) And Clase Not In (3) And Municipio = '''+@Municipio+''' And (Estatus <> 9 Or Estatus Is Null) '
   Set @Filtro = @Filtro+' And ( Case When Fecha_Factura Is Null Then 0 Else Year(Fecha_Factura) End >= Year(GetDate())-13 Or Case When An_construccion Is Null Then 0 Else An_Construccion End >= Year(GetDate())-13 ) '
   Set  @Filtro = @Filtro+'And ((Tipo_Combustible = 5 And An_Construccion < 2009) or Tipo_Combustible <> 5 ) '
   --Set  @Filtro = @Filtro+'AND  serie=''3CUD2AXS1EX000035'''
   Set @Filtro = 'Select Serie,An_Construccion,Fecha_Factura From tenencias.dbo.ten_Padron_Vehicular where '+@Filtro
   --print @Filtro   
   Insert into @Emisiones Exec(@Filtro)
   
End

--Select * From @Emisiones

Declare @Serie             varchar(20) = ''
Declare @Fecha_Factura     datetime
Declare @Ejercicio_Inicial int  = Year(GetDate())-4 --Están Solicitando 2014-2018, aunque el sistema calcula Ejercicio Actual y 5 anños Anteriores
Declare @Ejercicio_Final   int  = Year(GetDate())

Declare @Emision_Final Table (Serie varchar(max),Ejercicio int)

DECLARE vend_cursor CURSOR FOR Select * From @Emisiones

OPEN vend_cursor

FETCH NEXT FROM vend_cursor INTO @Serie,@An_Construccion,@Fecha_Factura

WHILE @@FETCH_STATUS = 0  
BEGIN  
   Declare @Ejercicio         int  = @Ejercicio_Inicial
   WHILE @Ejercicio <= @Ejercicio_Final
   BEGIN             
      Declare @PASA_SN int = 0
      If @An_Construccion + 9 >= @Ejercicio_Inicial
      Begin
           If @Ejercicio >= @An_Construccion And @Ejercicio <= @An_Construccion +9
           Begin
              Set @PASA_SN = 1
           End
      End      
      If @Ejercicio < Year(@Fecha_Factura)
      Begin
         Set @PASA_SN = 0
      End
      If @PASA_SN = 1
 
           
      Begin       
         If (Select Count(*) From (
         Select Numero_Serie as Serie 
         from ingresos.dbo.obl_detalle_vehiculo 
         where Numero_Serie=@Serie AND Anio_moroso=@Ejercicio --Requerimientos
         Union
         Select tp.Serie as Serie 
         FROM tenencias.dbo.ten_prescripciones as tp 
         Where tp.Estatus in ('A') and tp.Serie= @Serie and tp.Ejercicio=@Ejercicio 
         and tp.Transaccion in ('TEN') --Prescripciones
         Union      
         Select hp.Serie as Serie 
         From tenencias.dbo.ten_Historico_Pagos as hp 
         where (hp.Estatus in ('0','1') or hp.Estatus is null) and hp.Serie= @Serie 
         and hp.Ejercicio_Fiscal=@Ejercicio and hp.Transaccion in ('TEN','UTV') --Historico de Cobranza
         Union
         Select cc.Serie 
         From ingresos.dbo.cob_cobros as cc 
         Inner join ingresos.dbo.cob_desglose as cd on cd.No_Operacion=cc.No_Operacion 
         and cd.Ejercicio_Fiscal=@Ejercicio and cd.Clave_Concepto IN ('TEN','UTV') 
         Where cc.Estatus in ('A','T','W') and cc.Serie= @Serie --Cobranza
         )t )= 0 
         Begin
            Insert into @Emision_Final Select @Serie,@Ejercicio
         End
      End
  Set @Ejercicio = @Ejercicio+1
   END
   
   FETCH NEXT FROM vend_cursor INTO @Serie,@An_Construccion,@Fecha_Factura
      
END   
CLOSE vend_cursor;  
DEALLOCATE vend_cursor;  

--Select @Municipio as Municipio, '02' as Oficina, '1801' as Numero_Emision,
INSERT INTO #obl_datos_vehiculo
select @Municipio as Municipio, 
		'02' as Oficina, 
		'1801' as Numero_Emision,
		b.Rfc,
		b.Serie, 
		'515' as Folio_impresion, 
		b.Nombre, 
		b.Apellido_Paterno, 
		b.Apellido_Materno,
		b.Localidad, 
		b.Domicilio,
		b.No_Exterior, 
		b.Colonia_o_Barrio,
		'' as Ubicacion,
		b.Codigo_Postal,
		YEAR(GETDATE()) as Ejercicio_fiscal, 
		'N' as Pagado, 
		'010604' as Clave_Obligacion,
		'07' as Clave_Periodicidad, 
		b.Placa, 
		b.An_Construccion,
		Descripcion_Vehiculo as Marca, 
		'' as Sub_marca,
		b.No_Motor,
		'' as Folio_Anterior
 From @Emision_Final  as a
 join  tenencias.dbo.ten_Padron_Vehicular as b
 on a.serie=b.serie
group by Municipio, Oficina, b.Rfc, b.Serie, b.Nombre,b.Apellido_Paterno , b.Apellido_Materno,
b.Localidad, b.Domicilio,b.No_Exterior, b.Colonia_o_Barrio,b.Codigo_Postal,b.Placa, 
b.An_Construccion,Descripcion_Vehiculo,
b.no_motor
order by b.Serie ;
 
 --SELECT * FROM #obl_datos_vehiculo;
 
 WITH CTE
		AS (SELECT Folio_Impresion,@Folio_Impresion+ROW_NUMBER()
		   OVER (ORDER BY  Numero_Serie, Numero_Serie) 
		   AS ROWNUM FROM #obl_datos_vehiculo)
		UPDATE CTE
		SET Folio_Impresion = ROWNUM;
 
--SELECT * FROM #obl_datos_vehiculo;
  
 --Select @Municipio as Municipio, '02' as Oficina, '1801' as Numero_Emision,
 INSERT INTO #TMP_detalle_vehiculo 
select @Municipio as Municipio, 
	   '02' as Oficina, 
	   '1801' as Numero_Emision,
	   b.Rfc,
	   b.Serie, 
	   '' as Folio_impresion,
	   a.Ejercicio,
	   '' as Numero_Operacion,
	   'N' as Pagado,
	   NULL as Fecha_Pago
From @Emision_Final  as a
join  tenencias.dbo.ten_Padron_Vehicular as b on a.serie=b.serie
order by b.Serie ;

		UPDATE #TMP_detalle_vehiculo
		SET Folio_Impresion= a.Folio_Impresion 
		FROM #obl_datos_vehiculo as a
		JOIN #TMP_detalle_vehiculo as b on a.NUMERO_SERIE=b.Numero_Serie;
		
--select * from #TMP_detalle_vehiculo
 
 INSERT INTO #TMP_detalle_documentos
 select @Municipio as Municipio, 
		'02' as Oficina, 
		'1801' as Numero_Emision,
		b.Rfc,
		a.Serie,
		'R1' as Movimiento,
		'515' as Folio_impresion,
		'B' as Status,
		'' as No_Loc_Impreso,
		'' as Multa_Efectiva,
		'' as Multa_Programada,
		'' as Gastos_Ejecucion,
		'' as EnRiesgo_Impreso
From @Emision_Final  as a
join  tenencias.dbo.ten_Padron_Vehicular as b
on a.serie=b.serie
group by a.Serie , b.rfc ;

		UPDATE #TMP_detalle_documentos
		SET Folio_Impresion= a.Folio_Impresion 
		FROM #obl_datos_vehiculo as a
		JOIN #TMP_detalle_documentos as b on a.NUMERO_SERIE=b.Numero_Serie;
		
 
 --SELECT * FROM #TMP_detalle_documentos;
 
	--	select top 10* from tenencias.dbo.ten_Padron_Vehicular
		
		
            COMMIT 
	 END TRY
  BEGIN CATCH
     
--     IF @@TRANCOUNT > 0
--		BEGIN
			ROLLBACK 
	 
--   	END
     -- Raise an error with the details of the exception
     declare @ErrMsg nvarchar(4000), @ErrSeverity int
     select @ErrMsg = ERROR_MESSAGE(),
         @ErrSeverity = ERROR_SEVERITY()
     raiserror(@ErrMsg, @ErrSeverity, 1)
  END CATCH

END




query de gabo para sacar los pagos de nomina

select 
--referencia,
ltrim(a.RFC),a.No_operacion,
year(Periodo_Inicial )Anio ,
datename(month,Periodo_Inicial )Mes,
d.Establecimiento 
,c.Tipo_Declaracion
from cob_cobros a 
inner join dec_nominas  c on c.Referencia = a.Referencia 
inner join dec_nominas_det d on d.referencia = c.Referencia 

where ltrim(a.RFC) = 'AOMD661207UH0'
and SUBSTRING (a.Referencia, 1,2) = '41'
and a.Estatus = 'A'
--and c.Tipo_Declaracion = 'N'

order by 

year(Periodo_Inicial ),
datename(month,Periodo_Inicial )



USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCO_carga_morosos_tenencias]
		@Municipio = N'07',
		@Oficina = N'02',
		@Numero_Emision = N'1801'
		

SELECT	'Return Value' = @return_value

GO


cream glos loreal
645
700


55425886     chelito dulceria
015559727287 manzanillo la serpentina



[marcar_pagos_referencias_multas]



pendientes por adelantar
reimprimir requerimiento


  multas vencidas de tulum
select 
a.RFC,b.Nombres + ' '+ b.Apellido_Materno +' '+b.Apellido_Materno as Nombre ,
a. Numero_Emision, Folio_Impresion, 
case a.movimiento when 'R1' then 'Primer Requerimiento'  
 when 'I1' then 'Multa por Incumplimiento'
 when 'I2' then 'Segunda Multa por Incumplimiento'
 when 'I3' then 'Tercera Multa por Incumplimiento'
 when 'ME' then 'Multa por Extemporaneidad'
  end as Movimiento,
   Fecha_Entrega , Fecha_Vencimiento ,
Gastos_Ejecucion , Multa_Programada, 'Vencido' as Estatus , Referencia , c.Clave_Obligacion+' - '+
d.Descripcion  as Clave_Obligacion
, 
case c.clave_periodicidad 
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
when '12' then 'INFORMATIVA MENSUAL'
end as Tipo_Periodo,
case c.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
case c.periodo_final 
when '' then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_final,
c.Anio_Moroso 
from obl_detalle_documentos as a 
join pad_contribuyentes as b on a.RFC=b.RFC 
join obl_control_emisiones as c on a.Numero_Emision =c.Numero_Emision 
and a.Municipio =c.Municipio 
and a.Oficina =c.Oficina and c.Clave_Obligacion not in ('010618','010623','010610')
join cat_obligaciones as d on c.Clave_Obligacion=d.Clave 
where a.Municipio ='09'
and referencia is not null 
and Movimiento not in('R1','R2','R3')
and Fecha_Vencimiento_Referencia<GETDATE()
and Fecha_Entrega is not null
and Status not in ('P','T','H','U','Y','O','K')
order by a.Numero_Emision, Folio_Impresion 


este query incluye las multas y requerimientos vencidos de todos los municipios



select 
a.Referencia,
f.nombre as Municipio,
k.nombre as Municipio_Establecimiento,

a.RFC,
b.Nombres + ' '+ b.Apellido_Materno +' '+b.Apellido_Materno as Nombre ,
h.nombre as Nombre_Establecimiento,
g.Numero_Establecimiento,
c.Clave_Obligacion+' - '+
d.Descripcion  as Clave_Obligacion, 
case c.clave_periodicidad 
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
when '12' then 'INFORMATIVA MENSUAL'
else 'MULTIANUAL'
end as Tipo_Periodo,
case c.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
case c.periodo_final 
when '' then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_final,
c.Anio_Moroso,
a. Numero_Emision, a.Folio_Impresion, 
case a.movimiento when 'R1' then 'Primer Requerimiento'  
 when 'I1' then 'Multa por Incumplimiento'
 when 'I2' then 'Segunda Multa por Incumplimiento'
 when 'I3' then 'Tercera Multa por Incumplimiento'
 when 'ME' then 'Multa por Extemporaneidad'
 else 'ME multiperiodos'
  end as Movimiento,
   Fecha_Entrega , Fecha_Vencimiento ,
Gastos_Ejecucion , Multa_Programada, 'Vencido' as Estatus ,
rtrim(b.Domicilio_Calle)+' '+ rtrim(b.Domicilio_Fiscal_Numero) as Domicilio, 
rtrim(b.Domicilio_Fiscal_Colonia) as Domicilio_Colonia,
REPLACE(REPLACE(Domicilio_Fiscal_Ubicacion,CHAR(10),''),CHAR(13),'') as Domicilio_Fiscal_Ubicacion,
j.descripcion as Giro
from obl_detalle_documentos as a 
join pad_contribuyentes as b on a.RFC=b.RFC 
join obl_control_emisiones as c on a.Numero_Emision =c.Numero_Emision 
and a.Municipio =c.Municipio 
and a.Oficina =c.Oficina and c.Clave_Obligacion not in ('010618','010623','010610')
join cat_obligaciones as d on c.Clave_Obligacion=d.Clave 
left join cob_cobros as e  on a.referencia=e.referencia and e.estatus in ('A','W','T')
join cat_municipios as f on a.municipio=f.clave
join  obl_detalle_sucursales as g on a.numero_emision=g.numero_emision
and a.folio_impresion=g.folio_impresion and a.municipio=g.municipio
and a.oficina=g.oficina
join pad_establecimientos as h on g.Numero_Establecimiento=h.Numero and 
g.RFC=h.rfc
join cat_giros as j  on h.giro=j.clave
join cat_municipios as k on g.municipio=k.clave

where 
--a.Municipio ='09'
--and 
a.referencia>'1'
--and Movimiento not in('R1','R2','R3')
and Fecha_Vencimiento_Referencia<GETDATE()
and Fecha_Entrega is not null 
and Status not in ('P','T','H','U','Y','O','K')
and e.estatus is null
--and a.rfc=' CEC960902VC0'
order by a.Municipio ,a.Numero_Emision, Folio_Impresion  

--3605







centauros

informes@centauros.com.mx
marta lopez

candy mania
Chetumal quintana roo 
av. maxuxac sn lote 5 mza 381
entre av. chetumal col. proterritorio cp. 77086
junto a una tienda comex y una pasteleria


determina la morosidad de un contribuyente
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_Determina_Morosidad_CPY]
		@RFC = N'AAMR791206GP6'

SELECT	'Return Value' = @return_value

GO



01_04_04_03 imprimir requerimientos
01_04_04_26 Imprimir Multas Incumplimento
01_04_04_29 Imprime Multas Extemporaneas


checar en genera emisión paquetes  da un error




SELECT        TOP (200) Municipio, Oficina, Numero_Emision, RFC, Numero_Serie, Movimiento, Folio_Impresion, Status, SubStatus, Fecha_Impresion, Fecha_Asignacion, Fecha_Citatorio, Fecha_No_Localizado, Fecha_Entrega, 
                         Fecha_Vencimiento, Fecha_Ultimo_Movimiento, Clave_Notificador, Gastos_Ejecucion, Multa_Efectiva, Multa_Programada, Actualizacion, Recargos, Honorarios_Notificacion, usuario_cancelacion, Categoria_No_Loc, 
                         Numero_No_Loc, Num_Salarios_Gastos_Ejecucion, No_Operacion, Referencia, No_Loc_Impreso, Descuento_Multa, Descuento_Gastos_Ejecucion, Subtotal, Total, Observaciones_Cancelacion, Fecha_Vencimiento_Referencia, 
                         Descuento, EnRiesgo_Impreso, Impuesto
FROM            obl_detalle_documentos
WHERE        (Municipio = '02') AND (Numero_Emision = '1912') AND (Folio_Impresion = 26978)

02	01	1902	 GGN900504M98	00	ME	11	E	C	2019-02-01 12:13:41.420	2019-02-15 13:26:26.047	2019-02-20 00:00:00.000	NULL	2019-02-21 00:00:00.000	2019-04-29 00:00:00.000	2019-02-21 14:44:42.680	jcastro	591.0000	338.0000	338.0000	0.0000	0.0000	0.0000	NULL	NULL	0	NULL	NULL	72028620637147067	NULL	0.0000	0.0000	929.0000	929.0000	NULL	2019-03-18 00:00:00.000	N	NULL	NULL
02	01	1902	 GGN900504M98	00	R1	11	H	H	2019-01-21 09:11:20.507	2019-01-24 15:33:58.203	2019-01-25 00:00:00.000	NULL	2019-01-28 00:00:00.000	2019-02-18 00:00:00.000	2019-01-29 12:47:29.730	fucan	564.0000	0.0000	0.0000	0.0000	0.0000	0.0000	caja	NULL	0	NULL	06020129973517	72028580847136179	 	0.0000	0.0000	564.0000	564.0000	NULL	2019-03-07 00:00:00.000	N	 	NULL
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL



      corregir Notice: Undefined variable?
 if (isset($listaPorRFC))
     {
     }
     
     
 ###########   cancelacion ramon y gabo caty  
     USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[cob_Cancelar_Operaciones_Cobros_Usuario]
		@No_Operacion = N'01100101598633',
		@Usuario = N'clopez'

SELECT	'Return Value' = @return_value

GO
     
############ gabo  pago con tarjeta y lo pasaron como efectivo
     update cob_cobros_tarjeta 
set Estatus='C',Activado='S', Codigo_Respuesta='00', Tipo_Tarjeta='DEBITO/BBVA BANCOMER/VISA'
where Id ='345850'


#### buscar y descomentar para devolver los logos
mini-3.jpg


######obtener estadistica de pago de algun rubro ramon concepto de pago    multas leydi
SELECT b.Concepto,SUM(b.Multa) as Multa, SUM(b.Honorarios_Notificacion) as Honorarios 
from cob_cobros as a  inner join cob_desglose as b
on a.No_Operacion=b.No_Operacion
where b.Rubro in ('010630','010631') and a.Estatus='A'
and YEAR(a.Fecha_Contable)=2017
group by b.Concepto

###########total de multas cobradas        rif
SELECT distinct(referencia)-- b.Concepto,SUM(b.Multa) as Multa, SUM(b.Honorarios_Notificacion) as Honorarios 
from cob_cobros as a  inner join cob_desglose as b
on a.No_Operacion=b.No_Operacion
where b.Rubro in ('010630','010631') and a.Estatus='A'
and YEAR(a.Fecha_Contable)=2019


#############################vig plus
SELECT b.Concepto,SUM(b.Multa) as Multa, SUM(b.Honorarios_Notificacion) as Honorarios from cob_cobros as a  inner join cob_desglose as b
on a.No_Operacion=b.No_Operacion
where b.Rubro in ('010624') and a.Estatus='A'
and YEAR(a.Fecha_Contable)=2019
and month(fecha_pago) between '01' and '08'
group by b.Concepto


######################total de multas cobradas
SELECT distinct(referencia)-- b.Concepto,SUM(b.Multa) as Multa, SUM(b.Honorarios_Notificacion) as Honorarios 
from cob_cobros as a  inner join cob_desglose as b
on a.No_Operacion=b.No_Operacion
where b.Rubro in ('010624') and a.Estatus='A'
and YEAR(a.Fecha_Contable)=2019
and month(fecha_pago) between '01' and '08'



  /*##############este bloque es el bueno
SELECT b.Concepto,SUM(b.Multa) as Multa, SUM(b.Honorarios_Notificacion) as Honorarios 
from cob_cobros as a  inner join cob_desglose as b
on a.No_Operacion=b.No_Operacion
where b.Rubro in ('010630','010631') and a.Estatus='A'
and YEAR(a.Fecha_Contable)=2021
and month(fecha_pago) between '01' and '10'
group by b.Concepto

SELECT b.Concepto,SUM(b.Multa) as Multa, SUM(b.Honorarios_Notificacion) as Honorarios from cob_cobros as a  inner join cob_desglose as b
on a.No_Operacion=b.No_Operacion
where b.Rubro in ('010624') and a.Estatus='A'
and YEAR(a.Fecha_Contable)=2021
and month(fecha_pago) between '01' and '10'
group by b.Concepto
*/



requerimientos vig plus   o morales
select sum(Numero_Control_Final )
from sirref_cat_equivalencias as a
join sirref_co_emisiones   as b on 
a.Numero_Emision=b.Numero_Emision 
where Tipo_Obligacion ='P'and 
a.Ejercicio_Fiscal='2016'
and Municipio_Estatal!=''
---and tipo_persona='M'

requerimientos vig plus  o morales
select sum(Numero_Control_Final )
from sirref_cat_equivalencias as a
join sirref_co_emisiones   as b on 
a.Numero_Emision=b.Numero_Emision 
where Tipo_Obligacion ='P'and 
a.Ejercicio_Fiscal='2017'
and Municipio_Estatal!=''
---and tipo_persona='M'


requerimientos vig plus o morales
select sum(Numero_Control_Final )
from sirref_cat_equivalencias as a
join sirref_co_emisiones   as b on 
a.Numero_Emision=b.Numero_Emision 
where Tipo_Obligacion ='P'and 
a.Ejercicio_Fiscal='2018'
and Municipio_Estatal!=''
---and tipo_persona='M'


--select * from est_conversion_rubros conversion de rubros 608.02 y 608.03 dif repecos e intermedios
gas	600
agua 	750
cel	  500
mama	1000
banx	2000
auto	5800
mr	  1700
12850
4000	
2000	
2000	
3900	
11900	

<head>

 <style type="text/css">
 table.aviso{
 border:7px solid;
 border-color: #FF0000;
 } 
</style>
 
 </head>
 
  <table align='center' class='aviso'>
  <tr>
   <td ALIGN="justify">
   Estimado contribuyente:
    <br>
    <br>
   De conformidad con el Decreto número 136 por el que se reforman, derogan y adicionan diversas disposiciones de la Ley del Impuesto sobre Nóminas del Estado de Quintana Roo, publicado en el Periódico Oficial del Estado número 146 extraordinario el 27 de diciembre de 2017, a través del cual se establece que los pagos del Impuesto sobre Nóminas se enteraran a partir del 1 de enero de 2018 mediante declaración mensual definitiva, derivado de lo anterior se informa que ya no se encuentra vigente la obligatoriedad de presentar la declaración anual del impuesto respecto al ejercicio fiscal 2018.
   </td>
  </tr>
 </table>  
 
 
 
 
 
 https://htmlg.com/html-editor/
 
 


Dirección de la web: oficinavirtual.issste.gob.mx
Usuario: llizardi
ctrs: liza0408



imposicion_multa_actas_inspeccion_imprimir.php



01
02
03
04
05
06 - todo
07- todo
08-
09-





-- =============================================
ALTER PROCEDURE [dbo].[paObl_Vigilancia_Correos_Estatales_Resume] 


USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paObl_Vigilancia_Correos_Estatales_Resume]

SELECT	'Return Value' = @return_value

GO



  <table width="746"  >
        <tr>
				<td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;BBVA BANCOMER: 1006290 </b></td>
        <td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;BANORTE: 96952</b></td>
        <td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;HSBC: 3336  </b></td>
		</tr>
		<tr>
				<td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;BANAMEX: PA 3928.01 </b></td>
        <td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;SCOTIABANK: 1103   </b></td>
        <td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;SANTANDER: 1791    </b></td>
		</tr>
    <tr>
				<td align="left" colspan="1"><?php echo "<img width=\"250px\" src=\"../../../../barcode/image.php?code=$referencia&style=196&type=C128A&width=250&height=80&xres=1&font=5\"/>";?></td>
        <td align="left" colspan="1">&nbsp;</td>
        <td align="left" colspan="1">&nbsp;</td>
		</tr>  <!-- -->
   	<tr>
				<td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;FECHA LÍMITE REFERENCIA: </b><?php echo $referencia_fecha_vencimiento;?></td>
        <td align="left" colspan="1">&nbsp;</td>
        <td align="left" colspan="1">&nbsp;</td>
		</tr>
	<!-- -->	<tr>
				<td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;REFERENCIA: </b><?php echo $referencia;?></td>
        <td align="left" colspan="1">&nbsp;</td>
        <td align="left" colspan="1">&nbsp;&nbsp;&nbsp;&nbsp;<b>IMPORTE:</b>&nbsp;$<?php echo number_format($Total_Pagar,2);?></td>
		</tr> 
  </table> <!--comentar fin referencia-->   





-----------------------------------------------------

revisar los que salieron espontáneos que no debieron salir morosos ya esta pagado

select  b.fecha_emision,c.fecha_declarado,*--distinct(Status) 
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision and a.municipio=b.municipio and a.oficina=b.oficina
inner join obl_detalle_sucursales as d on 
a.numero_emision=d.numero_emision and a.oficina=d.oficina and a.Municipio=d.municipio and a.Folio_Impresion =d.folio_impresion
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC and b.periodo_inicial=c.mes_inicial and b.Anio_Moroso=c.Anio_Inicial and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion
and d.Numero_Establecimiento=c.Numero_Establecimiento 
where a.municipio='02' and a.oficina='01'
 ---and a.numero_emision='1914' --
 --and a.folio_impresion='38762'
 and b.Clave_Obligacion='010103'
 and a.Numero_Emision >'1900'
and a.movimiento='R1'
--and b.fecha_emision<=c.fecha_declarado
and c.Fecha_Declarado is not null
and a.Status='B'


update obl_detalle_documentos
set status='T', usuario_cancelacion='Info', 
fecha_ultimo_movimiento=getdate()
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision and a.municipio=b.municipio and a.oficina=b.oficina
inner join obl_detalle_sucursales as d on 
a.numero_emision=d.numero_emision and a.oficina=d.oficina and a.Municipio=d.municipio and a.Folio_Impresion =d.folio_impresion
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC and b.periodo_inicial=c.mes_inicial and b.Anio_Moroso=c.Anio_Inicial and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion
and d.Numero_Establecimiento=c.Numero_Establecimiento 
where a.municipio='09' and a.oficina='01'
 ---and a.numero_emision='1914' --
 --and a.folio_impresion='38762'
 and b.Clave_Obligacion='010102'
 and a.Numero_Emision >'1900'
and a.movimiento='R1'
and b.fecha_emision<=c.fecha_declarado
and c.Fecha_Declarado is not null
and a.status in ('C','D','E','I','N','V','X')



-----------------------------------------
100701187495296C77042






WHERE        (Numero_Emision = '19354') AND (Numero_Control = '100705191252164C73065')

WHERE        (Numero_Emision = '19350') AND (Numero_Control = '102304191147079C73065')











830 
MER-748795
4367699
referencias
http://10.9.1.216/ingresos2010/cobros/cobro_detalle.htm

fuentes
https://fontmeme.com/fuentes/fuente-shit-happens/



55	tortillas	
815	comida	
500	pastel	
110	refrescos	
20	desechables	
1500		
		
1300		
200		185
1500		

102304191145648C73042 rif
100406191618253C73042 plus

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_19072019]

SELECT	'Return Value' = @return_value

GO



revisar que adeudad un contribuyente
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paPadron_Validar_Activo]
		@RFC = N'GOCG810416FT7',
		@Numero_Licencia = N'8731'

SELECT	'Return Value' = @return_value

GO


--insertar la multas extemporaneas que no se marcan ejecutar periodicamente
 insert into obl_detalle_documentos
(Municipio, Oficina, Numero_Emision, RFC,Folio_Impresion, Movimiento, Fecha_Ultimo_Movimiento )
select a.Municipio, a.Oficina, a.Numero_Emision, a.RFC,a.Folio_Impresion,'ME', min(c.fecha_declarado)--, a.status, a.usuario_cancelacion, c.Tipo_Periodo,
--c.Mes_Inicial 
 --getdate()
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and b.periodo_inicial=c.mes_inicial 
and b.Anio_Moroso=c.Anio_Inicial 
and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion
left join obl_detalle_documentos as e on a.Numero_Emision=e.Numero_Emision 
and a.Municipio=e.municipio
and a.oficina=e.oficina and e.Movimiento='ME' and a.Folio_Impresion=e.Folio_Impresion 
where 
a.municipio='11'
and e.Folio_Impresion is null 
 and
a.oficina='01' 
--and a.numero_emision='2037' 
--and a.folio_impresion='20949'
and a.movimiento='R1'    
and (a.Fecha_Entrega is not null and a.fecha_entrega+1<c.fecha_declarado)
and a.status in ('P','T','H','E','V')
and b.numero_emision >'1900'
--and a.rfc='OIPR860124IL9'
--and fecha_declarado>'01/12/2020'
group by a.Municipio, a.Oficina, a.Numero_Emision, a.RFC,a.Folio_Impresion, a.Movimiento--, c.Fecha_Declarado 


inserta las multas    extemporaneas de ilepal nuevo impuesto
insert into obl_detalle_documentos
(Municipio, Oficina, Numero_Emision, RFC,Folio_Impresion, Movimiento, Fecha_Ultimo_Movimiento )
select a.Municipio, a.Oficina, a.Numero_Emision, a.RFC,a.Folio_Impresion,'ME', a.Fecha_Ultimo_Movimiento 
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and b.periodo_inicial=c.mes_inicial 
and b.Anio_Moroso=c.Anio_Inicial 
and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion
left join obl_detalle_documentos as e on a.Numero_Emision=e.Numero_Emision and a.Municipio=e.municipio
and a.oficina=e.oficina and e.Movimiento='ME' and a.Folio_Impresion=e.Folio_Impresion 
where --a.municipio='09'and
 e.Folio_Impresion is null 
 --and a.oficina='01' 
--and a.numero_emision='1839' 
--and a.folio_impresion='70187'
and a.movimiento='R1'    
and (a.Fecha_Entrega is not null and a.fecha_entrega<c.fecha_declarado)
and a.status in ('P','T','H')
and b.Anio_Moroso ='2020'
and b.Clave_Obligacion in ('010102')
--and b.numero_emision >'1700'
--and a.rfc='PAHG6410283N6'
group by a.Municipio, a.Oficina, a.Numero_Emision, a.RFC,a.Folio_Impresion, a.Movimiento, a.Fecha_Ultimo_Movimiento 



determina multas sirref
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[pa_Determina_Referencia_Multas_SIRREF]
		@Id = N'1',
		@No_Municipio = N'01',
		@Oficina = N'01',
		@No_Emision = N'19350',
		@Numero_Control = N'102304191145648C73042',
		@Movimiento = N'I1',
		@Clave_Obligacion = N'X',
		@Multa = N'1',
		@Multa1 = N'1',
		@Multa2 = N'1',
		@Multa3 = N'1',
		@Multa4 = N'1',
		@Gastos_Ejecucion = N'1'

SELECT	'Return Value' = @return_value

GO
/// recorrer un arreglo en php
 while (list($key, $value) = each($_POST[conceptos])) 
    { 
     $sql_upd_detalle="update sirref_co_detalle
                  set  Multa_Efectiva=CAST(round('{$_POST['Multa_Efectiva2']}',0,0) AS int)           
                  WHERE numero_control='{$_GET['Numero_Control']}' 
                      and  Movimiento='{$_GET['Movimiento']}' 
                      and numero_emision='{$_GET['Numero_Emision']}'
                      and concepto_ley='$value'";
                      
                      //Multa_Efectiva= CAST(round('{$_POST['multa_efectiva']}',0,0) AS int)  ,
         
                   
     //  $conexionBD->Seleccion($sql_upd_detalle);
    }  

cancelar un pago solo del dia
http://10.9.1.216/ingresos2/cobros/cobro_detalle_control.php


poner el total en sirref_co_documentos y en multa efectiva


Folio de registro:
487206

Registrado a nombre de:
LILI LIZARDI RODRIGUEZ

Para acceder al seguimiento de su trámite entre a la liga https://jovenesconstruyendoelfuturo.stps.gob.mx/login Sus datos de acceso son: 
Usuario: lizardi_w@hotmail.com 
Contraseña: liza0408



01



Candy Manía es una tienda que comercializa dulceria y botanas 
la capacitación que recibirá el becario será conocerá los diferentes tipos 
de dulceria fina confiteria y variedad de botanas para servir en eventos.
Realizará las siguientes actividades:

Aprenderá la variedad de productos que se venden en una dulcería
y su manejo para conservar la frescura de estos.

Aprenderá el manejo de inventarios a través de un sistema de punto de ventas.

Aprenderá el uso de herramientas como un equipo de cómputo, impresora, selladora de bolsas, máquina de tamaño comercial de palomitas, fuente de chocolate, cortadoras profesionales de papel.

Aprenderá a el montaje de mesas de dulces, empaquetado de los productos, uso de las bases para colocación de los productos, diseño de colores y diseño de etiquetas. 




determinar el reporte de morosos que ya incluye juegos y sorteos
[paCo_Determina_Morosidad_padron_CPY_Estatales_19072019]


##################LISTADO DE MOROSOS SEGUN EL IMPORTE DE LO ULTIMO DECLARADO EN 2018
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[Generar_Invitaciones_Estatales_Total_REP_IMPRESION_AGO2019]
		@Municipio = N'02',
		@EjercicioFiscal = N'2019',
		@EjercicioFiscalFinal = N'2019',
		@ClaveLocalidad = N'0',
		@ClaveZona = N'0',
		@ClaveOficina = N'01',
		@Anio = N'2019'

SELECT	'Return Value' = @return_value

GO



  <table width="746"  >
        <tr>
				<td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;BBVA BANCOMER: 1006290 </b></td>
        <td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;BANORTE: 96952</b></td>
        <td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;HSBC: 3336  </b></td>
		</tr>
		<tr>
				<td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;BANAMEX: PA 3928.01 </b></td>
        <td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;SCOTIABANK: 1103   </b></td>
        <td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;SANTANDER: 1791    </b></td>
		</tr>
    <tr>
				<td align="left" colspan="1"><?php echo "<img width=\"250px\" src=\"../../../../barcode/image.php?code=$referencia&style=196&type=C128A&width=250&height=80&xres=1&font=5\"/>";?></td>
        <td align="left" colspan="1">&nbsp;</td>
        <td align="left" colspan="1">&nbsp;</td>
		</tr>  
   	<tr>
				<td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;FECHA LÍMITE REFERENCIA: </b><?php echo $referencia_fecha_vencimiento;?></td>
        <td align="left" colspan="1">&nbsp;</td>
        <td align="left" colspan="1">&nbsp;</td>
		</tr>
	<tr>
				<td align="left" colspan="1"><b>&nbsp;&nbsp;&nbsp;&nbsp;REFERENCIA: </b><?php echo $referencia;?></td>
        <td align="left" colspan="1">&nbsp;</td>
        <td align="left" colspan="1">&nbsp;&nbsp;&nbsp;&nbsp;<b>IMPORTE:</b>&nbsp;$<?php echo number_format($Total_Pagar,2);?></td>
		</tr> 
  </table> <!--comentar fin referencia-->     


--corregir el formato que no se imprime ben



<!--Esta Dirección de Recaudación de <b><?=//$moroso['Nombre_Municipio']?></b>, con fundamento en los artículos 16 de la 
Constitución Política de los Estados Unidos Mexicanos; 24 de la Constitución Política del Estado Libre y Soberano 
de Quintana Roo; cláusulas Primera, Segunda fracción X inciso a), Cuarta, Octava fracción I incisos a), b), c) y d), 
Novena, Décima fracciones I y III y Décima Sexta fracciones I inciso a), y III incisos a) b)y c) del Convenio de Colaboración 
Administrativa en Materia Fiscal Federal celebrado entre el Gobierno Federal, por conducto de la Secretaría de Hacienda y 
Crédito Público, y el Gobierno del Estado de Quintana Roo, publicado en el Diario Oficial de la Federación el día 06 de 
febrero de 2009 y en el Periódico Oficial del Estado de Quintana Roo el 27 de febrero de 2009; Cláusulas Primero, Segunda 
fracciones I, II Y III, Tercera, Cuarta, Octava fracciones I incisos a), b) y d), y II inciso II, Novena, Tercera Transitorio, 
y Cuarta Transitoria del Convenio de Colaboración Administrativa en Materia Fiscal Federal celebrado entre el Gobierno Federal, 
por conducto de la Secretaría de Hacienda y Crédito Público y el Gobierno del Estado de Quintana Roo, publicado el 17 de agosto 
de 2015 en el Diario Oficial de la Federación y el 10 de agosto de 2015 en el Periódico Oficial del Estado de Quintana Roo; 
artículos 6 párrafos tercero y cuarto, 20 penúltimo párrafo, 31 sexto párrafo, 41 fracción I y 134 fracción I, 135, 136 del 
Código Fiscal de la Federación en vigor; 3, 6, 19 fracción III, 21, 26 y 33 fracciones XVI, XVII y XVIII de la Ley Orgánica 
de la Administración Pública del Estado de Quintana Roo; 27 fracción XVII inciso d) del Código Fiscal del Estado de Quintana 
Roo; 2, 4 fracciones II, III, IV y último párrafo, 7, 8, 10 fracciones XI, XVI, XIX, XXII, XXIII, XXIV, XXV y XL, 13 y 14, 
15 fracción III, 24, 25  y Décimo Transitorio de la Ley del Servicio de Administración Tributaria del Estado de Quintana Roo; 
Decreto 294 por el que se expide la Ley del Servicio de Administración Tributaria del Estado de Quintana Roo, publicado en el 
Periódico Oficial del Estado de Quintana Roo, el 31 de diciembre de 2018; Decreto 295 por el que se reforman, adicionan y 
derogan diversas disposiciones del Código Fiscal del Estado de Quintana Roo, publicado en el Periódico Oficial del Estado 
de Quintana Roo, el 31 de diciembre de 2018; Decreto 306 por el que se reforman diversas disposiciones del Decreto 294 por 
el que se expide la Ley del Servicio de Administración Tributaria del Estado de Quintana Roo, publicado en el Periódico 
Oficial del Estado el 28 de febrero de 2019; Decreto 307 por el que se reforman, adiciona y deroga diversas disposiciones 
del Código Fiscal del Estado de Quintana Roo y se reforma el párrafo segundo del Transitorio Primero del Decreto 295, 
publicado en el Periódico Oficial del Estado de Quintana Roo el 28 de febrero de 2019; y los artículos 1, 6 punto 2, 2.1 
inciso <?=//$Incisospto2?> y último párrafo, 7, 8 segundo párrafo fracción I 
 inciso <?=//$Incisospto8?> y último párrafo, 9 primer párrafo, 16 fracciones X, XIV Y LVII del Reglamento Interior del Servicio de Administración 
Tributaria del Estado de Quintana Roo publicado en el Periódico Oficial del Estado de Quintana Roo el 04 de abril de 2019.-->

-----------------------------------------------------------------------------
Actualiza en una tabla las referencias que no se marcaron de SIRREF
	
DECLARE @Cadena               VARCHAR(MAX),@Cadena2   VARCHAR(MAX),
@Palabra_aBuscar VARCHAR(MAX),
@Longitud_Palabra INT,
@Longitud_Palabra2 INT

select @Cadena=Datos_Especificos_Contribucion from dec_contribucion where referencia='72011780617365263'
SET @Palabra_aBuscar = 'Numero Control:'
SET @Longitud_Palabra = LEN(@Palabra_aBuscar)
SET @Longitud_Palabra2 = @Longitud_Palabra+15

insert into ingresos.dbo.sirref_referencias
select x.Referencia, x.Numero_Control, numero_emision, '14/10/2019'  as Fecha_Vencimiento
from ( select max(Referencia) as Referencia,numero_control, max(Alta_Fecha) as alta_fecha from (
select Referencia,Datos_Especificos_Contribucion,Alta_Fecha,SUBSTRING(Datos_Especificos_Contribucion,CHARINDEX('Numero Control:',Datos_Especificos_Contribucion)+15,@Longitud_Palabra+6) as Numero_control,len(SUBSTRING(Datos_Especificos_Contribucion,CHARINDEX('Numero Control:',Datos_Especificos_Contribucion)+15,@Longitud_Palabra+6)) as Numero_control2
 from dec_contribucion 
 where-- referencia='72011780617365263' and 
 SUBSTRING(Datos_Especificos_Contribucion,CHARINDEX('Numero Control',Datos_Especificos_Contribucion),@Longitud_Palabra)='Numero Control:'
 and  year(Alta_Fecha) = '2019' and month(Alta_Fecha)='09' and day(Alta_Fecha)='06'
) as a 
--where a.Numero_control='100309192351743C73316'
group by numero_control) as x
join sirref_co_documentos as l on x.numero_control=l.numero_control
where l.numero_emision='19380'


-------------------------------------------------------------
cursor
    OPEN cursorCONTRIBUYENTES
    
    FETCH NEXT FROM cursorCONTRIBUYENTES INTO @Concepto_Ley

 
    WHILE (@@FETCH_STATUS = 0)
    BEGIN
    
       INSERT INTO #t
	   select  Concepto_Ley, Multa from sirref_co_detalle 
		 where  Numero_Emision=@No_Emision and numero_control =@Numero_Control and Concepto_ley=@Concepto_Ley 
		 and movimiento=@Movimiento
       FETCH NEXT FROM cursorCONTRIBUYENTES INTO @Concepto_Ley
    END

    CLOSE cursorCONTRIBUYENTES
    DEALLOCATE cursorCONTRIBUYENTES

	SELECT * from #t



--------------------------armar un xml de una consulta de varios renglones
declare @xml xml


select  @xml =(
select id,Cantidad --,Concepto ,Importe  
from dec_contribucion_detalle 
where id_dec_contribucion= 2881900
FOR XML PATH('detalle')
)
select @xml

---------------------------------------
usuario facebook
normancampos@gmail
contraseña el alazann


-*-----------------------------------------------------
--estadistica de avances de actas de inspeccion


select t.municipio, t.Oficina, Numero_Emision, t.Anio_Moroso,
		t.Total as Emitidos, t.Impreso as Impresos,
		t.Asignado as Asignados,
		t.Capturado as Capturado--, 
		--t.Pagado+t.Pago_Honorarios as Pagados, t.Pago_Espontaneo as Pagos_Espontaneos 
		from 
(
SELECT
		b. municipio,
		b.Oficina,
		--b.Clave_Obligacion as Clave_Obligacion,
            --   c.Descripcion as Obligacion,
               a.Numero_Emision,
               min(b.fecha_emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN ( a.Fecha_Impresion is null and a.Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado,
               SUM(CASE WHEN (a.Fecha_Entrega is null and a.Status in ('D')) THEN 1 ELSE 0 END) AS Pendiente,
               --SUM(CASE WHEN (a.Status in ('C')) THEN 1 ELSE 0 END) AS Citatorio, 
	           SUM(CASE WHEN (a.Fecha_Captura is not null) THEN 1 ELSE 0 END) AS Capturado,
               SUM(CASE WHEN (a.Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado,
               --SUM(CASE WHEN (a.Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo,
               --SUM(CASE WHEN (a.Status in ('H'))  THEN 1 ELSE 0 END) AS Pago_Honorarios,
               SUM(CASE WHEN (a.Status in ('J'))  THEN 1 ELSE 0 END) AS Resolucion_Juridica,
               SUM(CASE WHEN (a.Status in ('S'))  THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia
               FROM obl_detalle_documentos_actas_inspeccion as a 
               inner join obl_control_emisiones_actas_inspeccion as b on a.Numero_Emision=b.Numero_Emision 
			   and b.municipio='01'
               --left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               where a.Movimiento like 'A%' and 
			   --b.Clave_Obligacion='010623' and 
			   b.Ejercicio_Fiscal='2019'
               group by b.municipio,b.oficina,a.Numero_Emision --,c.Descripcion 
			   
) as t
order by  t.municipio,-- t.Clave_Obligacion,
t.Numero_Emision 




select t.municipio, t.Oficina, Numero_Emision,
		t.Total as Emitidos, t.Impreso as Impresos,
		t.Asignado as Asignados,
		t.Capturado as Capturado--, 
		--t.Pagado+t.Pago_Honorarios as Pagados, t.Pago_Espontaneo as Pagos_Espontaneos 
		from 
(
SELECT
		b. municipio,
		b.Oficina,
		--b.Clave_Obligacion as Clave_Obligacion,
            --   c.Descripcion as Obligacion,
               a.Numero_Emision,
               min(b.fecha_emision) as Fecha_Emision,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN ( a.Fecha_Impresion is null and a.Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado,
               SUM(CASE WHEN (a.Fecha_Entrega is null and a.Status in ('D')) THEN 1 ELSE 0 END) AS Pendiente,
               --SUM(CASE WHEN (a.Status in ('C')) THEN 1 ELSE 0 END) AS Citatorio, 
	           SUM(CASE WHEN (a.Fecha_Captura is not null) THEN 1 ELSE 0 END) AS Capturado,
               SUM(CASE WHEN (a.Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado,
               --SUM(CASE WHEN (a.Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo,
               --SUM(CASE WHEN (a.Status in ('H'))  THEN 1 ELSE 0 END) AS Pago_Honorarios,
               SUM(CASE WHEN (a.Status in ('J'))  THEN 1 ELSE 0 END) AS Resolucion_Juridica,
               SUM(CASE WHEN (a.Status in ('S'))  THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia
               FROM obl_detalle_documentos_actas_inspeccion as a 
               inner join obl_control_emisiones_actas_inspeccion as b on a.Numero_Emision=b.Numero_Emision 
			   and b.municipio='01'
               --left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               where a.Movimiento like 'D%' and 
			   --b.Clave_Obligacion='010623' and 
			   b.Ejercicio_Fiscal='2019'
               group by b.municipio,b.oficina,a.Numero_Emision --,c.Descripcion 
			   
) as t
order by  t.municipio,-- t.Clave_Obligacion,
t.Numero_Emision 



select t.municipio, t.Oficina, Numero_Emision, 
		t.Total as Emitidos, t.Impreso as Impresos,
		t.Asignado as Asignados,
		t.Capturado as Capturado--, 
		--t.Pagado+t.Pago_Honorarios as Pagados, t.Pago_Espontaneo as Pagos_Espontaneos 
		from 
(
SELECT
		b. municipio,
		b.Oficina,
		--b.Clave_Obligacion as Clave_Obligacion,
            --   c.Descripcion as Obligacion,
               a.Numero_Emision,
               min(b.fecha_emision) as Fecha_Emision,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN ( a.Fecha_Impresion is null and a.Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado,
               SUM(CASE WHEN (a.Fecha_Entrega is null and a.Status in ('D')) THEN 1 ELSE 0 END) AS Pendiente,
               --SUM(CASE WHEN (a.Status in ('C')) THEN 1 ELSE 0 END) AS Citatorio, 
	           SUM(CASE WHEN (a.Fecha_Captura is not null) THEN 1 ELSE 0 END) AS Capturado,
               SUM(CASE WHEN (a.Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado,
               --SUM(CASE WHEN (a.Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo,
               --SUM(CASE WHEN (a.Status in ('H'))  THEN 1 ELSE 0 END) AS Pago_Honorarios,
               SUM(CASE WHEN (a.Status in ('J'))  THEN 1 ELSE 0 END) AS Resolucion_Juridica,
               SUM(CASE WHEN (a.Status in ('S'))  THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia
               FROM obl_detalle_documentos_actas_inspeccion as a 
               inner join obl_control_emisiones_actas_inspeccion as b on a.Numero_Emision=b.Numero_Emision 
			   and b.municipio='01'
               --left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
               where a.Movimiento like 'S%' and 
			   --b.Clave_Obligacion='010623' and 
			   b.Ejercicio_Fiscal='2019'
               group by b.municipio,b.oficina,a.Numero_Emision --,c.Descripcion 
			   
) as t
order by  t.municipio,-- t.Clave_Obligacion,
t.Numero_Emision 


https://articulo.mercadolibre.com.mx/MLM-683764862-kit-10-insertos-sexto-4-policarbonato-plastico-dilitools-_JM?quantity=1#position=13&type=item&tracking_id=65eb2b0b-72b0-4264-a3ef-eabb21d93770

  query total de documentos diligenciados sirref
  ----------------------

select b.Municipio_Estatal, c.nombre as Municipio_Estatal_Nombre, a.Numero_Control, a.Numero_Emision, a.RFC, b.Nombre_Contribuyente, b.Calle, b.Colonia, b.Localidad, 
a.Fecha_Citatorio, a.Fecha_Entrega, a.Fecha_No_Localizado, 

case Mes_Moroso 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Mes_Moroso

, d.Anio_Moroso 
from sirref_co_documentos as a 
join sirref_co_datos as b on a.numero_control=b.Numero_Control  and a.Numero_Emision=b.Numero_Emision 
join cat_municipios  as c on b.municipio_estatal=c.clave
join sirref_co_emisiones as d on b.Municipio_Estatal =d.municipio_estatal  and a.Numero_Emision=d.Numero_Emision 
where  a.numero_emision in ('19374','19378','19379','19380') and Movimiento='R1'

----------------------------------------------------------------
select * from sirref_cat_fundamentos where numero_emision='19001'
select * from sirref_co_documentos where numero_emision='19001'
select * from sirref_co_detalle where numero_emision='19001'
select * from sirref_co_datos where numero_emision='19001'
select * from sirref_co_emisiones where numero_emision='19001'
select * from sirref_cat_equivalencias where numero_emision='19001'

delete sirref_co_documentos where numero_emision='19001'
delete sirref_co_detalle where numero_emision='19001'
delete sirref_co_datos where numero_emision='19001'
delete sirref_co_emisiones where numero_emision='19001'
delete sirref_cat_equivalencias where numero_emision='19001'
delete sirref_cat_fundamentos where numero_emision='19001'


---------------------------
renombrar archivos en linea de comandos        CMD
ren *.pdf ??????????????????????????????????M.*

  ----------determinar morosos nomina y hospedaje con su importe del ultimo pago  reporte con importe

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_18102019]

SELECT	'Return Value' = @return_value

GO




--Actualizar las fechas de pago de los ilepales en vigilable presentada 
update obl_obligacion_vigilable_presentada
set fecha_declarado=b.fecha_pago
from obl_obligacion_vigilable_presentada as a
join cob_cobros as b on a.no_operacion=b.no_operacion and a.rfc=b.rfc
where clave_obligacion='010102' and fecha_declarado is NULL






lililizardiro@gmail.com
liza0408

airb&b
lililizardiro@gmail.com
liza0408#

correo para airbnb
lililizardiairbnb@gmail.com
liza0408


La cuenta lililizardiro@gmail.com ya está autorizada para administrar Candy Manía Chetumal en Google

amiga mauricioppt




MPIO                    NUM. EMISION   TOTAL MOROSOS
OTHON P. BCO	   1958	                    	5
BENITO JUÁREZ    1940   		7
COZUMEL 	    1962			5
SOLIDARIDAD 	    1946			8



-----------------------------------------------------------------------------
Actualizar los importes d elas I1
 
select  movimiento, numero_control, emision,multa, multa_importe, multa* multa_importe as total, gastos_ejecucion,  (multa* multa_importe)+gastos_ejecucion as Multa_Programada
from (
select 'I1' as movimiento,a.numero_control, count(b.numero_control) as multa, min (a.multa) as multa_importe, min (a.Numero_Emision) as emision, max(a.gastos_ejecucion) as gastos_ejecucion
from sirref_co_detalle as a  
left join sirref_co_documentos as b on a. numero_emision=b.numero_emision and a.Numero_Control=b.numero_control and 
a.Movimiento=b.Movimiento 
where --a.numero_emision='19339'-- and a.movimiento='ME'and 
b.movimiento in ('I1')
and b.status in ('A',
'D',
'E')
--and a.Numero_Control ='100208189064085C73316'
group by a.Numero_Control ) as a




update sirref_co_documentos
set Multa_Efectiva=a.total, Multa_Programada=a.total,
Total=a.multa_programada, Subtotal=a.multa_programada
from obl_I1_Importe as a
join sirref_co_documentos as b
on a.numero_control=b.numero_control
and a.emision=b.Numero_Emision 
and a.movimiento=b.Movimiento 
--where a.numero_control='100652I412077G'






select * 
from obl_I1_Importe as a
join sirref_co_documentos as b
on a.numero_control=b.numero_control
and a.emision=b.Numero_Emision 
and a.movimiento=b.Movimiento 
where a.numero_control='100652I412077G'



###############################
    sirref referencias pagadas

select d.Nombre as Municipio,a.Numero_Emision,(select sum(numero_control_final) from sirref_co_emisiones where numero_emision=a.numero_emision) as Total_Requerimientos,a.Referencia ,  b.RFC,b.Total, b.Fecha_Pago
from sirref_co_documentos as a
join cob_cobros  as b on a.referencia=b.referencia
join sirref_co_datos as c on a.numero_emision=c.numero_emision and a.numero_control=c.numero_control
join cat_municipios as d on c.municipio_estatal=d.clave
where a.numero_emision in 
(
'19411',
'19404',
'19001',
'19380',
'19379',
'19378')
and movimiento='R1'
and b.Estatus='A'
and a.Referencia!=''
order by numero_emision


##cuantos se han pagado  sirref de cada municipio
select min(d.nombre) as Municipio,a.Numero_Emision, count(*) as Total_Pagados
from sirref_co_documentos as a
join cob_cobros  as b on a.referencia=b.referencia
join sirref_co_datos as c on a.Numero_Control=c.Numero_Control  and a.numero_emision=c.numero_emision
join cat_municipios as d on c.municipio_estatal=d.clave

where a.numero_emision in 
(
'19411',
'19404',
'19001',
'19380',
'19379',
'19378')
and movimiento='R1'
and b.Estatus='A'
and a.Referencia!=''
group by c.municipio_estatal ,a.numero_emision
order by numero_emision, municipio



---usuario tarjeta
lizardi_w@hotmail.com
Liza0408

xrp gabo 

18.53 xrps = 50 pesos

Mamá celular telcel
9831641933

8359X8359


Folio banamex
20191220039203369




Dr. Jose Cetina Canto

#avance de cierre
select * from cob_tira_auditora  
where fecha = '20200110'


#cuando todos tengan fecha de cierre estan cerradas
select * from cob_bitacora 
where fecha_apertura = '20200110'
order by municipio

10.9.1.143 entrar por escritorio remoto stop test start  test
10.9.3.143	GLASSFISH	Web service y Cliente de Formas Valoradas	 	 	
USUARIO Administrador	CONTRASEÑA:lmwhiteS254gold1981

#cuales cajas faltan por cerrar
select * from cob_bitacora 
where fecha_apertura = '20200110'
order by municipio



select a.Municipio , a.Oficina , a.caja,a.Usuario_Transaccion, a.Fecha , a.Hora ,a.Transaccion , b.Transaccion 
 from cob_tira_auditora  a left join cob_tira_auditora b on
a.Municipio = b.Municipio  and
a.Oficina = b.Oficina  and
a.Caja =  b.Caja  and 
a.Transaccion != b.Transaccion 
and a.Fecha = b.Fecha 
where a.fecha = '20200110'
and a.Transaccion = 1
order by b.Transaccion



    ###########################estadistica de los cobrado
select Municipio, count(*) as Recibos,Sum(Total) as Recaudado from cob_cobros where Fecha_Pago='20200117' and Estatus='A' and Caja !='99'
--order by Fecha_Pago desc, Hora_Pago desc
group by Municipio
order by Sum(Total) desc


select count(*) as Recibos,Sum(Total) as Recaudado from cob_cobros where Fecha_Pago='20200117' and Estatus='A' and Caja !='99'
--order by Fecha_Pago desc, Hora_Pago desc
--group by Municipio

select * from cob_cobros where Fecha_Pago='20200117' and Caja!='99' and Estatus='A' order by Fecha_Pago desc, Hora_Pago desc;


   METER LOS PAGOS DE ESTE CONTRIBUYENTE
select * from obl_obligacion_vigilable_presentada where No_Operacion='04020175327847'

select rfc,'' as numero_serie, '' as REC, ESTABLECIMIENTO AS Numero_Establecimiento, '010103' as Clave_Obligacion,  periodo,fecha_declarado, no_operacion, '2' as Tipo_Periodo, 'T' as Estado, 'Mn' as Tipo_Presentacion, 
 year(cast(fecha_pago as date)) as ejercicio_fiscal, Lugar as Fuente_Informacion,Municipio, Oficina,'' as Numero_Establecimiento_Anterior
from   ingresos.dbo.respaldo_PDC900503N73 where establecimiento='02001'


select
from   ingresos.dbo.respaldo_PDC900503N73 
where establecimiento='02001'





cinta dorada
tia carmen





hsbc
lizardiw
liza0408



9831412046


Corregir lasemisiones en la fundamentacion 
17236
16147
16158
16163
16168

16181
16192
16199
16206
16212
16218
16225


pagos de leydi
pagos de ilepal


###########que usuarios tienen una opcion mimi
Select * from ingresos.dbo.seg_usuarios 
Select * from ingresos.dbo.seg_usuarios_grupos
Select * From ingresos.dbo.seg_menu where descripcion like '%actas%' 

 
select distinct a.Usuario,b.Nombre,b.Apellido
from seg_usuarios_grupos as a
inner join seg_usuarios as b on a.Usuario=b.Usuario
where a.Grupo in (
Select nombre from ingresos.dbo.seg_permisos where opcion in('01_04_08') group by nombre)
and b.Activado='S'
and b.Municipio='01'




actualizo los requerimientos diligenciados por la app
select * 
from obl_detalle_documentos as a
right join RequerimientosBFC as b on a.rfc=b.rfc 
and a. Movimiento=b.F5 
and a.numero_emision=F4
and a.folio_impresion=b.Requerimientos 
and b.Requerimientos='84912'


update obl_detalle_documentos
set Marcado_app='S'
from RequerimientosBFC as a
inner join obl_detalle_documentos as b on a.rfc=b.rfc 
and a. F5=b.Movimiento
and a.F4=numero_emision
and a.Requerimientos=b.folio_impresion 
and a.Requerimientos='75710'




update obl_detalle_documentos


set Marcado_app='S'
from RequerimientosLRB as a
inner join obl_detalle_documentos as b on a.rfc=b.rfc 
and a. F5=b.Movimiento
and a.F4=numero_emision
and a.Requerimientos=b.folio_impresion 

sp del reporte de los entregados

EXEC     [dbo].[paPadron_App_Reporte_Entregados]
                @Fecha_Inicio = N'01/01/2020',
				 @Fecha_Final = N'20/02/2020'
               
               
               
 72021151147544362              
               
               
               
----------------------------------------------
  ################ insertar los pagos de una obligacion que no entraron por la cobranza        gabo

INSERT INTO obl_obligacion_vigilable_presentada (
        rfc
       ,numero_serie
       ,rec
       ,numero_establecimiento
       ,clave_obligacion
       ,anio_inicial
       ,mes_inicial
       ,fecha_inicial
       ,anio_final
       ,mes_final
       ,fecha_final
       ,fecha_declarado
       ,no_operacion
       ,tipo_periodo
       ,estado
       ,tipo_presentacion
       ,ejercicio_fiscal
       ,fuente_informacion
       ,municipio
       ,oficina
    )  OUTPUT inserted.*
  
	   select
       a.Rfc
       ,''
       ,''
       ,b.Establecimiento
       ,'010106'
       ,year(a.FEcha_inicial)
       ,Month(a.FEcha_inicial)
       ,a.FEcha_inicial
       ,year(a.FEcha_final)
       ,Month(a.FEcha_final)
       ,a.FEcha_final
       ,aa.Fecha_Pago 
       ,aa.No_Operacion 
       ,'2'
       ,'T'
       ,case when (a.Tipo_Declaracion ='C')then 'Co' else 'Mn' end
       ,year(a.FEcha_inicial)
       ,''
       ,aa.municipio
       ,aa.oficina
       from  dec_Extraccion a inner join 
	   cob_cobros aa on aa.referencia = a.referencia inner join
	   dec_extraccion_det_2020 b on a.referencia = b.referencia 
	   where a.FEcha_inicial >= '20200101'

               
               
               
  #### actualiza pagos espontaneos de documentos que ya hayan pagado y no se han marcado           

update  obl_detalle_documentos
set SubStatus=Status, Status='T', usuario_cancelacion='INFO', Fecha_Ultimo_Movimiento=GETDATE()
--select fecha_declarado, fecha_impresion
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and b.periodo_inicial=c.mes_inicial 
and b.Anio_Moroso=c.Anio_Inicial 
and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion   
where --a.municipio='01' 
--and a.oficina='01' and 
a.Movimiento in ('R1')
and b.Clave_Obligacion in ('010102')
and b.Anio_Moroso  ='2020'
--and a.numero_emision='1433' 
--and a.folio_impresion='1616'
and a.fecha_impresion>c.fecha_declarado
and a.Status not in ('P','T','H','L','M','J','S','Y','Z','O','U','W','R','G','F')
and c.RFC is not null
--and a.RFC='SURM670909RG2'


    #### inserto las multas extemporáeas
insert into obl_detalle_documentos
(Municipio, Oficina, Numero_Emision, RFC,Folio_Impresion, Movimiento, Fecha_Ultimo_Movimiento )
select a.Municipio, a.Oficina, a.Numero_Emision, a.RFC,a.Folio_Impresion,'ME', a.Fecha_Ultimo_Movimiento 
from obl_detalle_documentos as	a
inner join obl_control_emisiones as b
on a.numero_emision=b.numero_emision 
and a.municipio=b.municipio 
and a.oficina=b.oficina
left join obl_obligacion_vigilable_presentada as c
on a.RFC=c.RFC 
and b.periodo_inicial=c.mes_inicial 
and b.Anio_Moroso=c.Anio_Inicial 
and b.Clave_Periodicidad=c.Tipo_Periodo
and b.Clave_Obligacion=c.Clave_Obligacion
left join obl_detalle_documentos as e on a.Numero_Emision=e.Numero_Emision and a.Municipio=e.municipio
and a.oficina=e.oficina and e.Movimiento='ME' and a.Folio_Impresion=e.Folio_Impresion 
where --a.municipio='09'and
 e.Folio_Impresion is null 
 --and a.oficina='01' 
--and a.numero_emision='1839' 
--and a.folio_impresion='70187'
and a.movimiento='R1'    
and (a.Fecha_Entrega is not null and a.fecha_entrega<c.fecha_declarado)
and a.status in ('P','T','H')
and b.Anio_Moroso ='2020'
and b.Clave_Obligacion in ('010102')
--and b.numero_emision >'1700'
--and a.rfc='PAHG6410283N6'
group by a.Municipio, a.Oficina, a.Numero_Emision, a.RFC,a.Folio_Impresion, a.Movimiento, a.Fecha_Ultimo_Movimiento

 
reporte que incluye pago de multa de los  
 
 EXEC     [dbo].[paPadron_App_Reporte_Entregados2]
               @Fecha_Inicio = N'01/01/2020',
                @Fecha_Final = N'12/03/2020'
                
                
                
                
                3*5  15
                3*5  15
                3*5  10
                
                
                
                
                
                 según los BOL, "SUM, AVG, COUNT, MAX y MIN omiten los valores NULL; COUNT(*) no permite usar null
                Advertencia: valor NULL eliminado por el agregado u otra operación SET.
                
                
 sp para saber cuales contribuyentes tienen mas establecimientos               
                
insert into obl_excluye_contribuyentes
 (rfc,nombres, no_establecimientos)
select a.RFC,
MIN(c.Nombres) as Nombres,
count(*) as totalEstablecimientos_Activos
from pad_establecimientos as a
inner join pad_obligacionesporestablecimiento as b on a.RFC=b.RFC and a.Numero=b.Numero_Establecimiento
inner join  pad_contribuyentes as c on c.rfc=b.rfc
where b.Clave='010208'
and a.Situacion='Activo'
and b.Situacion='Activo'
group by a.RFC
having count(*) >80
order by totalEstablecimientos_Activos 





CUENTA SAT 
LIRL830804SI8
CTRS:
LIZA0408
50405500 CLAVE PRODUCTO FACTURACIO

##########################a fin de año cambio de año
alimentar el catalogo de cat_periodos_ejercicio


 reporte de morosos estatales 2017 2020         ya incluye la separacion del bimestral ilepal y mensual

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_11052020]

SELECT	'Return Value' = @return_value

GO

  poner los campos nullos en null cuando dan error los campos de fecha

Select isnull(date_column_name,cast('1900-01-01' as DATE)) from table name




[marcar_pagos_espontaneos_estatales_anuales_RFC]





exec [dbo].[ObtenerHistorialPagosContribuyente2] 
	@RFC = N'GEL741008GY9',
		@Rubro = N'010103'
    
    
    
    
    
##reporte de roberto sobre totales de requerimientos generados
    select  
municipio,oficina,numero_emision, folio_impresion--,
-- a.*
--municipio,  oficina, numero_emision, rfc, movimiento, folio_impresion
from obl_detalle_documentos a
where (year(fecha_entrega)='2020' or year(fecha_citatorio)='2020'   or year(fecha_no_localizado)='2020' )
and movimiento in ('R1','R2','R3')
and status in ('E','V','C','N','X','T','P') 
--and Municipio='01'
group by municipio,oficina,numero_emision, folio_impresion
order by municipio,oficina,numero_emision, folio_impresion



select  
municipio,oficina,numero_emision, folio_impresion--,
-- a.*
--municipio,  oficina, numero_emision, rfc, movimiento, folio_impresion
from obl_detalle_documentos a
where (year(fecha_entrega)='2020' or year(fecha_citatorio)='2020'   or year(fecha_no_localizado)='2020' )
and movimiento in ('ME','I1','I2','I3')
and status in ('E','V','C','N','X','T','P') 
--and Municipio='01'
group by municipio,oficina,numero_emision, folio_impresion
order by municipio,oficina,numero_emision, folio_impresion








select  
numero_emision, numero_control--,
 --a.*
--municipio,  oficina, numero_emision, rfc, movimiento, folio_impresion
from sirref_co_documentos a
where (year(fecha_entrega)='2020' or year(fecha_citatorio)='2020'   or year(fecha_no_localizado)='2020' )
and movimiento in ('R1','R2','R3')
and status in ('E','V','C','N','X','T','P') 
--and Municipio='01'
group by  numero_emision, numero_control
order by numero_emision, numero_control



select  
numero_emision, numero_control--,
-- a.*
--municipio,  oficina, numero_emision, rfc, movimiento, folio_impresion
from sirref_co_documentos a
where (year(fecha_entrega)='2020' or year(fecha_citatorio)='2020'   or year(fecha_no_localizado)='2020' )
and movimiento in ('ME','I1','I2','I3')
and status in ('E','V','C','N','X','T','P') 
--and Municipio='01'
group by numero_emision, numero_control
order by numero_emision, numero_control





  #### este codigo ponerlo cuando tengo duda de si el mes me esta llegando bien en los sps de generar multas o marcar pagos
set @mes= REPLICATE('0', 2 - LEN(@mes)) + @mes



####procedimiento almacenado para sp que determina morosidad de los estatales morosos estatales

USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCo_Determina_Morosidad_padron_CPY_Estatales_19022021]

SELECT	'Return Value' = @return_value

GO



##############estadistica de multas vencidas si descomento lo comentado me dice el general

--select clave_obligacion as Concepto, count(*) as Cantidad, sum( gastos_ejecucion+multa_programada) as Monto  from (
select 
a.Referencia,
f.nombre as Municipio,
k.nombre as Municipio_Establecimiento,

a.RFC,
b.Nombres + ' '+ b.Apellido_Materno +' '+b.Apellido_Materno as Nombre ,
h.nombre as Nombre_Establecimiento,
g.Numero_Establecimiento,
c.Clave_Obligacion+' - '+
d.Descripcion  as Clave_Obligacion, 
case c.clave_periodicidad 
when '02' then 'MENSUAL' 
when '03' then 'BIMESTRAL'
when '07' then 'ANUAL'
when '12' then 'INFORMATIVA MENSUAL'
else 'MULTIANUAL'
end as Tipo_Periodo,
case c.Periodo_Inicial 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_Inicial,
case c.periodo_final 
when '' then '--' 
when '00' then 'ANUAL' 
when '01' then 'ENERO' 
when '02' then 'FEBRERO'
when '03' then 'MARZO'
when '04' then 'ABRIL' 
when '05' then 'MAYO'
when '06' then 'JUNIO'
when '07' then 'JULIO' 
when '08' then 'AGOSTO'
when '09' then 'SEPTIEMBRE'
when '10' then 'OCTUBRE' 
when '11' then 'NOVIEMBRE'
when '12' then 'DICIEMBRE'
end as Periodo_final,
c.Anio_Moroso,
a. Numero_Emision, a.Folio_Impresion, 
case a.movimiento when 'R1' then 'Primer Requerimiento'  
 when 'I1' then 'Multa por Incumplimiento'
 when 'I2' then 'Segunda Multa por Incumplimiento'
 when 'I3' then 'Tercera Multa por Incumplimiento'
 when 'ME' then 'Multa por Extemporaneidad'
 else 'ME multiperiodos'
  end as Movimiento,
   Fecha_Entrega , Fecha_Vencimiento ,
Gastos_Ejecucion , Multa_Programada, 'Vencido' as Estatus ,
rtrim(b.Domicilio_Calle)+' '+ rtrim(b.Domicilio_Fiscal_Numero) as Domicilio, 
rtrim(b.Domicilio_Fiscal_Colonia) as Domicilio_Colonia,
REPLACE(REPLACE(Domicilio_Fiscal_Ubicacion,CHAR(10),''),CHAR(13),'') as Domicilio_Fiscal_Ubicacion,


j.descripcion as Giro

from obl_detalle_documentos as a 
join pad_contribuyentes as b on a.RFC=b.RFC 
join obl_control_emisiones as c on a.Numero_Emision =c.Numero_Emision 
and a.Municipio =c.Municipio 
and a.Oficina =c.Oficina and c.Clave_Obligacion not in ('010618','010623','010610')
join cat_obligaciones as d on c.Clave_Obligacion=d.Clave 
left join cob_cobros as e  on a.referencia=e.referencia and e.estatus in ('A','W','T')
join cat_municipios as f on a.municipio=f.clave
join  obl_detalle_sucursales as g on a.numero_emision=g.numero_emision
and a.folio_impresion=g.folio_impresion and a.municipio=g.municipio
and a.oficina=g.oficina
join pad_establecimientos as h on g.Numero_Establecimiento=h.Numero and 
g.RFC=h.rfc
join cat_giros as j  on h.giro=j.clave
join cat_municipios as k on g.municipio=k.clave

where 
a.Municipio ='11'
and 
a.referencia>'1'
--and Movimiento not in('R1','R2','R3')
and Fecha_Vencimiento_Referencia<GETDATE()
and Fecha_Entrega is not null 
and Status not in ('P','T','H','U','Y','O','K')
and e.estatus is null
--and a.rfc=' CEC960902VC0'
and c.Anio_Moroso>'2015'
and a.movimiento!='R1'
--order by a.Municipio ,a.Numero_Emision, Folio_Impresion  


--) as t
--group by clave_obligacion

                                                                   
###mostrar los errores del query 

    mssql_query("set ANSI_NULLS ON ",$enlace);
      mssql_query("set ANSI_WARNINGS ON",$enlace);
   $resultado_notb=mssql_query($_POST['consulta3'], $enlace) or die(mssql_get_last_message());
   
   
  ############## SP para marcar los pagos de nomina mensual 
   [paPagosBanco_GenerarRecibosRubro010103]
   
   axie.com
   
   frasemetamask
   helmet poverty math cloud visa dinner blood fury topic lecture tribe wait
   
    cartera ronin
   curious flip circle congress black base wasp they bubble lumber someone dwarf
   nombre de mi cuenta    axie
   Lunacian #1458719
   
   frase secreta chrome metamask
   cuenta   llizardiro@hotmail.com
   ctrs liza04081
   spawn leaf canvas journey palm parade amused room nasty purse reform subject
   
     lililizardiro@gmail.com
     liza0408
     metamask
     royal dress repeat client sea open dice athlete lawsuit ethics this whip
   
   https://www.coingecko.com/es/monedas/smooth-love-potion
   
   
    --sp para cargar los periodos morosos
   [paCo_cargar_periodos_ejercicio_modificado]
   
   
   
   
   firmante de la  cuenta responsiva
   
   est_cat_cuenta_respons
   
   12 pvu
   
   
   
   
   
   
   
   
   
   
  ###este me servira para generar el previo de los morosos de benito juarez tenencias
   
   USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].[paCO_desglose_morosos_tenencias_previo]
		@Municipio = N'05'

SELECT	'Return Value' = @return_value

GO


7 cons 10 fernando palomo farias


Select Padron.Serie,Padron.An_Construccion,Padron.Fecha_Factura From tenencias.dbo.ten_Padron_Vehicular  as Padron 
	cross apply ( 
	Select top 1 * from ingresos.dbo.cob_cobros 
	where serie=Padron.Serie and 
	Estatus in ('A','T','W') 
	and substring(referencia,1,2)='51' 
	Order by Fecha_Pago Desc
	) as Pagos
   where  Year(pagos.fecha_pago)<year(getdate()) and  Tipo_Servicio   = 1 And (Padron.Situacion_Crit IN(0,7) Or Padron.Situacion_Crit Is Null) And (Padron.Exento_Tenencia = 0 
   Or Padron.Exento_Tenencia Is Null) And Padron.Clase Not In (3) And Padron.Municipio = '02' And (Padron.Estatus <> 9 Or Padron.Estatus Is Null)  And ( Case When Padron.Fecha_Factura Is Null Then 0 Else Year(Padron.Fecha_Factura) End >= Year(GetDate())-13 Or Case 
   When Padron.An_construccion Is Null Then 0 Else Padron.An_Construccion End >= Year(GetDate())-13 ) And ((Padron.Tipo_Combustible = 5 And Padron.An_Construccion < 2009) or Padron.Tipo_Combustible <> 5 ) 




Broxel
lizardi_w@hotmail.com
Liza0408
_Liza04081



--link para replicar un formato de pago del tributanet gabo
https://shacienda.qroo.gob.mx/Tributanet/contribucion/dec_contribucion_control.php?opcion=imprimir&Referencia=72022997548089710

coingecko
usuario: lizardi_w@hotmail.com
ctrs: 8972H8972

radar mensajes monedas
https://cryptoradar.co/price-alerts
 
usuario: lizardi_w@hotmail.com
ctrs: 8972H8972



83

cambio de pin de huawei 356511 del reloj    pago tarjeta bnt


  #### generar el listado de invitaciones enviadas  carlos gerardo
EXEC [dbo].[paResumenInvitacionesEstatales] 
'20211201', '20211231' 

correo eduardo lizardi diaz
eduardolizardidiaz@gmail.com
liza0408


crear campos en word con la captura en formato formulario
https://www.youtube.com/watch?v=cFl6Oidsq0Y

usar \* CHARFORMAT para que mantenga el formato TAMAÑO DE LETRA NEGRITAS ETC
{REF COLONIA \* CHARFORMAT}




front end
css
responsive
flexbox y grid
preprocesador css - less stylus  sass
css grid layout
bootstrap 4
maquetacion web
jscript
jquery
angular reac vue

#########REFERENCIAS CSS
 
###fuentes de google
https://fonts.google.com/

####CSS colores
https://www.w3schools.com/cssref/css_colors.asp
https://www.google.com/search?client=firefox-b-d&q=color+picker

### css3 generador de codigo css
https://www.toptal.com/developers/css3maker/index.html


##fuente para poner los symbolos en css
.gear, .icon{
    font-family: "WebSymbolsRegular";
}



9983511662


###ejecutar dentro del directorio en linea de comandos
ejecutar sass 
sass --watch estilos.scss styles.css


medidas definidas por bootstrap para hacer los cambios del responsive
Available breakpoints
Bootstrap includes six default breakpoints, sometimes referred to as grid tiers, for building responsively. These breakpoints can be customized if youre using our source Sass files.

Breakpoint	Class infix	Dimensions
X-Small	None	<576px
Small	sm	=576px
Medium	md	=768px
Large	lg	=992px
Extra large	xl	=1200px
Extra extra large	xxl	=1400px
// X-Small devices (portrait phones, less than 576px)
// No media query for `xs` since this is the default in Bootstrap
media querys para bootstrap y los dispositivos
// X-Small devices (portrait phones, less than 576px)
@media (max-width: 575.98px) { ... }

// Small devices (landscape phones, less than 768px)
@media (max-width: 767.98px) { ... }

// Medium devices (tablets, less than 992px)
@media (max-width: 991.98px) { ... }

// Large devices (desktops, less than 1200px)
@media (max-width: 1199.98px) { ... }

// X-Large devices (large desktops, less than 1400px)
@media (max-width: 1399.98px) { ... }

// XX-Large devices (larger desktops)
// No media query since the xxl breakpoint has no upper bound on its width

incluir en el head para que se lea bien los navegadores
<meta name="viewport" content="width=device-width, user-scalable=no">


##habilita o deshabilita una seccion en el frame
<nav id="menu" class="col-12 bg-secondary text-white
        d-sm-none d-md-block "> <!--d-sm-none(deshabilita en pantalla sm) d-md-block (habilita la opcion en tamaño mediano)-->
        
####etiquetas a usar en HTML en ligar de DIV        
<header>        
<main>
<h1>
<nav>
<section>
<footer>
<aside>
        ##circulo y borde
<div class="caja w-50 h-50 border border-success rounded-circle"><!--border circulo-->        

ecmac6 typescript
 jumbotron en css 5
.jumbotron {
    padding: 2rem 1rem;
    margin-bottom: 2rem;
    background-color: #e9ecef;
    border-radius: .3rem;
}


   .ficha{
            border: 2px solid black;
            background: white;
            margin: 15px auto;/*centrar la caja*/
            padding: 15px;
            width:250px;
        }
  ///contenedor
 #container{
    width:90%;
    height: auto;
    margin: 0px auto;
    border: 1px solid rgba(225, 225, 226, 0.8);
    box-shadow: 0px 0px 10px #ccc;
    margin-top: 40px;
    margin-bottom: 40px;
    min-height: 600px;
}

        udemy 
        lizardi_w@hotmail.com
        Liza0408
        
        
        
        
   ##########/*ejecutar un funcion en php desde href*/     
        
             <?php
                function myFunction() {
    echo 'Have a great day'.'<br>';
 }
if (isset($_GET['name'])) {
    myFunction();
}
?>
<a href='imprime_requerimientos2_federales_pdf.php?name=true'>Execute PHP Function</a>

<?php
    exit();
            ?>    
            
            
            
  #### custom properties variables en CSS
  
  :root{
  --borders-colors:7px dashed black;
  }
  
  
  .title{
    border: var(--bordes-colors);//aplicar el nombre de la variable declarada arriba
    color:royalblue;
  }
  
  
  
  LINK PARA EL CURSO            
  RIESGO DE TRABAJO
  https://videoconferencia.telmex.com/j/1240938850
  
  PREVENCION DE ADICCIONES
  https://videoconferencia.telmex.com/j/1248318604
  
  
  #######poner defer para no tener que poner el script despues del html e incluir los JS en el head 
  Los scripts marcados con deferse ejecutan justo después del evento domInteractive, que ocurre después de que el HTML se carga, analiza y se monta el DOM. Una vez hecho esto, el navegador emitirá el evento domComplete y luego onLoad.
  
  
  
     <!--marcar todos los checkbox-->
  
  <input type="checkbox" onClick="toggle(this)" /> Toggle All<br/>

<input type="checkbox" name="foo" value="bar1"> Bar 1<br/>
<input type="checkbox" name="foo" value="bar2"> Bar 2<br/>
<input type="checkbox" name="foo" value="bar3"> Bar 3<br/>
<input type="checkbox" name="foo" value="bar4"> Bar 4<br/>

 <SCRIPT LANGUAGE = "JavaScript">
       function toggle(source) {
  checkboxes = document.getElementsByName('files[]');
  for(var i=0, n=checkboxes.length;i<n;i++) {
    checkboxes[i].checked = source.checked;
  }
}
  </SCRIPT>




  #########################BUENAS PRACTICA PARA EVITAR SER JAQUEADO DESDE LA URL POR GET 
  
  <?php
include 'conexion.php';
if($_SERVER['REQUEST_METHOD']== 'POST')   //pARA EVITAR SER JAQUEADO DESDE LA URL POR GET 
{
     $producto = $_POST['producto'];
    $precio = htmlentities($_POST['precio']);  //elimina caracteres raros 
    $cantidad = $con->real_escape_string(htmlentities(($_POST['cantidad'])));   //evita el sql injection
    echo $producto.$precio.$cantidad;
}else{
    header("location:index.php");
}

?>


############step redondeo que permita ingresar decimales en un entero
<div class="form-group">
           <input type="number" name="precio" placeholder="Precio" step="0.01" class="form-control">
</div>



################
<form id="formRegistro" autocomplete="off" @submit.prevent="registro" enctype="multipart/form-data"><!--enctype="multipart/form-data" poner esto si se van a enviar imagenes en un formulario siempre en un form-->



imprimir en tributanet
XAXX010101000
Ab123456*




##################
validar un email en vue    js
validEmail: function (email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
        }



#################### descargar el post en variables desde un ciclo php

foreach ($_POST as $campo => $valor){
    $var = "$".$campo."='".$valor."';";
    eval($var);
}



alertas cutes de javascript
https://sweetalert.js.org/guides/
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> en el footer poner este include



################ los que mas pagan top de 43 es hospedaje nomina es 41     cobranza pagos
select top 1000 RFC, Nombre, sum(b.Principal+b.Actualizacion+b.Recargos+b.Multa+b.Gastos_Ejecucion+b.Honorarios_Notificacion) as Suma 
from cob_cobros as a inner join cob_desglose as b
on a.No_Operacion=b.No_Operacion 
where a.Estatus in ('A','B') 
and Year(a.Fecha_Pago)=2020 and SUBSTRING(a.Referencia,1,2)='43'
group by RFC,Nombre
order by Suma desc

para revisar conceptos ir a cob_tipos_referencias

    sp hospedaje
USE [ingresos]
GO

DECLARE	@return_value int

EXEC	@return_value = [dbo].pa_Rep_Obtiene_Top100_Hospedaje_importe
		@Ejercicio = 2021


SELECT	'Return Value' = @return_value

GO


    sp nomina
pa_Rep_Obtener_Top100_Nomina_importe

npm run dev        arrancar el server

host gratuito
https://mex.000webhost.com/#feature-table


host gratuito
https://mex.000webhost.com/members/website/list
sitio web
usuario: lizardi_w@hotmail.com
Liza0408



snnipets
m5oX24ghARIYn!wKqPA!

base de datos
nombre bs :cdnvue
user name :snippets
contraseña: Liza0408hars1222>

DB Name  :
id19423191_cdnvue
DB User   :
id19423191_snippets



spotify 
lizardi_w@hotmail.com


estado de cuenta 
https://nvoedocta.fovissste.com.mx/Account/Login.aspx?ReturnUrl=%2f
LIRL830804MVZZDL07
Flkup4212


LIZARDI RODRIGUEZ LILI
LIRL830804S18
CIRCUITO TUCAN, NUM. EXT. 919, MANZANA 227, LOTE 35, PLANTA BAJA COL. RESIDENCIAL SIAN KA AN II DEL./MUN. OTHON P BLANCO ENT. QUINTANA ROO C.P. 77086el post 


##################generar un json desde php 
http://localhost:8000/snippets/api/crud/getcategoria.php?cat=mysql
   mysql
<?php
include '../conexion.php';
$cat= $con->real_escape_string(htmlentities($_GET['cat']));
$temporal = array();
$resultado = array ();

$sel = $con->query("SELECT * FROM snippets WHERE categoria = '$cat'");


while($f = $sel->fetch_assoc()){
    $temporal = $f;
    array_push($resultado,$temporal);
}
echo json_encode($resultado);
?>

----------------------------------
sql server
<?php           
header('Access-Control-Allow-Origin: *');
    
   include '../includes/enlace_ingresos_inc.php';
$query = "select * from cat_municipios"   ;
$result=mssql_query($query ,$enlace );

  $i=0;
while ($fila=mssql_fetch_assoc($result))
{
$filas[$i] =$fila;
$i++;
}
;
echo json_encode($filas);

?>          







######themes gratuitos 
https://adminlte.io/themes/v3/index2.html



#############crear un proyecto nuevo en vue web pack cli

C:\Users\SATQ60>cd C:\Users\SATQ60\Desktop\ejemplo-webpack

C:\Users\SATQ60\Desktop\ejemplo-webpack>vue init webpack

? Generate project in current directory? Yes
"git" no se reconoce como un comando interno o externo,
programa o archivo por lotes ejecutable.
? Project name mi-proyecto-webpack
? Project description primer proyecto con webpack y vue
? Author
? Vue build standalone
? Install vue-router? Yes
? Use ESLint to lint your code? Yes
? Pick an ESLint preset Standard
? Set up unit tests No
? Setup e2e tests with Nightwatch? No
? Should we run `npm install` for you after the project has been created? (recommended) npm

   vue-cli · Generated "ejemplo-webpack".


   C:\Users\SATQ60\Desktop\ejemplo-webpack>npm run dev



     ############ componente vue lo basico para crear uno
     
<template>
  <p>Mi primer componente en Vue</p>
</template>

<script>
  export default {
    name: "MiComponente"
  }
</script>

<style lang="scss" scoped>
</style>



-------------------------------
#########requerimientos entregados , diligenciados, generados solo ME

	select min(municipio) as Municipio, sum (Diligenciados) as Diligenciados,sum(Entregados) as Entregados,sum(emitidos)	 as Total, sum(TotalImporte	   ) as TotalImporte, 
	sum(Total_Por_Pagar) as Total_Por_Pagar
	from (
select t.Municipio, t.Oficina, t.Clave_Obligacion, t.Obligacion, Numero_Emision, t.Dirigida, 
		t.Periodo_Inicial, t.Periodo_Final, t.Anio_Moroso,
		t.Total as Emitidos, t.Impreso as Impresos,( t.Entregado+t.No_Localizado+t.Doble_No_Localizado+t.Declaracion_en_Ceros
		+t.Cambio_Periodo+t.Resolucion_Juridica
		 +t.Solventado_por_Insolvencia+t.Baja+t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa
		 +t.Contribuyente_Solidario+t.Aviso_RFC)
		 as Diligenciados, t.Entregado as Entregados, 
		t.Pagado+t.Pago_Honorarios as Pagados, t.Pago_Espontaneo as Pagos_Espontaneos
		,TotalImporte, Total_Por_Pagar
		from 
(
SELECT
		b. Municipio,
		b.Oficina,
		b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               a.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN ( a.Fecha_Impresion is null and a.Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado,
               SUM(CASE WHEN (a.Fecha_Entrega is null and a.Status in ('D')) THEN 1 ELSE 0 END) AS Pendiente,
              -- SUM(CASE WHEN (a.Status in ('C')) THEN 1 ELSE 0 END) AS Citatorio, 
	          SUM(CASE WHEN (a.Fecha_Citatorio is not null) THEN 1 ELSE 0 END) AS Citatorio, 
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Entregado,
               SUM(CASE WHEN (a.Status in ('V')) THEN 1 ELSE 0 END) AS Vencido,
		SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('N')) THEN 1 ELSE 0 END) AS No_Localizado,
               SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('X')) THEN 1 ELSE 0 END) AS Doble_No_Localizado,
               SUM(CASE WHEN (a.Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado,
               SUM(CASE WHEN (a.Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo,
               SUM(CASE WHEN (a.Status in ('H'))  THEN 1 ELSE 0 END) AS Pago_Honorarios,
               SUM(CASE WHEN (a.Status in ('L'))  THEN 1 ELSE 0 END) AS Declaracion_en_Ceros,
               SUM(CASE WHEN (a.Status in ('M'))  THEN 1 ELSE 0 END) AS Cambio_Periodo,
               SUM(CASE WHEN (a.Status in ('J'))  THEN 1 ELSE 0 END) AS Resolucion_Juridica,
               SUM(CASE WHEN (a.Status in ('S'))  THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia,
               SUM(CASE WHEN (a.Status in ('Y'))  THEN 1 ELSE 0 END) AS Baja,
               SUM(CASE WHEN (a.Status in ('Z'))  THEN 1 ELSE 0 END) AS Suspension_Actividades,
               SUM(CASE WHEN (a.Status in ('O'))  THEN 1 ELSE 0 END) AS Sin_Obligacion,
               SUM(CASE WHEN (a.Status in ('U'))  THEN 1 ELSE 0 END) AS Pago_Multa,
               SUM(CASE WHEN (a.Status in ('W'))  THEN 1 ELSE 0 END) AS Contribuyente_Solidario,
               SUM(CASE WHEN (a.Status in ('R'))  THEN 1 ELSE 0 END) AS Aviso_RFC
			   ,	   sum(e.total) as TotalImporte,
			   sum(a.total) as Total_Por_Pagar
			   FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
			   left join cob_cobros as e  on a.referencia=e.referencia and e.estatus in ('A','W')
               where a.Movimiento in ('ME','M1','M2','M3') and 
			   --b.Clave_Obligacion='010623' and 
			  -- b.Municipio='01' and b.Oficina='01' and  
			     --e.Referencia='72070220968255848' and
               year(a.Fecha_Impresion )='2022'--and a.Movimiento='R1' and a.fec
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision ,c.Descripcion 	   
) as t) as S
group by municipio--, clave_obligacion
order by  Municipio--,t.Clave_Obligacion,t.Numero_Emision 


		/*	   select e.total	  
			   FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
			   left join cob_cobros as e  on a.referencia=e.referencia and e.estatus in ('A','W')
               where a.Movimiento in ('ME','M1','M2','M3') and 
			   --b.Clave_Obligacion='010623' and 
			  -- b.Municipio='01' and b.Oficina='01' and  
               year(a.Fecha_Impresion )='2022'--and a.Movimiento='R1' and a.fec
			   and e.Referencia='72070220968255848'
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision ,c.Descripcion */



      #########requerimientos entregados , diligenciados, generados solo R1 incluyendo requerimientos R1, R2 y R3
			   
	select min(municipio) as Municipio, sum (Diligenciados) as Diligenciados,sum(Entregados) as Entregados,sum(emitidos)	 as Total	 , sum(TotalImporte	   ) as TotalImporte, 
	sum(Total_Por_Pagar) as Total_Por_Pagar  
	from (
select t.Municipio, t.Oficina, t.Clave_Obligacion, t.Obligacion, Numero_Emision, t.Dirigida, 
		t.Periodo_Inicial, t.Periodo_Final, t.Anio_Moroso,
		t.Total as Emitidos, t.Impreso as Impresos,( t.Entregado+t.No_Localizado+t.Doble_No_Localizado+t.Declaracion_en_Ceros
		+t.Cambio_Periodo+t.Resolucion_Juridica
		 +t.Solventado_por_Insolvencia+t.Baja+t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa
		 +t.Contribuyente_Solidario+t.Aviso_RFC)
		 as Diligenciados, t.Entregado as Entregados, 
		t.Pagado+t.Pago_Honorarios as Pagados, t.Pago_Espontaneo as Pagos_Espontaneos
		,TotalImporte, Total_Por_Pagar
		 from 
(
SELECT
		b. Municipio,
		b.Oficina,
		b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               a.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN ( a.Fecha_Impresion is null and a.Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado,
               SUM(CASE WHEN (a.Fecha_Entrega is null and a.Status in ('D')) THEN 1 ELSE 0 END) AS Pendiente,
               --SUM(CASE WHEN (a.Status in ('C')) THEN 1 ELSE 0 END) AS Citatorio, 
	       SUM(CASE WHEN (a.Fecha_Citatorio is not null) THEN 1 ELSE 0 END) AS Citatorio, 
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Entregado,
               SUM(CASE WHEN (a.Status in ('V')) THEN 1 ELSE 0 END) AS Vencido,
		SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('N')) THEN 1 ELSE 0 END) AS No_Localizado,
               SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('X')) THEN 1 ELSE 0 END) AS Doble_No_Localizado,
               SUM(CASE WHEN (a.Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado,
               SUM(CASE WHEN (a.Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo,
               SUM(CASE WHEN (a.Status in ('H'))  THEN 1 ELSE 0 END) AS Pago_Honorarios,
               SUM(CASE WHEN (a.Status in ('L'))  THEN 1 ELSE 0 END) AS Declaracion_en_Ceros,
               SUM(CASE WHEN (a.Status in ('M'))  THEN 1 ELSE 0 END) AS Cambio_Periodo,
               SUM(CASE WHEN (a.Status in ('J'))  THEN 1 ELSE 0 END) AS Resolucion_Juridica,
               SUM(CASE WHEN (a.Status in ('S'))  THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia,
               SUM(CASE WHEN (a.Status in ('Y'))  THEN 1 ELSE 0 END) AS Baja,
               SUM(CASE WHEN (a.Status in ('Z'))  THEN 1 ELSE 0 END) AS Suspension_Actividades,
               SUM(CASE WHEN (a.Status in ('O'))  THEN 1 ELSE 0 END) AS Sin_Obligacion,
               SUM(CASE WHEN (a.Status in ('U'))  THEN 1 ELSE 0 END) AS Pago_Multa,
               SUM(CASE WHEN (a.Status in ('W'))  THEN 1 ELSE 0 END) AS Contribuyente_Solidario,
               SUM(CASE WHEN (a.Status in ('R'))  THEN 1 ELSE 0 END) AS Aviso_RFC
			    ,	   sum(e.total) as TotalImporte,
			   sum(a.total) as Total_Por_Pagar
			   FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
			    left join cob_cobros as e  on a.referencia=e.referencia and e.estatus in ('A','W')
               where --a.Movimiento='R1' and 
			   --b.Clave_Obligacion='010623' and 
			  -- b.Municipio='01' and b.Oficina='01' and  
              year(a.Fecha_Impresion)='2022' and a.Movimiento in ('R1','R2','R3') and fecha_asignacion is not null
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision ,c.Descripcion 	   
) as t) as S
group by municipio--, clave_obligacion
order by  Municipio--,t.Clave_Obligacion,t.Numero_Emision 


       
			  ##este incluye lo generado en ese ejercicio fiscal el otro todo lo generado incluyendo requerimientos R1, R2 y R3 
	select min(municipio) as Municipio, sum (Diligenciados) as Diligenciados,sum(Entregados) as Entregados,sum(emitidos)	 as Total	 , sum(TotalImporte	   ) as TotalImporte, 
	sum(Total_Por_Pagar) as Total_Por_Pagar  
	from (
select t.Municipio, t.Oficina, t.Clave_Obligacion, t.Obligacion, Numero_Emision, t.Dirigida, 
		t.Periodo_Inicial, t.Periodo_Final, t.Anio_Moroso,
		t.Total as Emitidos, t.Impreso as Impresos,( t.Entregado+t.No_Localizado+t.Doble_No_Localizado+t.Declaracion_en_Ceros
		+t.Cambio_Periodo+t.Resolucion_Juridica
		 +t.Solventado_por_Insolvencia+t.Baja+t.Suspension_Actividades+t.Sin_Obligacion+t.Pago_Multa
		 +t.Contribuyente_Solidario+t.Aviso_RFC)
		 as Diligenciados, t.Entregado as Entregados, 
		t.Pagado+t.Pago_Honorarios as Pagados, t.Pago_Espontaneo as Pagos_Espontaneos
		,TotalImporte, Total_Por_Pagar
		 from 
(
SELECT
		b. Municipio,
		b.Oficina,
		b.Clave_Obligacion as Clave_Obligacion,
               c.Descripcion as Obligacion,
               a.Numero_Emision,
               min(b.Fecha_Emision) as Fecha_Emision,
               min(b.Dirigida) as Dirigida,
               min(b.Periodo_Inicial) as Periodo_Inicial,
               min(b.Periodo_Final) as Periodo_Final,
               min(b.anio_moroso) as Anio_Moroso,
               SUM(CASE WHEN a.Status is not null THEN 1 ELSE 0 END) AS	Total,
               SUM(CASE WHEN ( a.Fecha_Impresion is null and a.Status in ('B')) THEN 1 ELSE 0 END) AS No_Impreso,
               SUM(CASE WHEN (a.Fecha_Impresion is not null ) THEN 1 ELSE 0 END) AS Impreso,
               SUM(CASE WHEN (a.Fecha_Asignacion is not null) THEN 1 ELSE 0 END) AS Asignado,
               SUM(CASE WHEN (a.Fecha_Entrega is null and a.Status in ('D')) THEN 1 ELSE 0 END) AS Pendiente,
               --SUM(CASE WHEN (a.Status in ('C')) THEN 1 ELSE 0 END) AS Citatorio, 
	       SUM(CASE WHEN (a.Fecha_Citatorio is not null) THEN 1 ELSE 0 END) AS Citatorio, 
               SUM(CASE WHEN (a.Fecha_Entrega is not null) THEN 1 ELSE 0 END) AS Entregado,
               SUM(CASE WHEN (a.Status in ('V')) THEN 1 ELSE 0 END) AS Vencido,
		SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('N')) THEN 1 ELSE 0 END) AS No_Localizado,
               SUM(CASE WHEN (a.Fecha_No_Localizado is not null and a.Status in ('X')) THEN 1 ELSE 0 END) AS Doble_No_Localizado,
               SUM(CASE WHEN (a.Status in ('P'))  THEN 1 ELSE 0 END) AS Pagado,
               SUM(CASE WHEN (a.Status in ('T'))  THEN 1 ELSE 0 END) AS Pago_Espontaneo,
               SUM(CASE WHEN (a.Status in ('H'))  THEN 1 ELSE 0 END) AS Pago_Honorarios,
               SUM(CASE WHEN (a.Status in ('L'))  THEN 1 ELSE 0 END) AS Declaracion_en_Ceros,
               SUM(CASE WHEN (a.Status in ('M'))  THEN 1 ELSE 0 END) AS Cambio_Periodo,
               SUM(CASE WHEN (a.Status in ('J'))  THEN 1 ELSE 0 END) AS Resolucion_Juridica,
               SUM(CASE WHEN (a.Status in ('S'))  THEN 1 ELSE 0 END) AS Solventado_por_Insolvencia,
               SUM(CASE WHEN (a.Status in ('Y'))  THEN 1 ELSE 0 END) AS Baja,         SUM(CASE WHEN (a.Status in ('Z'))  THEN 1 ELSE 0 END) AS Suspension_Actividades,
               SUM(CASE WHEN (a.Status in ('O'))  THEN 1 ELSE 0 END) AS Sin_Obligacion,
               SUM(CASE WHEN (a.Status in ('U'))  THEN 1 ELSE 0 END) AS Pago_Multa,
               SUM(CASE WHEN (a.Status in ('W'))  THEN 1 ELSE 0 END) AS Contribuyente_Solidario,
               SUM(CASE WHEN (a.Status in ('R'))  THEN 1 ELSE 0 END) AS Aviso_RFC
			    ,	   sum(e.total) as TotalImporte,
			   sum(a.total) as Total_Por_Pagar
			   FROM obl_detalle_documentos as a 
               inner join obl_control_emisiones as b on a.Numero_Emision=b.Numero_Emision and a.Municipio=b.Municipio  
               and a.Oficina=b.Oficina
               left join cat_obligaciones as c on b.Clave_Obligacion=c.Clave
			    left join cob_cobros as e  on a.referencia=e.referencia and e.estatus in ('A','W')
               where --a.Movimiento='R1' and 
			   --b.Clave_Obligacion='010623' and 
			  -- b.Municipio='01' and b.Oficina='01' and  
              b.Ejercicio_Fiscal='2022' and a.Movimiento in ('R1') and fecha_asignacion is not null
               group by b.Municipio, b.Oficina,b.Clave_Obligacion,a.Numero_Emision ,c.Descripcion 	   
) as t) as S
group by municipio--, clave_obligacion
order by  Municipio--,t.Clave_Obligacion,t.Numero_Emision 



           ###########insertar la imagen en VUe

               <img class="stickerOne" src="./scotch.png" alt="Pegatina">
                <img class="stickerTwo" src="./scotch.png" alt="Pegatina">
           
           
           
           ####date para volver a cargar el css 
           <?php echo date("H:i:s");?>
           
           ####estilo para los campos de texto
           style=' background: #C2C2C2;
   border: 0px;
   border-radius: 1px 1px 1px 1px;
   color: #393939;
   font-size: 12px;
   padding: 5px; ' 
   
   
   
    ##background text
   background-color: rgba(172, 91, 30, 0.1) 
   
   
   
   
   ################### EVENTOS JAVASCRIPT
    onchange	An HTML element has been changed
    onclick	The user clicks an HTML element
    onmouseover	The user moves the mouse over an HTML element     <div onmouseover="this.style.backgroundColor='red'">myDIV.</div>
    onmouseout	The user moves the mouse away from an HTML element
    onkeydown	The user pushes a keyboard key
    onload	The browser has finished loading the page
    
    
    
    
    #############imprimir un array Javascript
    <!DOCTYPE html>
<html>
<body>

<h2>JavaScript Array.forEach()</h2>
<p>Calls a function once for each array element.</p>

<p id="demo"></p>

<script>
const numbers = [45, 4, 9, 16, 25];

let txt = "";
numbers.forEach(myFunction);
document.getElementById("demo").innerHTML = "<ul>"+txt+"</ul>";

function myFunction(value, index, array) {
  txt += "<li>" +value+"</li>"; 
}
</script>

</body>
</html>


<html>
<body>
<h2>JavaScript Sets</h2>
<p>forEach() calls a function for each element:</p>

<p id="demo"></p>

<script>
// Create a Set
const letters = new Set(["a","b","c"]);

// List all Elements
let text = "";
letters.forEach (function(value) {
  text += value + "<br>";
})

document.getElementById("demo").innerHTML = text;
</script>

</body>
</html>

###desaparecer el elemento     javascript
<button onclick="this.style.display='none'">Click to Remove Me!</button>


  ###funciones de flecha   javascript
Arrow Function With Parameters:
hello = (val) => "Hello " + val;

In fact, if you have only one parameter, you can skip the parentheses as well:

Arrow Function Without Parentheses:
hello = val => "Hello " + val;


####objeto javascript
const person = {
  firstName: "John",
  lastName: "Doe",
  age: 50,
  eyeColor: "blue"
};

const person = {firstName:"John", lastName:"Doe", age:50, eyeColor:"blue"};



###otro objeto
<h2>JavaScript Objects</h2>
<p>Object.values() converts an object to an array.</p>

<p id="demo"></p>

<script>
const person = {
  name: "John",
  age: 30,
  city: "New York"
};

document.getElementById("demo").innerHTML = Object.values(person);
</script>


###########bootstrap
<link rel="stylesheet" type="text/css" href="../estilos/bstp/bootstrap/css/bootstrap.min.css"/>


 #########accesar al dom via variable
<p>If you expect to access a DOM element several times, access it once, and the use it as a local variable:</p>

<p id="demo"></p>

<script>
const obj = document.getElementById("demo");
obj.innerHTML = " Hello";
</script>



#################insertar codigo html o texto en javascript    innerText  innerHTML      textContent
   <script>
function getinnerText() {
  let text = document.getElementById("myP").innerText;
  document.getElementById("demo").innerText = text;
}

function getinnerHTML() {
  let text = document.getElementById("myP").innerHTML;
  document.getElementById("demo").innerText = text;
}

function gettextContent() {
  let text = document.getElementById("myP").textContent;
  document.getElementById("demo").innerText = text;
}
</script>

   473923654 

HTML Example
<p id="myP">   This element has extra spacing     and contains <span>a span element</span>.</p>
JavaScript Examples
let text = document.getElementById("myP").innerText;

let text = document.getElementById("myP").innerHTML;

let text = document.getElementById("demo").textContent;
 
 
 
 resultado:

The innerText property returns:
This element has extra spacing and contains a span element.
The innerHTML property returns:
   This element has extra spacing    and contains <span>a span element</span>.
The textContent property returns:
   This element has extra spacing    and contains a span element.
   
   
    ###insertar elementos javascript directo desde los eventos
   <h2 onclick="this.innerHTML='Ooops!'" onmouseover="this.innerHTML='Bye!'">Click on this text!</h2>
   
   
   <h2 onclick="changeText(this)">Click on this text!</h2>

<script>
function changeText(id) {
  id.innerHTML = "<h1>Ooops!</h1>";
}
</script>


            ########eventos del DOM
https://www.w3schools.com/jsref/dom_obj_event.asp





GNP seguro auto mazda

https://www.gnp.com.mx/soy-cliente#!/mi-perfil
cliente: 0088335357
lizardi_w@hotmail.com
ctrseña
Liza0408






<h2>JavaScript Prompt</h2>

<button onclick="myFunction()">Try it</button>

<p id="demo"></p>

<script>
function myFunction() {
  let text;
  let person = prompt("Please enter your name:", "Harry Potter");
  if (person == null || person == "") {
    text = "User cancelled the prompt.";
  } else {
    text = "Hello " + person + "! How are you today?";
  }
  document.getElementById("demo").innerHTML = text;
}
</script>




<h2>JavaScript Validation</h2>  validar un numero maximo y minimo

<p>Enter a number and click OK:</p>

<input id="id1" type="number" min="100" max="300" required>
<button onclick="myFunction()">OK</button>

<p>If the number is less than 100 or greater than 300, an error message will be displayed.</p>

<p id="demo"></p>

<script>
function myFunction() {
  const inpObj = document.getElementById("id1");
  if (!inpObj.checkValidity()) {
    document.getElementById("demo").innerHTML = inpObj.validationMessage;
  } else {
    document.getElementById("demo").innerHTML = "Input OK";
  } 
} 
</script>

         ######segunda validacion
<input id="id1" type="number" max="100">
<button onclick="myFunction()">OK</button>

<p id="demo"></p>

<script>
function myFunction() {
  let text = "Value OK";
  if (document.getElementById("id1").validity.rangeOverflow) {
    text = "Value too large";
  }
}
</script>


#####cambiar el color del puntero
<style scoped>
input{
  caret-color: deeppink;
}
</style>

 ##input redondeado y con borde exterior
<style scoped>
input{
  border-radius: 10px;
  background-color: rgb(167, 9, 88);
  caret-color:  rgb(167, 9, 88);
  outline: 3px solid rgb(167, 9, 88);
  outline-offset: 3px;
  color: rgb(253, 253, 251);
  
}
::placeholder {
  color: rgb(223, 189, 221);
  font-size: 1em;
}
</style>



firebase
llizardiro@gmail.com
Liza04081

bdliza0408 proyecto




######## marcar los requerimientos  que se no se han marcado    ejecutar periodicamente

 
update obl_detalle_documentos
set status='U', Fecha_Ultimo_Movimiento=getdate(), usuario_cancelacion='INFO'
from obl_detalle_documentos as a                                                                                                                             
join cob_cobros as b on a.referencia=b.referencia and a.rfc=b.rfc
where --a.referencia='72024996758461121'and 
a.status not in ('P','T','H','U') and a.municipio='12'
and movimiento='R1'
and Numero_Emision >='1801'
and estatus in ('a' ,'w')
and a.total=b.total




##crear un crud a firebase 
https://arduinoes.github.io/VueFirestore/vue/#template-formulario

    v-model

<input type="text" v-model="title" >

<script>
export default {
  name: "MiComponente",
  data: () => ({
    title: ""
  }) 
};
</script>